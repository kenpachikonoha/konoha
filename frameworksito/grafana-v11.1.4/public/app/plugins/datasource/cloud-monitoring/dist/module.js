define(["lodash","@grafana/data","@grafana/runtime","@emotion/css","react","@grafana/ui","rxjs"],((e,t,r,n,a,o,i)=>(()=>{var l={872:(e,t,r)=>{var n=r(781),a=r(7),o=r(959),i=r(241),l=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(o);const c="jwt",s="gce",u="Paste JWT button",p="Upload JWT button",y=["private_key","token_uri","client_email","project_id"],d=({onChange:e,showConfigEditor:t,showPaste:r,showUpload:n,isPasting:i,isUploading:c})=>{const[s,y]=o.useState(),d=a.useTheme2(),f=o.useCallback((e=>{y(null),r()}),[r]),b=o.useCallback((e=>{n(),y(null)}),[n]),v=o.useCallback((r=>{if(""!==r.trim()){let n;try{n=JSON.parse(r)}catch(e){y("Invalid JWT token")}const a=m(n);a.isValid?(t(),e({privateKey:n.private_key,tokenUri:n.token_uri,clientEmail:n.client_email,projectId:n.project_id})):y(a.error)}}),[y,e,t]);return l.default.createElement(l.default.Fragment,null,l.default.createElement(a.Field,{label:"JWT token",invalid:Boolean(s),description:i?"Paste JWT token below":"Upload or paste Google JWT token",error:s},l.default.createElement(l.default.Fragment,null,c&&l.default.createElement("div",{"data-testid":"Configuration drop zone"},a.FileDropzone&&l.default.createElement(a.FileDropzone,{options:{multiple:!1,accept:".json"},readAs:"readAsText",onLoad:e=>{v(e)}},l.default.createElement("p",{style:{margin:0,fontSize:`${d.typography.h4.fontSize}`,textAlign:"center"}},"Drop the Google JWT file here",l.default.createElement("br",null),l.default.createElement("br",null),l.default.createElement(a.Button,{fill:"outline"},"Click to browse files")))),i&&l.default.createElement(a.TextArea,{"data-testid":"Configuration text area",autoFocus:!0,invalid:Boolean(s),placeholder:"Paste Google JWT token here",onBlur:e=>v(e.currentTarget.value),rows:12}))),!i&&l.default.createElement(l.default.Fragment,null,l.default.createElement(a.Button,{"data-testid":u,type:"button",fill:"outline",style:{color:`${d.colors.primary.text}`},onClick:f},"Paste JWT Token"),l.default.createElement("span",{style:{paddingRight:"10px",paddingLeft:"10px"}},"or")),i&&l.default.createElement(l.default.Fragment,null,l.default.createElement(a.Button,{"data-testid":p,type:"button",fill:"outline",style:{color:`${d.colors.primary.text}`},onClick:()=>{n()}},"Upload JWT Token"),l.default.createElement("span",{style:{paddingRight:"10px",paddingLeft:"10px"}},"or")),l.default.createElement(a.Button,{"data-testid":"Fill JWT info manually",type:"button",fill:"outline",style:{color:`${d.colors.primary.text}`},onClick:t},"Fill In JWT Token manually"),i&&s&&l.default.createElement(a.Field,null,l.default.createElement(a.Button,{type:"button",fill:"outline",style:{color:`${d.colors.primary.text}`},onClick:b},"Upload JWT Token")))},m=e=>{if(!i.isObject(e))return{isValid:!1,error:"Invalid JWT token"};const t=y.filter((t=>!e[t]));return t.length>0?{isValid:!1,error:`Missing keys: ${t.join(", ")}`}:{isValid:!0}},{SecretFormField:f}=a.LegacyForms;var b;!function(e){e.PATH="path",e.JWT="jwt"}(b||(b={}));const v=({options:e,onReset:t,onOptionsChange:r,showPaste:o,showUpload:i})=>{var c;const[s,y]=l.default.useState((e=>"privateKeyPath"in e&&""!==e.privateKeyPath?b.PATH:b.JWT)(e.jsonData)),d=t=>n.onUpdateDatasourceJsonDataOption({options:e,onOptionsChange:r},t),m=()=>{s===b.JWT?y(b.PATH):y(b.JWT)},v=a.useTheme2(),g=l.default.createElement("span",null,s===b.PATH?l.default.createElement("a",{className:"external-link",onClick:m,"data-testid":"Show private key input"},"Paste private key"):"Paste private key"," ","or  ",s===b.JWT?l.default.createElement("a",{className:"external-link",onClick:m,"data-testid":"Show private key path input"},"provide path to private file"):"provide path to private key file"),h={isConfigured:Boolean(e.secureJsonFields.privateKey),value:(null===(c=e.secureJsonData)||void 0===c?void 0:c.privateKey)||"",placeholder:"Enter Private key",onReset:()=>t(),onChange:n.onUpdateDatasourceSecureJsonDataOption({options:e,onOptionsChange:r},"privateKey"),"data-testid":"Private Key Input"};return l.default.createElement("div",{"data-testid":"JWT form"},l.default.createElement(a.Field,{label:"Project ID"},l.default.createElement(a.Input,{id:"defaultProject",width:60,value:e.jsonData.defaultProject||"",onChange:d("defaultProject")})),l.default.createElement(a.Field,{label:"Client email"},l.default.createElement(a.Input,{width:60,id:"clientEmail",value:e.jsonData.clientEmail||"",onChange:d("clientEmail")})),l.default.createElement(a.Field,{label:"Token URI"},l.default.createElement(a.Input,{width:60,id:"tokenUri",value:e.jsonData.tokenUri||"",onChange:d("tokenUri")})),s===b.PATH&&l.default.createElement(a.Field,{label:"Private key path",description:g},l.default.createElement(a.Input,{width:60,id:"privateKeyPath",value:e.jsonData.privateKeyPath||"",placeholder:"File location of your private key (e.g. /etc/secrets/gce.pem)",onChange:d("privateKeyPath"),"data-testid":"Private Key Path Input"})),s===b.JWT&&l.default.createElement(l.default.Fragment,null,a.SecretInput?l.default.createElement(a.Field,{label:"Private key",description:g},l.default.createElement(a.SecretInput,Object.assign({},h,{width:60}))):l.default.createElement(f,Object.assign({},h,{label:"Private key",labelWidth:10,inputWidth:20}))),l.default.createElement(l.default.Fragment,null,l.default.createElement(a.Button,{"data-testid":u,type:"button",fill:"outline",style:{color:`${v.colors.primary.text}`},onClick:o},"Paste JWT Token"),l.default.createElement("span",{style:{paddingRight:"10px",paddingLeft:"10px"}},"or"),l.default.createElement(a.Button,{"data-testid":p,type:"button",fill:"outline",style:{color:`${v.colors.primary.text}`},onClick:i},"Upload JWT Token")))};function g(e){const{options:t,onOptionsChange:r,authOptions:i}=e,{jsonData:u,secureJsonFields:p,secureJsonData:y}=t,m=()=>Boolean(u.clientEmail&&u.defaultProject&&u.tokenUri&&(p&&p.privateKey||u.privateKeyPath));u.authenticationType||(u.authenticationType=c);const[f,b]=o.useState(h(u.authenticationType)),[g,O]=o.useState(m()),[E,S]=o.useState(!1),[j,T]=o.useState(!0),P=()=>{S(!1),T(!0),O(!1)},I=()=>{S(!0),T(!1),O(!1)};return l.default.createElement(l.default.Fragment,null,l.default.createElement(a.FieldSet,{label:"Authentication"},l.default.createElement(a.Field,{label:"Authentication type"},l.default.createElement(a.RadioButtonGroup,{options:i,value:u.authenticationType||c,onChange:e=>{O(m()),r(Object.assign(Object.assign({},t),{jsonData:Object.assign(Object.assign({},t.jsonData),{authenticationType:e})})),b(h(e))}}))),f&&l.default.createElement(a.FieldSet,{label:"JWT Key Details"},g?l.default.createElement(v,{options:t,onReset:()=>(e=>{const n=Object.assign({},y),a=Object.assign({},t.jsonData);delete a.clientEmail,delete a.defaultProject,delete a.tokenUri,delete a.privateKeyPath,delete n.privateKey,b(!0),O(!1),r(Object.assign(Object.assign({},t),{secureJsonFields:Object.assign(Object.assign({},t.secureJsonFields),{privateKey:!1}),secureJsonData:n,jsonData:a}))})(),onOptionsChange:r,showUpload:P,showPaste:I}):l.default.createElement(d,{showConfigEditor:()=>{O(!0)},showUpload:P,showPaste:I,isPasting:E,isUploading:j,onChange:e=>{r(Object.assign(Object.assign({},t),{secureJsonFields:Object.assign(Object.assign({},p),{privateKey:!0}),secureJsonData:Object.assign(Object.assign({},y),{privateKey:e.privateKey}),jsonData:Object.assign(Object.assign({},u),{clientEmail:e.clientEmail,defaultProject:e.projectId,tokenUri:e.tokenUri})}))}})," "),u.authenticationType===s&&l.default.createElement(a.Field,{label:"Default project"},l.default.createElement(a.Input,{id:"defaultProject",width:60,value:t.jsonData.defaultProject||"",onChange:n.onUpdateDatasourceJsonDataOption(e,"defaultProject")})))}const h=e=>e===c||void 0===e,O=[{label:"Google JWT File",value:c,ariaLabel:"JWT button"},{label:"GCE Default Service Account",value:s,ariaLabel:"GCE button"}];t.ConnectionConfig=e=>{const{options:{jsonData:t}}=e;t.authenticationType||(t.authenticationType=c);const r=t.authenticationType===c||void 0===t.authenticationType;return l.default.createElement(l.default.Fragment,null,l.default.createElement(g,Object.assign({authOptions:O},e)),l.default.createElement("div",{className:"grafana-info-box",style:{marginTop:"16px"},"data-testid":"Configuration help box"},l.default.createElement("p",null,"Don’t know how to get a service account key file or create a service account? Read more"," ",l.default.createElement("a",{className:"external-link",target:"_blank",rel:"noopener noreferrer",href:"https://grafana.com/docs/grafana/latest/datasources/google-cloud-monitoring/google-authentication/"},"in the documentation."))),!r&&l.default.createElement(a.Alert,{title:"",severity:"info"},"Verify GCE default service account by clicking Save & Test"))}},80:(e,t,r)=>{"use strict";e.exports=r(872)},635:e=>{"use strict";e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=void 0,a=void 0,o=void 0,i=[];return function(){var c=function(e){return"function"==typeof e?e():e}(t),s=(new Date).getTime(),u=!n||s-n>c;n=s;for(var p=arguments.length,y=Array(p),d=0;d<p;d++)y[d]=arguments[d];if(u&&r.leading)return r.accumulate?Promise.resolve(e.call(this,[y])).then((function(e){return e[0]})):Promise.resolve(e.call.apply(e,[this].concat(y)));if(a?clearTimeout(o):a=function(){var e={};return e.promise=new Promise((function(t,r){e.resolve=t,e.reject=r})),e}(),i.push(y),o=setTimeout(l.bind(this),c),r.accumulate){var m=i.length-1;return a.promise.then((function(e){return e[m]}))}return a.promise};function l(){var t=a;clearTimeout(o),Promise.resolve(r.accumulate?e.call(this,i):e.apply(this,i[i.length-1])).then(t.resolve,t.reject),i=[],a=null}}},513:e=>{"use strict";e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,a,o;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(a=n;0!=a--;)if(!e(t[a],r[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(o=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(a=n;0!=a--;)if(!Object.prototype.hasOwnProperty.call(r,o[a]))return!1;for(a=n;0!=a--;){var i=o[a];if(!e(t[i],r[i]))return!1}return!0}return t!=t&&r!=r}},89:e=>{"use strict";e.exports=n},781:e=>{"use strict";e.exports=t},531:e=>{"use strict";e.exports=r},7:e=>{"use strict";e.exports=o},241:t=>{"use strict";t.exports=e},959:e=>{"use strict";e.exports=a},269:e=>{"use strict";e.exports=i}},c={};function s(e){var t=c[e];if(void 0!==t)return t.exports;var r=c[e]={exports:{}};return l[e](r,r.exports,s),r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return(()=>{"use strict";s.r(u),s.d(u,{plugin:()=>kn});var e=s(241),t=s(781),r=s(531),n=s(89),a=s(959),o=s.n(a);class i extends a.PureComponent{render(){return o().createElement("div",null,o().createElement("h2",null,"Cloud Monitoring alias patterns"),o().createElement("div",null,o().createElement("p",null,"Format the legend keys any way you want by using alias patterns. Format the legend keys any way you want by using alias patterns."),"Example:",o().createElement("code",null,"{{metric.name}} - {{metric.label.instance_name}}"),o().createElement("br",null),"Result:   ",o().createElement("code",null,"cpu/usage_time - server1-europe-west-1"),o().createElement("br",null),o().createElement("br",null),o().createElement("span",null,"Patterns:"),o().createElement("br",null),o().createElement("ul",{className:n.css`
              list-style: none;
            `},o().createElement("li",null,o().createElement("code",null,"{{metric.type}}")," = metric type e.g. compute.googleapis.com/instance/cpu/usage_time"),o().createElement("li",null,o().createElement("code",null,"{{metric.name}}")," = name part of metric e.g. instance/cpu/usage_time"),o().createElement("li",null,o().createElement("code",null,"{{metric.service}}")," = service part of metric e.g. compute"),o().createElement("li",null,o().createElement("code",null,"{{metric.label.label_name}}")," = Metric label metadata e.g. metric.label.instance_name"),o().createElement("li",null,o().createElement("code",null,"{{resource.label.label_name}}")," = Resource label metadata e.g. resource.label.zone"),o().createElement("li",null,o().createElement("code",null,"{{metadata.system_labels.name}}")," = Meta data system labels e.g. metadata.system_labels.name. For this to work, the needs to be included in the group by"),o().createElement("li",null,o().createElement("code",null,"{{metadata.user_labels.name}}")," = Meta data user labels e.g. metadata.user_labels.name. For this to work, the needs to be included in the group by"),o().createElement("li",null,o().createElement("code",null,"{{bucket}}")," = bucket boundary for distribution metrics when using a heatmap in Grafana"),o().createElement("li",null,o().createElement("code",null,"{{project}}")," = The project name that was specified in the query editor"),o().createElement("li",null,o().createElement("code",null,"{{service}}")," = The service id that was specified in the SLO query editor"),o().createElement("li",null,o().createElement("code",null,"{{slo}}")," = The SLO id that was specified in the SLO query editor"),o().createElement("li",null,o().createElement("code",null,"{{selector}}")," = The Selector function that was specified in the SLO query editor"))))}}var l=s(7),c=Object.defineProperty,p=Object.defineProperties,y=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,b=(e,t,r)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,v=(e,t)=>{for(var r in t||(t={}))m.call(t,r)&&b(e,r,t[r]);if(d)for(var r of d(t))f.call(t,r)&&b(e,r,t[r]);return e};const g=({dataSourceName:e,docsLink:t,hasRequiredFields:r=!0,className:a})=>{const i=(0,l.useTheme2)(),c={container:(0,n.css)({p:{margin:0},"p + p":{marginTop:i.spacing(2)}}),text:(0,n.css)((s=v({},i.typography.body),u={color:i.colors.text.secondary,a:(0,n.css)({color:i.colors.text.link,textDecoration:"underline","&:hover":{textDecoration:"none"}})},p(s,y(u))))};var s,u;return o().createElement("div",{className:(0,n.cx)(c.container,a)},o().createElement("p",{className:c.text},"Before you can use the ",e," data source, you must configure it below or in the config file. For detailed instructions,"," ",o().createElement("a",{href:t,target:"_blank",rel:"noreferrer"},"view the documentation"),"."),r&&o().createElement("p",{className:c.text},o().createElement("i",null,"Fields marked with * are required")))};var h=Object.defineProperty,O=Object.defineProperties,E=Object.getOwnPropertyDescriptors,S=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable,P=(e,t,r)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,I=(e,t)=>{for(var r in t||(t={}))j.call(t,r)&&P(e,r,t[r]);if(S)for(var r of S(t))T.call(t,r)&&P(e,r,t[r]);return e};const w=({children:e,title:t,description:r,isCollapsible:i=!1,isInitiallyOpen:c=!0,kind:s="section",className:u})=>{const{colors:p,typography:y,spacing:d}=(0,l.useTheme2)(),[m,f]=(0,a.useState)(!i||c),b=m?"angle-up":"angle-down",v="sub-section"===s,g=`${m?"Collapse":"Expand"} section ${t}`,h={header:(0,n.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,n.css)({margin:0}),subtitle:(0,n.css)({margin:0,fontWeight:y.fontWeightRegular}),descriptionText:(0,n.css)((S=I({marginTop:d(v?.25:.5),marginBottom:0},y.bodySmall),j={color:p.text.secondary},O(S,E(j)))),content:(0,n.css)({marginTop:d(2)})};var S,j;return o().createElement("div",{className:u},o().createElement("div",{className:h.header},"section"===s?o().createElement("h3",{className:h.title},t):o().createElement("h6",{className:h.subtitle},t),i&&o().createElement(l.IconButton,{name:b,onClick:()=>f(!m),type:"button",size:"xl","aria-label":g})),r&&o().createElement("p",{className:h.descriptionText},r),m&&o().createElement("div",{className:h.content},e))};var N=Object.defineProperty,D=Object.defineProperties,L=Object.getOwnPropertyDescriptors,C=Object.getOwnPropertySymbols,_=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable,x=(e,t,r)=>t in e?N(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const R=e=>{var t,r=e,{children:n}=r,a=((e,t)=>{var r={};for(var n in e)_.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&C)for(var n of C(e))t.indexOf(n)<0&&A.call(e,n)&&(r[n]=e[n]);return r})(r,["children"]);return o().createElement(w,(t=((e,t)=>{for(var r in t||(t={}))_.call(t,r)&&x(e,r,t[r]);if(C)for(var r of C(t))A.call(t,r)&&x(e,r,t[r]);return e})({},a),D(t,L({kind:"section"}))),n)};var U=s(80);function M(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class k extends a.PureComponent{render(){const{options:e,onOptionsChange:t}=this.props;return o().createElement(o().Fragment,null,o().createElement(g,{dataSourceName:"Google Cloud Monitoring",docsLink:"https://grafana.com/docs/grafana/latest/datasources/google-cloud-monitoring/",hasRequiredFields:!0}),o().createElement(l.Divider,null),o().createElement(U.ConnectionConfig,(n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){M(e,t,r[t])}))}return e}({},this.props),a=null!=(a={onOptionsChange:this.handleOnOptionsChange})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(a)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(a,e))})),n)),r.config.secureSocksDSProxyEnabled&&o().createElement(o().Fragment,null,o().createElement(l.Divider,null),o().createElement(R,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source. This includes Secure Socks Proxy.",isCollapsible:!0,isInitiallyOpen:void 0!==e.jsonData.enableSecureSocksProxy},o().createElement(l.SecureSocksProxySettings,{options:e,onOptionsChange:t}))));var n,a}constructor(...e){super(...e),M(this,"handleOnOptionsChange",(e=>{(e.jsonData.privateKeyPath||e.secureJsonFields.privateKey)&&(0,r.reportInteraction)("grafana_cloud_monitoring_config_changed",{authenticationType:"JWT",privateKey:e.secureJsonFields.privateKey,privateKeyPath:!!e.jsonData.privateKeyPath}),this.props.onOptionsChange(e)}))}}var G=s(513),Q=s.n(G),q=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;const V=e=>{var t=e,{children:r}=t,n=((e,t)=>{var r={};for(var n in e)B.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&q)for(var n of q(e))t.indexOf(n)<0&&F.call(e,n)&&(r[n]=e[n]);return r})(t,["children"]);const i=(0,l.useStyles2)((0,a.useCallback)((e=>K(e,n)),[n]));return o().createElement("div",{className:i.root},r)},K=(e,t)=>{var r,a,o;return{root:(0,n.css)({display:"flex",flexDirection:null!=(r=t.direction)?r:"row",flexWrap:null==(a=t.wrap)||a?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!=(o=t.gap)?o:2),flexGrow:t.flexGrow})}},$=({children:e})=>o().createElement(V,{gap:.5,direction:"column"},e),Y={components:{queryEditor:{container:"data-testid cloud-monitoring-query-editor",header:{select:"data-testid cloud-monitoring-header"},visualMetricsQueryEditor:{container:{input:"data-testid cloud-monitoring-visual-metrics-query-editor"}},mqlMetricsQueryEditor:{container:{input:"data-testid cloud-monitoring-mql-query-editor"}},sloQueryEditor:{container:{input:"data-testid cloud-monitoring-slo-query-editor"}},promQlQueryEditor:{container:{input:"data-testid cloud-monitoring-prom-ql-query-editor"}}}}};var J,W,z,H,X,Z;!function(e){e.ANNOTATION="annotation",e.PROMQL="promQL",e.SLO="slo",e.TIME_SERIES_LIST="timeSeriesList",e.TIME_SERIES_QUERY="timeSeriesQuery"}(J||(J={})),function(e){e.Delta="delta",e.None="none",e.Rate="rate"}(W||(W={})),function(e){e.CUMULATIVE="CUMULATIVE",e.DELTA="DELTA",e.GAUGE="GAUGE",e.METRIC_KIND_UNSPECIFIED="METRIC_KIND_UNSPECIFIED"}(z||(z={})),function(e){e.BOOL="BOOL",e.DISTRIBUTION="DISTRIBUTION",e.DOUBLE="DOUBLE",e.INT64="INT64",e.MONEY="MONEY",e.STRING="STRING",e.VALUE_TYPE_UNSPECIFIED="VALUE_TYPE_UNSPECIFIED"}(H||(H={})),function(e){e.ALIGN_COUNT="ALIGN_COUNT",e.ALIGN_COUNT_FALSE="ALIGN_COUNT_FALSE",e.ALIGN_COUNT_TRUE="ALIGN_COUNT_TRUE",e.ALIGN_DELTA="ALIGN_DELTA",e.ALIGN_FRACTION_TRUE="ALIGN_FRACTION_TRUE",e.ALIGN_INTERPOLATE="ALIGN_INTERPOLATE",e.ALIGN_MAX="ALIGN_MAX",e.ALIGN_MEAN="ALIGN_MEAN",e.ALIGN_MIN="ALIGN_MIN",e.ALIGN_NEXT_OLDER="ALIGN_NEXT_OLDER",e.ALIGN_NONE="ALIGN_NONE",e.ALIGN_PERCENTILE_05="ALIGN_PERCENTILE_05",e.ALIGN_PERCENTILE_50="ALIGN_PERCENTILE_50",e.ALIGN_PERCENTILE_95="ALIGN_PERCENTILE_95",e.ALIGN_PERCENTILE_99="ALIGN_PERCENTILE_99",e.ALIGN_PERCENT_CHANGE="ALIGN_PERCENT_CHANGE",e.ALIGN_RATE="ALIGN_RATE",e.ALIGN_STDDEV="ALIGN_STDDEV",e.ALIGN_SUM="ALIGN_SUM"}(X||(X={})),function(e){e.Aggregations="aggregations",e.Aligners="aligners",e.AlignmentPeriods="alignmentPeriods",e.DefaultProject="defaultProject",e.LabelKeys="labelKeys",e.LabelValues="labelValues",e.MetricTypes="metricTypes",e.Projects="projects",e.ResourceTypes="resourceTypes",e.SLO="slo",e.SLOServices="sloServices",e.Selectors="selectors",e.Services="services"}(Z||(Z={}));const ee=({v:e=0,h:t=0,layout:r="block"})=>{const i=(0,l.useStyles2)((0,a.useCallback)((n=>te(n,{v:e,h:t,layout:r})),[e,t,r]));return o().createElement("span",{className:(0,n.cx)(i.wrapper)})},te=(e,t)=>{var r,a;return{wrapper:(0,n.css)([{paddingRight:e.spacing(null!=(r=t.h)?r:0),paddingBottom:e.spacing(null!=(a=t.v)?a:0)},"inline"===t.layout&&{display:"inline-block"},"block"===t.layout&&{display:"block"}])}};var re=Object.defineProperty,ne=Object.getOwnPropertySymbols,ae=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable,ie=(e,t,r)=>t in e?re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const le=e=>{var t;const r=e,{label:n,optional:i,tooltip:c,tooltipInteractive:s,children:u,width:p}=r,y=((e,t)=>{var r={};for(var n in e)ae.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&ne)for(var n of ne(e))t.indexOf(n)<0&&oe.call(e,n)&&(r[n]=e[n]);return r})(r,["label","optional","tooltip","tooltipInteractive","children","width"]),d=(0,l.useStyles2)((0,a.useCallback)((e=>ce(e,p)),[p])),m=(null==y?void 0:y.htmlFor)||(null==(t=l.ReactUtils)?void 0:t.getChildId(u)),f=o().createElement(o().Fragment,null,o().createElement("label",{className:d.label,htmlFor:m},n,i&&o().createElement("span",{className:d.optional}," - optional"),c&&o().createElement(l.Tooltip,{placement:"top",content:c,theme:"info",interactive:s},o().createElement(l.Icon,{tabIndex:0,name:"info-circle",size:"sm",className:d.icon}))),o().createElement(ee,{v:.5}));return o().createElement("div",{className:d.root},o().createElement(l.Field,((e,t)=>{for(var r in t||(t={}))ae.call(t,r)&&ie(e,r,t[r]);if(ne)for(var r of ne(t))oe.call(t,r)&&ie(e,r,t[r]);return e})({className:d.field,label:f},y),u))},ce=(e,t)=>({root:(0,n.css)({minWidth:e.spacing(null!=t?t:0)}),label:(0,n.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium}),optional:(0,n.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,n.css)({marginBottom:0}),icon:(0,n.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})}),se=({refId:t,value:r="",onChange:n})=>{const[i,c]=(0,a.useState)(null!=r?r:""),s=(0,e.debounce)(n,1e3);return o().createElement(le,{label:"Alias by"},o().createElement(l.Input,{id:`${t}-alias-by`,value:i,onChange:e=>{c(e.currentTarget.value),s(e.currentTarget.value)}}))},ue=({children:e})=>{const t=(0,l.useStyles2)(pe);return o().createElement("div",{className:t.root},o().createElement(V,{gap:2},e))},pe=e=>({root:(0,n.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(1)})}),ye=[{text:"none",value:"ALIGN_NONE",valueTypes:[H.INT64,H.DOUBLE,H.MONEY,H.DISTRIBUTION,H.STRING,H.VALUE_TYPE_UNSPECIFIED,H.BOOL],metricKinds:[z.GAUGE]},{text:"delta",value:"ALIGN_DELTA",valueTypes:[H.INT64,H.DOUBLE,H.MONEY,H.DISTRIBUTION],metricKinds:[z.CUMULATIVE,z.DELTA]},{text:"rate",value:"ALIGN_RATE",valueTypes:[H.INT64,H.DOUBLE,H.MONEY],metricKinds:[z.CUMULATIVE,z.DELTA]},{text:"interpolate",value:"ALIGN_INTERPOLATE",valueTypes:[H.INT64,H.DOUBLE,H.MONEY],metricKinds:[z.GAUGE]},{text:"next older",value:"ALIGN_NEXT_OLDER",valueTypes:[H.INT64,H.DOUBLE,H.MONEY,H.DISTRIBUTION,H.STRING,H.VALUE_TYPE_UNSPECIFIED,H.BOOL],metricKinds:[z.GAUGE]},{text:"min",value:"ALIGN_MIN",valueTypes:[H.INT64,H.DOUBLE,H.MONEY],metricKinds:[z.GAUGE,z.DELTA]},{text:"max",value:"ALIGN_MAX",valueTypes:[H.INT64,H.DOUBLE,H.MONEY],metricKinds:[z.GAUGE,z.DELTA]},{text:"mean",value:"ALIGN_MEAN",valueTypes:[H.INT64,H.DOUBLE,H.MONEY],metricKinds:[z.GAUGE,z.DELTA]},{text:"count",value:"ALIGN_COUNT",valueTypes:[H.INT64,H.DOUBLE,H.MONEY,H.BOOL],metricKinds:[z.GAUGE,z.DELTA]},{text:"sum",value:"ALIGN_SUM",valueTypes:[H.INT64,H.DOUBLE,H.MONEY,H.DISTRIBUTION],metricKinds:[z.GAUGE,z.DELTA]},{text:"stddev",value:"ALIGN_STDDEV",valueTypes:[H.INT64,H.DOUBLE,H.MONEY],metricKinds:[z.GAUGE,z.DELTA]},{text:"count true",value:"ALIGN_COUNT_TRUE",valueTypes:[H.BOOL],metricKinds:[z.GAUGE]},{text:"count false",value:"ALIGN_COUNT_FALSE",valueTypes:[H.BOOL],metricKinds:[z.GAUGE]},{text:"fraction true",value:"ALIGN_FRACTION_TRUE",valueTypes:[H.BOOL],metricKinds:[z.GAUGE]},{text:"percentile 99",value:"ALIGN_PERCENTILE_99",valueTypes:[H.DISTRIBUTION],metricKinds:[z.GAUGE,z.DELTA]},{text:"percentile 95",value:"ALIGN_PERCENTILE_95",valueTypes:[H.DISTRIBUTION],metricKinds:[z.GAUGE,z.DELTA]},{text:"percentile 50",value:"ALIGN_PERCENTILE_50",valueTypes:[H.DISTRIBUTION],metricKinds:[z.GAUGE,z.DELTA]},{text:"percentile 05",value:"ALIGN_PERCENTILE_05",valueTypes:[H.DISTRIBUTION],metricKinds:[z.GAUGE,z.DELTA]},{text:"percent change",value:"ALIGN_PERCENT_CHANGE",valueTypes:[H.INT64,H.DOUBLE,H.MONEY],metricKinds:[z.GAUGE,z.DELTA]}],de=[{text:"none",value:"REDUCE_NONE",valueTypes:[H.INT64,H.DOUBLE,H.MONEY,H.DISTRIBUTION,H.BOOL,H.STRING],metricKinds:[z.GAUGE,z.DELTA,z.CUMULATIVE,z.METRIC_KIND_UNSPECIFIED]},{text:"mean",value:"REDUCE_MEAN",valueTypes:[H.INT64,H.DOUBLE,H.MONEY,H.DISTRIBUTION],metricKinds:[z.GAUGE,z.DELTA,z.CUMULATIVE]},{text:"min",value:"REDUCE_MIN",valueTypes:[H.INT64,H.DOUBLE,H.MONEY],metricKinds:[z.GAUGE,z.DELTA,z.CUMULATIVE,z.METRIC_KIND_UNSPECIFIED]},{text:"max",value:"REDUCE_MAX",valueTypes:[H.INT64,H.DOUBLE,H.MONEY],metricKinds:[z.GAUGE,z.DELTA,z.CUMULATIVE,z.METRIC_KIND_UNSPECIFIED]},{text:"sum",value:"REDUCE_SUM",valueTypes:[H.INT64,H.DOUBLE,H.MONEY,H.DISTRIBUTION],metricKinds:[z.GAUGE,z.DELTA,z.CUMULATIVE,z.METRIC_KIND_UNSPECIFIED]},{text:"std. dev.",value:"REDUCE_STDDEV",valueTypes:[H.INT64,H.DOUBLE,H.MONEY,H.DISTRIBUTION],metricKinds:[z.GAUGE,z.DELTA,z.CUMULATIVE,z.METRIC_KIND_UNSPECIFIED]},{text:"count",value:"REDUCE_COUNT",valueTypes:[H.INT64,H.DOUBLE,H.MONEY,H.DISTRIBUTION,H.BOOL,H.STRING],metricKinds:[z.GAUGE,z.DELTA,z.CUMULATIVE]},{text:"count true",value:"REDUCE_COUNT_TRUE",valueTypes:[H.BOOL],metricKinds:[z.GAUGE,z.DELTA]},{text:"count false",value:"REDUCE_COUNT_FALSE",valueTypes:[H.BOOL],metricKinds:[z.GAUGE,z.DELTA]},{text:"99th percentile",value:"REDUCE_PERCENTILE_99",valueTypes:[H.INT64,H.DOUBLE,H.MONEY,H.DISTRIBUTION],metricKinds:[z.GAUGE,z.DELTA,z.CUMULATIVE]},{text:"95th percentile",value:"REDUCE_PERCENTILE_95",valueTypes:[H.INT64,H.DOUBLE,H.MONEY,H.DISTRIBUTION],metricKinds:[z.GAUGE,z.DELTA,z.CUMULATIVE]},{text:"50th percentile",value:"REDUCE_PERCENTILE_50",valueTypes:[H.INT64,H.DOUBLE,H.MONEY,H.DISTRIBUTION],metricKinds:[z.GAUGE,z.DELTA,z.CUMULATIVE]},{text:"5th percentile",value:"REDUCE_PERCENTILE_05",valueTypes:[H.INT64,H.DOUBLE,H.MONEY,H.DISTRIBUTION],metricKinds:[z.GAUGE,z.DELTA,z.CUMULATIVE]}],me=[{text:"grafana auto",value:"grafana-auto"},{text:"stackdriver auto",value:"stackdriver-auto",hidden:!0},{text:"cloud monitoring auto",value:"cloud-monitoring-auto"},{text:"1m",value:"+60s"},{text:"2m",value:"+120s"},{text:"5m",value:"+300s"},{text:"10m",value:"+600s"},{text:"30m",value:"+1800s"},{text:"1h",value:"+3600s"},{text:"3h",value:"+7200s"},{text:"6h",value:"+21600s"},{text:"1d",value:"+86400s"},{text:"3d",value:"+259200s"},{text:"1w",value:"+604800s"}],fe=[{text:"auto",value:"auto"},{text:"1m",value:"1m"},{text:"2m",value:"2m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"30m",value:"30m"},{text:"1h",value:"1h"},{text:"3h",value:"3h"},{text:"6h",value:"6h"},{text:"1d",value:"1d"},{text:"3d",value:"3d"},{text:"1w",value:"1w"}],be=[{text:"1m",value:"1m"},{text:"2m",value:"2m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"30m",value:"30m"},{text:"1h",value:"1h"},{text:"3h",value:"3h"},{text:"6h",value:"6h"},{text:"24h",value:"24h"},{text:"72h",value:"72h"}],ve=["metadata.system_labels.cloud_account","metadata.system_labels.name","metadata.system_labels.region","metadata.system_labels.state","metadata.system_labels.instance_group","metadata.system_labels.node_name","metadata.system_labels.service_name","metadata.system_labels.top_level_controller_type","metadata.system_labels.top_level_controller_name","metadata.system_labels.container_image"],ge="select_slo_burn_rate",he=[{label:"SLI Value",value:"select_slo_health"},{label:"SLO Compliance",value:"select_slo_compliance"},{label:"SLO Error Budget Remaining",value:"select_slo_budget_fraction"},{label:"SLO Burn Rate",value:ge}],Oe=[{label:"Builder",value:J.TIME_SERIES_LIST},{label:"MQL",value:J.TIME_SERIES_QUERY},{label:"Service Level Objectives (SLO)",value:J.SLO},{label:"PromQL",value:J.PROMQL}];function Ee({refId:e,projectName:t,datasource:r,onChange:n,templateVariableOptions:i}){const[c,s]=(0,a.useState)([]);(0,a.useEffect)((()=>{r.getProjects().then((e=>s(e)))}),[r]);const u=(0,a.useMemo)((()=>[{label:"Template Variables",options:i},...c]),[c,i]);return o().createElement(le,{label:"Project"},o().createElement(l.Select,{width:"auto",allowCustomValue:!0,formatCreateLabel:e=>`Use project: ${e}`,onChange:({value:e})=>n(e),options:u,value:{value:t,label:t},placeholder:"Select Project",inputId:`${e}-project`}))}const Se=({children:e})=>o().createElement(V,{gap:1},e);function je(e,t,r,n,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,a)}function Te(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Pe=t=>(0,e.uniqBy)(t,"service"),Ie=(e,t)=>e.filter((e=>e.service===t)),we=(e,t,r,n)=>{const a=Ie(e,n).map((e=>({value:e.type,name:e.displayName}))),o=a.some((e=>e.value===r)),i=a.length?a[0].value:"";return{metricTypes:a,selectedMetricType:o?t:i}},Ne=(e,t,r)=>(r&&r===W.Rate&&(t=z.GAUGE),e?ye.filter((r=>-1!==r.valueTypes.indexOf(e)&&-1!==r.metricKinds.indexOf(t))):[]),De=(e,t)=>t?de.filter((r=>-1!==r.valueTypes.indexOf(e)&&-1!==r.metricKinds.indexOf(t))):[],Le=(Ce=function*(e,t,r){const n=yield e.getLabels(t,"handleLabelKeysQuery",r);return[...Object.keys(n),...ve]},_e=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=Ce.apply(e,t);function o(e){je(a,r,n,o,i,"next",e)}function i(e){je(a,r,n,o,i,"throw",e)}o(void 0)}))},function(e,t,r){return _e.apply(this,arguments)});var Ce,_e;const Ae=(e=H.DOUBLE,t=z.GAUGE,n=X.ALIGN_MEAN,a)=>{const o=(0,r.getTemplateSrv)(),i=Ne(e,t,a).map((e=>{return t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Te(e,t,r[t])}))}return e}({},e),r=null!=(r={label:e.text})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t;var t,r}));return i.some((e=>e.value===o.replace(n)))||(n=i.length>0?i[0].value:X.ALIGN_MEAN),{alignOptions:i,perSeriesAligner:n}},xe=t=>{const r=t.reduce(((t,r)=>{const n=r.split(".").map(e.startCase),a=(2===n.length?n:(0,e.initial)(n)).join(" "),o={value:r,label:r};return t[a]?t[a]=[...t[a],o]:t[a]=[o],t}),{});return Object.entries(r).map((([e,t])=>({label:e,options:t,expanded:!0})),[])},Re=(e,r)=>{const{perSeriesAligner:n,alignmentPeriod:a}=e;if(!a||!n)return"";const o=ye.find((e=>e.value===r.templateSrv.replace(n))),i=parseInt(a,10);var l;return`${t.rangeUtil.secondsToHms(i)} interval (${null!==(l=null==o?void 0:o.text)&&void 0!==l?l:""})`},Ue=e=>{var t,r;const n=null==e||null===(t=e.filters)||void 0===t?void 0:t.findIndex((e=>"metric.type"===e));return(null==e||null===(r=e.filters)||void 0===r?void 0:r[n+2])||""},Me=(e,t)=>{var r;if(!e.filters)return e.filters=["metric.type","=",t],e;const n=null==e||null===(r=e.filters)||void 0===r?void 0:r.findIndex((e=>"metric.type"===e));return-1===n?e.filters.push("metric.type","=",t):e.filters[n+2]=t,e};function ke(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Ge=e=>{const t=Qe(e),r=qe(t,e);return o().createElement(le,{label:"Group by function","data-testid":"cloud-monitoring-aggregation"},o().createElement(l.Select,{width:"auto",onChange:({value:t})=>e.onChange(t),value:r,options:[{label:"Template Variables",options:e.templateVariableOptions},{label:"Aggregations",expanded:!0,options:t}],placeholder:"Select Reducer",inputId:`${e.refId}-group-by-function`,menuPlacement:"top"}))},Qe=({metricDescriptor:e})=>{const t=null==e?void 0:e.valueType,r=null==e?void 0:e.metricKind;return(0,a.useMemo)((()=>t&&r?De(t,r).map((e=>{return t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ke(e,t,r[t])}))}return e}({},e),r=null!=(r={label:e.text})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t;var t,r})):[]),[t,r])},qe=(e,t)=>(0,a.useMemo)((()=>[...e,...t.templateVariableOptions].find((e=>e.value===t.crossSeriesReducer))),[e,t.crossSeriesReducer,t.templateVariableOptions]);function Be(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Be(e,t,r[t])}))}return e}function Ve(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Ke=({refId:e,labels:t=[],query:r,onChange:n,variableOptionGroup:i,metricDescriptor:c})=>{const s=(0,a.useMemo)((()=>[i,...xe([...t,...ve])]),[t,i]);var u,p;return o().createElement(Se,null,o().createElement(le,{label:"Group by",tooltip:"You can reduce the amount of data returned for a metric by combining different time series. To combine multiple time series, you can specify a grouping and a function. Grouping is done on the basis of labels. The grouping function is used to combine the time series in the group into a single time series."},o().createElement(l.MultiSelect,{allowCustomValue:!0,inputId:`${e}-group-by`,width:"auto",placeholder:"Choose label",options:s,value:null!==(u=r.groupBys)&&void 0!==u?u:[],onChange:e=>{n(Ve(Fe({},r),{groupBys:e.map((e=>e.value))}))},menuPlacement:"top"})),o().createElement(Ge,{metricDescriptor:c,templateVariableOptions:i.options,crossSeriesReducer:r.crossSeriesReducer,groupBys:null!==(p=r.groupBys)&&void 0!==p?p:[],onChange:e=>n(Ve(Fe({},r),{crossSeriesReducer:e})),refId:e}))};function $e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Ye=({inputId:e,query:t,templateVariableOptions:r,onChange:n,metricDescriptor:i,preprocessor:c})=>{const{perSeriesAligner:s}=t;let{valueType:u,metricKind:p}=i||{};const{perSeriesAligner:y,alignOptions:d}=(0,a.useMemo)((()=>Ae(u,p,s,c)),[u,p,s,c]);return o().createElement(l.Select,{onChange:({value:e})=>{return n((r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){$e(e,t,r[t])}))}return e}({},t),a=null!=(a={perSeriesAligner:e})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(a)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(a,e))})),r));var r,a},value:[...d,...r].find((e=>e.value===y)),options:[{label:"Template Variables",options:r},{label:"Alignment options",expanded:!0,options:d}],placeholder:"Select Alignment",inputId:e,menuPlacement:"top"})};function Je(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function We({inputId:e,templateVariableOptions:t,onChange:r,current:n,disabled:i,aligmentPeriods:c}){const s=(0,a.useMemo)((()=>c.map((e=>{return t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Je(e,t,r[t])}))}return e}({},e),r=null!=(r={label:e.text})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t;var t,r}))),[c]),u=(0,a.useMemo)((()=>s.filter((e=>!e.hidden))),[s]);return o().createElement(l.Select,{width:"auto",onChange:({value:e})=>r(e),value:[...s,...t].find((e=>e.value===n)),options:[{label:"Template Variables",options:t},{label:"Aggregations",expanded:!0,options:u}],placeholder:"Select Period",inputId:e,disabled:i,allowCustomValue:!0,menuPlacement:"top"})}function ze(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function He(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ze(e,t,r[t])}))}return e}const Xe=({refId:e,templateVariableOptions:t,onChange:r,query:n,customMetaData:i,datasource:l,metricDescriptor:c,preprocessor:s})=>{const u=(0,a.useMemo)((()=>Re(i,l)),[i,l]);return o().createElement(Se,null,o().createElement(le,{label:"Alignment function",tooltip:"The process of alignment consists of collecting all data points received in a fixed length of time, applying a function to combine those data points, and assigning a timestamp to the result."},o().createElement(Ye,{inputId:`${e}-alignment-function`,templateVariableOptions:t,query:n,onChange:e=>r(He({},n,e)),metricDescriptor:c,preprocessor:s})),o().createElement(le,{label:"Alignment period",tooltip:u},o().createElement(We,{inputId:`${e}-alignment-period`,templateVariableOptions:t,current:n.alignmentPeriod,onChange:e=>{return r((t=He({},n),a=null!=(a={alignmentPeriod:e})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})),t));var t,a},aligmentPeriods:me})))};var Ze=Object.defineProperty,et=Object.defineProperties,tt=Object.getOwnPropertyDescriptors,rt=Object.getOwnPropertySymbols,nt=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable,ot=(e,t,r)=>t in e?Ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const it=e=>{var t=e,{className:r}=t,a=((e,t)=>{var r={};for(var n in e)nt.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&rt)for(var n of rt(e))t.indexOf(n)<0&&at.call(e,n)&&(r[n]=e[n]);return r})(t,["className"]);const i=(0,l.useStyles2)(lt);return o().createElement(l.Button,(c=((e,t)=>{for(var r in t||(t={}))nt.call(t,r)&&ot(e,r,t[r]);if(rt)for(var r of rt(t))at.call(t,r)&&ot(e,r,t[r]);return e})({},a),s={className:(0,n.cx)(r,i.button)},et(c,tt(s))));var c,s},lt=e=>({button:(0,n.css)({paddingLeft:e.spacing(1.5),paddingRight:e.spacing(1.5)})}),ct=o().forwardRef((function({items:e,renderItem:t,onChange:r},n){return o().createElement(V,null,e.map(((n,a)=>o().createElement("div",{key:a},t(n,(t=>((t,n)=>{const a=[...e];a[t]=n,r(a)})(a,t)),(()=>(t=>{const n=[...e];n.splice(t,1),r(n)})(a)))))),o().createElement(l.Button,{ref:n,onClick:()=>{const t=[...e,{}];r(t)},variant:"secondary",size:"md",icon:"plus","aria-label":"Add",type:"button"}))})),st="=",ut="AND",pt=["=","!=","=~","!=~"].map(t.toOption),yt=["metric.type"],dt=({labels:r={},filters:n,onChange:i,variableOptionGroup:c})=>{const s=(t=>(0,e.chunk)(t,4).map((([e,t,r,n="AND"])=>({key:e,operator:t,value:r,condition:n}))))(n),u=s.filter((({key:e})=>!yt.includes(e))),p=s.filter((({key:e})=>yt.includes(e))),y=(0,a.useMemo)((()=>[c,...xe(Object.keys(r))]),[r,c]),d=({key:e="",value:n=""})=>{y.some((t=>t.options?y.some((t=>t.label===e)):t.label===e))||y.push({label:e,value:e});const a=r.hasOwnProperty(e)?[c,...r[e].map(t.toOption)]:[c];return a.some((e=>e.label===n))||a.push({label:n,value:n}),{options:y,valueOptions:a}};return o().createElement(ue,null,o().createElement(le,{label:"Filter",tooltip:"To reduce the amount of data charted, apply a filter. A filter has three components: a label, a comparison, and a value. The comparison can be an equality, inequality, or regular expression."},o().createElement(ct,{items:u,renderItem:(e,t,r)=>{const{key:n="",operator:a=st,value:i="",condition:c=ut}=e,{options:s,valueOptions:u}=d(e);return o().createElement(l.HorizontalGroup,{spacing:"xs",width:"auto"},o().createElement(l.Select,{"aria-label":"Filter label key",formatCreateLabel:e=>`Use label key: ${e}`,allowCustomValue:!0,value:n,options:s,onChange:({value:e=""})=>t({key:e,operator:a,value:i,condition:c})}),o().createElement(l.Select,{value:a,options:pt,onChange:({value:e=st})=>t({key:n,operator:e,value:i,condition:c})}),o().createElement(l.Select,{"aria-label":"Filter label value",placeholder:"add filter value",formatCreateLabel:e=>`Use label value: ${e}`,allowCustomValue:!0,value:i,options:u,onChange:({value:e=""})=>t({key:n,operator:a,value:e,condition:c})}),o().createElement(it,{"aria-label":"Remove",icon:"times",variant:"secondary",onClick:r,type:"button"}))},onChange:e=>{const t=e.concat(p).map((({key:e,operator:t,value:r,condition:n})=>({key:e||"",operator:t||st,value:r||"",condition:n||ut})));i((e=>e.flatMap((({key:e,operator:t,value:r,condition:n})=>[e,t,r,n])).slice(0,-1))(t))}})))},mt=()=>o().createElement("div",{className:"grafana-info-box alert-info"},o().createElement("div",null,o().createElement("h5",null,"Annotation Query Format"),o().createElement("p",null,"An annotation is an event that is overlaid on top of graphs. Annotation rendering is expensive so it is important to limit the number of rows returned."," "),o().createElement("p",null,"The Title and Text fields support templating and can use data returned from the query. For example, the Title field could have the following text:"),o().createElement("code",null,"{{metric.type}}"," has value: ","{{metric.value}}"),o().createElement("p",null,"Example Result: ",o().createElement("code",null,"monitoring.googleapis.com/uptime_check/http_status has this value: 502")),o().createElement("span",null,"Patterns:"),o().createElement("p",null,o().createElement("code",null,"{{metric.value}}")," = value of the metric/point"),o().createElement("p",null,o().createElement("code",null,"{{metric.type}}")," = metric type e.g. compute.googleapis.com/instance/cpu/usage_time"),o().createElement("p",null,o().createElement("code",null,"{{metric.name}}")," = name part of metric e.g. instance/cpu/usage_time"),o().createElement("p",null,o().createElement("code",null,"{{metric.service}}")," = service part of metric e.g. compute"),o().createElement("p",null,o().createElement("code",null,"{{metric.label.label_name}}")," = Metric label metadata e.g. metric.label.instance_name"),o().createElement("p",null,o().createElement("code",null,"{{resource.label.label_name}}")," = Resource label metadata e.g. resource.label.zone")));function ft(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const bt=({refId:e,current:t,templateVariableOptions:r,onChange:n})=>{const a=be.map((e=>{return t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ft(e,t,r[t])}))}return e}({},e),r=null!=(r={label:e.text})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t;var t,r}));t&&!a.find((e=>e.value===t))&&a.push({label:t,text:t,value:t,hidden:!1});const i=a.filter((e=>!e.hidden));return o().createElement(le,{label:"Lookback period",htmlFor:`${e}-lookback-period`},o().createElement(l.Select,{inputId:`${e}-lookback-period`,width:"auto",allowCustomValue:!0,value:[...a,...r].find((e=>e.value===t)),options:[{label:"Template Variables",options:r},{label:"Predefined periods",expanded:!0,options:i}],onChange:({value:e})=>n(e)}))};function vt(e,t,r,n,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,a)}function gt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const ht=({refId:e,query:t,templateVariableOptions:r,onChange:n,datasource:i})=>{const[c,s]=(0,a.useState)([]),{projectName:u,serviceId:p}=t;return(0,a.useEffect)((()=>{u&&p&&i.getServiceLevelObjectives(u,p).then((e=>{s([{label:"Template Variables",options:r},...e])}))}),[i,u,p,r]),o().createElement(le,{label:"SLO"},o().createElement(l.Select,{inputId:`${e}-slo`,width:"auto",allowCustomValue:!0,value:(null==t?void 0:t.sloId)&&{value:null==t?void 0:t.sloId,label:(null==t?void 0:t.sloName)||(null==t?void 0:t.sloId)},placeholder:"Select SLO",options:c,onChange:function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){vt(o,n,a,i,l,"next",e)}function l(e){vt(o,n,a,i,l,"throw",e)}i(void 0)}))}}((function*({value:e="",label:r=""}){const a=(yield i.getServiceLevelObjectives(u,p)).find((({value:t})=>t===i.templateSrv.replace(e)));var o,l;n((o=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){gt(e,t,r[t])}))}return e}({},t),l=null!=(l={sloId:e,sloName:r,goal:null==a?void 0:a.goal})?l:{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(l)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(l,e))})),o))}));return function(t){return e.apply(this,arguments)}}()}))};function Ot(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Et=({refId:e,query:t,templateVariableOptions:r,onChange:n,datasource:a})=>o().createElement(le,{label:"Selector",htmlFor:`${e}-slo-selector`},o().createElement(l.Select,{inputId:`${e}-slo-selector`,width:"auto",allowCustomValue:!0,value:[...he,...r].find((e=>{var r;return null!==(r=e.value===(null==t?void 0:t.selectorName))&&void 0!==r?r:""})),options:[{label:"Template Variables",options:r},...he],onChange:({value:e})=>{return n((r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Ot(e,t,r[t])}))}return e}({},t),a=null!=(a={selectorName:null!=e?e:""})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(a)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(a,e))})),r));var r,a}}));function St(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const jt=({refId:e,query:t,templateVariableOptions:r,onChange:n,datasource:i})=>{const[c,s]=(0,a.useState)([]),{projectName:u}=t;return(0,a.useEffect)((()=>{u&&i.getSLOServices(u).then((e=>{s([{label:"Template Variables",options:r},...e])}))}),[i,u,r]),o().createElement(le,{label:"Service"},o().createElement(l.Select,{inputId:`${e}-slo-service`,width:"auto",allowCustomValue:!0,value:(null==t?void 0:t.serviceId)&&{value:null==t?void 0:t.serviceId,label:(null==t?void 0:t.serviceName)||(null==t?void 0:t.serviceId)},placeholder:"Select service",options:c,onChange:({value:e="",label:r=""})=>{return n((a=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){St(e,t,r[t])}))}return e}({},t),o=null!=(o={serviceId:e,serviceName:r,sloId:""})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(o)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(o)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(o,e))})),a));var a,o}}))};function Tt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Tt(e,t,r[t])}))}return e}function It(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function wt({refId:e,query:t,datasource:r,onChange:n,variableOptionGroup:i,customMetaData:l,aliasBy:c,onChangeAliasBy:s}){const u=(0,a.useMemo)((()=>Re(l,r)),[l,r]);return o().createElement("span",{"data-testid":Y.components.queryEditor.sloQueryEditor.container.input},o().createElement(ue,null,o().createElement(Ee,{refId:e,templateVariableOptions:i.options,projectName:t.projectName,datasource:r,onChange:e=>n(It(Pt({},t),{projectName:e}))}),o().createElement(jt,{refId:e,datasource:r,templateVariableOptions:i.options,query:t,onChange:n}),o().createElement(ht,{refId:e,datasource:r,templateVariableOptions:i.options,query:t,onChange:n}),o().createElement(Et,{refId:e,datasource:r,templateVariableOptions:i.options,query:t,onChange:n}),t.selectorName===ge&&o().createElement(bt,{refId:e,onChange:e=>n(It(Pt({},t),{lookbackPeriod:e})),current:t.lookbackPeriod,templateVariableOptions:i.options}),o().createElement(Se,null,o().createElement(le,{label:"Alignment period",tooltip:u},o().createElement(We,{inputId:`${e}-alignment-period`,templateVariableOptions:i.options,current:t.alignmentPeriod,onChange:e=>n(It(Pt({},t),{alignmentPeriod:e})),aligmentPeriods:me}))),o().createElement(se,{refId:e,value:c,onChange:s})))}function Nt({query:e,onChange:t,onRunQuery:r}){return o().createElement("span",{"data-testid":Y.components.queryEditor.mqlMetricsQueryEditor.container.input},o().createElement(l.TextArea,{name:"Query",className:"slate-query-field",value:e,rows:10,placeholder:"Enter a Cloud Monitoring MQL query (Run with Shift+Enter)",onBlur:r,onChange:e=>t(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&(e.shiftKey||e.ctrlKey)&&(e.preventDefault(),r())}}))}const Dt=({label:e,onChange:t,value:r,options:n,allowCustomValue:a=!1})=>o().createElement(l.Field,{label:e},o().createElement(l.Select,{width:25,allowCustomValue:a,value:r,onChange:({value:e})=>t(e),options:n}));var Lt=s(635),Ct=s.n(Lt);function _t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const At={label:"None",value:W.None},xt=({query:e,metricDescriptor:t,onChange:r})=>{const n=Rt(t);var a;return o().createElement(le,{label:"Pre-processing",tooltip:"Preprocessing options are displayed when the selected metric has a metric kind of delta or cumulative. The specific options available are determined by the metric's value type. If you select 'Rate', data points are aligned and converted to a rate per time series. If you select 'Delta', data points are aligned by their delta (difference) per time series"},o().createElement(l.RadioButtonGroup,{onChange:n=>{const{perSeriesAligner:a}=e,{valueType:o,metricKind:i}=null!=t?t:{},{perSeriesAligner:l}=Ae(o,i,a,n);var c,s;r((c=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_t(e,t,r[t])}))}return e}({},e),s=null!=(s={preprocessor:n,perSeriesAligner:l})?s:{},Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(s)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(s)).forEach((function(e){Object.defineProperty(c,e,Object.getOwnPropertyDescriptor(s,e))})),c))},value:null!==(a=e.preprocessor)&&void 0!==a?a:W.None,options:n}))},Rt=e=>{const t=null==e?void 0:e.metricKind,r=null==e?void 0:e.valueType;return(0,a.useMemo)((()=>{if(!t||t===z.GAUGE||r===H.DISTRIBUTION)return[At];const e=[At,{label:"Rate",value:W.Rate,description:"Data points are aligned and converted to a rate per time series"}];return t===z.CUMULATIVE?[...e,{label:"Delta",value:W.Delta,description:"Data points are aligned by their delta (difference) per time series"}]:e}),[t,r])};function Ut(e,t,r,n,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,a)}function Mt(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Ut(o,n,a,i,l,"next",e)}function l(e){Ut(o,n,a,i,l,"throw",e)}i(void 0)}))}}function kt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){kt(e,t,r[t])}))}return e}function Qt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function qt({refId:t,onChange:n,datasource:i,query:c,variableOptionGroup:s,customMetaData:u,aliasBy:p,onChangeAliasBy:y,range:d}){const[m,f]=(0,a.useState)({}),[b,v]=(0,a.useState)([]),[g,h]=(0,a.useState)(),[O,E]=(0,a.useState)([]),[S,j]=(0,a.useState)([]),[T,P]=(0,a.useState)(""),[I,w]=(0,a.useState)(Gt({},d));var N;N=d,null===I||I.raw.from.toString()===N.raw.from.toString()&&I.raw.to.toString()===N.raw.to.toString()||w(Gt({},N));const D=(0,l.useTheme2)(),L=(0,l.getSelectStyles)(D),C=(0,l.useStyles2)(Bt),{projectName:_,groupBys:A,crossSeriesReducer:x}=c,R=Ue(c),{templateSrv:U}=i,M=(0,a.useCallback)(((e,t)=>e.find((e=>e.type===U.replace(t)))),[U]);(0,a.useEffect)((()=>{_&&R&&i.getLabels(R,t,_,{groupBys:A,crossSeriesReducer:x},I).then((e=>f(e)))}),[i,A,R,_,t,x,I]),(0,a.useEffect)((()=>{const e=function(){var e=Mt((function*(){if(_){const e=yield i.getMetricTypes(_);(0,r.reportInteraction)("cloud-monitoring-metric-descriptors-loaded",{count:e.length});const t=k(e);v(e),j(t)}}));return function(){return e.apply(this,arguments)}}();e()}),[i,_,C,L.optionDescription]),(0,a.useEffect)((()=>{const e=(e=>{const t=M(e,R);return t?e.filter((e=>e.service===t.service)).map((e=>({service:e.service,value:e.type,label:e.displayName,component:function(){return o().createElement("div",null,o().createElement("div",{className:C},e.type),o().createElement("div",{className:L.optionDescription},e.description))}}))):[]})(b),t=e.length>0?e[0].service:"",r=M(b,R);h(r),E(e),P(t)}),[b,M,R,C,L.optionDescription]);const k=t=>{const r=t.map((t=>({value:t.service,label:(0,e.startCase)(t.serviceShortName)})));return r.length>0?(0,e.uniqBy)(r,(e=>e.value)):[]},G=function(){var e=Mt((function*(e){const t=(yield i.filterMetricsByType(_,T)).filter((t=>t.type.includes(e.toLowerCase()))).map((e=>({value:e.type,label:e.displayName,component:function(){return o().createElement("div",null,o().createElement("div",{className:C},e.type),o().createElement("div",{className:L.optionDescription},e.description))}})));return[{label:"Template Variables",options:s.options},...t]}));return function(t){return e.apply(this,arguments)}}(),Q=Ct()(G,400),q=({value:e})=>{const t=M(b,e);h(t);const{metricKind:r,valueType:a}=t,o=r===z.GAUGE||a===H.DISTRIBUTION?W.None:W.Rate,{perSeriesAligner:l}=Ae(a,r,c.perSeriesAligner,o);Object.assign(c,Qt(Gt({},Jt(i)),{projectName:c.projectName,filters:c.filters})),n(Qt(Gt({},Me(Qt(Gt({},c),{perSeriesAligner:l}),e)),{preprocessor:o}))};return o().createElement("span",{"data-testid":Y.components.queryEditor.visualMetricsQueryEditor.container.input},o().createElement(ue,null,o().createElement(Se,null,o().createElement(Ee,{refId:t,templateVariableOptions:s.options,projectName:_,datasource:i,onChange:e=>{n(Qt(Gt({},c),{projectName:e}))}}),o().createElement(le,{label:"Service",width:"auto"},o().createElement(l.Select,{width:"auto",onChange:({value:e})=>{const t=b.filter((t=>t.service===U.replace(e))).map((e=>({service:e.service,value:e.type,label:e.displayName,description:e.description})));c.filters=[],t.length>0&&!t.some((e=>e.value===U.replace(R)))?(q(t[0]),P(e),E(t)):(P(e),E(t))},isLoading:0===S.length,value:[...S,...s.options].find((e=>e.value===T)),options:[{label:"Template Variables",options:s.options},...S],placeholder:"Select Services",inputId:`${t}-service`})),o().createElement(le,{label:"Metric name",width:"auto",htmlFor:`${t}-select-metric`},o().createElement("span",{title:""===T?"Select a service first":"Type to search metrics"},o().createElement(l.AsyncSelect,{width:"auto",onChange:q,value:[...O,...s.options].find((e=>e.value===R)),loadOptions:Q,defaultOptions:[{label:"Template Variables",options:s.options},...O.slice(0,100)],placeholder:"Select Metric",inputId:`${t}-select-metric`,disabled:""===T}))))),o().createElement(o().Fragment,null,o().createElement(dt,{labels:m,filters:c.filters,onChange:e=>n(Qt(Gt({},c),{filters:e})),variableOptionGroup:s}),o().createElement(ue,null,o().createElement(xt,{metricDescriptor:g,query:c,onChange:n}),o().createElement(Ke,{refId:t,labels:Object.keys(m),query:c,onChange:n,variableOptionGroup:s,metricDescriptor:g}),o().createElement(Xe,{refId:t,datasource:i,templateVariableOptions:s.options,query:c,customMetaData:u,onChange:n,metricDescriptor:g,preprocessor:c.preprocessor}),o().createElement(se,{refId:t,value:p,onChange:y}))))}const Bt=e=>n.css`
  label: grafana-select-option-description;
  font-weight: normal;
  font-style: italic;
  color: ${e.colors.text.secondary};
`,Ft=o().memo(qt),Vt=({refId:e,onChange:t,graphPeriod:r,variableOptionGroup:n})=>o().createElement(ue,null,o().createElement(le,{label:"Graph period",htmlFor:`${e}-graph-period`,tooltip:o().createElement(o().Fragment,null,"Set ",o().createElement("code",null,"graph_period")," which forces a preferred period between points. Automatically set to the current interval if left blank.")},o().createElement(l.HorizontalGroup,null,o().createElement(l.Switch,{"data-testid":`${e}-switch-graph-period`,value:"disabled"!==r,onChange:e=>t(e.currentTarget.checked?"":"disabled")}),o().createElement(We,{inputId:`${e}-graph-period`,templateVariableOptions:n.options,current:r,onChange:t,disabled:"disabled"===r,aligmentPeriods:fe}))));function Kt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $t(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Kt(e,t,r[t])}))}return e}function Yt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Jt=e=>({projectName:e.getDefaultProject(),crossSeriesReducer:"REDUCE_NONE",alignmentPeriod:"cloud-monitoring-auto",perSeriesAligner:X.ALIGN_MEAN,groupBys:[],filters:[]}),Wt=e=>({projectName:e.getDefaultProject(),query:""});function zt({refId:e,query:t,datasource:r,onChange:n,onRunQuery:i,customMetaData:l,variableOptionGroup:c,range:s}){const u=(0,a.useCallback)((e=>{let r=!0;if((null==e?void 0:e.filters)&&e.filters.length>0)for(const t of e.filters)if(""===t){r=!1;break}n(Yt($t({},t),{timeSeriesList:e})),r&&i()}),[n,i,t]),p=(0,a.useCallback)((e=>{n(Yt($t({},t),{timeSeriesQuery:e})),i()}),[n,i,t]);return(0,a.useEffect)((()=>{t.queryType!==J.TIME_SERIES_LIST||t.timeSeriesList||n({refId:t.refId,datasource:t.datasource,queryType:J.TIME_SERIES_LIST,timeSeriesList:Jt(r),aliasBy:t.aliasBy}),t.queryType!==J.TIME_SERIES_QUERY||t.timeSeriesQuery||n({refId:t.refId,datasource:t.datasource,queryType:J.TIME_SERIES_QUERY,timeSeriesQuery:Wt(r),aliasBy:t.aliasBy})}),[n,t,r]),o().createElement($,null,(t.queryType===J.ANNOTATION||t.queryType===J.TIME_SERIES_LIST)&&t.timeSeriesList&&o().createElement(Ft,{refId:e,variableOptionGroup:c,customMetaData:l,onChange:u,datasource:r,query:t.timeSeriesList,aliasBy:t.aliasBy,onChangeAliasBy:e=>n(Yt($t({},t),{aliasBy:e})),range:s}),t.queryType===J.TIME_SERIES_QUERY&&t.timeSeriesQuery&&o().createElement(o().Fragment,null,o().createElement(V,{gap:1,direction:"row"},o().createElement(Ee,{refId:e,datasource:r,onChange:e=>p(Yt($t({},t.timeSeriesQuery),{projectName:e})),templateVariableOptions:c.options,projectName:t.timeSeriesQuery.projectName}),o().createElement(se,{refId:e,value:t.aliasBy,onChange:e=>n(Yt($t({},t),{aliasBy:e}))})),o().createElement(Nt,{onChange:e=>p(Yt($t({},t.timeSeriesQuery),{query:e})),onRunQuery:i,query:t.timeSeriesQuery.query}),o().createElement(Vt,{onChange:e=>p(Yt($t({},t.timeSeriesQuery),{graphPeriod:e})),graphPeriod:t.timeSeriesQuery.graphPeriod,refId:e,variableOptionGroup:c})))}const Ht=o().memo(zt);function Xt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Zt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Xt(e,t,r[t])}))}return e}function er(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function tr({refId:e,query:t,datasource:r,onChange:n,variableOptionGroup:a,onRunQuery:i}){function c(e){"Enter"===e.key&&e.shiftKey&&(i(),e.preventDefault(),e.stopPropagation())}var s;return o().createElement("span",{"data-testid":Y.components.queryEditor.promQlQueryEditor.container.input},o().createElement(ue,null,o().createElement(Ee,{refId:e,templateVariableOptions:a.options,projectName:t.projectName,datasource:r,onChange:e=>n(er(Zt({},t),{projectName:e}))}),o().createElement(l.TextArea,{name:"Query",className:"slate-query-field",value:t.expr,rows:10,placeholder:"Enter a Cloud Monitoring Prometheus query (Run with Shift+Enter)",onBlur:i,onKeyDown:c,onChange:e=>n(er(Zt({},t),{expr:e.currentTarget.value}))}),o().createElement(le,{label:"Min step",tooltip:"Time units and built-in variables can be used here, for example: $__interval, $__rate_interval, 5s, 1m, 3h, 1d, 1y (Default if no unit is specified: 10s)"},o().createElement(l.Input,{type:"string",placeholder:"auto",onChange:e=>n(er(Zt({},t),{step:e.currentTarget.value})),onKeyDown:c,value:null!==(s=t.step)&&void 0!==s?s:""}))))}const rr=({children:e})=>{const t=(0,l.useStyles2)(nr);return o().createElement("div",{className:t.root},e)},nr=e=>({root:(0,n.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:e.spacing(3),minHeight:e.spacing(4)})});var ar=Object.defineProperty,or=Object.defineProperties,ir=Object.getOwnPropertyDescriptors,lr=Object.getOwnPropertySymbols,cr=Object.prototype.hasOwnProperty,sr=Object.prototype.propertyIsEnumerable,ur=(e,t,r)=>t in e?ar(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,pr=(e,t)=>{for(var r in t||(t={}))cr.call(t,r)&&ur(e,r,t[r]);if(lr)for(var r of lr(t))sr.call(t,r)&&ur(e,r,t[r]);return e},yr=(e,t)=>or(e,ir(t));function dr(e){var t=e,{label:r}=t,n=((e,t)=>{var r={};for(var n in e)cr.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&lr)for(var n of lr(e))t.indexOf(n)<0&&sr.call(e,n)&&(r[n]=e[n]);return r})(t,["label"]);const i=(0,l.useStyles2)(br),[c]=(0,a.useState)((()=>Math.random().toString(16).slice(2))),s={SelectContainer:mr,ValueContainer:fr,SingleValue:fr};return o().createElement("div",{className:i.root},r&&o().createElement("label",{className:i.label,htmlFor:c},r,":"," "),o().createElement(l.Select,yr(pr({openMenuOnFocus:!0,inputId:c},n),{components:s})))}const mr=e=>{const{children:t}=e,r=(0,l.useStyles2)(br);return o().createElement(l.SelectContainer,yr(pr({},e),{className:(0,n.cx)(e.className,r.container)}),t)},fr=e=>{const{className:t,children:r}=e,a=(0,l.useStyles2)(br);return o().createElement("div",{className:(0,n.cx)(t,a.valueContainer)},r)},br=e=>({root:(0,n.css)({display:"flex",fontSize:12,alignItems:"center"}),label:(0,n.css)({color:e.colors.text.secondary,whiteSpace:"nowrap"}),container:(0,n.css)({background:"none",borderColor:"transparent"}),valueContainer:(0,n.css)({display:"flex",alignItems:"center",flex:"initial",color:e.colors.text.secondary,fontSize:12})}),vr=({grow:e,shrink:t})=>o().createElement("div",{style:{display:"block",flexGrow:e,flexShrink:t}});function gr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const hr=e=>{const{query:t,onChange:r,onRunQuery:n}=e,{queryType:a}=t;return o().createElement(rr,null,o().createElement(dr,{label:"Query type",options:Oe,value:a,onChange:({value:e})=>{var a,o;r((a=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){gr(e,t,r[t])}))}return e}({},t),o=null!=(o={queryType:e})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(o)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(o)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(o,e))})),a)),n()}}),o().createElement(vr,{grow:1}))};function Or(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Er(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Or(e,t,r[t])}))}return e}function Sr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function jr(e,t,r,n,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,a)}function Tr(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){jr(o,n,a,i,l,"next",e)}function l(e){jr(o,n,a,i,l,"throw",e)}i(void 0)}))}}function Pr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ir(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Pr(e,t,r[t])}))}return e}function wr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class Nr extends a.PureComponent{componentDidMount(){var e=this;return Tr((function*(){yield e.props.datasource.ensureGCEDefaultProject();const t=e.props.query.projectName||e.props.datasource.getDefaultProject(),n=yield e.props.datasource.getProjects(),a=yield e.props.datasource.getMetricTypes(e.props.query.projectName||e.props.datasource.getDefaultProject()),o=Pe(a).map((e=>({value:e.service,label:e.serviceShortName})));let i="";o.some((t=>t.value===(0,r.getTemplateSrv)().replace(e.state.selectedService)))?i=e.state.selectedService:o&&o.length>0&&(i=o[0].value);const{metricTypes:l,selectedMetricType:c}=we(a,e.state.selectedMetricType,(0,r.getTemplateSrv)().replace(e.state.selectedMetricType),(0,r.getTemplateSrv)().replace(i)),s=yield e.props.datasource.getSLOServices(t),u=wr(Ir({services:o,selectedService:i,metricTypes:l,selectedMetricType:c,metricDescriptors:a,projects:n},yield e.getLabels(c,t)),{sloServices:s,loading:!1,projectName:t});e.setState(u,(()=>e.onPropsChange()))}))()}onQueryTypeChange(e){var t=this;return Tr((function*(){const r=Ir({selectedQueryType:e},yield t.getLabels(t.state.selectedMetricType,t.state.projectName,e));t.setState(r)}))()}onProjectChange(e){var t=this;return Tr((function*(){const n=yield t.props.datasource.getMetricTypes(e),a=yield t.getLabels(t.state.selectedMetricType,e),{metricTypes:o,selectedMetricType:i}=we(n,t.state.selectedMetricType,(0,r.getTemplateSrv)().replace(t.state.selectedMetricType),(0,r.getTemplateSrv)().replace(t.state.selectedService)),l=yield t.props.datasource.getSLOServices(e);t.setState(wr(Ir({},a),{metricTypes:o,selectedMetricType:i,metricDescriptors:n,projectName:e,sloServices:l}),(()=>t.onPropsChange()))}))()}onServiceChange(e){var t=this;return Tr((function*(){const{metricTypes:n,selectedMetricType:a}=we(t.state.metricDescriptors,t.state.selectedMetricType,(0,r.getTemplateSrv)().replace(t.state.selectedMetricType),(0,r.getTemplateSrv)().replace(e)),o=Ir({selectedService:e,metricTypes:n,selectedMetricType:a},yield t.getLabels(a,t.state.projectName));t.setState(o,(()=>t.onPropsChange()))}))()}onMetricTypeChange(e){var t=this;return Tr((function*(){const n=Ir({selectedMetricType:e},yield t.getLabels((0,r.getTemplateSrv)().replace(e),t.state.projectName));t.setState(n,(()=>t.onPropsChange()))}))()}onLabelKeyChange(e){this.setState({labelKey:e},(()=>this.onPropsChange()))}componentDidUpdate(e,t){const r=t.selectedQueryType!==this.state.selectedQueryType,n=this.state.selectedSLOService!==t.selectedSLOService;(r||n)&&this.onPropsChange()}getLabels(e,t,n=this.state.selectedQueryType){var a=this;return Tr((function*(){let o={labels:a.state.labels,labelKey:a.state.labelKey};if(e&&n===Z.LabelValues){const n=yield Le(a.props.datasource,e,t),i=n.some((e=>e===(0,r.getTemplateSrv)().replace(a.state.labelKey)))?a.state.labelKey:n[0];o={labels:n,labelKey:i}}return o}))()}renderQueryTypeSwitch(e){const t={label:"Template Variables",expanded:!1,options:(0,r.getTemplateSrv)().getVariables().map((e=>({value:`$${e.name}`,label:`$${e.name}`})))};switch(e){case Z.MetricTypes:return o().createElement(o().Fragment,null,o().createElement(Dt,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"}),o().createElement(Dt,{value:this.state.selectedService,options:[t,...this.state.services],onChange:e=>this.onServiceChange(e),label:"Service"}));case Z.LabelKeys:case Z.LabelValues:case Z.ResourceTypes:return o().createElement(o().Fragment,null,o().createElement(Dt,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"}),o().createElement(Dt,{value:this.state.selectedService,options:[t,...this.state.services],onChange:e=>this.onServiceChange(e),label:"Service"}),o().createElement(Dt,{value:this.state.selectedMetricType,options:[t,...this.state.metricTypes.map((({value:e,name:t})=>({value:e,label:t})))],onChange:e=>this.onMetricTypeChange(e),label:"Metric Type"}),e===Z.LabelValues&&o().createElement(Dt,{value:this.state.labelKey,options:[t,...this.state.labels.map((e=>({value:e,label:e})))],onChange:e=>this.onLabelKeyChange(e),label:"Label Key"}));case Z.Aligners:case Z.Aggregations:return o().createElement(o().Fragment,null,o().createElement(Dt,{value:this.state.selectedService,options:[t,...this.state.services],onChange:e=>this.onServiceChange(e),label:"Service"}),o().createElement(Dt,{value:this.state.selectedMetricType,options:[t,...this.state.metricTypes.map((({value:e,name:t})=>({value:e,label:t})))],onChange:e=>this.onMetricTypeChange(e),label:"Metric Type"}));case Z.Services:case Z.SLOServices:return o().createElement(o().Fragment,null,o().createElement(Dt,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"}));case Z.SLO:return o().createElement(o().Fragment,null,o().createElement(Dt,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"}),o().createElement(Dt,{value:this.state.selectedSLOService,options:[t,...this.state.sloServices],onChange:e=>{this.setState(wr(Ir({},this.state),{selectedSLOService:e}))},label:"SLO Service"}));default:return""}}render(){return this.state.loading?o().createElement(Dt,{value:"loading",options:[{value:"loading",label:"Loading..."}],onChange:e=>null,label:"Query Type"}):o().createElement(o().Fragment,null,o().createElement(Dt,{value:this.state.selectedQueryType,options:this.queryTypes,onChange:e=>this.onQueryTypeChange(e),label:"Query Type"}),this.renderQueryTypeSwitch(this.state.selectedQueryType))}constructor(e){super(e),Pr(this,"queryTypes",[{value:Z.Projects,label:"Projects"},{value:Z.Services,label:"Services"},{value:Z.MetricTypes,label:"Metric Types"},{value:Z.LabelKeys,label:"Label Keys"},{value:Z.LabelValues,label:"Label Values"},{value:Z.ResourceTypes,label:"Resource Types"},{value:Z.Aggregations,label:"Aggregations"},{value:Z.Aligners,label:"Aligners"},{value:Z.AlignmentPeriods,label:"Alignment Periods"},{value:Z.Selectors,label:"Selectors"},{value:Z.SLOServices,label:"SLO Services"},{value:Z.SLO,label:"Service Level Objectives (SLO)"}]),Pr(this,"defaults",{selectedQueryType:this.queryTypes[0].value,metricDescriptors:[],selectedService:"",selectedMetricType:"",labels:[],labelKey:"",metricTypes:[],services:[],sloServices:[],selectedSLOService:"",projects:[],projectName:"",loading:!0}),Pr(this,"onPropsChange",(()=>{const e=this.state,{metricDescriptors:t,labels:r,metricTypes:n,services:a}=e,o=function(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(e,["metricDescriptors","labels","metricTypes","services"]);this.props.onChange(wr(Ir({},o),{refId:"CloudMonitoringVariableQueryEditor-VariableQuery"}))})),this.state=Object.assign(this.defaults,this.props.query)}}var Dr=s(269);function Lr(e){return"function"==typeof e}function Cr(e){return function(t){if(function(e){return Lr(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}var _r=function(e,t){return _r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},_r(e,t)};function Ar(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}_r(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function xr(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(c){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&l[0]?n.return:l[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,l[1])).done)return a;switch(n=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,n=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],n=0}finally{r=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}}function Rr(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ur(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,o=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return i}function Mr(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))}function kr(e){return this instanceof kr?(this.v=e,this):new kr(e)}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var Gr,Qr=((Gr=function(e){var t;t=this,Error.call(t),t.stack=(new Error).stack,this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}).prototype=Object.create(Error.prototype),Gr.prototype.constructor=Gr,Gr);function qr(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Br=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,r,n,a;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var i=Rr(o),l=i.next();!l.done;l=i.next())l.value.remove(this)}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}else o.remove(this);var c=this.initialTeardown;if(Lr(c))try{c()}catch(e){a=e instanceof Qr?e.errors:[e]}var s=this._finalizers;if(s){this._finalizers=null;try{for(var u=Rr(s),p=u.next();!p.done;p=u.next()){var y=p.value;try{Vr(y)}catch(e){a=null!=a?a:[],e instanceof Qr?a=Mr(Mr([],Ur(a)),Ur(e.errors)):a.push(e)}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}if(a)throw new Qr(a)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)Vr(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&qr(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&qr(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function Fr(e){return e instanceof Br||e&&"closed"in e&&Lr(e.remove)&&Lr(e.add)&&Lr(e.unsubscribe)}function Vr(e){Lr(e)?e():e.unsubscribe()}Br.EMPTY;var Kr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},$r={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var a=$r.delegate;return(null==a?void 0:a.setTimeout)?a.setTimeout.apply(a,Mr([e,t],Ur(r))):setTimeout.apply(void 0,Mr([e,t],Ur(r)))},clearTimeout:function(e){var t=$r.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Yr(e){$r.setTimeout((function(){var t=Kr.onUnhandledError;if(!t)throw e;t(e)}))}function Jr(){}var Wr=zr("C",void 0,void 0);function zr(e,t,r){return{kind:e,value:t,error:r}}var Hr=null,Xr=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,Fr(t)&&t.add(r)):r.destination=on,r}return Ar(t,e),t.create=function(e,t,r){return new rn(e,t,r)},t.prototype.next=function(e){this.isStopped?an(function(e){return zr("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?an(zr("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?an(Wr,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Br),Zr=Function.prototype.bind;function en(e,t){return Zr.call(e,t)}var tn=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){nn(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){nn(e)}else nn(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){nn(e)}},e}(),rn=function(e){function t(t,r,n){var a,o,i=e.call(this)||this;return Lr(t)||!t?a={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:i&&Kr.useDeprecatedNextContext?((o=Object.create(t)).unsubscribe=function(){return i.unsubscribe()},a={next:t.next&&en(t.next,o),error:t.error&&en(t.error,o),complete:t.complete&&en(t.complete,o)}):a=t,i.destination=new tn(a),i}return Ar(t,e),t}(Xr);function nn(e){var t;Kr.useDeprecatedSynchronousErrorHandling?(t=e,Kr.useDeprecatedSynchronousErrorHandling&&Hr&&(Hr.errorThrown=!0,Hr.error=t)):Yr(e)}function an(e,t){var r=Kr.onStoppedNotification;r&&$r.setTimeout((function(){return r(e,t)}))}var on={closed:!0,next:Jr,error:function(e){throw e},complete:Jr};function ln(e,t,r,n,a){return new cn(e,t,r,n,a)}var cn=function(e){function t(t,r,n,a,o,i){var l=e.call(this,t)||this;return l.onFinalize=o,l.shouldUnsubscribe=i,l._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,l._error=a?function(e){try{a(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,l._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,l}return Ar(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Xr);function sn(e,t){return Cr((function(r,n){var a=0;r.subscribe(ln(n,(function(r){n.next(e.call(t,r,a++))})))}))}var un=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},pn="function"==typeof Symbol&&Symbol.observable||"@@observable";function yn(e){return e}var dn=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n,a=this,o=(n=e)&&n instanceof Xr||function(e){return e&&Lr(e.next)&&Lr(e.error)&&Lr(e.complete)}(n)&&Fr(n)?e:new rn(e,t,r);return function(e){if(Kr.useDeprecatedSynchronousErrorHandling){var t=!Hr;if(t&&(Hr={errorThrown:!1,error:null}),e(),t){var r=Hr,n=r.errorThrown,a=r.error;if(Hr=null,n)throw a}}else e()}((function(){var e=a,t=e.operator,r=e.source;o.add(t?t.call(o,r):r?a._subscribe(o):a._trySubscribe(o))})),o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=mn(t))((function(t,n){var a=new rn({next:function(t){try{e(t)}catch(e){n(e),a.unsubscribe()}},error:n,complete:t});r.subscribe(a)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[pn]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(r=e).length?yn:1===r.length?r[0]:function(e){return r.reduce((function(e,t){return t(e)}),e)})(this);var r},e.prototype.toPromise=function(e){var t=this;return new(e=mn(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}();function mn(e){var t;return null!==(t=null!=e?e:Kr.Promise)&&void 0!==t?t:Promise}var fn="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function bn(e){if(e instanceof dn)return e;if(null!=e){if(function(e){return Lr(e[pn])}(e))return o=e,new dn((function(e){var t=o[pn]();if(Lr(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(un(e))return a=e,new dn((function(e){for(var t=0;t<a.length&&!e.closed;t++)e.next(a[t]);e.complete()}));if(Lr(null==(n=e)?void 0:n.then))return r=e,new dn((function(e){r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Yr)}));if(function(e){return Symbol.asyncIterator&&Lr(null==e?void 0:e[Symbol.asyncIterator])}(e))return vn(e);if(function(e){return Lr(null==e?void 0:e[fn])}(e))return t=e,new dn((function(e){var r,n;try{for(var a=Rr(t),o=a.next();!o.done;o=a.next()){var i=o.value;if(e.next(i),e.closed)return}}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}e.complete()}));if(function(e){return Lr(null==e?void 0:e.getReader)}(e))return vn(function(e){return function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,a=r.apply(e,t||[]),o=[];return n={},i("next"),i("throw"),i("return",(function(e){return function(t){return Promise.resolve(t).then(e,s)}})),n[Symbol.asyncIterator]=function(){return this},n;function i(e,t){a[e]&&(n[e]=function(t){return new Promise((function(r,n){o.push([e,t,r,n])>1||l(e,t)}))},t&&(n[e]=t(n[e])))}function l(e,t){try{(r=a[e](t)).value instanceof kr?Promise.resolve(r.value.v).then(c,s):u(o[0][2],r)}catch(e){u(o[0][3],e)}var r}function c(e){l("next",e)}function s(e){l("throw",e)}function u(e,t){e(t),o.shift(),o.length&&l(o[0][0],o[0][1])}}(this,arguments,(function(){var t,r,n;return xr(this,(function(a){switch(a.label){case 0:t=e.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,kr(t.read())];case 3:return r=a.sent(),n=r.value,r.done?[4,kr(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,kr(n)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}(e))}var t,r,n,a,o;throw function(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}(e)}function vn(e){return new dn((function(t){(function(e,t){var r,n,a,o,i,l,c,s;return i=this,l=void 0,s=function(){var i,l;return xr(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),r=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=Rr(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,a){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,a,(t=e[r](t)).done,t.value)}))}}}(e),c.label=1;case 1:return[4,r.next()];case 2:if((n=c.sent()).done)return[3,4];if(i=n.value,t.next(i),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return l=c.sent(),a={error:l},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(o=r.return)?[4,o.call(r)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))},new((c=void 0)||(c=Promise))((function(e,t){function r(e){try{a(s.next(e))}catch(e){t(e)}}function n(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var a;t.done?e(t.value):(a=t.value,a instanceof c?a:new c((function(e){e(a)}))).then(r,n)}a((s=s.apply(i,l||[])).next())}))})(e,t).catch((function(e){return t.error(e)}))}))}function gn(e,t,r){return void 0===r&&(r=1/0),Lr(t)?gn((function(r,n){return sn((function(e,a){return t(r,e,n,a)}))(bn(e(r,n)))}),r):("number"==typeof t&&(r=t),Cr((function(t,n){return function(e,t,r,n,a,o,i,l){var c=[],s=0,u=0,p=!1,y=function(){!p||c.length||s||t.complete()},d=function(e){return s<n?m(e):c.push(e)},m=function(e){s++;var a=!1;bn(r(e,u++)).subscribe(ln(t,(function(e){t.next(e)}),(function(){a=!0}),void 0,(function(){if(a)try{s--;for(var e=function(){var e=c.shift();m(e)};c.length&&s<n;)e();y()}catch(e){t.error(e)}})))};return e.subscribe(ln(t,d,(function(){p=!0,y()}))),function(){}}(t,n,e,r)})))}function hn(e,t,r){void 0===t&&(t=0),void 0===r&&(r=[]);var n=function(e,t){void 0===t&&(t=0);var r=(0,a.useRef)(!1),n=(0,a.useRef)(),o=(0,a.useRef)(e),i=(0,a.useCallback)((function(){return r.current}),[]),l=(0,a.useCallback)((function(){r.current=!1,n.current&&clearTimeout(n.current),n.current=setTimeout((function(){r.current=!0,o.current()}),t)}),[t]),c=(0,a.useCallback)((function(){r.current=null,n.current&&clearTimeout(n.current)}),[]);return(0,a.useEffect)((function(){o.current=e}),[e]),(0,a.useEffect)((function(){return l(),c}),[t]),[i,c,l]}(e,t),o=n[0],i=n[1],l=n[2];return(0,a.useEffect)(l,r),[o,i]}function On(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function En(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){On(e,t,r[t])}))}return e}function Sn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const jn=e=>{const{datasource:r,query:n,onRunQuery:i,data:c,onChange:s,range:u}=e,p=(null==c?void 0:c.series.length)?null==c?void 0:c.series[0].meta:{};var y;const d=null!==(y=null==p?void 0:p.custom)&&void 0!==y?y:{},m=En({},(e=>Sn(En({},Jt(e)),{title:"",text:""}))(r),n.timeSeriesList),[f,b]=(0,a.useState)(m.title||""),[v,g]=(0,a.useState)(m.text||""),h={label:"Template Variables",options:r.getVariables().map(t.toOption)};return hn((()=>{s(Sn(En({},n),{timeSeriesList:Sn(En({},m),{title:f})}))}),1e3,[f,s]),hn((()=>{s(Sn(En({},n),{timeSeriesList:Sn(En({},m),{text:v})}))}),1e3,[v,s]),(0,a.useEffect)((()=>{n.queryType&&Object.values(J).includes(n.queryType)||s(Sn(En({},n),{queryType:J.TIME_SERIES_LIST}))})),o().createElement($,null,o().createElement(o().Fragment,null,o().createElement(Ht,{refId:n.refId,variableOptionGroup:h,customMetaData:d,onChange:s,onRunQuery:i,datasource:r,query:n,range:u||(0,t.getDefaultTimeRange)()}),o().createElement(le,{label:"Title",htmlFor:"annotation-query-title"},o().createElement(l.Input,{id:"annotation-query-title",value:f,onChange:e=>{b(e.target.value)}})),o().createElement(le,{label:"Text",htmlFor:"annotation-query-text"},o().createElement(l.Input,{id:"annotation-query-text",value:v,onChange:e=>{g(e.target.value)}}))),o().createElement(mt,null))};function Tn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Pn=e=>({prepareAnnotation:t=>{if(!(e=>{var t,r;return void 0!==(null===(t=e.target)||void 0===t?void 0:t.title)||void 0!==(null===(r=e.target)||void 0===r?void 0:r.text)})(t))return t;const{enable:r,name:n,iconColor:a}=t,{target:o}=t;return{datasource:t.datasource,enable:r,name:n,iconColor:a,target:{intervalMs:e.intervalMs,refId:(null==o?void 0:o.refId)||"annotationQuery",queryType:J.ANNOTATION,timeSeriesList:{projectName:(null==o?void 0:o.projectName)||e.getDefaultProject(),filters:(null==o?void 0:o.filters)||[],crossSeriesReducer:"REDUCE_NONE",perSeriesAligner:X.ALIGN_NONE,title:(null==o?void 0:o.title)||"",text:(null==o?void 0:o.text)||""}}}},prepareQuery:e=>{if(e.target)return t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Tn(e,t,r[t])}))}return e}({},e.target),r=null!=(r={queryType:J.ANNOTATION,type:"annotationQuery"})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t;var t,r},QueryEditor:jn});function In(e,t,r,n,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,a)}function wn(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){In(o,n,a,i,l,"next",e)}function l(e){In(o,n,a,i,l,"throw",e)}i(void 0)}))}}function Nn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Dn{execute(e){var t=this;return wn((function*(){try{switch(e.projectName||(e.projectName=t.datasource.getDefaultProject()),e.selectedQueryType){case Z.Projects:return t.handleProjectsQuery();case Z.Services:return t.handleServiceQuery(e);case Z.MetricTypes:return t.handleMetricTypesQuery(e);case Z.LabelKeys:return t.handleLabelKeysQuery(e);case Z.LabelValues:return t.handleLabelValuesQuery(e);case Z.ResourceTypes:return t.handleResourceTypeQuery(e);case Z.Aligners:return t.handleAlignersQuery(e);case Z.AlignmentPeriods:return t.handleAlignmentPeriodQuery();case Z.Aggregations:return t.handleAggregationQuery(e);case Z.SLOServices:return t.handleSLOServicesQuery(e);case Z.SLO:return t.handleSLOQuery(e);case Z.Selectors:return t.handleSelectorQuery();default:return[]}}catch(t){return console.error(`Could not run CloudMonitoringMetricFindQuery ${e}`,t),[]}}))()}handleProjectsQuery(){var e=this;return wn((function*(){return(yield e.datasource.getProjects()).map((e=>({text:e.label,value:e.value,expandable:!0})))}))()}handleServiceQuery({projectName:e}){var t=this;return wn((function*(){const r=yield t.datasource.getMetricTypes(e);return Pe(r).map((e=>({text:e.serviceShortName,value:e.service,expandable:!0})))}))()}handleMetricTypesQuery({selectedService:e,projectName:t}){var r=this;return wn((function*(){if(!e)return[];const n=yield r.datasource.getMetricTypes(t);return Ie(n,r.datasource.templateSrv.replace(e)).map((e=>({text:e.displayName,value:e.type,expandable:!0})))}))()}handleLabelKeysQuery({selectedMetricType:e,projectName:t}){var r=this;return wn((function*(){return e?(yield Le(r.datasource,e,t)).map(r.toFindQueryResult):[]}))()}handleLabelValuesQuery({selectedMetricType:e,labelKey:t,projectName:r}){var n=this;return wn((function*(){if(!e)return[];const a=yield n.datasource.getLabels(e,"handleLabelValuesQuery",r,{groupBys:[t],crossSeriesReducer:"REDUCE_MEAN"}),o=n.datasource.templateSrv.replace(t);return(a.hasOwnProperty(o)?a[o]:[]).map(n.toFindQueryResult)}))()}handleResourceTypeQuery({selectedMetricType:e,projectName:t}){var r=this;return wn((function*(){var n,a;return e&&null!==(a=null===(n=(yield r.datasource.getLabels(e,"handleResourceTypeQueryQueryType",t))["resource.type"])||void 0===n?void 0:n.map(r.toFindQueryResult))&&void 0!==a?a:[]}))()}handleAlignersQuery({selectedMetricType:e,projectName:t}){var r=this;return wn((function*(){if(!e)return[];const n=(yield r.datasource.getMetricTypes(t)).find((t=>t.type===r.datasource.templateSrv.replace(e)));return n?Ne(n.valueType,n.metricKind).map(r.toFindQueryResult):[]}))()}handleAggregationQuery({selectedMetricType:e,projectName:t}){var r=this;return wn((function*(){if(!e)return[];const n=(yield r.datasource.getMetricTypes(t)).find((t=>t.type===r.datasource.templateSrv.replace(e)));return n?De(n.valueType,n.metricKind).map(r.toFindQueryResult):[]}))()}handleSLOServicesQuery({projectName:e}){var t=this;return wn((function*(){return(yield t.datasource.getSLOServices(e)).map(t.toFindQueryResult)}))()}handleSLOQuery({selectedSLOService:e,projectName:t}){var r=this;return wn((function*(){return(yield r.datasource.getServiceLevelObjectives(t,e)).map(r.toFindQueryResult)}))()}handleSelectorQuery(){var e=this;return wn((function*(){return he.map(e.toFindQueryResult)}))()}handleAlignmentPeriodQuery(){return me.map(this.toFindQueryResult)}toFindQueryResult(t){return(0,e.isString)(t)?{text:t,expandable:!0}:(r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Nn(e,t,r[t])}))}return e}({},t),n=null!=(n={expandable:!0})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(n)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))})),r);var r,n}constructor(e){Nn(this,"datasource",void 0),this.datasource=e}}function Ln(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Cn extends t.CustomVariableSupport{query(e){const t=(0,Dr.from)(this.metricFindQuery.execute(e.targets[0]));return(0,Dr.from)(this.datasource.ensureGCEDefaultProject()).pipe(gn((()=>t)),sn((e=>({data:e}))))}constructor(e){super(),Ln(this,"datasource",void 0),Ln(this,"metricFindQuery",void 0),Ln(this,"editor",void 0),this.datasource=e,this.editor=Nr,this.metricFindQuery=new Dn(e)}}function _n(e,t,r,n,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,a)}function An(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){_n(o,n,a,i,l,"next",e)}function l(e){_n(o,n,a,i,l,"throw",e)}i(void 0)}))}}function xn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Rn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){xn(e,t,r[t])}))}return e}function Un(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class Mn extends r.DataSourceWithBackend{getVariables(){return this.templateSrv.getVariables().map((e=>`$${e.name}`))}query(e){return e.targets=e.targets.map((t=>Un(Rn({},this.migrateQuery(t)),{intervalMs:e.intervalMs}))),super.query(e)}applyTemplateVariables(e,t){const{timeSeriesList:r,timeSeriesQuery:n,sloQuery:a,promQLQuery:o}=e;return Un(Rn({},e),{datasource:this.getRef(),intervalMs:this.intervalMs,timeSeriesList:r&&Un(Rn({},this.interpolateProps(r,t)),{projectName:this.templateSrv.replace(r.projectName?r.projectName:this.getDefaultProject(),t),filters:this.interpolateFilters(r.filters||[],t),groupBys:this.interpolateGroupBys(r.groupBys||[],t),view:r.view||"FULL"}),timeSeriesQuery:n&&Un(Rn({},this.interpolateProps(n,t)),{projectName:this.templateSrv.replace(n.projectName?n.projectName:this.getDefaultProject(),t)}),sloQuery:a&&this.interpolateProps(a,t),promQLQuery:o&&this.interpolateProps(o,t,{expr:this.interpolatePromQLQuery})})}getLabels(e,n,a,o,i){var l=this;return An((function*(){var c;const s={targets:[{refId:n,datasource:l.getRef(),queryType:J.TIME_SERIES_LIST,timeSeriesList:Me({projectName:l.templateSrv.replace(a),groupBys:l.interpolateGroupBys((null==o?void 0:o.groupBys)||[],{}),crossSeriesReducer:null!==(c=null==o?void 0:o.crossSeriesReducer)&&void 0!==c?c:"REDUCE_NONE",view:"HEADERS"},l.templateSrv.replace(e))}],range:i||(0,t.getDefaultTimeRange)()},u=s.targets;return u.length?(0,Dr.lastValueFrom)((0,Dr.from)(l.ensureGCEDefaultProject()).pipe(gn((()=>l.backendSrv.fetch({url:"/api/ds/query",method:"POST",headers:l.getRequestHeaders(),data:{from:s.range.from.valueOf().toString(),to:s.range.to.valueOf().toString(),queries:u}}))),sn((({data:e})=>{const t=(0,r.toDataQueryResponse)({data:e}),n=null==t?void 0:t.data.map((e=>{var t,r;return null===(r=e.meta)||void 0===r||null===(t=r.custom)||void 0===t?void 0:t.labels})).filter((e=>!!e)).reduce(((e,t)=>{for(let r in t)e[r]||(e[r]=new Set),t[r]&&e[r].add(t[r]);return e}),{});return Object.fromEntries(Object.entries(n).map((([e,t])=>[e,Array.from(t)])))})))):(0,Dr.lastValueFrom)((0,Dr.of)({results:[]}))}))()}getGCEDefaultProject(){var e=this;return An((function*(){return e.getResource("gceDefaultProject")}))()}getDefaultProject(){const{defaultProject:e,authenticationType:t,gceDefaultProject:r}=this.instanceSettings.jsonData;return"gce"===t?r||"":e||""}ensureGCEDefaultProject(){var e=this;return An((function*(){const{authenticationType:t,gceDefaultProject:r}=e.instanceSettings.jsonData;"gce"!==t||r||(e.instanceSettings.jsonData.gceDefaultProject=yield e.getGCEDefaultProject())}))()}getMetricTypes(e){var t=this;return An((function*(){return e?t.getResource(`metricDescriptors/v3/projects/${t.templateSrv.replace(e)}/metricDescriptors`):[]}))()}filterMetricsByType(e,t){var r=this;return An((function*(){return e?r.getResource(`metricDescriptors/v3/projects/${r.templateSrv.replace(e)}/metricDescriptors`,{filter:`metric.type : "${t}"`}):[]}))()}getSLOServices(e){var t=this;return An((function*(){return t.getResource(`services/v3/projects/${t.templateSrv.replace(e)}/services?pageSize=1000`)}))()}getServiceLevelObjectives(e,t){var r=this;return An((function*(){if(!t)return Promise.resolve([]);let{projectName:n,serviceId:a}=r.interpolateProps({projectName:e,serviceId:t});return r.getResource(`slo-services/v3/projects/${n}/services/${a}/serviceLevelObjectives`)}))()}getProjects(){return this.getResource("projects")}migrateMetricTypeFilter(e,t){const r=["metric.type","=",e];return(null==t?void 0:t.length)?t.concat("AND",r):r}migrateQuery(t){const{hide:r,refId:n,datasource:a,key:o,queryType:i,maxLines:l,metric:c,intervalMs:s,type:u}=t,p=function(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(t,["hide","refId","datasource","key","queryType","maxLines","metric","intervalMs","type"]);if(!(t.hasOwnProperty("metricQuery")||t.hasOwnProperty("sloQuery")||t.hasOwnProperty("timeSeriesQuery")||t.hasOwnProperty("timeSeriesList"))){let i=p.filters||[];return p.metricType&&(i=this.migrateMetricTypeFilter(p.metricType,i)),{datasource:a,key:o,refId:n,intervalMs:s,hide:r,queryType:"annotationQuery"===u?J.ANNOTATION:J.TIME_SERIES_LIST,timeSeriesList:Un(Rn({},p),{projectName:(0,e.get)(t,"projectName")||this.getDefaultProject(),filters:i,view:p.view||"FULL"})}}var y;if((0,e.has)(t,"metricQuery")&&["metrics",J.ANNOTATION].includes(null!==(y=t.queryType)&&void 0!==y?y:"")){const r=(0,e.get)(t,"metricQuery");"mql"===r.editorMode?(t.timeSeriesQuery={projectName:r.projectName,query:r.query,graphPeriod:r.graphPeriod},t.queryType=J.TIME_SERIES_QUERY):(t.timeSeriesList={projectName:r.projectName||this.getDefaultProject(),crossSeriesReducer:r.crossSeriesReducer,alignmentPeriod:r.alignmentPeriod,perSeriesAligner:r.perSeriesAligner,groupBys:r.groupBys,filters:r.filters,view:r.view,preprocessor:r.preprocessor},t.queryType=J.TIME_SERIES_LIST,r.metricType&&(t.timeSeriesList.filters=this.migrateMetricTypeFilter(r.metricType,t.timeSeriesList.filters))),t.aliasBy=r.aliasBy,t=(0,e.omit)(t,"metricQuery")}if(t.queryType===J.SLO&&(0,e.has)(t,"sloQuery.aliasBy")){const r=(0,e.get)(t,"sloQuery.aliasBy");"string"==typeof r&&(t.aliasBy=r),t=(0,e.omit)(t,"sloQuery.aliasBy")}return t}interpolatePromQLQuery(t,r){return(0,e.isArray)(t)?t.join("|"):t}interpolateProps(t,r={},n){return Object.entries(t).reduce(((t,[a,o])=>{let i=o;return o&&(0,e.isString)(o)&&(i=this.templateSrv.replace(o,r,n&&n[a])),Un(Rn({},t),{[a]:i})}),{})}filterQuery(e){if(e.hide)return!1;const t=this.migrateQuery(e);if(t.queryType===J.SLO){if(!t.sloQuery)return!1;const{selectorName:e,serviceId:r,sloId:n,projectName:a,lookbackPeriod:o}=t.sloQuery;return!(!e||!r||!n||!a||e===ge&&!o)}return t.queryType===J.TIME_SERIES_QUERY?!!t.timeSeriesQuery&&!!t.timeSeriesQuery.projectName&&!!t.timeSeriesQuery.query:t.queryType&&[J.TIME_SERIES_LIST,J.ANNOTATION].includes(t.queryType)?!!t.timeSeriesList&&!!t.timeSeriesList.projectName&&!!Ue(t.timeSeriesList):t.queryType===J.PROMQL&&!!(t.promQLQuery&&t.promQLQuery.projectName&&t.promQLQuery.expr&&t.promQLQuery.step)}interpolateVariablesInQueries(e,t){return e.map((e=>this.applyTemplateVariables(this.migrateQuery(e),t)))}interpolateFilters(t,r){const n=(0,e.chunk)(t,4).map((([e,t,r,n])=>Rn({key:e,operator:t,value:r},n&&{condition:n}))).filter((e=>e.value));return(0,e.flatten)(n.map((({key:t,operator:n,value:a,condition:o})=>[this.templateSrv.replace(t,r||{}),n,this.templateSrv.replace(a,r||{},(t=>(0,e.isArray)(t)&&t.length?`(${t.join("|")})`:t)),...o?[o]:[]])))||[]}interpolateGroupBys(e,t){let r=[];return(e||[]).forEach((e=>{const n=this.templateSrv.replace(e,t||{},"csv").split(",");Array.isArray(n)?r=r.concat(n):r.push(n)})),r}constructor(e,t=(0,r.getTemplateSrv)()){super(e),xn(this,"instanceSettings",void 0),xn(this,"templateSrv",void 0),xn(this,"authenticationType",void 0),xn(this,"intervalMs",void 0),xn(this,"backendSrv",void 0),this.instanceSettings=e,this.templateSrv=t,this.authenticationType=e.jsonData.authenticationType||"jwt",this.variables=new Cn(this),this.intervalMs=0,this.annotations=Pn(this),this.backendSrv=(0,r.getBackendSrv)()}}const kn=new t.DataSourcePlugin(Mn).setQueryEditorHelp(i).setQueryEditor((r=>{var n,i;const{datasource:c,query:s,onRunQuery:u,onChange:p,range:y}=r,[d,m]=(0,a.useState)(!1);(0,a.useEffect)((()=>{const e=c.migrateQuery(s);Q()(e,s)||p(Er({},e))}),[s,c,p]);const[f,b]=(0,a.useState)(s),[v,g]=(0,a.useState)(!1),h=Er({},{projectName:c.getDefaultProject(),alignmentPeriod:"cloud-monitoring-auto",perSeriesAligner:X.ALIGN_MEAN,aliasBy:"",selectorName:"select_slo_health",serviceId:"",serviceName:"",sloId:"",sloName:"",lookbackPeriod:""},s.sloQuery),O=Er({},{projectName:c.getDefaultProject(),expr:"",step:"10s"},s.promQLQuery),E=(null===(n=r.data)||void 0===n?void 0:n.series.length)?null===(i=r.data)||void 0===i?void 0:i.series[0].meta:{};var S;const j=null!==(S=null==E?void 0:E.custom)&&void 0!==S?S:{},T={label:"Template Variables",expanded:!1,options:c.getVariables().map(t.toOption)};(0,a.useEffect)((()=>{s.queryType&&Object.values(J).includes(s.queryType)||p(Sr(Er({},s),{queryType:J.TIME_SERIES_LIST}))}));const P=s.queryType;return o().createElement("span",{"data-testid":Y.components.queryEditor.container},o().createElement($,null,o().createElement(l.ConfirmModal,{"data-testid":"switch-query-type-modal",title:"Warning",body:"By switching your query type, your current query will be lost.",isOpen:d,onConfirm:()=>{m(!1),p(f),g(!1)},confirmText:"Confirm",onDismiss:()=>{m(!1),b(s)}}),o().createElement(hr,{query:s,onChange:e=>{!v||f.queryType!==J.TIME_SERIES_LIST&&f.queryType!==J.TIME_SERIES_QUERY?p(e):f.queryType!==e.queryType&&m(!0),b(e)},onRunQuery:u}),P===J.PROMQL&&o().createElement(tr,{refId:s.refId,variableOptionGroup:T,onChange:e=>{p(Sr(Er({},s),{promQLQuery:e}))},onRunQuery:u,datasource:c,query:O}),P!==J.SLO&&o().createElement(Ht,{refId:s.refId,variableOptionGroup:T,customMetaData:j,onChange:t=>{(t.queryType===J.TIME_SERIES_LIST&&!(0,e.isEqual)(t.timeSeriesList,Jt(c))||t.queryType===J.TIME_SERIES_QUERY&&!(0,e.isEqual)(t.timeSeriesQuery,Wt(c)))&&g(!0),p(t)},onRunQuery:u,datasource:c,query:s,range:y||(0,t.getDefaultTimeRange)()}),P===J.SLO&&o().createElement(wt,{refId:s.refId,variableOptionGroup:T,customMetaData:j,onChange:e=>{p(Sr(Er({},s),{sloQuery:e})),u()},onRunQuery:u,datasource:c,query:h,aliasBy:s.aliasBy,onChangeAliasBy:e=>p(Sr(Er({},s),{aliasBy:e}))})))})).setConfigEditor(k).setVariableQueryEditor(Nr);(0,r.getAppEvents)().subscribe(t.DashboardLoadedEvent,(({payload:{dashboardId:t,orgId:n,grafanaVersion:a,queries:o}})=>{const i=o.stackdriver;let l={[J.TIME_SERIES_QUERY]:0,[J.TIME_SERIES_LIST]:0,[J.SLO]:0,[J.ANNOTATION]:0,[J.PROMQL]:0};var c;i.forEach((t=>{t.queryType===J.TIME_SERIES_QUERY||t.queryType===J.TIME_SERIES_LIST||t.queryType===J.SLO||t.queryType===J.ANNOTATION||t.queryType===J.PROMQL?l[t.queryType]++:"metrics"===t.queryType&&(t.hasOwnProperty("type")&&"annotationQuery"===(0,e.get)(t,"type")&&l.annotation++,"mql"===(0,e.get)(t,"metricQuery.editorMode")?l.timeSeriesQuery++:l.timeSeriesList++)})),i&&i.length>0&&(c={grafana_version:a,dashboard_id:t,org_id:n,mql_queries:l[J.TIME_SERIES_QUERY],time_series_filter_queries:l[J.TIME_SERIES_LIST],slo_queries:l[J.SLO],annotation_queries:l[J.ANNOTATION],promQL_queries:l[J.PROMQL]},(0,r.reportInteraction)("grafana_ds_cloudmonitoring_dashboard_loaded",c))}))})(),u})()));
//# sourceMappingURL=module.js.map