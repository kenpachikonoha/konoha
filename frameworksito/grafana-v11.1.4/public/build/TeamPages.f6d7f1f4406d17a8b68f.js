"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2212],{31084:(j,I,e)=>{e.d(I,{Y:()=>P});var D=e(96540),t=e(41053),h=e(10096),M=e(31678),T=e(37425),v=e(85927);const P=({teamId:A,roleOptions:d,disabled:a,roles:i,onApplyRoles:f,pendingRoles:g,apply:C=!1,maxWidth:S,width:z,isLoading:U})=>{const[{loading:E,value:y=i||[]},W]=(0,t.A)(async()=>{try{if(i)return i;if(C&&g?.length)return g;if(h.contextSrv.hasPermission(M.AccessControlAction.ActionTeamsRolesList)&&A>0)return await(0,v.xN)(A)}catch(O){console.error("Error loading options",O)}return[]},[A,g,i]);(0,D.useEffect)(()=>{W()},[W]);const B=async O=>{C?f&&f(O):(await(0,v.G3)(O,A),await W())},F=h.contextSrv.hasPermission(M.AccessControlAction.ActionTeamsRolesAdd)&&h.contextSrv.hasPermission(M.AccessControlAction.ActionTeamsRolesRemove);return D.createElement(T.n,{apply:C,onRolesChange:B,roleOptions:d,appliedRoles:y,isLoading:E||U,disabled:a,basicRoleDisabled:!0,canUpdateRoles:F,maxWidth:S,width:z})}},54939:(j,I,e)=>{e.d(I,{o:()=>v});var D=e(96540),t=e(24705),h=e(10096),M=e(31678),T=e(85927);const v=P=>{const[A,d]=(0,D.useState)(P),{value:a=[]}=(0,t.A)(async()=>h.contextSrv.licensedAccessControlEnabled()&&h.contextSrv.hasPermission(M.AccessControlAction.ActionRolesList)?(0,T.RL)(A):Promise.resolve([]),[A]);return[{roleOptions:a},d]}},39745:(j,I,e)=>{e.d(I,{A:()=>J,u:()=>O});var D=e(32196),t=e(96540),h=e(97594),M=e(41987),T=e(13544),v=e(14110),P=e(32264),A=e(84167),d=e(88575),a=e(21594),i=e(60029),f=e(20333),g=e(15648),C=e(29678),S=e(55852),z=e(3911),U=e(59429),E=e(8484),y=e(74513),W=e(65615),B=e(2769);function F(){const m=y.Yj.map(r=>({value:r.code,label:r.name})).sort((r,_)=>r.value===y.wi?1:_.value===y.wi?-1:r.label.localeCompare(_.label));return[{value:"",label:(0,E.t)("common.locale.default","Default")},...m]}class O extends t.PureComponent{constructor(l){super(l),this.onSubmitForm=async r=>{if(r.preventDefault(),this.props.onConfirm?await this.props.onConfirm():!0){const{homeDashboardUID:$,theme:R,timezone:b,weekStart:K,language:x,queryHistory:L}=this.state;await this.service.update({homeDashboardUID:$,theme:R,timezone:b,weekStart:K,language:x,queryHistory:L}),window.location.reload()}},this.onThemeChanged=r=>{this.setState({theme:r.value}),r.value&&(0,B.K)(r.value,!0)},this.onTimeZoneChanged=r=>{typeof r=="string"&&this.setState({timezone:r})},this.onWeekStartChanged=r=>{this.setState({weekStart:r})},this.onHomeDashboardChanged=r=>{this.setState({homeDashboardUID:r})},this.onLanguageChanged=r=>{this.setState({language:r}),(0,v.rR)("grafana_preferences_language_changed",{toLanguage:r,preferenceType:this.props.preferenceType})},this.service=new W.W(l.resourceUri),this.state={theme:"",timezone:"",weekStart:"",language:"",queryHistory:{homeTab:""}},this.themeOptions=(0,h.k)(P.$.featureToggles.extraThemes).map(r=>({value:r.id,label:s(r)})),this.themeOptions.unshift({value:"",label:(0,E.t)("shared-preferences.theme.default-label","Default")})}async componentDidMount(){const l=await this.service.load();this.setState({homeDashboardUID:l.homeDashboardUID,theme:l.theme,timezone:l.timezone,weekStart:l.weekStart,language:l.language,queryHistory:l.queryHistory})}render(){const{theme:l,timezone:r,weekStart:_,homeDashboardUID:$,language:R}=this.state,{disabled:b}=this.props,K=n(),x=F(),L=this.themeOptions.find(N=>N.value===l)??this.themeOptions[0];return t.createElement("form",{onSubmit:this.onSubmitForm,className:K.form},t.createElement(A.n,{label:t.createElement(E.x6,{i18nKey:"shared-preferences.title"},"Preferences"),disabled:b},t.createElement(d.D,{label:(0,E.t)("shared-preferences.fields.theme-label","Interface theme")},t.createElement(a.l6,{options:this.themeOptions,value:L,onChange:this.onThemeChanged,inputId:"shared-preferences-theme-select"})),t.createElement(d.D,{label:t.createElement(i.J,{htmlFor:"home-dashboard-select"},t.createElement("span",{className:K.labelText},t.createElement(E.x6,{i18nKey:"shared-preferences.fields.home-dashboard-label"},"Home Dashboard"))),"data-testid":"User preferences home dashboard drop down"},t.createElement(U.b,{value:$,onChange:N=>this.onHomeDashboardChanged(N?.uid??""),defaultOptions:!0,isClearable:!0,placeholder:(0,E.t)("shared-preferences.fields.home-dashboard-placeholder","Default dashboard"),inputId:"home-dashboard-select"})),t.createElement(d.D,{label:(0,E.t)("shared-dashboard.fields.timezone-label","Timezone"),"data-testid":T.Tp.components.TimeZonePicker.containerV2},t.createElement(f.U,{includeInternal:!0,value:r,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})),t.createElement(d.D,{label:(0,E.t)("shared-preferences.fields.week-start-label","Week start"),"data-testid":T.Tp.components.WeekStartPicker.containerV2},t.createElement(g.l,{value:_||"",onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})),t.createElement(d.D,{label:t.createElement(i.J,{htmlFor:"locale-select"},t.createElement("span",{className:K.labelText},t.createElement(E.x6,{i18nKey:"shared-preferences.fields.locale-label"},"Language")),t.createElement(C.y,{featureState:M.Ay.beta})),"data-testid":"User preferences language drop down"},t.createElement(a.l6,{value:x.find(N=>N.value===R),onChange:N=>this.onLanguageChanged(N.value??""),options:x,placeholder:(0,E.t)("shared-preferences.fields.locale-placeholder","Choose language"),inputId:"locale-select"}))),t.createElement(S.$n,{type:"submit",variant:"primary","data-testid":T.Tp.components.UserProfile.preferencesSaveButton},t.createElement(E.x6,{i18nKey:"common.save"},"Save")))}}const J=O,n=(0,z.N)(()=>({labelText:(0,D.css)({marginRight:"6px"}),form:(0,D.css)({width:"100%",maxWidth:"600px"})}));function s(m){switch(m.id){case"dark":return(0,E.t)("shared.preferences.theme.dark-label","Dark");case"light":return(0,E.t)("shared.preferences.theme.light-label","Light");case"system":return(0,E.t)("shared.preferences.theme.system-label","System preference");default:return m.name}}},82508:(j,I,e)=>{e.r(I),e.d(I,{default:()=>Ee});var D=e(25508),t=e(96540),h=e(24180),M=e(16817),T=e(33378),v=e(67608),P=e(77454),A=e(2913),d=e(17422),a=e(16233),i=e(31678),f=e(32196),g=e(71468),C=e(55852),S=e(14578),z=e(56034),U=e(39268),E=e(14186),y=e(10354),W=e(40845),B=e(9025),F=e(25469),O=e(7521),J=e(35538),n=e(33667);const s=o=>o.groups,m=(o,c)=>o.team.id===parseInt(c,10)?o.team:null;function l(o){return{groups:s(o.team)}}const r={loadTeamGroups:n.aK,addTeamGroup:n.It,removeTeamGroup:n.nC},_=(0,g.connect)(l,r),$="Sync LDAP, OAuth or SAML groups with your Grafana teams.";class R extends t.PureComponent{constructor(c){super(c),this.onToggleAdding=()=>{this.setState({isAdding:!this.state.isAdding})},this.onNewGroupIdChanged=u=>{this.setState({newGroupId:u.target.value})},this.onAddGroup=u=>{u.preventDefault(),this.props.addTeamGroup(this.state.newGroupId),this.setState({isAdding:!1,newGroupId:""})},this.onRemoveGroup=u=>{this.props.removeTeamGroup(u.groupId)},this.state={isAdding:!1,newGroupId:""}}componentDidMount(){this.fetchTeamGroups()}async fetchTeamGroups(){await this.props.loadTeamGroups()}isNewGroupValid(){return this.state.newGroupId.length>1}renderGroup(c){const{isReadOnly:u}=this.props;return t.createElement("tr",{key:c.groupId},t.createElement("td",null,c.groupId),t.createElement("td",{style:{width:"1%"}},t.createElement(C.$n,{size:"sm",variant:"destructive",onClick:()=>this.onRemoveGroup(c),disabled:u,"aria-label":`Remove group ${c.groupId}`},t.createElement(S.I,{name:"times"}))))}render(){const{isAdding:c,newGroupId:u}=this.state,{groups:p,isReadOnly:G}=this.props,H=x();return t.createElement("div",null,(0,J.z5)()&&t.createElement(P.Iz,{featureId:"team-sync",eventVariant:"trial",featureName:"team sync",text:"Add a group to enable team sync for free during your trial of Grafana Pro."}),t.createElement("div",{className:"page-action-bar"},(!(0,J.z5)()||p.length>0)&&t.createElement(t.Fragment,null,t.createElement("h3",{className:"page-sub-heading"},"External group sync"),t.createElement(z.m,{placement:"auto",content:$},t.createElement(S.I,{className:(0,f.cx)(H.icon,"page-sub-heading-icon"),name:"question-circle"}))),t.createElement("div",{className:"page-action-bar__spacer"}),p.length>0&&t.createElement(C.$n,{className:"pull-right",onClick:this.onToggleAdding,disabled:G},t.createElement(S.I,{name:"plus"})," Add group")),t.createElement(B.a,{in:c},t.createElement("div",{className:"cta-form"},t.createElement(F.J,{onClick:this.onToggleAdding}),t.createElement("form",{onSubmit:this.onAddGroup},t.createElement(U.C,null,t.createElement(E.I,{label:"Add External Group",tooltip:"LDAP Group Example: cn=users,ou=groups,dc=grafana,dc=org."},t.createElement(y.p,{type:"text",id:"add-external-group",placeholder:"",value:u,onChange:this.onNewGroupIdChanged,disabled:G})),t.createElement(C.$n,{type:"submit",disabled:G||!this.isNewGroupValid(),style:{marginLeft:4}},"Add group"))))),p.length===0&&!c&&((0,J.z5)()?t.createElement(b,{action:{onClick:this.onToggleAdding,text:"Add group"}}):t.createElement(O.A,{onClick:this.onToggleAdding,buttonIcon:"users-alt",title:"There are no external groups to sync with",buttonTitle:"Add group",proTip:$,proTipLinkTitle:"Learn more",proTipLink:"https://grafana.com/docs/grafana/latest/setup-grafana/configure-security/configure-team-sync/",proTipTarget:"_blank",buttonDisabled:G})),p.length>0&&t.createElement("div",{className:"admin-list-table"},t.createElement("table",{className:"filter-table filter-table--hover form-inline"},t.createElement("thead",null,t.createElement("tr",null,t.createElement("th",null,"External Group ID"),t.createElement("th",{style:{width:"1%"}}))),t.createElement("tbody",null,p.map(Y=>this.renderGroup(Y))))))}}const b=({action:o})=>{const c=(0,W.$j)();return t.createElement(P.El,{action:o,listItems:["Stop managing user access in two places - assign users to groups in SAML, LDAP or Oauth, and manage access at a Team level in Grafana","Update users\u2019 permissions immediately when you add or remove them from an LDAP group, with no need for them to sign out and back in"],image:`team-sync-${c.isLight?"light":"dark"}.png`,featureName:"team sync",featureUrl:"https://grafana.com/docs/grafana/latest/enterprise/team-sync",description:"Team Sync makes it easier for you to manage users\u2019 access in Grafana, by immediately updating each user\u2019s Grafana teams and permissions based on their single sign-on group membership, instead of when users sign in."})},K=(0,g.connect)(l,r)(R),x=()=>({icon:(0,f.css)({opacity:.7,"&:hover":{opacity:1}})});var L=e(52487);const ae=o=>{const c=a.TP.hasPermissionInMetadata(i.AccessControlAction.ActionTeamsPermissionsWrite,o.team);return t.createElement(L.x,{title:"",addPermissionTitle:"Add member",buttonLabel:"Add member",emptyLabel:"There are no members in this team or you do not have the permissions to list the current members.",resource:"teams",resourceId:o.team.id,canSetPermissions:c})};var ne=e(49785),se=e(67061),oe=e(84167),X=e(88575),re=e(31084),ie=e(54939),le=e(39745);const ce={updateTeam:n.n7},me=(0,g.connect)(null,ce)(({team:o,updateTeam:c})=>{const u=a.TP.hasPermissionInMetadata(i.AccessControlAction.ActionTeamsWrite,o),p=a.TP.user.orgId,[{roleOptions:G}]=(0,ie.o)(p),{handleSubmit:H,register:Y,formState:{errors:Z}}=(0,ne.mN)({defaultValues:o}),w=a.TP.hasPermission(i.AccessControlAction.ActionTeamsRolesAdd)&&a.TP.hasPermission(i.AccessControlAction.ActionTeamsRolesRemove),k=a.TP.hasPermissionInMetadata(i.AccessControlAction.ActionTeamsRolesList,o)&&a.TP.hasPermission(i.AccessControlAction.ActionRolesList),V=async Q=>{c(Q.name,Q.email||"")};return t.createElement(se.B,{direction:"column",gap:3},t.createElement("form",{onSubmit:H(V),style:{maxWidth:"600px"}},t.createElement(oe.n,{label:"Team details"},t.createElement(X.D,{label:"Name",disabled:!u,required:!0,invalid:!!Z.name,error:"Name is required"},t.createElement(y.p,{...Y("name",{required:!0}),id:"name-input"})),a.TP.licensedAccessControlEnabled()&&k&&t.createElement(X.D,{label:"Role"},t.createElement(re.Y,{teamId:o.id,roleOptions:G,disabled:!w,maxWidth:"100%"})),t.createElement(X.D,{label:"Email",description:"This is optional and is primarily used to set the team profile avatar (via gravatar service).",disabled:!u},t.createElement(y.p,{...Y("email"),placeholder:"team@email.com",type:"email",id:"email-input"})),t.createElement(C.$n,{type:"submit",disabled:!u},"Update"))),t.createElement(le.u,{resourceUri:`teams/${o.id}`,disabled:!u,preferenceType:"team"}))});var de=e(78319),ue=(o=>(o.Members="members",o.Settings="settings",o.GroupSync="groupsync",o))(ue||{});const q=["members","settings","groupsync"],he=(0,D.Mz)([o=>o.team,(o,c)=>c],(o,c)=>m(o,c)),ge=(0,D.Mz)([o=>o.navIndex,(o,c)=>c,(o,c,u)=>u],(o,c,u)=>{const p=(0,de.X)(c);return(0,d.tc)(o,`team-${c}-${u}`,p).main}),ee=t.memo(()=>{const o=(0,t.useRef)((0,T.a)("teamsync")),c=(0,h.g)(),u=(0,t.useMemo)(()=>parseInt(c.id,10),[c]),p=(0,i.useSelector)(V=>he(V,u));let G="members";(!p||!a.TP.hasPermissionInMetadata(i.AccessControlAction.ActionTeamsPermissionsRead,p))&&(G="settings");const H=c.page??G,Y=(0,i.useSelector)(V=>ge(V,H,u)),Z=(0,i.useDispatch)(),{loading:w}=(0,M.A)(async()=>Z((0,n.eo)(u)),[u]),k=()=>{const V=q.includes(H)?H:q[0],Q=a.TP.hasPermissionInMetadata(i.AccessControlAction.ActionTeamsRead,p),te=a.TP.hasPermissionInMetadata(i.AccessControlAction.ActionTeamsPermissionsRead,p),pe=a.TP.hasPermissionInMetadata(i.AccessControlAction.ActionTeamsPermissionsWrite,p);switch(V){case"members":if(te)return t.createElement(ae,{team:p});case"settings":return Q&&t.createElement(me,{team:p});case"groupsync":if(o.current){if(te)return t.createElement(K,{isReadOnly:!pe})}else if(A.Ay.featureToggles.featureHighlights)return t.createElement(t.Fragment,null,t.createElement(P.Iz,{featureName:"team sync",featureId:"team-sync"}),t.createElement(b,null))}return null};return t.createElement(v.Y,{navId:"teams",pageNav:Y},t.createElement(v.Y.Contents,{isLoading:w},p&&Object.keys(p).length!==0&&k()))});ee.displayName="TeamPages";const Ee=ee},33667:(j,I,e)=>{e.d(I,{Bu:()=>a,It:()=>F,To:()=>g,Vk:()=>z,aK:()=>B,eo:()=>f,n7:()=>W,nC:()=>O,nM:()=>C,yd:()=>S});var D=e(2543),t=e.n(D),h=e(17172),M=e(82467),T=e(10096),v=e(80714),P=e(31678),A=e(78319),d=e(34655);function a(n=!1){return async(s,m)=>{const{query:l,page:r,perPage:_,sort:$}=m().teams;if(!T.contextSrv.hasPermission(P.AccessControlAction.ActionTeamsRead)){s((0,d.Q9)({teams:[],totalCount:0,page:1,perPage:_,noTeams:!0}));return}const R=await(0,h.AI)().get("/api/teams/search",(0,v.F)({query:l,page:r,perpage:_,sort:$}));let b=!1;if(n&&(b=R.teams.length===0),T.contextSrv.licensedAccessControlEnabled()&&T.contextSrv.hasPermission(P.AccessControlAction.ActionTeamsRolesList)){s((0,d.dJ)());const K=R?.teams.map(L=>L.id),x=await(0,h.AI)().post("/api/access-control/teams/roles/search",{teamIds:K});R.teams.forEach(L=>{L.roles=x?x[L.id]||[]:[]}),s((0,d.jE)())}s((0,d.Q9)({noTeams:b,...R}))}}const i=(0,D.debounce)(n=>n(a()),500);function f(n){return async s=>{const m=await(0,h.AI)().get(`/api/teams/${n}`,(0,v.F)());s((0,d.$T)(m)),s((0,M.Vz)((0,A.R)(m)))}}function g(n){return async s=>{await(0,h.AI)().delete(`/api/teams/${n}`),await T.contextSrv.fetchUserPermissions(),s(a())}}function C(n){return async s=>{s((0,d.L5)(n)),i(s)}}function S(n){return async s=>{s((0,d.EC)(n)),s(a())}}function z({sortBy:n}){const s=n.length?`${n[0].id}-${n[0].desc?"desc":"asc"}`:void 0;return async m=>{m((0,d.$u)(s)),m(a())}}function U(){return async(n,s)=>{const m=s().team.team,l=await getBackendSrv().get(`/api/teams/${m.id}/members`);n(teamMembersLoaded(l))}}function E(n){return async(s,m)=>{const l=m().team.team;await getBackendSrv().post(`/api/teams/${l.id}/members`,{userId:n}),s(U())}}function y(n){return async(s,m)=>{const l=m().team.team;await getBackendSrv().delete(`/api/teams/${l.id}/members/${n}`),s(U())}}function W(n,s){return async(m,l)=>{const r=l().team.team;await(0,h.AI)().put(`/api/teams/${r.id}`,{name:n,email:s}),m(f(r.id))}}function B(){return async(n,s)=>{const m=s().team.team,l=await(0,h.AI)().get(`/api/teams/${m.id}/groups`);n((0,d.tC)(l))}}function F(n){return async(s,m)=>{const l=m().team.team;await(0,h.AI)().post(`/api/teams/${l.id}/groups`,{groupId:n}),s(B())}}function O(n){return async(s,m)=>{const l=m().team.team;await(0,h.AI)().delete(`/api/teams/${l.id}/groups?groupId=${encodeURIComponent(n)}`),s(B())}}function J(n){return async s=>{await getBackendSrv().put(`/api/teams/${n.teamId}/members/${n.userId}`,{permission:n.permission}),s(U())}}},78319:(j,I,e)=>{e.d(I,{R:()=>A,X:()=>d});var D=e(33378),t=e(76323),h=e(2913),M=e(16233),T=e(35538),v=e(31678);const P={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:v.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function A(a){const i={img:a.avatarUrl,id:"team-"+a.id,subTitle:"Manage members and settings",url:"",text:a.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${a.id}`,text:"Settings",url:`org/teams/edit/${a.id}/settings`}]};(a===P||M.TP.hasPermissionInMetadata(v.AccessControlAction.ActionTeamsPermissionsRead,a))&&i.children.unshift({active:!1,icon:"users-alt",id:`team-members-${a.id}`,text:"Members",url:`org/teams/edit/${a.id}/members`});const f={active:!1,icon:"sync",id:`team-groupsync-${a.id}`,text:"External group sync",url:`org/teams/edit/${a.id}/groupsync`},g=a===P;return(0,T.z5)()&&(f.tabSuffix=()=>(0,t.J)({experimentId:g?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,D.a)("teamsync")?(g||M.TP.hasPermissionInMetadata(v.AccessControlAction.ActionTeamsPermissionsRead,a))&&i.children.push(f):h.Ay.featureToggles.featureHighlights&&i.children.push({...f,tabSuffix:()=>(0,t.J)({experimentId:g?"":"feature-highlights-team-sync-badge"})}),i}function d(a){const i=A(P);let f;for(const g of i.children)if(g.id.indexOf(a)>0){g.active=!0,f=g;break}return{main:i,node:f}}}}]);

//# sourceMappingURL=TeamPages.f6d7f1f4406d17a8b68f.js.map