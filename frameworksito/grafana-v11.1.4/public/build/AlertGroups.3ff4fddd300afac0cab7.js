"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8427],{12564:(W,N,e)=>{e.r(N),e.d(N,{default:()=>ee});var t=e(96540),s=e(39558),f=e(42418),C=e(90613),T=e(94753),E=e(83277),D=e(31678),b=e(60021),z=e(82843),M=e(37959),y=e(35016),h=e(32196),G=e(40845),x=e(55852),F=e(56361),R=e(60029),$=e(94354);const Q=({onStateFilterChange:r,stateFilter:p})=>{const S=Object.entries(b.Or).sort(([o],[n])=>o<n?-1:1).map(([o,n])=>({label:o,value:n}));return t.createElement("div",null,t.createElement(R.J,null,"State"),t.createElement($.z,{options:S,value:p,onChange:r}))};var j=e(2543),U=e(21594),J=e(14578),H=e(75214);const Y=({groups:r,groupBy:p,onGroupingChange:S})=>{const o=(0,j.uniq)(r.flatMap(n=>n.alerts).flatMap(({labels:n})=>Object.keys(n))).filter(n=>!(0,H.F2)(n)).map(n=>({label:n,value:n}));return t.createElement("div",{"data-testid":"group-by-container"},t.createElement(R.J,null,"Custom group by"),t.createElement(U.KF,{"aria-label":"group by label keys",value:p,placeholder:"Group by",prefix:t.createElement(J.I,{name:"tag-alt"}),onChange:n=>{S(n.map(({value:v})=>v))},options:o,width:34}))};var V=e(53876);const X=({groups:r})=>{const[p,S]=(0,t.useState)(Math.floor(Math.random()*100)),[o,n]=(0,E.s)(),{groupBy:v=[],queryString:c,alertState:m}=(0,F.Ht)(o),A=`matcher-${p}`,O=(0,G.of)(Z),B=()=>{n({groupBy:null,queryString:null,alertState:null}),setTimeout(()=>S(p+1),100)},_=!!(v.length>0||c||m);return t.createElement("div",{className:O.wrapper},t.createElement("div",{className:O.filterSection},t.createElement(V.X,{key:A,defaultQueryString:c,onFilterChange:u=>n({queryString:u||null})}),t.createElement(Y,{groups:r,groupBy:v,onGroupingChange:u=>n({groupBy:u.length?u.join(","):null})}),t.createElement(Q,{stateFilter:m,onStateFilterChange:u=>n({alertState:u||null})}),_&&t.createElement(x.$n,{className:O.clearButton,variant:"secondary",icon:"times",onClick:B},"Clear filters")))},Z=r=>({wrapper:(0,h.css)({borderBottom:`1px solid ${r.colors.border.medium}`,marginBottom:r.spacing(3)}),filterSection:(0,h.css)({display:"flex",flexDirection:"row",marginBottom:r.spacing(3),gap:r.spacing(1)}),clearButton:(0,h.css)({marginLeft:r.spacing(1),marginTop:"19px"})});var K=e(98164);const k=r=>{const[p]=(0,E.s)(),S=(0,F.Ht)(p),o=(0,K.J$)(S.queryString||"");return(0,t.useMemo)(()=>r.reduce((n,v)=>{const c=v.alerts.filter(({labels:m,status:A})=>{const O=(0,K.Av)(m,o),B=S.alertState?A.state===S.alertState:!0;return O&&B});return c.length>0&&(Object.keys(v.labels).length===0?n.unshift({...v,alerts:c}):n.push({...v,alerts:c})),n},[]),[r,S,o])},w=(r,p)=>(0,t.useMemo)(()=>p.length===0?r.filter(n=>Object.keys(n.labels).length===0).length>1?r.reduce((n,v)=>{if(Object.keys(v.labels).length===0){const c=n.find(({labels:m})=>Object.keys(m));c?c.alerts=(0,j.uniqBy)([...c.alerts,...v.alerts],"labels"):n.push({alerts:v.alerts,labels:{},receiver:{name:"NONE"}})}else n.push(v);return n},[]):r:(0,j.uniqBy)(r.flatMap(({alerts:o})=>o),o=>o.fingerprint).reduce((o,n)=>{if(p.every(c=>Object.keys(n.labels).includes(c)))n.receivers.map(m=>({alerts:[n],labels:p.reduce((A,O)=>(A={...A,[O]:n.labels[O]},A),{}),receiver:m})).forEach(m=>{const A=o.find(O=>Object.keys(m.labels).every(B=>O.labels[B]===m.labels[B])&&O.receiver.name===m.receiver.name);A?A.alerts.push(n):o.push(m)});else{const c=o.find(m=>Object.keys(m.labels).length===0);c?c.alerts.push(n):o.push({alerts:[n],labels:{},receiver:{name:"NONE"}})}return o},[]),[r,p]);var q=e(61410),a=e(70383),d=e(23770),i=e(55740),P=e(57220),g=e(88467);const l=()=>{const{selectedAlertmanager:r}=(0,a.VI)(),p=(0,D.useDispatch)(),[S]=(0,E.s)(),{groupBy:o=[]}=(0,F.Ht)(S),{currentData:n}=z.m.endpoints.getGrafanaAlertingConfigurationStatus.useQuery(),v=(0,q.$)(u=>u.amAlertGroups),{loading:c,error:m,result:A=[]}=v[r||""]??g.jA,O=w(A,o),B=k(O),_=r===P.hY&&n?.alertmanagersChoice===b.nA.External;return(0,t.useEffect)(()=>{function u(){r&&p((0,d.D3)(r))}u();const L=setInterval(u,i.U3);return()=>{clearInterval(L)}},[p,r]),t.createElement(t.Fragment,null,t.createElement(X,{groups:A}),c&&t.createElement(s._,{text:"Loading notifications"}),m&&!c&&t.createElement(f.F,{title:"Error loading notifications",severity:"error"},m.message||"Unknown error"),_&&t.createElement(f.F,{title:"Grafana alerts are not delivered to Grafana Alertmanager"},"Grafana is configured to send alerts to external alertmanagers only. No alerts are expected to be available here for the selected Alertmanager."),A&&B.map((u,L)=>t.createElement(t.Fragment,{key:`${JSON.stringify(u.labels)}-group-${L}`},(L===1&&Object.keys(B[0].labels).length===0||L===0&&Object.keys(u.labels).length>0)&&t.createElement(C.a,{paddingY:2},t.createElement(T.E,{element:"h2",variant:"body"},"Grouped by: ",Object.keys(u.labels).join(", "))),t.createElement(y._,{alertManagerSourceName:r||"",group:u}))),A&&!B.length&&t.createElement("p",null,"No results."))},ee=()=>t.createElement(M.y,{navId:"groups",accessType:"instance"},t.createElement(l,null))},64853:(W,N,e)=>{e.d(N,{_:()=>T});var t=e(2543),s=e.n(t),f=e(96540),C=e(19073);const T=({actions:y,children:h})=>{const G=(0,t.filter)(y,z),x=(0,t.filter)(y,M);return G.length?f.createElement(E,{actions:G},h):x.length?f.createElement(D,{actions:x},h):null},E=({actions:y,children:h})=>{const G=(0,C.iI)();return b(G,y)?f.createElement(f.Fragment,null,h):null},D=({actions:y,children:h})=>{const G=(0,C.e2)();return b(G,y)?f.createElement(f.Fragment,null,h):null};function b(y,h){return(0,t.chain)(y).pick(h).values().value().some(([G,x])=>x===!0)}function z(y){return Object.values(C.QI).includes(y)}function M(y){return Object.values(C.RY).includes(y)}},64047:(W,N,e)=>{e.d(N,{e:()=>f});var t=e(96540),s=e(55852);const f=({isCollapsed:C,onToggle:T,idControlled:E,className:D,text:b,size:z="xl",...M})=>t.createElement(s.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!C,"aria-controls":E,className:D,icon:C?"angle-right":"angle-down",onClick:()=>T(!C),...M},b)},35016:(W,N,e)=>{e.d(N,{_:()=>w});var t=e(32196),s=e(96540),f=e(40845),C=e(67061),T=e(72109),E=e(60021),D=e(56361),b=e(69087),z=e(64047),M=e(55196),y=e(70416),h=e(10562),G=e(97754),x=e(55852),F=e(16233),R=e(31678),$=e(19073),Q=e(57220),j=e(71223),U=e(64853);const J=({alert:a,alertManagerSourceName:d})=>{const i=(0,f.of)(H),g=(0,Q.z2)(d)?F.TP.hasPermission(R.AccessControlAction.AlertingRuleRead):!0;return s.createElement(s.Fragment,null,s.createElement("div",{className:i.actionsRow},a.status.state===E.Or.Suppressed&&s.createElement(U._,{actions:[$.QI.CreateSilence,$.QI.UpdateSilence]},s.createElement(x.z9,{href:`${(0,D.nL)("/alerting/silences",d)}&silenceIds=${a.status.silencedBy.join(",")}`,className:i.button,icon:"bell",size:"sm"},"Manage silences")),a.status.state===E.Or.Active&&s.createElement(U._,{actions:[$.QI.CreateSilence]},s.createElement(x.z9,{href:(0,D.BK)(d,a.labels),className:i.button,icon:"bell-slash",size:"sm"},"Silence")),g&&a.generatorURL&&s.createElement(x.z9,{className:i.button,href:a.generatorURL,icon:"chart-line",size:"sm"},"See source")),Object.entries(a.annotations).map(([l,I])=>s.createElement(j.s,{key:l,annotationKey:l,value:I})),s.createElement("div",{className:i.receivers},"Receivers:"," ",a.receivers.map(({name:l})=>l).filter(l=>!!l).join(", ")))},H=a=>({button:(0,t.css)({"& + &":{marginLeft:a.spacing(1)}}),actionsRow:(0,t.css)({padding:`${a.spacing(2,0)} !important`,borderBottom:`1px solid ${a.colors.border.medium}`}),receivers:(0,t.css)({padding:a.spacing(1,0)})}),Y=({alerts:a,alertManagerSourceName:d})=>{const i=(0,f.of)(V),P=(0,s.useMemo)(()=>[{id:"state",label:"State",renderCell:({data:l})=>s.createElement(s.Fragment,null,s.createElement(G.y,{state:l.status.state}),s.createElement("span",{className:i.duration},"for"," ",(0,y.dU)({start:new Date(l.startsAt),end:new Date(l.endsAt)}))),size:"220px"},{id:"labels",label:"Labels",renderCell:({data:{labels:l}})=>s.createElement(b.m,{labels:l,size:"sm"}),size:1}],[i]),g=(0,s.useMemo)(()=>a.map(l=>({id:l.fingerprint,data:l})),[a]);return s.createElement("div",{className:i.tableWrapper,"data-testid":"alert-group-table"},s.createElement(h.B,{cols:P,items:g,isExpandable:!0,renderExpandedContent:({data:l})=>s.createElement(J,{alert:l,alertManagerSourceName:d})}))},V=a=>({tableWrapper:(0,t.css)({marginTop:a.spacing(3),[a.breakpoints.up("md")]:{marginLeft:a.spacing(4.5)}}),duration:(0,t.css)({marginLeft:a.spacing(1),fontSize:a.typography.bodySmall.fontSize})});var X=e(55127),Z=e.n(X);const K=a=>({[E.Or.Active]:(0,t.css)({color:a.colors.error.text}),[E.Or.Suppressed]:(0,t.css)({color:a.colors.primary.text}),[E.Or.Unprocessed]:(0,t.css)({color:a.colors.secondary.text})}),k=({group:a})=>{const d=(0,f.of)(K),i=a.alerts.length,P=a.alerts.reduce((g,l)=>(g[l.status.state]?g[l.status.state]+=1:g[l.status.state]=1,g),{});return s.createElement("div",null,`${i} ${Z()("alert",i)}: `,Object.entries(P).map(([g,l],I)=>s.createElement("span",{key:`${JSON.stringify(a.labels)}-notifications-${I}`,className:d[g]},I>0&&", ",`${l} ${g}`)))},w=({alertManagerSourceName:a,group:d})=>{const[i,P]=(0,s.useState)(!0),g=(0,f.of)(q),l=d.receiver.name!=="NONE",I=d.receiver.name;return s.createElement("div",{className:g.wrapper},s.createElement("div",{className:g.header},s.createElement("div",{className:g.group,"data-testid":"alert-group"},s.createElement(z.e,{size:"sm",isCollapsed:i,onToggle:()=>P(!i),"data-testid":"alert-group-collapse-toggle"}),Object.keys(d.labels).length?s.createElement(C.B,{direction:"row",alignItems:"center"},s.createElement(b.m,{labels:d.labels,size:"sm"}),l&&s.createElement(M.P,{icon:"at"},"Delivered to"," ",s.createElement(T.Y,{href:(0,D.bg)(I,a),variant:"bodySmall",color:"primary",inline:!1},d.receiver.name))):s.createElement("span",null,"No grouping")),s.createElement(k,{group:d})),!i&&s.createElement(Y,{alertManagerSourceName:a,alerts:d.alerts}))},q=a=>({wrapper:(0,t.css)({"& + &":{marginTop:a.spacing(2)}}),header:(0,t.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",padding:`${a.spacing(1)} ${a.spacing(1)} ${a.spacing(1)} 0`,backgroundColor:a.colors.background.secondary,width:"100%"}),group:(0,t.css)({display:"flex",flexDirection:"row",alignItems:"center"}),summary:(0,t.css)({}),[E.Or.Active]:(0,t.css)({color:a.colors.error.main}),[E.Or.Suppressed]:(0,t.css)({color:a.colors.primary.main}),[E.Or.Unprocessed]:(0,t.css)({color:a.colors.secondary.main})})}}]);

//# sourceMappingURL=AlertGroups.3ff4fddd300afac0cab7.js.map