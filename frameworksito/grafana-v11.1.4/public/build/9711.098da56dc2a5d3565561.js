"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9711],{26928:(k,T,a)=>{a.d(T,{s:()=>E});var o=a(32196),e=a(2543),M=a.n(e),u=a(96540),S=a(40845),f=a(67061),h=a(69613),L=a(32642),O=a(35108);const E=({matchers:c,formatter:v="default"})=>{const y=(0,S.of)(m),x=5,C=(0,e.take)(c,x),W=(0,e.takeRight)(c,c.length-x),$=W.length>0;return u.createElement("span",{"data-testid":"label-matchers"},u.createElement(f.B,{direction:"row",gap:1,alignItems:"center",wrap:"wrap"},C.map(w=>u.createElement(D,{key:(0,e.uniqueId)(),matcher:w,formatter:v})),$&&u.createElement(O.j,{arrow:!0,placement:"top",content:u.createElement(u.Fragment,null,W.map(w=>u.createElement(D,{key:(0,e.uniqueId)(),matcher:w})))},u.createElement("span",null,u.createElement("div",{className:y.metadata},`and ${W.length} more`)))))},D=({matcher:c,formatter:v="default"})=>{const y=(0,S.of)(m);return u.createElement("div",{className:y.matcher(c[0]).wrapper},u.createElement(f.B,{direction:"row",gap:0,alignItems:"baseline"},L.t8[v](c)))},m=c=>({matcher:v=>{const{color:y,borderColor:x}=(0,h.MC)(v);return{wrapper:(0,o.css)({color:"#fff",background:y,padding:`${c.spacing(.33)} ${c.spacing(.66)}`,fontSize:c.typography.bodySmall.fontSize,border:`solid 1px ${x}`,borderRadius:c.shape.borderRadius(2)})}},metadata:(0,o.css)({color:c.colors.text.secondary,fontSize:c.typography.bodySmall.fontSize,fontWeight:c.typography.bodySmall.fontWeight})})},39711:(k,T,a)=>{a.r(T),a.d(T,{default:()=>dt});var o=a(32196),e=a(96540),M=a(40845),u=a(42418),S=a(39558),f=a(66602),h=a(87286),L=a(2543),O=a(55127),E=a.n(O),D=a(42941),m=a(55852),c=a(69613),v=a(64149),y=a(98164),x=a(64047),C=a(55196),W=a(26058),$=a(26928);function w(t){return t.path?.length===0}function H(t){const r=new Map;function l(s,d=[]){r.set(s.id,{...s,path:d}),s.routes?.forEach(n=>l(n,[...d,s.id]))}return l(t,[]),r}function z(t){return t.object_matchers?.length===0}function G({route:t,matcherFormatter:r}){const l=(0,M.of)(V);return w(t)?e.createElement("div",{className:l.defaultPolicy},"Default policy"):z(t)?e.createElement("div",{className:l.textMuted},"No matchers"):e.createElement($.s,{matchers:t.object_matchers??[],formatter:r})}const V=t=>({defaultPolicy:(0,o.css)({padding:t.spacing(.5),background:t.colors.background.secondary,width:"fit-content"}),textMuted:(0,o.css)({color:t.colors.text.secondary})});var Y=a(37390),U=a(67061),J=a(14578),Q=a(19073),X=a(70383),Z=a(56361),q=a(64853);function _({route:t,routesByIdMap:r,matcherFormatter:l}){const s=(0,M.of)(F),d=t.path?.slice(1)??[],n=[...(0,L.compact)(d.map(i=>r.get(i))),t];return e.createElement("div",{className:s.policyPathWrapper},e.createElement("div",{className:s.defaultPolicy},"Default policy"),n.map((i,g)=>e.createElement("div",{key:i.id},e.createElement("div",{className:s.policyInPath(g,g===n.length-1)},z(i)?e.createElement("div",{className:s.textMuted},"No matchers"):e.createElement($.s,{matchers:i.object_matchers??[],formatter:l})))))}function tt({onClose:t,route:r,receiver:l,routesByIdMap:s,alertManagerSourceName:d}){const n=(0,M.of)(F),i=w(r);return e.createElement(X.b9,{accessType:"notification",alertmanagerSourceName:d},e.createElement(Y.a,{className:n.detailsModal,isOpen:!0,title:"Routing details",onDismiss:t,onClickBackdrop:t},e.createElement(U.B,{gap:0,direction:"column"},e.createElement("div",{className:(0,o.cx)(n.textMuted,n.marginBottom(2))},"Your alert instances are routed as follows."),e.createElement("div",null,"Notification policy path"),i&&e.createElement("div",{className:n.textMuted},"Default policy"),e.createElement("div",{className:n.separator(1)}),!i&&e.createElement(e.Fragment,null,e.createElement(_,{route:r,routesByIdMap:s,matcherFormatter:(0,y.VE)(d)})),e.createElement("div",{className:n.separator(4)}),e.createElement("div",{className:n.contactPoint},e.createElement(U.B,{gap:1,direction:"row",alignItems:"center"},"Contact point:",e.createElement("span",{className:n.textMuted},l.name)),e.createElement(q._,{actions:[Q.QI.UpdateContactPoint]},e.createElement(U.B,{gap:1,direction:"row",alignItems:"center"},e.createElement("a",{href:(0,Z.nL)(`/alerting/notifications/receivers/${encodeURIComponent(l.name)}/edit`,d),className:n.link,target:"_blank",rel:"noreferrer"},"See details ",e.createElement(J.I,{name:"external-link-alt"}))))),e.createElement("div",{className:n.button},e.createElement(m.$n,{variant:"primary",type:"button",onClick:t},"Close")))))}const F=t=>({textMuted:(0,o.css)({color:t.colors.text.secondary}),link:(0,o.css)({display:"block",color:t.colors.text.link}),button:(0,o.css)({justifyContent:"flex-end",display:"flex"}),detailsModal:(0,o.css)({maxWidth:"560px"}),defaultPolicy:(0,o.css)({padding:t.spacing(.5),background:t.colors.background.secondary,width:"fit-content"}),contactPoint:(0,o.css)({display:"flex",flexDirection:"row",gap:t.spacing(1),alignItems:"center",justifyContent:"space-between",marginBottom:t.spacing(1)}),policyPathWrapper:(0,o.css)({display:"flex",flexDirection:"column",marginTop:t.spacing(1)}),separator:r=>(0,o.css)({marginTop:t.spacing(r)}),marginBottom:r=>(0,o.css)({marginBottom:t.spacing(t.spacing(r))}),policyInPath:(r=0,l=!1)=>(0,o.css)({marginLeft:`${30+r*30}px`,padding:t.spacing(1),marginTop:t.spacing(1),border:`solid 1px ${l?t.colors.info.border:t.colors.border.weak}`,background:t.colors.background.secondary,width:"fit-content",position:"relative","&:before":{content:'""',position:"absolute",height:"calc(100% - 10px)",width:t.spacing(1),borderLeft:`solid 1px ${t.colors.border.weak}`,borderBottom:`solid 1px ${t.colors.border.weak}`,marginTop:t.spacing(-2),marginLeft:"-17px"}})});function et({route:t,receiver:r,routesByIdMap:l,instancesCount:s,alertManagerSourceName:d,expandRoute:n,onExpandRouteClick:i}){const g=(0,M.of)(K),[P,A]=(0,e.useState)(!1),I=()=>{A(!0)};return e.createElement("div",{className:g.routeHeader},e.createElement(x.e,{isCollapsed:!n,onToggle:B=>i(!B),"aria-label":"Expand policy route"}),e.createElement(h.B,{flexGrow:1,gap:1},e.createElement("div",{onClick:()=>i(!n),className:g.expandable},e.createElement(h.B,{gap:1,direction:"row",alignItems:"center"},"Notification policy",e.createElement(G,{route:t,matcherFormatter:(0,y.VE)(d)}))),e.createElement(W.h,null),e.createElement(h.B,{gap:2,direction:"row",alignItems:"center"},e.createElement(C.P,{icon:"layers-alt","data-testid":"matching-instances"},s??"-"," ",E()("instance",s)),e.createElement(h.B,{gap:1,direction:"row",alignItems:"center"},e.createElement("div",null,e.createElement("span",{className:g.textMuted},"@ Delivered to")," ",r.name),e.createElement("div",{className:g.verticalBar}),e.createElement(m.$n,{type:"button",onClick:I,variant:"secondary",fill:"outline",size:"sm"},"See details")))),P&&e.createElement(tt,{onClose:()=>A(!1),route:t,receiver:r,routesByIdMap:l,alertManagerSourceName:d}))}function at({route:t,instanceMatches:r,receiver:l,routesByIdMap:s,alertManagerSourceName:d}){const n=(0,M.of)(K),[i,g]=(0,D.A)(!1),P=9;return e.createElement("div",{"data-testid":"matching-policy-route"},e.createElement(et,{route:t,receiver:l,routesByIdMap:s,instancesCount:r.length,alertManagerSourceName:d,expandRoute:i,onExpandRouteClick:g}),i&&e.createElement(h.B,{gap:1,direction:"column"},e.createElement("div",{className:n.routeInstances,"data-testid":"route-matching-instance"},r.map(A=>{const I=Array.from(A.labelsMatch);let B=I.map(([p,R])=>({label:`${p[0]}=${p[1]}`,match:R.match,colorIndex:R.match?(0,c.JF)(p[0]):P}));const N=B.filter(p=>p.match),b=B.filter(p=>!p.match);return e.createElement("div",{className:n.tagListCard,key:(0,L.uniqueId)()},I.length>0?e.createElement(e.Fragment,null,N.length>0?e.createElement(v.L,{tags:N.map(p=>p.label),className:n.labelList,getColorIndex:(p,R)=>N[R].colorIndex}):e.createElement("div",{className:(0,o.cx)(n.textMuted,n.textItalic)},"No matching labels"),e.createElement("div",{className:n.labelSeparator}),e.createElement(v.L,{tags:b.map(p=>p.label),className:n.labelList,getColorIndex:(p,R)=>b[R].colorIndex})):e.createElement("div",{className:n.textMuted},"No labels"))}))))}const K=t=>({textMuted:(0,o.css)({color:t.colors.text.secondary}),textItalic:(0,o.css)({fontStyle:"italic"}),expandable:(0,o.css)({cursor:"pointer"}),routeHeader:(0,o.css)({display:"flex",flexDirection:"row",gap:t.spacing(1),alignItems:"center",borderBottom:`1px solid ${t.colors.border.weak}`,padding:t.spacing(.5,.5,.5,0),"&:hover":{backgroundColor:t.components.table.rowHoverBackground}}),labelList:(0,o.css)({flex:"0 1 auto",justifyContent:"flex-start"}),labelSeparator:(0,o.css)({width:"1px",backgroundColor:t.colors.border.weak}),tagListCard:(0,o.css)({display:"flex",flexDirection:"row",gap:t.spacing(2),position:"relative",background:t.colors.background.secondary,padding:t.spacing(1),borderRadius:t.shape.borderRadius(2),border:`solid 1px ${t.colors.border.weak}`}),routeInstances:(0,o.css)({padding:t.spacing(1,0,1,4),position:"relative",display:"flex",flexDirection:"column",gap:t.spacing(1),"&:before":{content:'""',position:"absolute",left:t.spacing(2),height:`calc(100% - ${t.spacing(2)})`,width:t.spacing(4),borderLeft:`solid 1px ${t.colors.border.weak}`}}),verticalBar:(0,o.css)({width:"1px",height:"20px",backgroundColor:t.colors.secondary.main,marginLeft:t.spacing(1),marginRight:t.spacing(1)})});var nt=a(16817),ot=a(51488),rt=a(19143),st=a(79657),ct=a(57220),j=a(79581);const lt=(t,r)=>{const{currentData:l,isLoading:s,error:d}=(0,ot.f)(t),n=l?.alertmanager_config,{matchInstancesToRoute:i}=(0,rt.L)(),{rootRoute:g,receivers:P}=(0,e.useMemo)(()=>n?{rootRoute:n.route?(0,j.rJ)((0,st.QM)(n.route)):void 0,receivers:n.receivers??[]}:{receivers:[],rootRoute:void 0},[n]),A=g?H((0,j._I)(g)):new Map,I=P.reduce((p,R)=>p.set(R.name,R),new Map)??new Map,{value:B=new Map,loading:N,error:b}=(0,nt.A)(async()=>{if(g)return await i(g,r,{unquoteMatchers:t!==ct.hY})},[g,r]);return{routesByIdMap:A,receiversByName:I,matchingMap:B,loading:s||N,error:d??b}};function it({alertManagerSource:t,potentialInstances:r,onlyOneAM:l}){const s=(0,M.of)(gt),{routesByIdMap:d,receiversByName:n,matchingMap:i,loading:g,error:P}=lt(t.name,r);return P?e.createElement(u.F,{title:"Cannot load Alertmanager configuration",severity:"error"},P.message):g?e.createElement(S._,{text:"Loading routing preview..."}):i.size>0?e.createElement("div",{className:s.alertManagerRow},!l&&e.createElement(h.B,{direction:"row",alignItems:"center"},e.createElement("div",{className:s.firstAlertManagerLine}),e.createElement("div",{className:s.alertManagerName}," ","Alertmanager:",e.createElement("img",{src:t.imgUrl,alt:"",className:s.img}),t.name),e.createElement("div",{className:s.secondAlertManagerLine})),e.createElement(h.B,{gap:1,direction:"column"},Array.from(i.entries()).map(([I,B])=>{const N=d.get(I),b=N?.receiver&&n.get(N.receiver);if(!N)return null;if(!b)throw new Error("Receiver not found");return e.createElement(at,{instanceMatches:B,route:N,receiver:b,key:I,routesByIdMap:d,alertManagerSourceName:t.name})}))):null}const dt=(0,f.Xc)(it),gt=t=>({alertManagerRow:(0,o.css)({display:"flex",flexDirection:"column",gap:t.spacing(1),width:"100%"}),firstAlertManagerLine:(0,o.css)({height:"1px",width:t.spacing(4),backgroundColor:t.colors.secondary.main}),alertManagerName:(0,o.css)({width:"fit-content"}),secondAlertManagerLine:(0,o.css)({height:"1px",width:"100%",flex:1,backgroundColor:t.colors.secondary.main}),img:(0,o.css)({marginLeft:t.spacing(2),width:t.spacing(3),height:t.spacing(3),marginRight:t.spacing(1)})})},19143:(k,T,a)=>{a.d(T,{L:()=>O});var o=a(14590),e=a(96540),M=a(25027),u=a(67278);const S=()=>new u.c(new URL(a.p+a.u(5398),a.b));let f;function h(){let E;if(f===void 0)try{E=S(),f=o.LV(E)}catch(m){m instanceof Error&&(0,M.vV)(m)}return{disposeWorker:()=>{E&&f&&(f[o.A2](),E.terminate(),f=void 0,E=void 0)}}}function L(E){if(!f)throw new Error("Route Matcher has not been initialized")}function O(){(0,e.useEffect)(()=>{const{disposeWorker:m}=h();return m},[]);const E=(0,e.useCallback)(async(m,c,v)=>{L(f);const y=performance.now(),x=await f.getRouteGroupsMap(m,c,v),C=performance.now()-y;return(0,M.fH)(`Route Groups Matched in  ${C} ms`,{matchingTime:C.toString(),alertGroupsCount:c.length.toString(),topLevelRoutesCount:m.routes?.length.toString()??"0"}),x},[]),D=(0,e.useCallback)(async(m,c,v)=>{L(f);const y=performance.now(),x=await f.matchInstancesToRoute(m,c,v),C=performance.now()-y;return(0,M.fH)(`Instances Matched in  ${C} ms`,{matchingTime:C.toString(),instancesToMatchCount:c.length.toString(),topLevelRoutesCount:m.routes?.length.toString()??"0"}),x},[]);return{getRouteGroupsMap:E,matchInstancesToRoute:D}}}}]);

//# sourceMappingURL=9711.098da56dc2a5d3565561.js.map