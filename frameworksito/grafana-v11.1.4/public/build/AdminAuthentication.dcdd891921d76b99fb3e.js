"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5592],{51332:(ne,E,a)=>{a.r(E),a.d(E,{AuthConfigPageUnconnected:()=>j,default:()=>he});var e=a(96540),S=a(71468),C=a(61268),p=a(14110),F=a(72109),se=a(27746),Z=a(71259),V=a(67608),pe=a(2913),R=a(32196),M=a(40845),oe=a(87978),G=a(94753),N=a(15292),re=a(55852),ye=a(3169),X=a(60610);const z=i=>({allowInsecureEmail:i.authConfig.settings?.auth?.oauth_allow_insecure_email_lookup.toLowerCase()==="true"}),ve={loadSettings:X.M5,saveSettings:X.DZ},ie=(0,S.connect)(z,ve)(({allowInsecureEmail:i,loadSettings:y,onClose:I,saveSettings:g})=>{const P=(0,ye._2)(),T=async()=>{try{await g({updates:{auth:{oauth_allow_insecure_email_lookup:""+!i}}}),await y(!1),P.success("Settings saved")}catch{P.error("Failed to save settings")}},$=async()=>{try{await g({removals:{auth:["oauth_allow_insecure_email_lookup"]}}),await y(!1),P.success("Settings saved")}catch{P.error("Failed to save settings")}},x=e.createElement(e.Fragment,null,"Configure auth settings. Find out more in our"," ",e.createElement(F.Y,{external:!0,href:"https://grafana.com/docs/grafana/next/setup-grafana/configure-security/configure-authentication/#settings"},"documentation"),"."),w=(0,M.of)(le);return e.createElement(oe._,{title:"Auth Settings",subtitle:x,size:"md",onClose:I},e.createElement("div",{className:w.advancedAuth},e.createElement(G.E,{variant:"h4"},"Advanced Auth"),e.createElement(G.E,{variant:"h5"},"Enable insecure email lookup"),e.createElement(G.E,{variant:"body",color:"secondary"},"Allow users to use the same email address to log into Grafana with different identity providers."),e.createElement(N.d,{value:i,onChange:T})),e.createElement(re.$n,{size:"md",variant:"secondary",className:w.button,onClick:$,tooltip:"This action will disregard any saved changes and load the configuration from the configuration file."},"Reset"))}),le=i=>({advancedAuth:(0,R.css)({display:"flex",flexDirection:"column",gap:i.spacing(1)}),button:(0,R.css)({marginTop:i.spacing(2)})});var ue=a(67061),ce=a(14578);const be=()=>{const i=(0,M.of)(Ae);return e.createElement("div",{className:i.container},e.createElement(ue.B,{gap:1,alignItems:"center"},e.createElement(ce.I,{name:"cog"}),e.createElement(G.E,null,"Configuration required")),e.createElement(G.E,{variant:"bodySmall",color:"secondary"},"You have no authentication configuration created at the moment."),e.createElement(F.Y,{href:"https://grafana.com/docs/grafana/latest/auth/overview/",external:!0},"Refer to the documentation on how to configure authentication"))},Ae=i=>({container:(0,R.css)({display:"flex",flexDirection:"column",gap:i.spacing(2),backgroundColor:i.colors.background.secondary,borderRadius:i.shape.radius.default,padding:i.spacing(3),width:"max-content",margin:i.spacing(3,"auto")})}),Ee=be;var Se=a(8887),B=a(10860),Ce=a(39938),de=a(7250),Q=a(5328);function me({providerId:i,enabled:y,configPath:I,authType:g,onClick:P}){const T=(0,Q.h)({configPath:I,id:i}),[$,x]=de.L[i]||["lock",i.toUpperCase()];return e.createElement(B.Z,{href:T,onClick:P},e.createElement(B.Z.Heading,null,x),e.createElement(B.Z.Meta,null,g),(0,Se.n6)($)&&e.createElement(B.Z.Figure,null,e.createElement(ce.I,{name:$,size:"xxxl"})),e.createElement(B.Z.Actions,null,e.createElement(Ce.E,{text:y?"Enabled":"Not enabled",color:y?"green":"blue"})))}var Ie=a(73399);function K(i){const{isLoading:y,providerStatuses:I,providers:g}=i.authConfig;return{isLoading:y,providerStatuses:I,providers:g}}const H={loadSettings:X.M5},fe=(0,S.connect)(K,H),j=({providerStatuses:i,isLoading:y,loadSettings:I,providers:g})=>{(0,e.useEffect)(()=>{I()},[I]);const[P,T]=(0,e.useState)(!1),x=(0,Ie.getRegisteredAuthProviders)().filter(c=>!i[c.id]?.hide),w=(c,k)=>{(0,p.rR)("authentication_ui_provider_clicked",{provider:c,enabled:k})};g=g.filter(c=>c.provider!=="saml");const J=x.length?[...x.map(c=>({provider:c.id,settings:{...i[c.id],configPath:c.configPath,type:c.type}})),...g]:g;return e.createElement(V.Y,{navId:"authentication",subTitle:e.createElement(e.Fragment,null,"Manage your auth settings and configure single sign-on. Find out more in our"," ",e.createElement(F.Y,{external:!0,href:"https://grafana.com/docs/grafana/next/setup-grafana/configure-security/configure-authentication"},"documentation"),"."),actions:pe.config.buildInfo.edition!==C.r.OpenSource&&e.createElement(se.I,{icon:"cog",variant:"canvas",onClick:()=>T(!0)},"Auth settings")},e.createElement(V.Y.Contents,{isLoading:y},J.length?e.createElement(Z.x,{gap:3,minColumnWidth:34},J.filter(({provider:c})=>!["grafana_com"].includes(c)).map(({provider:c,settings:k})=>e.createElement(me,{key:c,authType:k.type||"OAuth",providerId:c,enabled:k.enabled,onClick:()=>w(c,k.enabled),configPath:k.configPath})),P&&e.createElement(ie,{onClose:()=>T(!1)})):e.createElement(Ee,null)))},he=fe(j)},22468:(ne,E,a)=>{a.r(E),a.d(E,{ProviderConfigPage:()=>De,default:()=>Fe});var e=a(96540),S=a(71468),C=a(67061),p=a(94753),F=a(39938),se=a(67608),Z=a(49785),V=a(26272),pe=a(3591),R=a(17172),M=a(14110),oe=a(12131),G=a(38138),N=a(88575),re=a(15292),ye=a(57418),X=a(90613),z=a(55852),ve=a(83122),we=a(29158),Ue=a(96374),ie=a(32196),le=a(24180),ue=a(37390);const ce=({confirmRedirect:n,onDiscard:t,onLocationChange:s})=>{const[o,u]=(0,e.useState)(!1),[d,m]=(0,e.useState)(null),[h,W]=(0,e.useState)(!1);(0,e.useEffect)(()=>{const r=v=>{n&&(v.preventDefault(),v.returnValue="")};return window.addEventListener("beforeunload",r),()=>{window.removeEventListener("beforeunload",r)}},[n]);const q=r=>{const v=window.location.pathname,l=r.pathname;if(v===l)return!0;const Y=s?.(r);let b=n&&!h;return Y!==void 0&&(b=b&&Y),b?(u(!0),m(r),!1):(Y&&t(),!0)},_=()=>{u(!1),m(null)},U=()=>{u(!1),W(!0),t()};return e.createElement(e.Fragment,null,e.createElement(le.XG,{when:!0,message:q}),d&&h&&e.createElement(le.rd,{to:d}),e.createElement(be,{isOpen:o,onDiscard:U,onBackToForm:_}))},be=({onDiscard:n,onBackToForm:t,isOpen:s})=>e.createElement(ue.a,{isOpen:s,title:"Leave page?",onDismiss:t,icon:"exclamation-triangle",className:(0,ie.css)({width:"500px"})},e.createElement("h5",null,"Changes that you made may not be saved."),e.createElement(ue.a.ButtonRow,null,e.createElement(z.$n,{variant:"secondary",onClick:t,fill:"outline"},"Continue editing"),e.createElement(z.$n,{variant:"destructive",onClick:n},"Discard unsaved changes")));var Ae=a(40845),Ee=a(10354),Se=a(9226),B=a(21594),Ce=a(10880),de=a(8227),Q=a(32264),me=a(72109),Ie=a(10096);function K(n){return Array.isArray(n)&&n.every(t=>typeof t=="object"&&t!==null&&"value"in t)}var H=a(5328);const fe={azuread:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","authUrl","tokenUrl","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributePath","roleAttributeStrict","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedOrganizations","allowedDomains","allowedGroups","forceUseGraphApi","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],generic_oauth:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","authStyle","scopes","authUrl","tokenUrl","apiUrl","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["nameAttributePath","loginAttributePath","emailAttributeName","emailAttributePath","idTokenAttributeName","roleAttributePath","roleAttributeStrict","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedOrganizations","allowedDomains","defineAllowedGroups",{name:"allowedGroups",dependsOn:"defineAllowedGroups"},{name:"groupsAttributePath",dependsOn:"defineAllowedGroups"},"defineAllowedTeamsIds",{name:"teamIds",dependsOn:"defineAllowedTeamsIds"},{name:"teamsUrl",dependsOn:"defineAllowedTeamsIds"},{name:"teamIdsAttributePath",dependsOn:"defineAllowedTeamsIds"},"usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],google:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributePath","roleAttributeStrict","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["validateHd","hostedDomain","allowedDomains","allowedGroups","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],github:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributePath","roleAttributeStrict","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedOrganizations","allowedDomains","teamIds","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],gitlab:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributePath","roleAttributeStrict","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedDomains","allowedGroups","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],okta:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","authUrl","tokenUrl","apiUrl","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributePath","roleAttributeStrict","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedDomains","allowedGroups","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}]};function j(n){return{clientId:{label:"Client Id",type:"text",description:"The client Id of your OAuth2 app.",validation:{required:!0,message:"This field is required"}},clientSecret:{label:"Client secret",type:"secret",description:"The client secret of your OAuth2 app."},allowedOrganizations:{label:"Allowed organizations",type:"select",description:`List of comma- or space-separated organizations. The user should be a member 
of at least one organization to log in.`,multi:!0,allowCustomValue:!0,options:[],placeholder:"Enter organizations (my-team, myteam...) and press Enter to add"},allowedDomains:{label:"Allowed domains",type:"select",description:`List of comma- or space-separated domains. The user should belong to at least 
one domain to log in.`,multi:!0,allowCustomValue:!0,options:[]},authUrl:{label:"Auth URL",type:"text",description:"The authorization endpoint of your OAuth2 provider.",validation:{required:!0,validate:t=>(0,H.K)(t),message:"This field is required and must be a valid URL."}},authStyle:{label:"Auth style",type:"select",description:"It determines how client_id and client_secret are sent to Oauth2 provider. Default is AutoDetect.",multi:!1,options:[{value:"AutoDetect",label:"AutoDetect"},{value:"InParams",label:"InParams"},{value:"InHeader",label:"InHeader"}],defaultValue:{value:"AutoDetect",label:"AutoDetect"}},tokenUrl:{label:"Token URL",type:"text",description:"The token endpoint of your OAuth2 provider.",validation:{required:!0,validate:t=>(0,H.K)(t),message:"This field is required and must be a valid URL."}},scopes:{label:"Scopes",type:"select",description:"List of comma- or space-separated OAuth2 scopes.",multi:!0,allowCustomValue:!0,options:[]},allowedGroups:{label:"Allowed groups",type:"select",description:e.createElement(e.Fragment,null,"List of comma- or space-separated groups. The user should be a member of at least one group to log in."," ",n==="generic_oauth"&&"If you configure allowed_groups, you must also configure groups_attribute_path."),multi:!0,allowCustomValue:!0,options:[],validation:n==="azuread"?{validate:t=>typeof t=="string"?(0,de.A)(t):K(t)?t.every(s=>s?.value&&(0,de.A)(s.value)):!0,message:"Allowed groups must be Object Ids."}:void 0},apiUrl:{label:"API URL",type:"text",description:e.createElement(e.Fragment,null,"The user information endpoint of your OAuth2 provider. Information returned by this endpoint must be compatible with"," ",e.createElement(me.Y,{href:"https://connect2id.com/products/server/docs/api/userinfo",external:!0,variant:"bodySmall"},"OpenID UserInfo"),"."),validation:{required:!1,validate:t=>typeof t!="string"?!1:t.length?(0,H.K)(t):!0,message:"This field must be a valid URL if set."}},roleAttributePath:{label:"Role attribute path",description:"JMESPath expression to use for Grafana role lookup.",type:"text",validation:{required:!1}},name:{label:"Display name",description:'Will be displayed on the login page as "Sign in with ...". Helpful if you use more than one identity providers or SSO protocols.',type:"text"},allowSignUp:{label:"Allow sign up",description:"If not enabled, only existing Grafana users can log in using OAuth.",type:"switch"},autoLogin:{label:"Auto login",description:"Log in automatically, skipping the login screen.",type:"switch"},signoutRedirectUrl:{label:"Sign out redirect URL",description:"The URL to redirect the user to after signing out from Grafana.",type:"text",validation:{required:!1}},emailAttributeName:{label:"Email attribute name",description:"Name of the key to use for user email lookup within the attributes map of OAuth2 ID token.",type:"text"},emailAttributePath:{label:"Email attribute path",description:"JMESPath expression to use for user email lookup from the user information.",type:"text"},nameAttributePath:{label:"Name attribute path",description:`JMESPath expression to use for user name lookup from the user ID token. 
This name will be used as the user\u2019s display name.`,type:"text"},loginAttributePath:{label:"Login attribute path",description:"JMESPath expression to use for user login lookup from the user ID token.",type:"text"},idTokenAttributeName:{label:"ID token attribute name",description:"The name of the key used to extract the ID token from the returned OAuth2 token.",type:"text"},roleAttributeStrict:{label:"Role attribute strict mode",description:"If enabled, denies user login if the Grafana role cannot be extracted using Role attribute path.",type:"switch"},allowAssignGrafanaAdmin:{label:"Allow assign Grafana admin",description:"If enabled, it will automatically sync the Grafana server administrator role.",type:"switch",hidden:!Ie.contextSrv.isGrafanaAdmin},skipOrgRoleSync:{label:"Skip organization role sync",description:"Prevent synchronizing users\u2019 organization roles from your IdP.",type:"switch"},defineAllowedGroups:{label:"Define allowed groups",type:"switch"},defineAllowedTeamsIds:{label:"Define allowed teams ids",type:"switch"},forceUseGraphApi:{label:"Force use Graph API",description:"If enabled, Grafana will fetch the users' groups using the Microsoft Graph API.",type:"checkbox"},usePkce:{label:"Use PKCE",description:e.createElement(e.Fragment,null,"If enabled, Grafana will use"," ",e.createElement(me.Y,{external:!0,variant:"bodySmall",href:"https://datatracker.ietf.org/doc/html/rfc7636"},"Proof Key for Code Exchange (PKCE)")," ","with the OAuth2 Authorization Code Grant."),type:"checkbox"},useRefreshToken:{label:"Use refresh token",description:"If enabled, Grafana will fetch a new access token using the refresh token provided by the OAuth2 provider.",type:"checkbox"},tlsClientCa:{label:"TLS client ca",description:"The file path to the trusted certificate authority list. Is not applicable on Grafana Cloud.",type:"text",hidden:!Q.$.localFileSystemAvailable},tlsClientCert:{label:"TLS client cert",description:"The file path to the certificate. Is not applicable on Grafana Cloud.",type:"text",hidden:!Q.$.localFileSystemAvailable},tlsClientKey:{label:"TLS client key",description:"The file path to the key. Is not applicable on Grafana Cloud.",type:"text",hidden:!Q.$.localFileSystemAvailable},tlsSkipVerifyInsecure:{label:"TLS skip verify",description:`If enabled, the client accepts any certificate presented by the server and any host 
name in that certificate. You should only use this for testing, because this mode leaves 
SSL/TLS susceptible to man-in-the-middle attacks.`,type:"switch"},groupsAttributePath:{label:"Groups attribute path",description:`JMESPath expression to use for user group lookup. If you configure allowed_groups, 
you must also configure groups_attribute_path.`,type:"text"},teamsUrl:{label:"Teams URL",description:e.createElement(e.Fragment,null,"The URL used to query for Team Ids. If not set, the default value is /teams."," ",n==="generic_oauth"&&"If you configure teams_url, you must also configure team_ids_attribute_path."),type:"text",validation:{validate:(t,s)=>{let o=!0;return s.teamIds.length&&(o=!!t),typeof t=="string"&&t.length&&(o=(0,H.K)(t)),o},message:"This field must be set if Team Ids are configured and must be a valid URL."}},teamIdsAttributePath:{label:"Team Ids attribute path",description:"The JMESPath expression to use for Grafana Team Id lookup within the results returned by the teams_url endpoint.",type:"text",validation:{validate:(t,s)=>s.teamIds.length?!!t:!0,message:"This field must be set if Team Ids are configured."}},teamIds:{label:"Team Ids",type:"select",description:e.createElement(e.Fragment,null,n==="github"?"Integer":"String"," list of Team Ids. If set, the user must be a member of one of the given teams to log in."," ",n==="generic_oauth"&&"If you configure team_ids, you must also configure teams_url and team_ids_attribute_path."),multi:!0,allowCustomValue:!0,options:[],placeholder:"Enter Team Ids and press Enter to add",validation:n==="github"?{validate:t=>typeof t=="string"?he(t):K(t)?t.every(s=>s?.value&&he(s.value)):!0,message:"Team Ids must be numbers."}:void 0},hostedDomain:{label:"Hosted domain",description:"The domain under which Grafana is hosted and accessible.",type:"text"},validateHd:{label:"Validate hosted domain",description:"If enabled, Grafana will match the Hosted Domain retrieved from the Google ID Token against the Allowed Domains list specified by the user.",type:"checkbox"}}}function he(n){return/^-?\d+$/.test(n)}const i=({field:n,register:t,errors:s,watch:o,setValue:u,control:d,unregister:m,secretConfigured:h,provider:W})=>{const[q,_]=(0,e.useState)(h),U=typeof n!="string",r=U?n.name:n,v=U?o(n.dependsOn):null,l=j(W)[r],Y=(0,Ae.$j)();if((0,e.useEffect)(()=>{U&&(v||m(r))},[m,r,v,U]),!n)return console.log("missing field:",r),null;if(l.hidden||U&&!o(n.dependsOn))return null;const b={label:l.label,required:!!l.validation?.required,invalid:!!s[r],error:l.validation?.message,key:r,description:l.description,defaultValue:l.defaultValue?.value};switch(l.type){case"text":return e.createElement(N.D,{...b},e.createElement(Ee.p,{...t(r,l.validation),type:l.type,id:r,autoComplete:"off"}));case"secret":return e.createElement(N.D,{...b,htmlFor:r},e.createElement(Z.xI,{name:r,control:d,rules:l.validation,render:({field:{ref:Pe,value:D,...ae}})=>e.createElement(Se.L4,{...ae,autoComplete:"off",id:r,value:typeof D=="string"?D:"",isConfigured:q,onReset:()=>{_(!1),u(r,"")}})}));case"select":const ee=o(r);let te=l.options;return l.options?.length||(te=K(ee)?ee:[]),e.createElement(N.D,{...b,htmlFor:r},e.createElement(Z.xI,{rules:l.validation,name:r,control:d,render:({field:{ref:Pe,onChange:D,...ae},fieldState:{invalid:Te}})=>e.createElement(B.l6,{...ae,placeholder:l.placeholder,isMulti:l.multi,invalid:Te,inputId:r,options:te,allowCustomValue:!!l.allowCustomValue,defaultValue:l.defaultValue,onChange:D,onCreateOption:ge=>{const O={value:ge,label:ge};D([...te||[],O])}})}));case"switch":return e.createElement(N.D,{...b},e.createElement(re.d,{...t(r),id:r}));case"checkbox":return e.createElement(Ce.S,{...t(r),id:r,...b,className:(0,ie.css)({marginBottom:Y.spacing(2)})});default:return console.error(`Unknown field type: ${l.type}`),null}},y={allowAssignGrafanaAdmin:!1,allowSignUp:!1,allowedDomains:[],allowedGroups:[],allowedOrganizations:[],apiUrl:"",authStyle:"",authUrl:"",autoLogin:!1,clientId:"",clientSecret:"",emailAttributeName:"",emailAttributePath:"",emptyScopes:!1,enabled:!1,extra:{},groupsAttributePath:"",hostedDomain:"",icon:"shield",name:"",roleAttributePath:"",roleAttributeStrict:!1,scopes:[],signoutRedirectUrl:"",skipOrgRoleSync:!1,teamIds:[],teamIdsAttributePath:"",teamsUrl:"",tlsClientCa:"",tlsClientCert:"",tlsClientKey:"",tlsSkipVerify:!1,tokenUrl:"",type:"",usePkce:!1,useRefreshToken:!1},I=n=>n?.length?Array.isArray(n)?n.map(t=>({label:t,value:t})):n.split(/[\s,]/).map(t=>({label:t,value:t})):[];function g(n){if(!n)return y;const t=T(n.provider),s=x(j(n.provider),t),o={...n.settings};for(const u of s)o[u]=I(o[u]);return o}const P=n=>n.map(({value:t})=>t).join(","),T=n=>{const t=fe[n],s=["enabled"];return Object.values(t).reduce((o,u)=>[...o,...u.fields.map(d=>typeof d=="string"?d:d.name)],s)};function $(n,t){let s=n;const o=T(t),u=x(j(t),o),d=Object.keys(s).filter(m=>o.includes(m)).reduce((m,h)=>({...m,[h]:s[h]}),{});for(const m of u){const h=s[m];h&&(K(h)?d[m]=P(h):K([h])&&(d[m]=h.value))}return d}function x(n,t){return Object.entries(n).filter(([s,o])=>t.includes(s)&&o.type==="select").map(([s])=>s)}const w=(0,pe.J7)(),J=({config:n,provider:t,isLoading:s})=>{const{register:o,handleSubmit:u,control:d,reset:m,watch:h,setValue:W,unregister:q,formState:{errors:_,dirtyFields:U,isSubmitted:r}}=(0,Z.mN)({defaultValues:g(n),mode:"onSubmit",reValidateMode:"onChange"}),[v,l]=(0,e.useState)(!1),[Y,b]=(0,e.useState)(!1),ee=r&&!Y,te=fe[t],[Pe,D]=(0,e.useState)(!1),ae=e.createElement(G.W,null,e.createElement(G.W.Item,{label:"Reset to default values",icon:"history-alt",onClick:()=>{D(!0)}})),Te=async f=>{l(!0),b(!1);const L=$(f,t);try{await(0,R.AI)().put(`/api/v1/sso-settings/${t}`,{id:n?.id,provider:n?.provider,settings:{...L}},{showErrorAlert:!1}),(0,M.rR)("grafana_authentication_ssosettings_saved",{provider:t,enabled:L.enabled}),w.publish({type:V.r1.alertSuccess.name,payload:["Settings saved"]}),m(f),setTimeout(()=>{oe.Ny.push("/admin/authentication")},300)}catch(A){let xe="";(0,R.NF)(A)?xe=A.data.message:A instanceof Error&&(xe=A.message),w.publish({type:V.r1.alertError.name,payload:[xe]}),b(!0),l(!1)}},ge=async()=>{try{await(0,R.AI)().delete(`/api/v1/sso-settings/${t}`,void 0,{showSuccessAlert:!1}),(0,M.rR)("grafana_authentication_ssosettings_removed",{provider:t}),w.publish({type:V.r1.alertSuccess.name,payload:["Settings reset to defaults"]}),setTimeout(()=>{oe.Ny.push("/admin/authentication")})}catch(f){let L="";(0,R.NF)(f)?L=f.data.message:f instanceof Error&&(L=f.message),w.publish({type:V.r1.alertError.name,payload:[L]})}},O=n?.settings.enabled,Re=f=>{(0,M.rR)("grafana_authentication_ssosettings_save_attempt",{provider:t,enabled:f?!O:O}),f&&W("enabled",!O)};return e.createElement(se.Y.Contents,{isLoading:s},e.createElement("form",{onSubmit:u(Te),style:{maxWidth:"600px"}},e.createElement(ce,{confirmRedirect:!!Object.keys(U).length&&!ee,onDiscard:()=>{(0,M.rR)("grafana_authentication_ssosettings_abandoned",{provider:t}),m()}}),e.createElement(N.D,{label:"Enabled",hidden:!0},e.createElement(re.d,{...o("enabled"),id:"enabled",label:"Enabled"})),e.createElement(C.B,{gap:2,direction:"column"},te.filter(f=>!f.hidden).map((f,L)=>e.createElement(ye.M,{label:f.name,isOpen:L===0,key:f.name},f.fields.filter(A=>typeof A!="string"?!A.hidden:!0).map(A=>e.createElement(i,{key:typeof A=="string"?A:A.name,field:A,control:d,errors:_,setValue:W,register:o,watch:h,unregister:q,provider:t,secretConfigured:!!n?.settings.clientSecret}))))),e.createElement(X.a,{display:"flex",gap:2,marginTop:5},e.createElement(C.B,{alignItems:"center",gap:2},e.createElement(z.$n,{type:"submit",disabled:v,onClick:()=>Re(!0),variant:O?"secondary":void 0},v?O?"Disabling...":"Saving...":O?"Disable":"Save and enable"),e.createElement(z.$n,{type:"submit",disabled:v,variant:"secondary",onClick:()=>Re(!1)},v?"Saving...":"Save"),e.createElement(z.z9,{href:"/admin/authentication",variant:"secondary"},"Discard"),e.createElement(ve.m,{overlay:ae,placement:"bottom-start"},e.createElement(we.K,{tooltip:"More actions",title:"More actions",tooltipPlacement:"top",size:"md",variant:"secondary",name:"ellipsis-v",hidden:n?.source==="system"}))))),Pe&&e.createElement(Ue.u,{isOpen:!0,icon:"trash-alt",title:"Reset",body:e.createElement(C.B,{direction:"column",gap:3},e.createElement("span",null,"Are you sure you want to reset this configuration?"),e.createElement("small",null,"After resetting these settings Grafana will use the provider configuration from the system (config file/environment variables) if any.")),confirmText:"Reset",onDismiss:()=>D(!1),onConfirm:async()=>{await ge(),D(!1)}}))};var c=a(7250),k=a(60610);const Ge=n=>{if(!n)return{text:"Authentication",subTitle:"Configure authentication providers",icon:"shield",id:"authentication"};const t=c.L[n.provider][1]||n.provider.toUpperCase();return{text:t||"",subTitle:`To configure ${t} OAuth2 you must register your application with ${t}. The provider will generate a Client ID and Client Secret for you to use.`,icon:n.settings.icon||"shield",id:n.provider}};function ke(n,t){const{isLoading:s,providers:o}=n.authConfig,{provider:u}=t.match.params;return{config:o.find(m=>m.provider===u),isLoading:s,provider:u}}const Oe={loadProviders:k.TD},Le=(0,S.connect)(ke,Oe),De=({config:n,loadProviders:t,isLoading:s,provider:o})=>{const u=Ge(n);return(0,e.useEffect)(()=>{t(o)},[t,o]),n?e.createElement(se.Y,{navId:"authentication",pageNav:u,renderTitle:d=>e.createElement(C.B,{gap:2,alignItems:"center"},e.createElement(p.E,{variant:"h1"},d),e.createElement(F.E,{text:n.settings.enabled?"Enabled":"Not enabled",color:n.settings.enabled?"green":"blue",icon:n.settings.enabled?"check":void 0}))},e.createElement(J,{config:n,isLoading:s,provider:o})):null},Fe=Le(De)},7250:(ne,E,a)=>{a.d(E,{L:()=>S,o:()=>e});const e="admin/authentication/",S={github:["github","GitHub"],gitlab:["gitlab","GitLab"],google:["google","Google"],generic_oauth:["lock","Generic OAuth"],grafana_com:["grafana","Grafana.com"],azuread:["microsoft","Azure AD"],okta:["okta","Okta"]}},5328:(ne,E,a)=>{a.d(E,{K:()=>C,h:()=>S});var e=a(7250);function S(p){return e.o+(p.configPath||p.id)}const C=p=>{if(typeof p!="string")return!1;try{return new URL(p).protocol.includes("http")}catch{return!1}}},8227:(ne,E,a)=>{a.d(E,{A:()=>C});const e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function S(p){return typeof p=="string"&&e.test(p)}const C=S}}]);

//# sourceMappingURL=AdminAuthentication.dcdd891921d76b99fb3e.js.map