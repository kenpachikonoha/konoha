"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2472],{39745:(k,D,t)=>{t.d(D,{A:()=>w,u:()=>s});var e=t(32196),n=t(96540),C=t(97594),I=t(41987),v=t(13544),H=t(14110),A=t(32264),j=t(84167),y=t(88575),N=t(21594),E=t(60029),o=t(20333),Q=t(15648),l=t(29678),O=t(55852),b=t(3911),V=t(59429),i=t(8484),L=t(74513),M=t(65615),x=t(2769);function a(){const z=L.Yj.map(r=>({value:r.code,label:r.name})).sort((r,K)=>r.value===L.wi?1:K.value===L.wi?-1:r.label.localeCompare(K.label));return[{value:"",label:(0,i.t)("common.locale.default","Default")},...z]}class s extends n.PureComponent{constructor(f){super(f),this.onSubmitForm=async r=>{if(r.preventDefault(),this.props.onConfirm?await this.props.onConfirm():!0){const{homeDashboardUID:Y,theme:G,timezone:J,weekStart:B,language:F,queryHistory:Z}=this.state;await this.service.update({homeDashboardUID:Y,theme:G,timezone:J,weekStart:B,language:F,queryHistory:Z}),window.location.reload()}},this.onThemeChanged=r=>{this.setState({theme:r.value}),r.value&&(0,x.K)(r.value,!0)},this.onTimeZoneChanged=r=>{typeof r=="string"&&this.setState({timezone:r})},this.onWeekStartChanged=r=>{this.setState({weekStart:r})},this.onHomeDashboardChanged=r=>{this.setState({homeDashboardUID:r})},this.onLanguageChanged=r=>{this.setState({language:r}),(0,H.rR)("grafana_preferences_language_changed",{toLanguage:r,preferenceType:this.props.preferenceType})},this.service=new M.W(f.resourceUri),this.state={theme:"",timezone:"",weekStart:"",language:"",queryHistory:{homeTab:""}},this.themeOptions=(0,C.k)(A.$.featureToggles.extraThemes).map(r=>({value:r.id,label:X(r)})),this.themeOptions.unshift({value:"",label:(0,i.t)("shared-preferences.theme.default-label","Default")})}async componentDidMount(){const f=await this.service.load();this.setState({homeDashboardUID:f.homeDashboardUID,theme:f.theme,timezone:f.timezone,weekStart:f.weekStart,language:f.language,queryHistory:f.queryHistory})}render(){const{theme:f,timezone:r,weekStart:K,homeDashboardUID:Y,language:G}=this.state,{disabled:J}=this.props,B=_(),F=a(),Z=this.themeOptions.find(p=>p.value===f)??this.themeOptions[0];return n.createElement("form",{onSubmit:this.onSubmitForm,className:B.form},n.createElement(j.n,{label:n.createElement(i.x6,{i18nKey:"shared-preferences.title"},"Preferences"),disabled:J},n.createElement(y.D,{label:(0,i.t)("shared-preferences.fields.theme-label","Interface theme")},n.createElement(N.l6,{options:this.themeOptions,value:Z,onChange:this.onThemeChanged,inputId:"shared-preferences-theme-select"})),n.createElement(y.D,{label:n.createElement(E.J,{htmlFor:"home-dashboard-select"},n.createElement("span",{className:B.labelText},n.createElement(i.x6,{i18nKey:"shared-preferences.fields.home-dashboard-label"},"Home Dashboard"))),"data-testid":"User preferences home dashboard drop down"},n.createElement(V.b,{value:Y,onChange:p=>this.onHomeDashboardChanged(p?.uid??""),defaultOptions:!0,isClearable:!0,placeholder:(0,i.t)("shared-preferences.fields.home-dashboard-placeholder","Default dashboard"),inputId:"home-dashboard-select"})),n.createElement(y.D,{label:(0,i.t)("shared-dashboard.fields.timezone-label","Timezone"),"data-testid":v.Tp.components.TimeZonePicker.containerV2},n.createElement(o.U,{includeInternal:!0,value:r,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})),n.createElement(y.D,{label:(0,i.t)("shared-preferences.fields.week-start-label","Week start"),"data-testid":v.Tp.components.WeekStartPicker.containerV2},n.createElement(Q.l,{value:K||"",onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})),n.createElement(y.D,{label:n.createElement(E.J,{htmlFor:"locale-select"},n.createElement("span",{className:B.labelText},n.createElement(i.x6,{i18nKey:"shared-preferences.fields.locale-label"},"Language")),n.createElement(l.y,{featureState:I.Ay.beta})),"data-testid":"User preferences language drop down"},n.createElement(N.l6,{value:F.find(p=>p.value===G),onChange:p=>this.onLanguageChanged(p.value??""),options:F,placeholder:(0,i.t)("shared-preferences.fields.locale-placeholder","Choose language"),inputId:"locale-select"}))),n.createElement(O.$n,{type:"submit",variant:"primary","data-testid":v.Tp.components.UserProfile.preferencesSaveButton},n.createElement(i.x6,{i18nKey:"common.save"},"Save")))}}const w=s,_=(0,b.N)(()=>({labelText:(0,e.css)({marginRight:"6px"}),form:(0,e.css)({width:"100%",maxWidth:"600px"})}));function X(z){switch(z.id){case"dark":return(0,i.t)("shared.preferences.theme.dark-label","Dark");case"light":return(0,i.t)("shared.preferences.theme.light-label","Light");case"system":return(0,i.t)("shared.preferences.theme.system-label","System preference");default:return z.name}}},48357:(k,D,t)=>{t.r(D),t.d(D,{UserProfileEditPage:()=>ne,default:()=>ue});var e=t(96540),n=t(71468),C=t(4392),I=t(74135),v=t(13544),H=t(3197),A=t(67061),j=t(63021),y=t(40675),N=t(40980),E=t(67608),o=t(39745),Q=t(83277),l=t(8484),O=t(39558),b=t(55852);class V extends e.PureComponent{render(){const{isLoading:P,orgs:h,user:g}=this.props;return P?e.createElement(O._,{text:"Loading organizations..."}):h.length===0?null:e.createElement("div",null,e.createElement("h3",{className:"page-sub-heading"},e.createElement(l.x6,{i18nKey:"user-orgs.title"},"Organizations")),e.createElement("table",{className:"filter-table form-inline","data-testid":v.Tp.components.UserProfile.orgsTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(l.x6,{i18nKey:"user-orgs.name-column"},"Name")),e.createElement("th",null,e.createElement(l.x6,{i18nKey:"user-orgs.role-column"},"Role")),e.createElement("th",null))),e.createElement("tbody",null,h.map((d,c)=>e.createElement("tr",{key:c},e.createElement("td",null,d.name),e.createElement("td",null,d.role),e.createElement("td",{className:"text-right"},d.orgId===g?.orgId?e.createElement(b.$n,{variant:"secondary",size:"sm",disabled:!0},e.createElement(l.x6,{i18nKey:"user-orgs.current-org-button"},"Current")):e.createElement(b.$n,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(d)}},e.createElement(l.x6,{i18nKey:"user-orgs.select-org-button"},"Select organisation"))))))))}}const i=V;var L=t(84167),M=t(88575),x=t(10354),a=t(56034),s=t(14578),w=t(72235),_=t(2913);const{disableLoginForm:X}=_.Ay,f=({user:u,isSavingUser:P,updateProfile:h})=>{const g=U=>{h(U)},d=(u&&u.isExternal)??!1,c=d&&u&&u.authLabels?u.authLabels[0]:"",T=c?` (Synced via ${c})`:"",S=X||d;return e.createElement(w.l,{onSubmit:g,validateOn:"onBlur"},({register:U,errors:$})=>e.createElement(e.Fragment,null,e.createElement(L.n,null,e.createElement(M.D,{label:(0,l.t)("user-profile.fields.name-label","Name")+T,invalid:!!$.name,error:e.createElement(l.x6,{i18nKey:"user-profile.fields.name-error"},"Name is required"),disabled:S},e.createElement(x.p,{...U("name",{required:!0}),id:"edit-user-profile-name",placeholder:(0,l.t)("user-profile.fields.name-label","Name"),defaultValue:u?.name??"",suffix:e.createElement(r,null)})),e.createElement(M.D,{label:(0,l.t)("user-profile.fields.email-label","Email")+T,invalid:!!$.email,error:e.createElement(l.x6,{i18nKey:"user-profile.fields.email-error"},"Email is required"),disabled:S},e.createElement(x.p,{...U("email",{required:!0}),id:"edit-user-profile-email",placeholder:(0,l.t)("user-profile.fields.email-label","Email"),defaultValue:u?.email??"",suffix:e.createElement(r,null)})),e.createElement(M.D,{label:(0,l.t)("user-profile.fields.username-label","Username")+T,disabled:S},e.createElement(x.p,{...U("login"),id:"edit-user-profile-username",defaultValue:u?.login??"",placeholder:(0,l.t)("user-profile.fields.username-label","Username")+T,suffix:e.createElement(r,null)}))),e.createElement(b.$n,{variant:"primary",disabled:P||S,"data-testid":v.Tp.components.UserProfile.profileSaveButton,type:"submit"},e.createElement(l.x6,{i18nKey:"common.save"},"Save"))))},r=()=>X?e.createElement(a.m,{content:"Login details locked because they are managed in another system."},e.createElement(s.I,{name:"lock"})):null;var K=t(32196),Y=t(72635);class G extends e.PureComponent{render(){const{isLoading:P,sessions:h,revokeUserSession:g}=this.props,d=J();return P?e.createElement(O._,{text:e.createElement(l.x6,{i18nKey:"user-sessions.loading"},"Loading sessions...")}):e.createElement("div",{className:d.wrapper},h.length>0&&e.createElement(e.Fragment,null,e.createElement("h3",{className:"page-sub-heading"},"Sessions"),e.createElement("table",{className:"filter-table form-inline","data-testid":v.Tp.components.UserProfile.sessionsTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(l.x6,{i18nKey:"user-session.seen-at-column"},"Last seen")),e.createElement("th",null,e.createElement(l.x6,{i18nKey:"user-session.created-at-column"},"Logged on")),e.createElement("th",null,e.createElement(l.x6,{i18nKey:"user-session.ip-column"},"IP address")),e.createElement("th",null,e.createElement(l.x6,{i18nKey:"user-session.browser-column"},"Browser & OS")),e.createElement("th",null))),e.createElement("tbody",null,h.map((c,T)=>e.createElement("tr",{key:T},c.isActive?e.createElement("td",null,"Now"):e.createElement("td",null,c.seenAt),e.createElement("td",null,(0,l.Xj)(c.createdAt,{dateStyle:"long"})),e.createElement("td",null,c.clientIp),e.createElement("td",null,c.browser," on ",c.os," ",c.osVersion),e.createElement("td",null,e.createElement(b.$n,{size:"sm",variant:"destructive",onClick:()=>g(c.id),"aria-label":(0,Y.t)("user-session.revoke","Revoke user session")},e.createElement(s.I,{name:"power"})))))))))}}const J=()=>({wrapper:(0,K.css)({maxWidth:"100%"})}),B=G;class F extends e.PureComponent{render(){const{isLoading:P,teams:h}=this.props;return P?e.createElement(O._,{text:"Loading teams..."}):h.length===0?null:e.createElement("div",null,e.createElement("h3",{className:"page-sub-heading"},"Teams"),e.createElement("table",{className:"filter-table form-inline","aria-label":"User teams table"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Name"),e.createElement("th",null,"Email"),e.createElement("th",null,"Members"))),e.createElement("tbody",null,h.map((g,d)=>e.createElement("tr",{key:d},e.createElement("td",{className:"width-4 text-center"},e.createElement("img",{className:"filter-table__avatar",src:g.avatarUrl,alt:""})),e.createElement("td",null,g.name),e.createElement("td",null,g.email),e.createElement("td",null,g.memberCount))))))}}const Z=null;var p=t(84969);const te="tab",q="general";function ie(u){const P=u.user,{user:h,teams:g,orgs:d,sessions:c,teamsAreLoading:T,orgsAreLoading:S,sessionsAreLoading:U,isUpdating:$}=P;return{orgsAreLoading:S,sessionsAreLoading:U,teamsAreLoading:T,orgs:d,sessions:c,teams:g,isUpdating:$,user:h}}const ce={initUserProfilePage:p.Qe,revokeUserSession:p._O,changeUserOrg:p.Aj,updateUserProfile:p.eg},me=(0,n.connect)(ie,ce);function ne({orgsAreLoading:u,sessionsAreLoading:P,teamsAreLoading:h,initUserProfilePage:g,orgs:d,sessions:c,teams:T,isUpdating:S,user:U,revokeUserSession:$,changeUserOrg:de,updateUserProfile:Ee}){const[fe,he]=(0,Q.s)(),ae=fe[te],[ee,ge]=(0,e.useState)(typeof ae=="string"?ae:q);(0,C.A)(()=>g());const{extensions:re}=(0,H.kr)({extensionPointId:I.S.UserProfileTab}),se=re.reduce((m,R)=>{const{title:W}=R;return m[W]?m[W].push(R):m[W]=[R],m},{}),le=m=>m.toLowerCase(),pe=re.length>0,ve=[{id:q,title:(0,l.t)("user-profile.tabs.general","General")},...Object.keys(se).map(m=>({id:le(m),title:m}))],oe=()=>e.createElement(A.B,{direction:"column",gap:2},e.createElement(f,{updateProfile:Ee,isSavingUser:S,user:U}),e.createElement(o.A,{resourceUri:"user",preferenceType:"user"}),e.createElement(A.B,{direction:"column",gap:6},e.createElement(F,{isLoading:h,teams:T}),e.createElement(i,{isLoading:u,setUserOrg:de,orgs:d,user:U}),e.createElement(B,{isLoading:P,revokeUserSession:$,sessions:c}))),Pe=()=>e.createElement("div",{"data-testid":v.Tp.components.UserProfile.extensionPointTabs},e.createElement(A.B,{direction:"column",gap:2},e.createElement(j.U,null,ve.map(({id:m,title:R})=>e.createElement(y.o,{key:m,label:R,active:ee===m,onChangeTab:()=>{ge(m),he({[te]:m})},"data-testid":v.Tp.components.UserProfile.extensionPointTab(m)}))),e.createElement(N.J,null,ee===q&&e.createElement(oe,null),Object.entries(se).map(([m,R])=>{const W=le(m);return ee===W?e.createElement(e.Fragment,{key:W},R.map(({component:Ue},Te)=>e.createElement(Ue,{key:`${W}-${Te}`}))):null}))));return e.createElement(E.Y,{navId:"profile/settings"},e.createElement(E.Y.Contents,{isLoading:!U},pe?e.createElement(Pe,null):e.createElement(oe,null)))}const ue=me(ne)},84969:(k,D,t)=>{t.d(D,{ec:()=>Q,Aj:()=>M,Qe:()=>l,YW:()=>O,_O:()=>L,eg:()=>x});var e=t(32264),n=t(17172);async function C(a){try{await(0,n.AI)().put("/api/user/password",a)}catch(s){console.error(s)}}function I(){return(0,n.AI)().get("/api/user")}function v(){return(0,n.AI)().get("/api/user/teams")}function H(){return(0,n.AI)().get("/api/user/orgs")}function A(){return(0,n.AI)().get("/api/user/auth-tokens")}async function j(a){await(0,n.AI)().post("/api/user/revoke-auth-token",{authTokenId:a})}async function y(a){await(0,n.AI)().post("/api/user/using/"+a.orgId,{})}async function N(a){try{await(0,n.AI)().put("/api/user",a)}catch(s){console.error(s)}}const E={changePassword:C,revokeUserSession:j,loadUser:I,loadSessions:A,loadOrgs:H,loadTeams:v,setUserOrg:y,updateUserProfile:N};var o=t(81862);function Q(a){return async function(s){s((0,o.Nm)({updating:!0})),await E.changePassword(a),s((0,o.Nm)({updating:!1}))}}function l(){return async function(a){await a(O()),a(b()),a(V()),a(i())}}function O(){return async function(a){const s=await E.loadUser();a((0,o.HO)({user:s}))}}function b(){return async function(a){a((0,o.ri)());const s=await E.loadTeams();a((0,o.Q9)({teams:s}))}}function V(){return async function(a){a((0,o.Mj)());const s=await E.loadOrgs();a((0,o.ny)({orgs:s}))}}function i(){return async function(a){a((0,o.uh)());const s=await E.loadSessions();a((0,o.RS)({sessions:s}))}}function L(a){return async function(s){s((0,o.Nm)({updating:!0})),await E.revokeUserSession(a),s((0,o.g$)({tokenId:a}))}}function M(a){return async function(s){s((0,o.Nm)({updating:!0})),await E.setUserOrg(a),window.location.href=e.$.appSubUrl+"/profile"}}function x(a){return async function(s){s((0,o.Nm)({updating:!0})),await E.updateUserProfile(a),await s(O()),s((0,o.Nm)({updating:!1}))}}},4392:(k,D,t)=>{t.d(D,{A:()=>C});var e=t(94701),n=function(I){(0,e.A)(function(){I()})};const C=n}}]);

//# sourceMappingURL=UserProfileEditPage.c58af15442d8bf20d5ee.js.map