"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9947],{40715:(le,V,n)=>{n.d(V,{o:()=>C});var l=n(96540),a=n(31678),t=n(97007);function C(A){const I=(0,a.useDispatch)(),x=(0,l.useRef)(A);x.current=A,(0,l.useEffect)(()=>()=>{I((0,t.N)({cleanupAction:x.current}))},[I])}},31099:(le,V,n)=>{n.d(V,{A:()=>p});var l=n(32196),a=n(1932),t=n(96540),C=n(49785),A=n(42941),I=n(40845),x=n(67061),F=n(94753),B=n(10354),P=n(21744),j=n(88575),O=n(55852),g=n(55740);const k=({field:e})=>{const o=(0,I.of)(he);return t.createElement("div",null,t.createElement("span",{className:o.annotationTitle},"Custom annotation name and content"),t.createElement(B.p,{placeholder:"Enter custom annotation name...",width:18,...e,className:o.customAnnotationInput}))},he=e=>({annotationTitle:(0,l.css)({color:e.colors.text.primary,marginBottom:"3px"}),customAnnotationInput:(0,l.css)({marginTop:"5px",width:"100%"})}),oe=k,be=({annotationField:e,annotations:o,annotation:s,index:f})=>{const{control:u}=(0,C.xW)();return t.createElement(x.B,{direction:"column",gap:0},t.createElement("label",null,t.createElement(C.xI,{name:`annotations.${f}.key`,defaultValue:e.key,render:({field:{ref:c,...d}})=>{if(!g.J3[s])return t.createElement(oe,{field:d});let m;switch(e.key){case g.YH.dashboardUID:m="Dashboard and panel";break;case g.YH.panelID:m="";break;default:m=g.J3[s]&&g.J3[s]+" (optional)"}return t.createElement("span",{"data-testid":`annotation-key-${f}`},t.createElement(F.E,{color:"primary",variant:"bodySmall"},m))},control:u,rules:{required:{value:!!o[f]?.value,message:"Required."}}})),t.createElement(F.E,{variant:"bodySmall",color:"secondary"},g.H8[s]))};var z=n(14578),se=n(56361);const De=({dashboard:e,panel:o,dashboardUid:s,panelId:f,onEditClick:u,onDeleteClick:c})=>{const d=(0,I.of)(Se),m=(0,se.JM)(e?.uid||s),h=(0,se.D2)(e?.uid||s,o?.id?.toString()||f);return t.createElement("div",{className:d.container},e&&t.createElement("a",{href:m,className:d.link,target:"_blank",rel:"noreferrer","data-testid":"dashboard-annotation"},e.title," ",t.createElement(z.I,{name:"external-link-alt"})),!e&&t.createElement("span",{className:d.noLink},"Dashboard ",s," "),o&&t.createElement("a",{href:h,className:d.link,target:"_blank",rel:"noreferrer","data-testid":"panel-annotation"},o.title||"<No title>"," ",t.createElement(z.I,{name:"external-link-alt"})),!o&&t.createElement("span",{className:d.noLink}," - Panel ",f),(e||o)&&t.createElement(t.Fragment,null,t.createElement(z.I,{name:"pen",onClick:u,className:d.icon}),t.createElement(z.I,{name:"trash-alt",onClick:c,className:d.icon})))},Se=e=>({container:(0,l.css)({marginTop:"5px"}),noLink:(0,l.css)({color:e.colors.text.secondary}),link:(0,l.css)({color:e.colors.text.link,marginRight:e.spacing(1.5)}),icon:(0,l.css)({marginRight:e.spacing(1),cursor:"pointer"})}),Ie=De;var Ae=n(2543),Ce=n(40996),re=n(70713),ce=n(91793),_=n(56034),ie=n(37390),xe=n(42418),ee=n(67647),te=n(39558),Le=n(49962);const de=Le.H.injectEndpoints({endpoints:e=>({search:e.query({query:({query:o})=>{const s=new URLSearchParams({type:"dash-db",limit:"1000",page:"1",sort:"name_sort"});return o&&s.set("query",o),{url:`/api/search?${s.toString()}`}}}),dashboard:e.query({query:({uid:o})=>({url:`/api/dashboards/uid/${o}`})})})});var Q=n(41811),ue=n(34214);const Be=(0,Q.A)(e=>{const{dashboard:o,meta:s}=structuredClone(e);return new ue.G(o,s)});function q(e){return de.endpoints.dashboard.useQuery({uid:e??""},{skip:!e,selectFromResult:({currentData:s,data:f,...u})=>({dashboardModel:s?Be(s):void 0,...u})})}function Pe(e,o){return e.title&&o.title?e.title.localeCompare(o.title):e.title&&!o.title?1:!e.title&&o.title?-1:0}const Re=({dashboardUid:e,panelId:o,isOpen:s,onChange:f,onDismiss:u})=>{const c=(0,I.of)(ae),[d,m]=(0,t.useState)(e),[h,L]=(0,t.useState)(o),[G,Z]=(0,t.useState)(""),[W,R]=(0,t.useState)(""),[w,H]=(0,t.useState)(""),{useSearchQuery:N}=de,{currentData:y=[],isFetching:b}=N({query:W}),{dashboardModel:T,isFetching:$}=q(d),K=(0,t.useCallback)(S=>{m(S),L(void 0)},[]),fe=me(T),ge=fe.filter(S=>S.title?.toLowerCase().includes(w.toLowerCase())).sort(Pe)??[],v=fe.find(S=>pe(S)&&S.id?.toString()===h),D=(0,t.useMemo)(()=>y.map(S=>S.uid).indexOf(d??""),[y,d]),U=e&&e===d,J=D>=0,X=(0,t.useCallback)(S=>{const Y=D>=0;U&&Y&&S?.scrollToItem(D,"smart")},[U,D]);(0,Ce.A)(()=>{R(G)},500,[G]);const Ee=({index:S,style:Y})=>{const M=y[S],ve=d===M.uid;return t.createElement("button",{type:"button",title:M.title,style:Y,className:(0,l.cx)(c.rowButton,{[c.rowOdd]:S%2===1,[c.rowSelected]:ve}),onClick:()=>K(M.uid)},t.createElement("div",{className:(0,l.cx)(c.dashboardTitle,c.rowButtonTitle)},M.title),t.createElement("div",{className:c.dashboardFolder},t.createElement(z.I,{name:"folder"})," ",M.folderTitle??"General"))},ne=({index:S,style:Y})=>{const M=ge[S],ve=M.title||"<No title>",Te=!!M.id&&h===M.id,Me=M.type==="graph"||M.type==="timeseries",ye=!pe(M);return t.createElement("button",{type:"button",style:Y,disabled:ye,className:(0,l.cx)(c.rowButton,c.panelButton,{[c.rowOdd]:S%2===1,[c.rowSelected]:Te}),onClick:()=>ye?Ae.noop:L(M.id)},t.createElement("div",{className:c.rowButtonTitle,title:ve},ve),!Me&&!ye&&t.createElement(_.m,{content:"The alert tab and alert annotations are only supported on graph and timeseries panels."},t.createElement(z.I,{name:"exclamation-triangle",className:c.warnIcon,"data-testid":"warning-icon"})),ye&&t.createElement(_.m,{content:"This panel does not have a valid identifier."},t.createElement(z.I,{name:"info-circle","data-testid":"info-icon"})))};return t.createElement(ie.a,{title:"Select dashboard and panel",closeOnEscape:!0,isOpen:s,onDismiss:u,className:c.modal,contentClassName:c.modalContent},!J&&e&&T&&t.createElement(xe.F,{title:"Current selection",severity:"info",topSpacing:0,bottomSpacing:1,className:c.modalAlert},t.createElement("div",null,"Dashboard: ",T.title," (",T.uid,") in folder"," ",T.meta?.folderTitle??"General"),v&&t.createElement("div",null,"Panel: ",v.title," (",v.id,")")),t.createElement("div",{className:c.container},t.createElement(ee.Z,{value:G,onChange:Z,title:"Search dashboard",placeholder:"Search dashboard",autoFocus:!0}),t.createElement(ee.Z,{value:w,onChange:H,title:"Search panel",placeholder:"Search panel"}),t.createElement("div",{className:c.column},b&&t.createElement(te._,{text:"Loading dashboards...",className:c.loadingPlaceholder}),!b&&t.createElement(re.Ay,null,({height:S,width:Y})=>t.createElement(ce.Y1,{ref:X,itemSize:50,height:S,width:Y,itemCount:y.length},Ee))),t.createElement("div",{className:c.column},!d&&!$&&t.createElement("div",{className:c.selectDashboardPlaceholder},t.createElement("div",null,"Select a dashboard to get a list of available panels")),$&&t.createElement(te._,{text:"Loading dashboard...",className:c.loadingPlaceholder}),d&&!$&&t.createElement(re.Ay,null,({width:S,height:Y})=>t.createElement(ce.Y1,{itemSize:32,height:Y,width:S,itemCount:ge.length},ne)))),t.createElement(ie.a.ButtonRow,null,t.createElement(O.$n,{type:"button",variant:"secondary",onClick:u,fill:"text"},"Cancel"),t.createElement(O.$n,{type:"button",variant:"primary",disabled:!(d&&h),onClick:()=>{d&&h&&f(d,h)}},"Confirm")))};function me(e){if(!e)return[];const o=e.panels.filter(u=>u.type!=="row"),s=e.panels.filter(u=>u.collapsed).flatMap(u=>u.panels??[]);return[...o,...s]}const pe=e=>{const o=typeof e.id=="number",s=typeof e.type=="string",f="libraryPanel"in e;return o&&(s||f)},ae=e=>{const o=(0,O.my)(e);return{container:(0,l.css)({display:"grid",gridTemplateColumns:"1fr 1fr",gridTemplateRows:"min-content auto",gap:e.spacing(2),flex:1}),column:(0,l.css)({flex:"1 1 auto"}),dashboardTitle:(0,l.css)({height:"22px",fontWeight:e.typography.fontWeightBold}),dashboardFolder:(0,l.css)({height:"20px",fontSize:e.typography.bodySmall.fontSize,color:e.colors.text.secondary,display:"flex",flexDirection:"row",justifyContent:"flex-start",columnGap:e.spacing(1),alignItems:"center"}),rowButton:(0,l.css)(o,{padding:e.spacing(.5),overflow:"hidden",textOverflow:"ellipsis",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer",border:"2px solid transparent","&:disabled":{cursor:"not-allowed",color:e.colors.text.disabled}}),rowButtonTitle:(0,l.css)({textOverflow:"ellipsis",overflow:"hidden"}),rowSelected:(0,l.css)({borderColor:e.colors.primary.border}),rowOdd:(0,l.css)({backgroundColor:e.colors.background.secondary}),panelButton:(0,l.css)({display:"flex",gap:e.spacing(1),justifyContent:"space-between",alignItems:"center"}),loadingPlaceholder:(0,l.css)({height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),selectDashboardPlaceholder:(0,l.css)({width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",fontWeight:e.typography.fontWeightBold}),modal:(0,l.css)({height:"100%"}),modalContent:(0,l.css)({flex:1,display:"flex",flexDirection:"column"}),modalAlert:(0,l.css)({flexGrow:0}),warnIcon:(0,l.css)({fill:e.colors.warning.main})}};var Ne=n(64100),r=n(271);const i=()=>{const e=(0,I.of)(E),[o,s]=(0,A.A)(!1),{control:f,register:u,watch:c,formState:{errors:d},setValue:m}=(0,C.xW)(),h=c("annotations"),{fields:L,append:G,remove:Z}=(0,C.jz)({control:f,name:"annotations"}),W=h.find(v=>v.key===g.YH.dashboardUID)?.value,R=Number(h.find(v=>v.key===g.YH.panelID)?.value),[w,H]=(0,t.useState)(void 0),[N,y]=(0,t.useState)(void 0),{dashboardModel:b,isFetching:T}=q(W);(0,t.useEffect)(()=>{if(T||!b)return;H(b);const D=me(b).find(U=>U.id===R);y(D)},[R,b,T]);const $=(v,D)=>{const U=(0,a.jM)(h,J=>{const X=J.find(ne=>ne.key===g.YH.dashboardUID),Ee=J.find(ne=>ne.key===g.YH.panelID);X?X.value=v:J.push({key:g.YH.dashboardUID,value:v}),Ee?Ee.value=D.toString():J.push({key:g.YH.panelID,value:D.toString()})});m("annotations",U),s(!1)},K=()=>{const v=h.filter(D=>D.key!==g.YH.dashboardUID&&D.key!==g.YH.panelID);m("annotations",v),H(void 0),y(void 0)},fe=()=>{s(!0)};function ge(){return t.createElement(x.B,{direction:"row",gap:.5,alignItems:"center"},t.createElement(F.E,{variant:"bodySmall",color:"secondary"},"Add more context in your notification messages."),t.createElement(Ne.G,{contentText:`Annotations add metadata to provide more information on the alert in your alert notification messages.
          For example, add a Summary annotation to tell you which value caused the alert to fire or which server it happened on.
          Annotations can contain a combination of text and template code.`,title:"Annotations"}))}return t.createElement(r.P,{stepNo:5,title:"Add annotations",description:ge(),fullWidth:!0},t.createElement(x.B,{direction:"column",gap:1},L.map((v,D)=>{const U=h[D]?.key?.toLocaleLowerCase().endsWith("url"),J=U?B.p:P.f,X=v.key;return t.createElement("div",{key:v.id,className:e.flexRow},t.createElement("div",null,t.createElement(be,{annotationField:v,annotations:h,annotation:X,index:D}),W&&R&&v.key===g.YH.dashboardUID&&t.createElement(Ie,{dashboard:w,panel:N,dashboardUid:W.toString(),panelId:R.toString(),onEditClick:fe,onDeleteClick:K}),t.createElement("div",{className:e.annotationValueContainer},t.createElement(j.D,{hidden:v.key===g.YH.dashboardUID||v.key===g.YH.panelID,className:(0,l.cx)(e.flexRowItemMargin,e.field),invalid:!!d.annotations?.[D]?.value?.message,error:d.annotations?.[D]?.value?.message},t.createElement(J,{"data-testid":`annotation-value-${D}`,className:(0,l.cx)(e.annotationValueInput,{[e.textarea]:!U}),...u(`annotations.${D}.value`),placeholder:U?"https://":v.key&&`Enter a ${v.key}...`||"Enter custom annotation content...",defaultValue:v.value})),!g.J3[X]&&t.createElement(O.$n,{type:"button",className:e.deleteAnnotationButton,"aria-label":"delete annotation",icon:"trash-alt",variant:"secondary",onClick:()=>Z(D)}))))}),t.createElement(x.B,{direction:"row",gap:1},t.createElement("div",{className:e.addAnnotationsButtonContainer},t.createElement(O.$n,{icon:"plus",type:"button",variant:"secondary",onClick:()=>{G({key:"",value:""})}},"Add custom annotation"),!w&&t.createElement(O.$n,{type:"button",variant:"secondary",icon:"dashboard",onClick:()=>s(!0)},"Link dashboard and panel"))),o&&t.createElement(Re,{isOpen:!0,dashboardUid:W,panelId:R,onChange:$,onDismiss:()=>s(!1)})))},E=e=>({annotationValueInput:(0,l.css)({width:"394px"}),textarea:(0,l.css)({height:"76px"}),addAnnotationsButtonContainer:(0,l.css)({marginTop:e.spacing(1),gap:e.spacing(1),display:"flex"}),field:(0,l.css)({marginBottom:e.spacing(.5)}),flexRow:(0,l.css)({display:"flex",flexDirection:"row",justifyContent:"flex-start"}),flexRowItemMargin:(0,l.css)({marginTop:e.spacing(1)}),deleteAnnotationButton:(0,l.css)({display:"inline-block",marginTop:"10px",marginLeft:"10px"}),annotationTitle:(0,l.css)({color:e.colors.text.primary,marginBottom:"3px"}),annotationContainer:(0,l.css)({marginTop:"5px"}),annotationDescription:(0,l.css)({color:e.colors.text.secondary}),annotationValueContainer:(0,l.css)({display:"flex"})}),p=i},64100:(le,V,n)=>{n.d(V,{G:()=>F});var l=n(32196),a=n(96540),t=n(40845),C=n(60782),A=n(67061),I=n(14578),x=n(94753);function F({contentText:P,externalLink:j,linkText:O,title:g="Need help?"}){const k=(0,t.of)(B);return a.createElement(C.G,{content:a.createElement("div",{className:k.mutedText},P),title:a.createElement(A.B,{gap:.5,direction:"row",alignItems:"center"},a.createElement(I.I,{name:"question-circle"}),g),footer:j?a.createElement("a",{href:j,target:"_blank",rel:"noreferrer"},a.createElement(A.B,{direction:"row",gap:.5,alignItems:"center"},a.createElement(x.E,{color:"link"},O," ",a.createElement(I.I,{size:"sm",name:"external-link-alt"})))):void 0,closeButton:!0,placement:"bottom-start"},a.createElement("div",{className:k.helpInfo},a.createElement(A.B,{direction:"row",alignItems:"center",gap:.5},a.createElement(I.I,{name:"question-circle",size:"sm"}),a.createElement(x.E,{variant:"bodySmall",color:"primary"},"Need help?"))))}const B=P=>({mutedText:(0,l.css)({color:P.colors.text.secondary,fontSize:P.typography.size.sm}),helpInfo:(0,l.css)({cursor:"pointer",textDecoration:"underline"})})},271:(le,V,n)=>{n.d(V,{P:()=>x});var l=n(32196),a=n(96540),t=n(40845),C=n(84167),A=n(94753),I=n(67061);const x=({title:B,stepNo:P,children:j,fullWidth:O=!1,description:g})=>{const k=(0,t.of)(F);return a.createElement("div",{className:k.parent},a.createElement(C.n,{className:(0,l.cx)(O&&k.fullWidth),label:a.createElement(A.E,{variant:"h3"},P,". ",B)},a.createElement(I.B,{direction:"column"},g&&a.createElement("div",{className:k.description},g),j)))},F=B=>({parent:(0,l.css)({display:"flex",flexDirection:"row",border:`solid 1px ${B.colors.border.weak}`,borderRadius:B.shape.radius.default,padding:`${B.spacing(2)} ${B.spacing(3)}`}),description:(0,l.css)({marginTop:`-${B.spacing(2)}`}),fullWidth:(0,l.css)({width:"100%"})})},97171:(le,V,n)=>{n.d(V,{DI:()=>ue,C1:()=>Be,Ay:()=>Ne});var l=n(32196),a=n(96540),t=n(49785),C=n(40845),A=n(67061),I=n(94753),x=n(68402),F=n(55852),B=n(39558),P=n(88575),j=n(76892),O=n(10354),g=n(31678),k=n(99494),he=n(49962);const oe=he.H.injectEndpoints({endpoints:r=>({getLabels:r.query({query:()=>({url:`/api/plugins/${k.W.Labels}/resources/v1/labels/keys`}),providesTags:["GrafanaLabels"]}),getLabelValues:r.query({query:({key:i})=>({url:`/api/plugins/${k.W.Labels}/resources/v1/labels/name/${i}`}),providesTags:["GrafanaLabels"]})})});var Oe=n(12210),be=n(61410),z=n(23770),se=n(75214),De=n(88131),Se=n(21594);const Ie=(0,De.c)({ignoreCase:!1});function Ae(r,i){return Ie({label:r.label??"",value:r.value??"",data:{}},i)}const Ce=(r,i,E)=>{const p=E.some(o=>o.label===r),e=r.trim().length;return!p&&!!e},re=a.forwardRef(function({onChange:i,options:E,defaultValue:p,type:e,onOpenMenu:o=()=>{}},s){const f=(0,C.of)(ce);return a.createElement("div",{ref:s},a.createElement(P.D,{disabled:!1,"data-testid":`alertlabel-${e}-picker`,className:f.resetMargin},a.createElement(Se.l6,{placeholder:`Choose ${e}`,width:29,className:"ds-picker select-container",backspaceRemovesValue:!1,onChange:i,onOpenMenu:o,filterOption:Ae,isValidNewOption:Ce,options:E,maxMenuHeight:500,noOptionsMessage:"No labels found",defaultValue:p,allowCustomValue:!0})))}),ce=()=>({resetMargin:(0,l.css)({marginBottom:0})}),_=re;var ie=n(69087),xe=n(64100);function ee({remove:r,index:i}){return a.createElement(F.$n,{"aria-label":"delete label",icon:"trash-alt","data-testid":`delete-label-${i}`,variant:"secondary",onClick:()=>{r(i)}})}function te({append:r}){return a.createElement(F.$n,{icon:"plus",type:"button",variant:"secondary",onClick:r},"Add more")}const Le=r=>{const{currentData:i,isLoading:E}=oe.endpoints.getLabels.useQuery(void 0,{skip:r});return{loading:E,labelsOpsKeys:i}},de=r=>{const i=(0,g.useDispatch)();(0,a.useEffect)(()=>{i((0,z.HB)(r))},[i,r]);const p=(0,be.$)(o=>o.rulerRules)[r],e=(0,a.useMemo)(()=>{const o={},s=p?.result;return s&&Object.values(s).flatMap(u=>u).flatMap(u=>u.rules).forEach(u=>{u.labels&&Object.entries(u.labels).forEach(([c,d])=>{if(!d)return;const m=o[c];m?m.add(d):o[c]=new Set([d])})}),o},[p]);return{loading:p?.loading,labelsByKey:e}};function Q(r=[],i){const E=new Set(i?i.map(p=>p.key):[]);return Array.from(r,p=>({label:p,value:p,isDisabled:E.has(p)}))}const ue=({labels:r})=>{const i=r.reduce((E,p)=>(p.key&&(E[p.key]=p.value),E),{});return a.createElement(ie.m,{labels:i})};function Be({dataSourceName:r,onClose:i,initialLabels:E}){const p=(0,C.of)(ae),e=u=>{i(u.labelsInSubform)},o=()=>{i()},s=(0,a.useMemo)(()=>({labelsInSubform:E}),[E]),f=(0,t.mN)({defaultValues:s});return a.createElement(t.Op,{...f},a.createElement("form",{onSubmit:f.handleSubmit(e)},a.createElement(A.B,{direction:"column",gap:4},a.createElement(I.E,null,"Add labels to your rule for searching, silencing, or routing to a notification policy."),a.createElement(A.B,{direction:"column",gap:1},a.createElement(Re,{dataSourceName:r}),a.createElement(x.$,{v:2}),a.createElement(ue,{labels:f.watch("labelsInSubform")}),a.createElement(x.$,{v:1}),a.createElement("div",{className:p.confirmButton},a.createElement(F.$n,{type:"button",variant:"secondary",onClick:o},"Cancel"),a.createElement(F.$n,{type:"submit"},"Save"))))))}const q=r=>!(0,se.F2)(r);function Pe(r,i,E,p,e){const{loading:o,labelsByKey:s}=de(r),{loading:f,labelsOpsKeys:u=[]}=Le(!i||E),c=(0,a.useMemo)(()=>u.reduce((b,T)=>(b[T.name]=new Set,b),{}),[u]),d=(0,a.useMemo)(()=>Q(Object.keys(c).filter(q),p),[c,p]),m=(0,a.useMemo)(()=>Q(Object.keys(s).filter(q),p),[s,p]),h=[{label:"From alerts",options:m,expanded:!0},{label:"From system",options:d,expanded:!0}],L=s[e]!==void 0&&s[e]?.size>0,G=c[e]!==void 0&&c[e]?.size>0,Z=!L&&!G,W=!L&&c[e]?.size>0,{currentData:R,isLoading:w=!1,error:H}=oe.endpoints.getLabelValues.useQuery({key:e},{skip:!i||!e||L||W||Z}),N=(0,a.useMemo)(()=>{if(L)return[];const b=c[e];if(b?.size>0)return Q(b);if(!w&&R?.values?.length&&!H){const $=R?.values.map(K=>K.name);return c[e]=new Set($),Q($)}return[]},[L,c,e,w,R,H]),y=(0,a.useCallback)(b=>q(b)?L||!i?Q(s[b]):N:[],[s,i,N,L]);return{loading:o||f,keysFromExistingAlerts:m,groupedOptions:h,getValuesForLabel:y}}function Re({dataSourceName:r}){const i=(0,C.of)(ae),{control:E,watch:p,formState:{errors:e}}=(0,t.xW)(),o=p("labelsInSubform"),{fields:s,remove:f,append:u}=(0,t.jz)({control:E,name:"labelsInSubform"}),c=(0,a.useCallback)(()=>{u({key:"",value:""})},[u]),{installed:d=!1,loading:m}=(0,Oe._)(k.W.Labels),[h,L]=(0,a.useState)(""),{loading:G,keysFromExistingAlerts:Z,groupedOptions:W,getValuesForLabel:R}=Pe(r,d,m,o,h),w=(0,a.useMemo)(()=>R(h),[h,R]),H=G||m;return a.createElement(a.Fragment,null,H&&a.createElement(B._,{text:"Loading existing labels"}),!H&&a.createElement(A.B,{direction:"column",gap:1,alignItems:"flex-start"},s.map((N,y)=>a.createElement("div",{key:N.id,className:(0,l.cx)(i.flexRow,i.centerAlignRow)},a.createElement(P.D,{className:i.labelInput,invalid:!!e.labelsInSubform?.[y]?.key?.message,error:e.labelsInSubform?.[y]?.key?.message,"data-testid":`labelsInSubform-key-${y}`},a.createElement(t.xI,{name:`labelsInSubform.${y}.key`,control:E,rules:{required:o[y]?.value?"Required.":!1},render:({field:{onChange:b,ref:T,...$}})=>a.createElement(_,{...$,defaultValue:N.key?{label:N.key,value:N.key}:void 0,options:d?W:Z,onChange:K=>{b(K.value),L(K.value)},type:"key"})})),a.createElement(j.c,{className:i.equalSign},"="),a.createElement(P.D,{className:i.labelInput,invalid:!!e.labelsInSubform?.[y]?.value?.message,error:e.labelsInSubform?.[y]?.value?.message,"data-testid":`labelsInSubform-value-${y}`},a.createElement(t.xI,{control:E,name:`labelsInSubform.${y}.value`,rules:{required:o[y]?.value?"Required.":!1},render:({field:{onChange:b,ref:T,...$}})=>a.createElement(_,{...$,defaultValue:N.value?{label:N.value,value:N.value}:void 0,options:w,onChange:K=>{b(K.value)},onOpenMenu:()=>{L(o[y].key)},type:"value"})})),a.createElement(ee,{index:y,remove:f}))),a.createElement(te,{append:c})))}const me=()=>{const r=(0,C.of)(ae),{register:i,control:E,watch:p,formState:{errors:e}}=(0,t.xW)(),o=p("labels"),{fields:s,remove:f,append:u}=(0,t.jz)({control:E,name:"labels"}),c=(0,a.useCallback)(()=>{u({key:"",value:""})},[u]);return a.createElement(a.Fragment,null,s.map((d,m)=>a.createElement("div",{key:d.id},a.createElement("div",{className:(0,l.cx)(r.flexRow,r.centerAlignRow),"data-testid":"alertlabel-input-wrapper"},a.createElement(P.D,{className:r.labelInput,invalid:!!e.labels?.[m]?.key?.message,error:e.labels?.[m]?.key?.message},a.createElement(O.p,{...i(`labels.${m}.key`,{required:{value:!!o[m]?.value,message:"Required."}}),placeholder:"key","data-testid":`label-key-${m}`,defaultValue:d.key})),a.createElement(j.c,{className:r.equalSign},"="),a.createElement(P.D,{className:r.labelInput,invalid:!!e.labels?.[m]?.value?.message,error:e.labels?.[m]?.value?.message},a.createElement(O.p,{...i(`labels.${m}.value`,{required:{value:!!o[m]?.key,message:"Required."}}),placeholder:"value","data-testid":`label-value-${m}`,defaultValue:d.value})),a.createElement(ee,{index:m,remove:f})))),a.createElement(te,{append:c}))};function pe(){return a.createElement("div",null,a.createElement(A.B,{direction:"column",gap:1},a.createElement(I.E,{element:"h5"},"Labels"),a.createElement(A.B,{direction:"row",gap:1},a.createElement(I.E,{variant:"bodySmall",color:"secondary"},"Add labels to your rule for searching, silencing, or routing to a notification policy."),a.createElement(xe.G,{contentText:`The dropdown only displays labels that you have previously used for alerts.
            Select a label from the options below or type in a new one.`,title:"Labels"}))),a.createElement(me,null))}const ae=r=>({flexColumn:(0,l.css)({display:"flex",flexDirection:"column"}),flexRow:(0,l.css)({display:"flex",flexDirection:"row",justifyContent:"flex-start"}),centerAlignRow:(0,l.css)({alignItems:"center",gap:r.spacing(.5)}),equalSign:(0,l.css)({alignSelf:"flex-start",width:"28px",justifyContent:"center",margin:0}),labelInput:(0,l.css)({width:"175px",margin:0}),confirmButton:(0,l.css)({display:"flex",flexDirection:"row",gap:r.spacing(1),marginLeft:"auto"})}),Ne=pe}}]);

//# sourceMappingURL=9947.6a4684d10b0eeb0f47eb.js.map