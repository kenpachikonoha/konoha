"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2042],{82042:(Qe,V,a)=>{a.r(V),a.d(V,{CreateAlertButton:()=>te,default:()=>we});var g=a(32196),e=a(96540),re=a(24180),oe=a(41053),se=a(10940),ie=a(49185),ce=a(76885),me=a(66602),I=a(40845),x=a(55852),de=a(57514),ue=a(31678),F=a(25027),L=a(19073),ge=a(9518),J=a(14285),X=a(61410),Z=a(23770),Ee=a(55740),S=a(57220),B=a(56361),ve=a(37959),pe=a(45058),fe=a(75648),ye=a(67381),Re=a(92467),he=a(84866),P=a(2543),Ie=a(42941),D=a(18461),T=a(23662),Ce=a(55127),z=a.n(Ce),u=a(67061),R=a(72109),M=a(83122),v=a(38138),N=a(94753),be=a(42418),f=a(94822),K=a(75214),h=a(55196),Y=a(90141),Q=a(26058),xe=a(56034),G=a(14578),Be=a(45314);function k({state:t,health:l,recording:i=!1,isPaused:s=!1}){const o={[f.cF.Inactive]:"check-circle",[f.cF.Pending]:"circle",[f.cF.Firing]:"exclamation-circle"},p={[f.cF.Inactive]:"success",[f.cF.Pending]:"warning",[f.cF.Firing]:"error"},r={[f.cF.Inactive]:"Normal",[f.cF.Pending]:"Pending",[f.cF.Firing]:"Firing"};let n=t?o[t]:"circle",E=t?p[t]:"secondary",d=t?r[t]:"unknown";return i&&(n="record-audio",E="success",d="Recording"),l==="nodata"&&(n="exclamation-triangle",E="warning",d="Insufficient data"),(0,Be.lf)(l)&&(n="times-circle",E="error",d="Failed to evaluate rule"),s&&(n="pause-circle",E="warning",d="Paused"),e.createElement(xe.m,{content:d,placement:"right"},e.createElement("div",null,e.createElement(N.E,{color:E},e.createElement(G.I,{name:n,size:"lg"}))))}var Ne=a(13064);const q=t=>{const{name:l,summary:i,state:s,health:o,error:p,href:r,isProvisioned:n,lastEvaluation:E,evaluationInterval:d,isPaused:y=!1,instancesCount:A=0,contactPoint:C,labels:$}=t,O=(0,I.of)(j);return e.createElement("li",{className:O.alertListItemContainer,role:"treeitem","aria-selected":"false"},e.createElement(u.B,{direction:"row",alignItems:"start",gap:1,wrap:"nowrap"},e.createElement(k,{state:s,health:o,isPaused:y}),e.createElement(u.B,{direction:"column",gap:.5,flex:"1"},e.createElement("div",null,e.createElement(u.B,{direction:"column",gap:0},e.createElement(u.B,{direction:"row",alignItems:"start"},e.createElement(R.Y,{href:r,inline:!1},l)),e.createElement(_,{content:i,error:p}))),e.createElement("div",null,e.createElement(u.B,{direction:"row",gap:1},!y&&e.createElement(e.Fragment,null,e.createElement(ee,{lastEvaluation:E,evaluationInterval:d,health:o,state:s,error:p}),e.createElement(h.P,{icon:"layers-alt"},e.createElement(R.Y,{href:r+"?tab=instances",variant:"bodySmall",color:"primary",inline:!1},z()("instance",A,!0)))),!(0,P.isEmpty)($)&&e.createElement(h.P,{icon:"tag-alt"},e.createElement(R.Y,{href:r,variant:"bodySmall",color:"primary",inline:!1},z()("label",(0,K.rm)($),!0))),C&&!y&&e.createElement(h.P,{icon:"at"},"Delivered to"," ",e.createElement(R.Y,{href:(0,B.bg)(C,S.hY),variant:"bodySmall",color:"primary",inline:!1},C))))),e.createElement(u.B,{direction:"row",alignItems:"center",gap:1,wrap:"nowrap"},e.createElement(x.$n,{variant:"secondary",size:"sm",icon:"pen",type:"button",disabled:n},"Edit"),e.createElement(M.m,{overlay:e.createElement(v.W,null,e.createElement(v.W.Item,{label:"Silence",icon:"bell-slash"}),e.createElement(v.W.Divider,null),e.createElement(v.W.Item,{label:"Export",disabled:n,icon:"download-alt"}),e.createElement(v.W.Item,{label:"Delete",disabled:n,icon:"trash-alt",destructive:!0}))},e.createElement(Y.A,null)))))};function _({content:t,error:l}){return l?e.createElement(N.E,{variant:"bodySmall",color:"error",weight:"light",truncate:!0},l):t?e.createElement(N.E,{variant:"bodySmall",color:"secondary"},t):null}const Ae=({name:t,error:l,state:i,health:s,isProvisioned:o,href:p,labels:r,lastEvaluation:n,evaluationInterval:E})=>{const d=(0,I.of)(j);return e.createElement("li",{className:d.alertListItemContainer,role:"treeitem","aria-selected":"false"},e.createElement(u.B,{direction:"row",alignItems:"center",gap:1},e.createElement(u.B,{direction:"row",alignItems:"start",gap:1,flex:"1"},e.createElement(k,{health:s,recording:!0}),e.createElement(u.B,{direction:"column",gap:.5},e.createElement(u.B,{direction:"column",gap:0},e.createElement(u.B,{direction:"row",alignItems:"start"},e.createElement(R.Y,{href:p,variant:"body",weight:"bold",inline:!1},t)),e.createElement(_,{error:l})),e.createElement("div",null,e.createElement(u.B,{direction:"row",gap:1},e.createElement(ee,{lastEvaluation:n,evaluationInterval:E,health:s,state:i,error:l}),!(0,P.isEmpty)(r)&&e.createElement(h.P,{icon:"tag-alt"},e.createElement(R.Y,{variant:"bodySmall",color:"primary",href:p,inline:!1},z()("label",(0,K.rm)(r),!0)))))),e.createElement(Q.h,null),e.createElement(x.$n,{variant:"secondary",size:"sm",icon:"pen",type:"button",disabled:o,"data-testid":"edit-rule-action"},"Edit"),e.createElement(M.m,{overlay:e.createElement(v.W,null,e.createElement(v.W.Item,{label:"Export",disabled:o,icon:"download-alt"}),e.createElement(v.W.Item,{label:"Delete",disabled:o,icon:"trash-alt",destructive:!0}))},e.createElement(Y.A,null)))))};function ee({lastEvaluation:t,evaluationInterval:l,state:i}){const s=(0,Ne.C)(t,l);return i===f.cF.Firing&&s?e.createElement(h.P,{icon:"clock-nine"},"Firing for ",e.createElement(N.E,{color:"primary"},"2m 34s"),s&&e.createElement(e.Fragment,null,"\xB7 next evaluation in ",s.humanized)):s?e.createElement(h.P,{icon:"clock-nine"},"Next evaluation ",s.humanized):null}const Fe=({rule:t})=>{const l=(0,I.of)(j),i={namespace:t.namespace.name,group:t.group.name,name:t.name};return(0,F.vV)(new Error("unknown rule type"),i),e.createElement(be.F,{title:"Unknown rule type",className:l.resetMargin},e.createElement("details",null,e.createElement("summary",null,"Rule definition"),e.createElement("pre",null,e.createElement("code",null,JSON.stringify(t.rulerRule,null,2)))))},j=t=>({alertListItemContainer:(0,g.css)({position:"relative",listStyle:"none",background:t.colors.background.primary,borderBottom:`solid 1px ${t.colors.border.weak}`,padding:t.spacing(1,1,1,1.5)}),resetMargin:(0,g.css)({margin:0})});var Le=a(39938);const Se=({name:t,provenance:l,interval:i,onToggle:s,isOpen:o=!1,children:p})=>{const r=(0,I.of)(Pe),n=!!l;return e.createElement(u.B,{direction:"column",role:"treeitem","aria-expanded":o,"aria-selected":"false",gap:0},e.createElement("div",{className:r.headerWrapper},e.createElement(u.B,{direction:"row",alignItems:"center",gap:1},e.createElement("button",{className:(0,g.cx)(r.hiddenButton,r.largerClickTarget),type:"button",onClick:s},e.createElement(u.B,{alignItems:"center",gap:.5},e.createElement(G.I,{name:o?"angle-down":"angle-right"}),e.createElement(N.E,{truncate:!0,variant:"body"},t))),n&&e.createElement(Le.E,{color:"purple",text:"Provisioned"}),e.createElement(Q.h,null),i&&e.createElement(h.P,{icon:"history"},i),e.createElement(x.$n,{size:"sm",icon:"pen",variant:"secondary",disabled:n,"data-testid":"edit-group-action"},"Edit"),e.createElement(M.m,{overlay:e.createElement(v.W,null,e.createElement(v.W.Item,{label:"Re-order rules",icon:"flip",disabled:n}),e.createElement(v.W.Divider,null),e.createElement(v.W.Item,{label:"Export",icon:"download-alt"}),e.createElement(v.W.Item,{label:"Delete",icon:"trash-alt",destructive:!0,disabled:n}))},e.createElement(Y.A,{size:"sm"})))),o&&e.createElement("div",{role:"group"},p))},Pe=t=>({headerWrapper:(0,g.css)({padding:`${t.spacing(1)} ${t.spacing(1)}`,background:t.colors.background.secondary,border:"none",borderBottom:`solid 1px ${t.colors.border.weak}`,borderTopLeftRadius:t.shape.radius.default,borderTopRightRadius:t.shape.radius.default}),hiddenButton:(0,g.css)({border:"none",background:"transparent"}),largerClickTarget:(0,g.css)({padding:t.spacing(.5),margin:`-${t.spacing(.5)}`})}),Te=Se,$e=({group:t,rulesSource:l})=>{const[i,s]=(0,Ie.A)(!1);return e.createElement(Te,{name:t.name,interval:t.interval,isOpen:i,onToggle:s},t.rules.map((o,p)=>{const{rulerRule:r,promRule:n,annotations:E}=o;if(!r)return null;const d=(0,T.Z8)(n);if((0,T.$y)(r))return e.createElement(q,{key:(0,D.Ns)(r),state:d?n?.state:void 0,health:n?.health,error:n?.lastError,name:r.alert,labels:r.labels,lastEvaluation:n?.lastEvaluation,evaluationDuration:n?.evaluationTime,evaluationInterval:t.interval,instancesCount:d?(0,P.size)(n.alerts):void 0,href:(0,B.w$)(l,o),summary:E?.summary});if((0,T.i7)(r))return e.createElement(Ae,{key:(0,D.Ns)(r),name:r.record,health:n?.health,error:n?.lastError,lastEvaluation:n?.lastEvaluation,evaluationDuration:n?.evaluationTime,evaluationInterval:t.interval,labels:r.labels,href:(0,B.w$)(l,o)});if((0,T.lT)(r)){const y=r.grafana_alert.notification_settings?.receiver;return e.createElement(q,{key:r.grafana_alert.uid,name:r.grafana_alert.title,state:d?n?.state:void 0,health:n?.health,error:n?.lastError,labels:r.labels,isPaused:r.grafana_alert.is_paused,lastEvaluation:n?.lastEvaluation,evaluationDuration:n?.evaluationTime,evaluationInterval:t.interval,instancesCount:d?(0,P.size)(n.alerts):void 0,href:(0,B.w$)(l,o),summary:o.annotations?.summary,isProvisioned:!!r.grafana_alert.provenance,contactPoint:y})}return e.createElement(Fe,{key:(0,D.Ns)(r),rule:o})}))};var We=a(96636);const De=({children:t,name:l,href:i,application:s})=>{const o=(0,I.of)(Me);return e.createElement("li",{className:o.namespaceWrapper,role:"treeitem","aria-selected":"false"},e.createElement("div",{className:o.namespaceTitle},e.createElement(u.B,{alignItems:"center",gap:1},e.createElement(ze,{application:s}),i?e.createElement(We.d,{title:"Alert rules",component:e.createElement(R.Y,{href:i,inline:!1},l)}):l)),t&&e.createElement("ul",{role:"group",className:o.groupItemsWrapper},t))},ze=({application:t})=>{switch(t){case f.N1.Prometheus:return e.createElement("img",{width:16,height:16,src:"public/app/plugins/datasource/prometheus/img/prometheus_logo.svg",alt:"Prometheus"});case f.N1.Mimir:return e.createElement("img",{width:16,height:16,src:"public/app/plugins/datasource/prometheus/img/mimir_logo.svg",alt:"Mimir"});case"loki":return e.createElement("img",{width:16,height:16,src:"public/app/plugins/datasource/loki/img/loki_icon.svg",alt:"Loki"});case"grafana":default:return e.createElement(G.I,{name:"folder"})}},Me=t=>({groupItemsWrapper:(0,g.css)({position:"relative",borderRadius:t.shape.radius.default,border:`solid 1px ${t.colors.border.weak}`,borderBottom:"none",marginLeft:t.spacing(3),"&:before":{content:"''",position:"absolute",height:"100%",borderLeft:`solid 1px ${t.colors.border.weak}`,marginTop:0,marginLeft:`-${t.spacing(2.5)}`}}),namespaceWrapper:(0,g.css)({display:"flex",flexDirection:"column",gap:t.spacing(1)}),namespaceTitle:(0,g.css)({padding:`${t.spacing(1)} ${t.spacing(1.5)}`,background:t.colors.background.secondary,border:`solid 1px ${t.colors.border.weak}`,borderRadius:t.shape.radius.default})}),Ye=De,Ge=fe.Ys+1,je=(0,me.Xc)(()=>{const t=(0,ue.useDispatch)(),l=(0,I.of)(Ue),i=(0,e.useMemo)(S.gR,[]),[s,o]=(0,e.useState)(!1),p=(0,e.useCallback)(()=>o(!1),[]),{filterState:r,hasActiveFilters:n}=(0,J.dI)(),E=(0,X.$)(m=>m.promRules),d=(0,X.$)(m=>m.rulerRules),y=i.some(m=>E[m]?.loading||d[m]?.loading),A=Object.entries(E),C=Object.entries(d),$=A.every(([m,c])=>c.dispatched&&(c?.result!==void 0||c?.error!==void 0)),O=C.every(([m,c])=>c.dispatched&&(c?.result!==void 0||c?.error!==void 0)),He=A.every(([m,c])=>c.dispatched&&c?.result?.length===0),Ve=C.every(([m,c])=>Object.entries(c?.result??{}).every(([le,b])=>b?.length===0)&&c.dispatched),W=n?void 0:Ge,[ke,Je]=(0,oe.A)(async()=>{y||await t((0,Z.yo)(!1,{limitAlerts:W}))},[y,W,t]);(0,e.useEffect)(()=>{(0,F.Sq)().catch(()=>{})},[]),(0,e.useEffect)(()=>{t((0,Z.yo)(!1,{limitAlerts:W}))},[t,W]),(0,se.A)(Je,Ee.HH);const ae=$&&He&&A.length>0&&Ve&&O,U=!ae,Xe=(0,ge.dy)(),ne=(0,J.i7)(Xe,r),Ze=ne.sort((m,c)=>m.name.localeCompare(c.name));return e.createElement(ve.d,{navId:"alert-list",isLoading:!1,actions:U&&e.createElement(te,null)},e.createElement(ye.o,null),e.createElement(he.A,{onFilterCleared:p}),U&&e.createElement(e.Fragment,null,e.createElement("div",{className:l.break}),e.createElement("div",{className:l.buttonsContainer},e.createElement("div",{className:l.statsContainer},n&&e.createElement(x.$n,{className:l.expandAllButton,icon:s?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>o(!s)},s?"Collapse all":"Expand all"),e.createElement(Re.M_,{namespaces:ne})))),ae&&e.createElement(pe.w,null),U&&e.createElement(e.Fragment,null,e.createElement(Oe,{visible:y}),e.createElement("ul",{className:l.rulesTree,role:"tree","aria-label":"List of alert rules"},Ze.map(m=>{const{rulesSource:c,uid:w}=m,H=(0,S.Vr)(c),le=H==="grafana"&&w?(0,B.c$)(w,m.name):void 0;return e.createElement(Ye,{key:(0,S.v8)(c)+m.name,href:le,name:m.name,application:H},m.groups.sort((b,Ke)=>b.name.localeCompare(Ke.name)).map(b=>e.createElement($e,{key:b.name,group:b,rulesSource:c})))}))))},{style:"page"}),Oe=({visible:t=!1})=>{const[l,{width:i}]=(0,ie.A)();return e.createElement("div",{ref:l},t&&e.createElement(de.G,{width:i}))},Ue=t=>({rulesTree:(0,g.css)({display:"flex",flexDirection:"column",gap:t.spacing(1)}),break:(0,g.css)({width:"100%",height:0,marginBottom:t.spacing(2),borderBottom:`solid 1px ${t.colors.border.medium}`}),buttonsContainer:(0,g.css)({marginBottom:t.spacing(2),display:"flex",justifyContent:"space-between"}),statsContainer:(0,g.css)({display:"flex",flexDirection:"row",alignItems:"center"}),expandAllButton:(0,g.css)({marginRight:t.spacing(1)})}),we=je;function te(){const[t,l]=(0,L.Ej)(L.RY.CreateAlertRule),[i,s]=(0,L.Ej)(L.RY.CreateExternalAlertRule),o=(0,re.zy)();return t&&l||i&&s?e.createElement(x.z9,{href:ce.kM.renderUrl("alerting/new/alerting",{returnTo:o.pathname+o.search}),icon:"plus",onClick:()=>(0,F.fH)(F.le.alertRuleFromScratch)},"New alert rule"):null}}}]);

//# sourceMappingURL=2042.196e6c03d82591092b7d.js.map