"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6552],{99226:(Ae,_,t)=>{t.d(_,{gv:()=>ee});var s=t(2543),e=t.n(s),n=t(96540),F=t(32264),g=t(67061),oe=t(55852),c=t(25968);const P=F.$.unifiedAlerting.minInterval??"10s",M=((G=P)=>{const E=[(0,c.M9)("10s"),(0,c.M9)("30s"),(0,c.M9)("1m"),(0,c.M9)("5m"),(0,c.M9)("10m"),(0,c.M9)("15m"),(0,c.M9)("30m"),(0,c.M9)("1h")],R=(0,c.P8)(G),J=E.filter(W=>R<=W),le=(0,s.times)(8-J.length,W=>{const K=(0,s.last)(J)??R,se=J.length===0?1:2;return K*se*(W+1)});return[...J,...le].map(c.an)})(P),ee=({currentInterval:G,onSelect:te})=>n.createElement(g.B,{direction:"row",gap:.5,role:"listbox"},M.map(E=>{const R=G===E;return n.createElement(oe.$n,{role:"option","aria-selected":R,key:E,variant:R?"primary":"secondary",size:"sm",onClick:()=>te(E)},E)}))},1723:(Ae,_,t)=>{t.d(_,{R:()=>Qe,I:()=>k});var s=t(32196),e=t(96540),n=t(49785),F=t(40845),g=t(67061),oe=t(29158),c=t(88575),P=t(60029),V=t(10354),M=t(94753),ee=t(15292),G=t(56034),te=t(14578),E=t(8484),R=t(25027),J=t(9518),le=t(61410),W=t(57220),K=t(25968),se=t(64047),me=t(46479),ae=t(2543),$=t(26272),U=t(13544),Q=t(55852),Ne=t(21594),Be=t(90613),Y=t(37390),Ce=t(28138),X=t(16233),Me=t(11230),ne=t(31678),Ge=t(79938),Re=t(730),ie=t(63066),De=t(23662),xe=t(48205),p=t(99226),h=t(85242);const y=()=>{const a=(0,F.of)(re),r=()=>window.open("https://github.com/grafana/grafana/issues/42947","_blank");return e.createElement(g.B,{gap:.5},e.createElement("div",{className:a.slashNotAllowed},"Folders with '/' character are not allowed."),e.createElement(G.m,{placement:"top",content:"Link to the Github issue",theme:"info"},e.createElement(te.I,{name:"info-circle",size:"xs",className:a.infoIcon,onClick:r})))},N=a=>a.indexOf("/")!==-1;function D(a){const{value:r}=a,o={warningCondition:i=>N(i),warningComponent:y},u={disallowValues:!0,isAllowedValue:i=>!N(i)};return e.createElement(h.sR,{showRoot:!1,rootName:"",allowEmpty:!0,initialFolderUid:r?.uid,searchQueryType:ne.SearchQueryType.AlertFolder,...a,permissionLevel:ne.PermissionLevelString.Edit,customAdd:u,folderWarning:o})}const re=a=>({slashNotAllowed:(0,s.css)({color:a.colors.warning.main,fontSize:"12px",marginBottom:"2px"}),infoIcon:(0,s.css)({color:a.colors.warning.main,fontSize:"12px",marginBottom:"2px",cursor:"pointer"})});var B=t(7921);const S=1e3,T=(a,r)=>{const{isLoading:l,currentData:o}=Ge.hK.endpoints.rulerNamespace.useQuery({namespace:a,rulerConfig:Re.$q},{skip:!a,refetchOnMountOrArgChange:!0});return{groupOptions:(0,e.useMemo)(()=>o?(Object.values(o).flat()??[]).map(m=>{const v=Se(m);return{label:m.name,value:m.name,description:m.interval??ie.T6,isDisabled:r?!1:v,isProvisioned:v}}).sort(Fe):[],[o,r]),loading:l}},Se=a=>a.rules.some(r=>(0,De.lT)(r)&&!!r.grafana_alert.provenance),Fe=(a,r)=>a.label?.localeCompare(r.label??"")||0,be=(a,r)=>a.label?.toLowerCase().includes(r.toLowerCase());function Pe({groupfoldersForGrafana:a,enableProvisionedGroups:r}){const{formState:{errors:l},watch:o,setValue:u,control:i}=(0,n.xW)(),m=(0,F.of)(ge),v=o("folder"),x=o("group"),{groupOptions:C,loading:I}=T(v?.uid??"",r),[O,A]=(0,e.useState)(!1),[b,L]=(0,e.useState)(!1),ue=()=>A(!0),z=()=>L(!0),H=f=>{ce(),u("folder",f),A(!1)},Ie=(f,j)=>{u("group",f),u("evaluateEvery",j),L(!1)},ce=(0,e.useCallback)(()=>{u("group","")},[u]),q=(0,e.useCallback)(async f=>{const j=f?C.filter(ye=>be(ye,f)):C;return(0,ae.take)(j,S)},[C]),we=(0,e.useMemo)(()=>(0,ae.debounce)(q,300,{leading:!0}),[q]),ze=x?{value:x,label:x}:void 0;return e.createElement("div",{className:m.container},e.createElement(g.B,{alignItems:"center"},e.createElement(c.D,{label:e.createElement(P.J,{htmlFor:"folder",description:"Select a folder to store your rule."},"Folder"),className:m.formInput,error:l.folder?.message,"data-testid":"folder-picker"},e.createElement(g.B,{direction:"row",alignItems:"center"},!O&&e.createElement(e.Fragment,null,e.createElement(n.xI,{render:({field:{ref:f,...j}})=>e.createElement("div",{style:{width:420}},e.createElement(D,{inputId:"folder",invalid:!!l.folder?.message,...j,enableReset:!0,onChange:({title:ye,uid:de})=>{j.onChange({title:ye,uid:de}),ce()}})),name:"folder",rules:{required:{value:!0,message:"Select a folder"},validate:{pathSeparator:f=>(0,B.G0)(f.uid)}}}),e.createElement(M.E,{color:"secondary"},"or"),e.createElement(Q.$n,{onClick:ue,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!X.TP.hasPermission(ne.AccessControlAction.FoldersCreate),"data-testid":U.Tp.components.AlertRules.newFolderButton},"New folder"))||e.createElement("div",null,"Creating new folder..."))),O&&e.createElement(ve,{onCreate:H,onClose:()=>A(!1)})),O&&e.createElement(ve,{onCreate:H,onClose:()=>A(!1)}),e.createElement(g.B,{alignItems:"center"},e.createElement("div",{style:{width:420}},e.createElement(c.D,{label:"Evaluation group and interval","data-testid":"group-picker",description:"Define how often the alert rule is evaluated.",className:m.formInput,error:l.group?.message,invalid:!!l.group?.message},e.createElement(n.xI,{render:({field:{ref:f,...j},fieldState:ye})=>e.createElement(Ne.DW,{disabled:!v||I,inputId:"group",key:(0,ae.uniqueId)(),...j,onChange:de=>{j.onChange(de.label??"")},isLoading:I,invalid:!!v&&!x&&!!ye.error,loadOptions:we,cacheOptions:!0,loadingMessage:"Loading groups...",defaultValue:ze,defaultOptions:C,getOptionLabel:de=>e.createElement("div",null,e.createElement("span",null,de.label),de.isProvisioned&&e.createElement(e.Fragment,null," ",e.createElement(xe.rS,null))),placeholder:"Select an evaluation group..."}),name:"group",control:i,rules:{required:{value:!0,message:"Must enter a group name"},validate:{pathSeparator:f=>(0,B.G0)(f)}}}))),e.createElement(Be.a,{marginTop:4,gap:1,display:"flex",alignItems:"center"},e.createElement(M.E,{color:"secondary"},"or"),e.createElement(Q.$n,{onClick:z,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!v,"data-testid":U.Tp.components.AlertRules.newEvaluationGroupButton},"New evaluation group")),b&&e.createElement(Z,{onCreate:Ie,onClose:()=>L(!1),groupfoldersForGrafana:a})))}function ve({onClose:a,onCreate:r}){const l=(0,F.of)(ge),[o,u]=(0,e.useState)(""),i=async()=>{const v=await(0,Me.vV)({title:o});if(!v.uid){Ce.A.emit($.r1.alertError,["Folder could not be created"]);return}const x={title:v.title,uid:v.uid};r(x),Ce.A.emit($.r1.alertSuccess,["Folder Created","OK"])},m=N(o);return e.createElement(Y.a,{className:l.modal,isOpen:!0,title:"New folder",onDismiss:a,onClickBackdrop:a},e.createElement("div",{className:l.modalTitle},"Create a new folder to store your rule"),e.createElement("form",{onSubmit:i},e.createElement(c.D,{label:e.createElement(P.J,{htmlFor:"folder"},"Folder name"),error:"The folder name can't contain slashes",invalid:m},e.createElement(V.p,{"data-testid":U.Tp.components.AlertRules.newFolderNameField,autoFocus:!0,id:"folderName",placeholder:"Enter a name",value:o,onChange:v=>u(v.currentTarget.value),className:l.formInput})),e.createElement(Y.a.ButtonRow,null,e.createElement(Q.$n,{variant:"secondary",type:"button",onClick:a},"Cancel"),e.createElement(Q.$n,{type:"submit",disabled:!o||m,"data-testid":U.Tp.components.AlertRules.newFolderNameCreateButton},"Create"))))}function Z({onClose:a,onCreate:r,groupfoldersForGrafana:l}){const o=(0,F.of)(ge),u=()=>{r(z("group"),z("evaluateEvery"))},{watch:i}=(0,n.xW)(),m="eval-every-input",[v,x]=i(["group","folder.title"]),C=(l&&l[x]?.find(q=>q.name===v)?.rules)??[],I=()=>{a()},O=(0,n.mN)({defaultValues:{group:"",evaluateEvery:ie.T6},mode:"onChange",shouldFocusError:!0}),{register:A,handleSubmit:b,formState:L,setValue:ue,getValues:z,watch:H}=O,Ie=H("evaluateEvery"),ce=q=>{ue("evaluateEvery",q,{shouldValidate:!0})};return e.createElement(Y.a,{className:o.modal,isOpen:!0,title:"New evaluation group",onDismiss:I,onClickBackdrop:I},e.createElement("div",{className:o.modalTitle},"Create a new evaluation group to use for this alert rule."),e.createElement(n.Op,{...O},e.createElement("form",{onSubmit:b(()=>u())},e.createElement(c.D,{label:e.createElement(P.J,{htmlFor:"group",description:"A group evaluates all its rules over the same evaluation interval."},"Evaluation group"),error:L.errors.group?.message,invalid:!!L.errors.group},e.createElement(V.p,{"data-testid":U.Tp.components.AlertRules.newEvaluationGroupName,className:o.formInput,autoFocus:!0,id:"group",placeholder:"Enter a name",...A("group",{required:{value:!0,message:"Required."}})})),e.createElement(c.D,{error:L.errors.evaluateEvery?.message,invalid:L.errors.evaluateEvery?!0:void 0,label:e.createElement(P.J,{htmlFor:m,description:"How often all rules in the group are evaluated."},"Evaluation interval")},e.createElement(g.B,{direction:"column"},e.createElement(V.p,{"data-testid":U.Tp.components.AlertRules.newEvaluationGroupInterval,className:o.formInput,id:m,placeholder:ie.T6,...A("evaluateEvery",(0,me.iS)(C))}),e.createElement(g.B,{direction:"row",alignItems:"flex-end"},e.createElement(p.gv,{currentInterval:Ie,onSelect:ce})))),e.createElement(Y.a.ButtonRow,null,e.createElement(Q.$n,{variant:"secondary",type:"button",onClick:I},"Cancel"),e.createElement(Q.$n,{type:"submit",disabled:!L.isValid,"data-testid":U.Tp.components.AlertRules.newEvaluationGroupCreate},"Create")))))}const ge=a=>({container:(0,s.css)({display:"flex",flexDirection:"column",alignItems:"baseline",maxWidth:`${a.breakpoints.values.lg}px`,justifyContent:"space-between"}),formInput:(0,s.css)({flexGrow:1}),modal:(0,s.css)({width:`${a.breakpoints.values.sm}px`}),modalTitle:(0,s.css)({color:a.colors.text.secondary,marginBottom:a.spacing(2)})});var w=t(94822);const pe=[{value:w.Q8.Alerting,label:"Alerting"},{value:w.Q8.NoData,label:"No Data"},{value:w.Q8.OK,label:"Normal"},{value:w.Q8.Error,label:"Error"},{value:w.Q8.KeepLast,label:"Keep Last State"}],fe=({includeNoData:a,includeError:r,...l})=>{const o=(0,e.useMemo)(()=>a?r?pe:pe.filter(u=>u.value!==w.Q8.Error):pe.filter(u=>u.value!==w.Q8.NoData),[a,r]);return e.createElement(Ne.l6,{options:o,...l})};var Te=t(64100);function Ee(a){const r=(0,K.P8)(a);return[0,r*1,r*2,r*3,r*4,r*5].map(K.an)}function Le({selectedPendingPeriod:a,groupEvaluationInterval:r,onSelect:l}){const o=i=>a===i,u=Ee(r);return e.createElement(g.B,{direction:"row",gap:.5,role:"listbox"},u.map(i=>e.createElement(Q.$n,{role:"option","aria-selected":o(i),key:i,variant:o(i)?"primary":"secondary",size:"sm",onClick:()=>{l(i)}},i==="0s"?"None":i)))}var Ve=t(271);const k=10,We=a=>({required:{value:!0,message:"Required."},validate:r=>{if(r==="0")return!0;try{const l=(0,K.M9)(r);if(l===0)return!0;try{const o=(0,K.M9)(a);return l>=o?!0:(0,E.t)("alert-rule-form.evaluation-behaviour-for.validation","Pending period must be greater than or equal to the evaluation interval.")}catch{return!0}}catch(l){return l instanceof Error?l.message:(0,E.t)("alert-rule-form.evaluation-behaviour-for.error-parsing","Failed to parse duration")}}}),Ke=(a,r)=>{const{groupOptions:l}=T(a,!1);return!(0,e.useCallback)(u=>l.some(i=>i.label===u),[l])(r)};function $e({evaluateEvery:a,setEvaluateEvery:r,enableProvisionedGroups:l}){const o=(0,F.of)(d),{watch:u,setValue:i,getValues:m}=(0,n.xW)(),[v,x]=(0,e.useState)(!1),[C,I,O]=u(["group","folder.uid","folder.title"]),b=(0,le.$)(f=>f.rulerRules)[W.hY],ue=(0,J.dy)(W.hY).find(f=>f.uid===I),z=ue?.groups.find(f=>f.name===C),H=Ke(I??"",C);(0,e.useEffect)(()=>{!H&&z?.interval&&r(z.interval)},[r,H,i,z]);const Ie=(f=!1)=>{f||(0,R.fH)(R.le.leavingRuleGroupEdit),x(!1)},ce=()=>x(!0),q=b?.loading||H||!I||!C,we={name:O,rulesSource:W.hY,groups:[]},ze={name:C,interval:a,rules:[],totals:{}};return e.createElement("div",null,e.createElement(Pe,{groupfoldersForGrafana:b?.result,enableProvisionedGroups:l}),O&&v&&e.createElement(me.u5,{namespace:ue??we,group:z??ze,folderUid:I,onClose:()=>Ie(),intervalEditOnly:!0,hideFolder:!0}),O&&C&&e.createElement("div",{className:o.evaluationContainer},e.createElement(g.B,{direction:"column",gap:0},e.createElement("div",{className:o.marginTop},e.createElement(g.B,{direction:"column",gap:1},m("group")&&m("evaluateEvery")&&e.createElement("span",null,e.createElement(E.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-group.text",evaluateEvery:a},"All rules in the selected group are evaluated every ",{evaluateEvery:a},"."),!H&&e.createElement(oe.K,{name:"pen","aria-label":"Edit",disabled:q,onClick:ce})))))))}function Ue({evaluateEvery:a}){const r=(0,F.of)(d),{register:l,formState:{errors:o},setValue:u,watch:i}=(0,n.xW)(),m="eval-for-input",v=i("evaluateFor"),x=C=>{u("evaluateFor",C)};return e.createElement(g.B,{direction:"row","justify-content":"flex-start","align-items":"flex-start"},e.createElement(c.D,{label:e.createElement(P.J,{htmlFor:"evaluateFor",description:'Period the threshold condition must be met to trigger the alert. Selecting "None" triggers the alert immediately once the condition is met.'},e.createElement(E.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.pending-period"},"Pending period")),className:r.inlineField,error:o.evaluateFor?.message,invalid:o.evaluateFor?.message?!0:void 0,validationMessageHorizontalOverflow:!0},e.createElement(g.B,{direction:"row",alignItems:"center"},e.createElement(V.p,{id:m,width:8,...l("evaluateFor",We(a))}),e.createElement(Le,{selectedPendingPeriod:v,groupEvaluationInterval:a,onSelect:x}))))}function he(){return e.createElement(g.B,{direction:"row",gap:.5,alignItems:"center"},e.createElement(M.E,{variant:"bodySmall",color:"secondary"},e.createElement(E.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.info-help.text"},"Define the alert behavior when the evaluation fails or the query returns no data.")),e.createElement(Te.G,{contentText:"These settings can help mitigate temporary data source issues, preventing alerts from unintentionally firing due to lack of data, errors, or timeouts.",externalLink:"https://grafana.com/docs/grafana/latest/alerting/alerting-rules/create-grafana-managed-rule/#configure-no-data-and-error-handling",linkText:"Read more about this option",title:"Configure no data and error handling"}))}function Oe(){return e.createElement(g.B,{direction:"row",gap:.5,alignItems:"center"},e.createElement(M.E,{variant:"bodySmall",color:"secondary"},e.createElement(E.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.description.text"},"Define how the alert rule is evaluated.")),e.createElement(Te.G,{contentText:e.createElement(e.Fragment,null,e.createElement("p",null,e.createElement(E.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description1"},"Evaluation groups are containers for evaluating alert and recording rules.")),e.createElement("p",null,e.createElement(E.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description2"},"An evaluation group defines an evaluation interval - how often a rule is evaluated. Alert rules within the same evaluation group are evaluated over the same evaluation interval.")),e.createElement("p",null,e.createElement(E.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description3"},"Pending period specifies how long the threshold condition must be met before the alert starts firing. This option helps prevent alerts from being triggered by temporary issues."))),externalLink:"https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/rule-evaluation/",linkText:"Read about evaluation and alert states",title:"Alert rule evaluation"}))}function Qe({evaluateEvery:a,setEvaluateEvery:r,existing:l,enableProvisionedGroups:o}){const u=(0,F.of)(d),[i,m]=(0,e.useState)(!1),{watch:v,setValue:x}=(0,n.xW)(),C=v("isPaused");return e.createElement(Ve.P,{stepNo:3,title:"Set evaluation behavior",description:Oe()},e.createElement(g.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start"},e.createElement($e,{setEvaluateEvery:r,evaluateEvery:a,enableProvisionedGroups:o}),e.createElement(Ue,{evaluateEvery:a}),l&&e.createElement(c.D,{htmlFor:"pause-alert-switch"},e.createElement(n.xI,{render:()=>e.createElement(g.B,{gap:1,direction:"row",alignItems:"center"},e.createElement(ee.d,{id:"pause-alert",onChange:I=>{x("isPaused",I.currentTarget.checked)},value:!!C}),e.createElement("label",{htmlFor:"pause-alert",className:u.switchLabel},e.createElement(E.x6,{i18nKey:"alert-rule-form.pause"},"Pause evaluation"),e.createElement(G.m,{placement:"top",content:"Turn on to pause evaluation for this alert rule.",theme:"info"},e.createElement(te.I,{tabIndex:0,name:"info-circle",size:"sm",className:u.infoIcon})))),name:"isPaused"}))),e.createElement(se.e,{isCollapsed:!i,onToggle:I=>m(!I),text:"Configure no data and error handling"}),i&&e.createElement(e.Fragment,null,e.createElement(he,null),e.createElement(c.D,{htmlFor:"no-data-state-input",label:"Alert state if no data or all values are null"},e.createElement(n.xI,{render:({field:{onChange:I,ref:O,...A}})=>e.createElement(fe,{...A,inputId:"no-data-state-input",width:42,includeNoData:!0,includeError:!1,onChange:b=>I(b?.value)}),name:"noDataState"})),e.createElement(c.D,{htmlFor:"exec-err-state-input",label:"Alert state if execution error or timeout"},e.createElement(n.xI,{render:({field:{onChange:I,ref:O,...A}})=>e.createElement(fe,{...A,inputId:"exec-err-state-input",width:42,includeNoData:!1,includeError:!0,onChange:b=>I(b?.value)}),name:"execErrState"}))))}const d=a=>({inlineField:(0,s.css)({marginBottom:0}),evaluateLabel:(0,s.css)({marginRight:a.spacing(1)}),evaluationContainer:(0,s.css)({color:a.colors.text.secondary,maxWidth:`${a.breakpoints.values.sm}px`,fontSize:a.typography.size.sm}),intervalChangedLabel:(0,s.css)({marginBottom:a.spacing(1)}),warningIcon:(0,s.css)({justifySelf:"center",marginRight:a.spacing(1),color:a.colors.warning.text}),infoIcon:(0,s.css)({marginLeft:"10px"}),warningMessage:(0,s.css)({color:a.colors.warning.text}),bold:(0,s.css)({fontWeight:"bold"}),alignInterval:(0,s.css)({marginTop:a.spacing(1),marginLeft:`-${a.spacing(1)}`}),marginTop:(0,s.css)({marginTop:a.spacing(1)}),switchLabel:(0,s.css)({color:a.colors.text.primary,cursor:"pointer",fontSize:a.typography.bodySmall.fontSize})})},46479:(Ae,_,t)=>{t.d(_,{u5:()=>De,iS:()=>ie});var s=t(32196),e=t(2543),n=t(96540),F=t(49785),g=t(39938),oe=t(40845),c=t(37390),P=t(67061),V=t(88575),M=t(60029),ee=t(10354),G=t(55852),te=t(3169),E=t(40715),R=t(31678),J=t(61410),le=t(23770),W=t(82775),K=t(57220),se=t(88467),me=t(63066),ae=t(23662),$=t(25968),U=t(75591),Q=t(32264),Ne=t(42418);const Be=()=>n.createElement(Ne.F,{severity:"warning",title:"Global evaluation interval limit exceeded"},"A minimum evaluation interval of ",n.createElement("strong",null,Q.$.unifiedAlerting.minInterval)," has been configured in Grafana.",n.createElement("br",null),"Please contact the administrator to configure a lower interval.");var Y=t(99106),Ce=t(99226),X=t(1723);const Me=10;function ne({message:p,error:h}){return h?n.createElement(g.E,{color:"red",icon:"exclamation-circle",text:"Error",tooltip:p}):n.createElement(g.E,{color:"orange",icon:"exclamation-triangle",text:"Unknown",tooltip:p})}const Ge=p=>{try{const h=(0,$.M9)(p);return!(h<X.I*1e3||h%(X.I*1e3)!==0)}catch{return!1}},Re=({rulesWithoutRecordingRules:p})=>{const h=(0,oe.of)(xe),{watch:y}=(0,F.xW)(),N=y("groupInterval"),D=!N,re=p.slice().map((S,T)=>({id:T,data:(0,ae.jg)(S,N)})).sort((S,T)=>(0,$.P8)(S.data.forDuration)-(0,$.P8)(T.data.forDuration)),B=(0,n.useMemo)(()=>[{id:"alertName",label:"Alert",renderCell:({data:{alertName:S}})=>n.createElement(n.Fragment,null,S),size:"330px"},{id:"for",label:"Pending period",renderCell:({data:{forDuration:S}})=>n.createElement(n.Fragment,null,S),size:.5},{id:"numberEvaluations",label:"#Eval",renderCell:({data:{evaluationsToFire:S}})=>D?n.createElement(ne,{message:"#Evaluations not available."}):Ge(N)?S===0?n.createElement(ne,{message:"Invalid 'For' value: it should be greater or equal to evaluation interval.",error:!0}):n.createElement(n.Fragment,null,S):n.createElement(ne,{message:"Invalid evaluation interval format",error:!0}),size:.4}],[N,D]);return n.createElement("div",{className:h.tableWrapper},n.createElement(U.E,{items:re,cols:B,pagination:{itemsPerPage:Me}}))},ie=p=>({required:{value:!0,message:"Required."},validate:h=>{try{const y=(0,$.M9)(h);if(y<X.I*1e3)return`Cannot be less than ${X.I} seconds.`;if(y%(X.I*1e3)!==0)return`Must be a multiple of ${X.I} seconds.`;if((0,le.uQ)(p,h).length===0)return!0;{const N=p.map(re=>{const{forDuration:B}=(0,ae.jg)(re,h);return(0,$.P8)(B)}),D=Math.min(...N);return`Evaluation interval should be smaller or equal to "pending period" values for existing rules in this rule group. Choose a value smaller than or equal to "${(0,$.an)(D)}".`}}catch(y){return y instanceof Error?y.message:"Failed to parse duration"}}});function De(p){const{namespace:h,group:y,onClose:N,intervalEditOnly:D,folderUid:re}=p,B=(0,oe.of)(xe),S=(0,R.useDispatch)(),{loading:T,error:Se,dispatched:Fe}=(0,J.$)(d=>d.updateLotexNamespaceAndGroup)??se.jA,be=(0,te._2)(),Pe=(0,n.useMemo)(()=>({namespaceName:(0,Y.EL)(h).name,groupName:y.name,groupInterval:y.interval??me.T6}),[h,y.name,y.interval]),ve=(0,K.EV)(h.rulesSource),Z=ve===K.hY,ge=(0,Y.EL)(h).parents,w=Z?"Folder":"Namespace";(0,n.useEffect)(()=>{Fe&&!T&&!Se&&N(!0)},[Fe,T,N,Se]),(0,E.o)(d=>d.unifiedAlerting.updateLotexNamespaceAndGroup=se.jA);const pe=d=>{const a=Z?(0,Y.wf)(d.namespaceName,ge):d.namespaceName;S((0,le.LU)({rulesSourceName:ve,groupName:y.name,newGroupName:d.groupName,namespaceName:h.name,newNamespaceName:a,groupInterval:d.groupInterval||void 0,folderUid:re}))},fe=(0,F.mN)({mode:"onBlur",defaultValues:Pe,shouldFocusError:!0}),{handleSubmit:Te,register:Ee,watch:Le,formState:{isDirty:Ve,errors:k,isValid:We},setValue:Ke,getValues:$e}=fe,Ue=()=>{be.error("There are errors in the form. Correct the errors and retry.")},he=(0,e.compact)(y.rules.map(d=>d.rulerRule).filter(d=>!(0,ae.i7)(d))),Oe=he.length>0,Qe=D||Z?"Edit evaluation group":"Edit namespace or evaluation group";return n.createElement(c.a,{className:B.modal,isOpen:!0,title:Qe,onDismiss:N,onClickBackdrop:N},n.createElement(F.Op,{...fe},n.createElement("form",{onSubmit:d=>d.preventDefault(),key:JSON.stringify(Pe)},n.createElement(n.Fragment,null,!p.hideFolder&&n.createElement(P.B,{gap:1,alignItems:"center"},n.createElement(V.D,{className:B.formInput,label:n.createElement(M.J,{htmlFor:"namespaceName",description:!Z&&"Change the current namespace name. Moving groups between namespaces is not supported"},w),invalid:k.namespaceName?!0:void 0,error:k.namespaceName?.message},n.createElement(ee.p,{id:"namespaceName",readOnly:D||Z,...Ee("namespaceName",{required:"Namespace name is required."})})),Z&&p.folderUrl&&n.createElement(G.z9,{href:p.folderUrl,title:"Go to folder",variant:"secondary",icon:"folder-open",target:"_blank"})),n.createElement(V.D,{label:n.createElement(M.J,{htmlFor:"groupName",description:"A group evaluates all its rules over the same evaluation interval."},"Evaluation group"),invalid:!!k.groupName,error:k.groupName?.message},n.createElement(ee.p,{autoFocus:!0,id:"groupName",readOnly:D,...Ee("groupName",{required:"Evaluation group name is required."})})),n.createElement(V.D,{label:n.createElement(M.J,{htmlFor:"groupInterval",description:"How often is the rule evaluated. Applies to every rule within the group."},n.createElement(P.B,{gap:.5},"Evaluation interval")),invalid:k.groupInterval?!0:void 0,error:k.groupInterval?.message},n.createElement(P.B,{direction:"column"},n.createElement(ee.p,{id:"groupInterval",placeholder:me.T6,...Ee("groupInterval",ie(he))}),n.createElement(Ce.gv,{currentInterval:$e("groupInterval"),onSelect:d=>Ke("groupInterval",d,{shouldValidate:!0,shouldDirty:!0})}))),(0,W.q)(Le("groupInterval")).exceedsLimit&&n.createElement(Be,null),!Oe&&n.createElement("div",null,"This group does not contain alert rules."),Oe&&n.createElement(n.Fragment,null,n.createElement("div",null,"List of rules that belong to this group"),n.createElement("div",{className:B.evalRequiredLabel},"#Eval column represents the number of evaluations needed before alert starts firing."),n.createElement(Re,{rulesWithoutRecordingRules:he})),n.createElement("div",{className:B.modalButtons},n.createElement(c.a.ButtonRow,null,n.createElement(G.$n,{variant:"secondary",type:"button",disabled:T,onClick:()=>N(!1),fill:"outline"},"Cancel"),n.createElement(G.$n,{type:"button",disabled:!Ve||!We||T,onClick:Te(d=>pe(d),Ue)},T?"Saving...":"Save")))))))}const xe=p=>({modal:(0,s.css)({maxWidth:"560px"}),modalButtons:(0,s.css)({top:"-24px",position:"relative"}),formInput:(0,s.css)({flex:1}),tableWrapper:(0,s.css)({marginTop:p.spacing(2),marginBottom:p.spacing(2),height:"100%"}),evalRequiredLabel:(0,s.css)({fontSize:p.typography.bodySmall.fontSize})})},41520:(Ae,_,t)=>{t.d(_,{V:()=>n});var s=t(96540),e=t(75471);function n(){return(0,s.useMemo)(()=>(0,e.Q9)(),[])}}}]);

//# sourceMappingURL=6552.f070d0c9cf5eb40602a1.js.map