"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6777],{23645:(se,V,t)=>{t.r(V),t.d(V,{ServiceAccountsListPageUnconnected:()=>_,default:()=>oe});var B=t(55127),a=t.n(B),e=t(96540),I=t(71468),A=t(55852),S=t(14186),i=t(67647),L=t(90613),w=t(94354),g=t(69529),k=t(96374),K=t(67608),G=t(2913),d=t(10096),b=t(8484),r=t(31678),f=t(70255),u=t(67061),c=t(48840),o=t(19384),F=t(12942),m=t(72109),T=t(14578),N=t(29158),Y=t(89062),U=t(5133);const z=({services:n,onRoleChange:s,roleOptions:p,onRemoveButtonClick:D,onDisable:l,onEnable:C,onAddTokenClick:W,showPaging:$,totalPages:te,onChangePage:X,currentPage:ne,isLoading:R})=>{const Z=(0,e.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:v},row:{original:P}})=>M(v,P,R,"avatarUrl")},{id:"name",header:"Account",cell:({cell:{value:v},row:{original:P}})=>M(v,P,R),sortType:"string"},{id:"id",header:"ID",cell:({cell:{value:v},row:{original:P}})=>M(v,P,R,"id")},{id:"role",header:"Roles",cell:({cell:{value:v},row:{original:P}})=>x(v,P,R,p,s)},{id:"tokens",header:"Tokens",cell:({cell:{value:v},row:{original:P}})=>M(v,P,R,"tokens")},{id:"actions",header:"",cell:({row:{original:v}})=>O(v,R,W,C,l,D)}],[R,W,l,C,D,s,p]);return e.createElement(u.B,{direction:"column",gap:2},e.createElement(c.j,{columns:Z,data:n,getRowId:v=>String(v.id)}),$&&te>1&&e.createElement(u.B,{justifyContent:"flex-end"},e.createElement(o.d,{numberOfPages:te,currentPage:ne,onNavigate:X})))},M=(n,s,p,D)=>{if(p)return D==="avatarUrl"?e.createElement(f.A,{circle:!0,width:24,height:24}):e.createElement(f.A,{width:100});const l=`/org/serviceaccounts/${s.id}`,C=`Edit service account's ${name} details`;switch(D){case"avatarUrl":return e.createElement("a",{"aria-label":C,href:l},e.createElement(F.e,{src:n,alt:"User avatar"}));case"id":return e.createElement(m.Y,{href:l,"aria-label":C,color:"secondary",inline:!1},s.login);case"tokens":return e.createElement(u.B,{alignItems:"center"},e.createElement(T.I,{name:"key-skeleton-alt"}),e.createElement(m.Y,{href:l,"aria-label":C,color:"primary",inline:!1},n||"No tokens"));default:return e.createElement(m.Y,{href:l,"aria-label":C,color:"primary",inline:!1},n)}},x=(n,s,p,D,l)=>{const C=d.contextSrv.hasPermission(r.AccessControlAction.ActionRolesList)&&d.contextSrv.hasPermission(r.AccessControlAction.ActionUserRolesList),W=d.contextSrv.hasPermissionInMetadata(r.AccessControlAction.ServiceAccountsWrite,s);return p?e.createElement(f.A,{width:100}):d.contextSrv.licensedAccessControlEnabled()?C&&e.createElement(Y.y,{userId:s.id,orgId:s.orgId,basicRole:n,roles:s.roles||[],onBasicRoleChange:$=>l($,s),roleOptions:D,basicRoleDisabled:!W,disabled:s.isExternal||s.isDisabled,width:40}):e.createElement(U.r,{"aria-label":"Role",value:n,disabled:s.isExternal||!W||s.isDisabled,onChange:$=>l($,s)})},O=(n,s,p,D,l,C)=>s?e.createElement(f.A,{width:100}):n.isExternal?e.createElement(u.B,{alignItems:"center",justifyContent:"flex-end"},e.createElement(N.K,{disabled:!0,name:"lock",size:"md",tooltip:"This is a managed service account and cannot be modified."})):e.createElement(u.B,{alignItems:"center",justifyContent:"flex-end"},d.contextSrv.hasPermission(r.AccessControlAction.ServiceAccountsWrite)&&!n.tokens&&e.createElement(A.$n,{onClick:()=>p(n),disabled:n.isDisabled},"Add token"),d.contextSrv.hasPermissionInMetadata(r.AccessControlAction.ServiceAccountsWrite,n)&&(n.isDisabled?e.createElement(A.$n,{variant:"secondary",size:"md",onClick:()=>D(n)},"Enable"):e.createElement(A.$n,{variant:"secondary",size:"md",onClick:()=>l(n)},"Disable")),d.contextSrv.hasPermissionInMetadata(r.AccessControlAction.ServiceAccountsDelete,n)&&e.createElement(N.K,{name:"trash-alt","aria-label":`Delete service account ${n.name}`,variant:"secondary",onClick:()=>C(n)}));z.displayName="ServiceAccountTable";var j=t(98788),y=t(12966);function ae(n){return{...n.serviceAccounts}}const H={changePage:y.yd,changeQuery:y.nM,fetchACOptions:y.pJ,fetchServiceAccounts:y.iJ,deleteServiceAccount:y.W4,updateServiceAccount:y.mV,changeStateFilter:y.qS,createServiceAccountToken:y.yC},Q=(0,I.connect)(ae,H),q=[{label:"All",value:r.ServiceAccountStateFilter.All},{label:"With expired tokens",value:r.ServiceAccountStateFilter.WithExpiredTokens},{label:"Disabled",value:r.ServiceAccountStateFilter.Disabled}];G.Ay.featureToggles.externalServiceAccounts&&q.push({label:"Managed",value:r.ServiceAccountStateFilter.External});const _=({page:n,changePage:s,totalPages:p,serviceAccounts:D,isLoading:l,roleOptions:C,query:W,serviceAccountStateFilter:$,changeQuery:te,fetchACOptions:X,fetchServiceAccounts:ne,deleteServiceAccount:R,updateServiceAccount:Z,changeStateFilter:v,createServiceAccountToken:P})=>{const[ve,re]=(0,e.useState)(!1),[Ee,le]=(0,e.useState)(!1),[Ae,ie]=(0,e.useState)(!1),[fe,de]=(0,e.useState)(""),[h,J]=(0,e.useState)(null);(0,e.useEffect)(()=>{ne({withLoadingIndicator:!0}),d.contextSrv.licensedAccessControlEnabled()&&X()},[X,ne]);const ce=D.length===0&&$===r.ServiceAccountStateFilter.All&&!W,De=async(E,Re)=>{const Be={...Re,role:E};Z(Be),d.contextSrv.licensedAccessControlEnabled()&&X()},Ce=E=>{te(E)},he=E=>{v(E)},Se=E=>{J(E),le(!0)},ge=async()=>{h&&R(h.id),ue()},ye=E=>{J(E),ie(!0)},Pe=()=>{h&&Z({...h,isDisabled:!0}),me()},Te=E=>{Z({...E,isDisabled:!1})},pe=E=>{J(E),re(!0)},Ie=async E=>{h&&P(h.id,E,de)},Me=()=>{re(!1),J(null),de("")},ue=()=>{le(!1),J(null)},me=()=>{ie(!1),J(null)},xe=e.createElement("a",{className:"external-link",href:"https://grafana.com/docs/grafana/latest/administration/service-accounts/",target:"_blank",rel:"noopener noreferrer"},"documentation."),Oe=e.createElement("span",null,"Service accounts and their tokens can be used to authenticate against the Grafana API. Find out more in our"," ",xe);return e.createElement(K.Y,{navId:"serviceaccounts",subTitle:Oe,actions:e.createElement(e.Fragment,null,!ce&&d.contextSrv.hasPermission(r.AccessControlAction.ServiceAccountsCreate)&&e.createElement(A.z9,{href:"org/serviceaccounts/create",variant:"primary"},"Add service account"))},e.createElement(K.Y.Contents,null,e.createElement("div",{className:"page-action-bar"},e.createElement(S.I,{grow:!0},e.createElement(i.Z,{placeholder:"Search service account by name",value:W,onChange:Ce,width:50})),e.createElement(L.a,{marginBottom:1},e.createElement(w.z,{options:q,onChange:he,value:$}))),!l&&!ce&&D.length===0&&e.createElement(g.p,{variant:"not-found",message:(0,b.t)("service-accounts.empty-state.message","No services accounts found")}),!l&&ce&&e.createElement(g.p,{variant:"call-to-action",button:e.createElement(A.z9,{disabled:!d.contextSrv.hasPermission(r.AccessControlAction.ServiceAccountsCreate),href:"org/serviceaccounts/create",icon:"key-skeleton-alt",size:"lg"},e.createElement(b.x6,{i18nKey:"service-accounts.empty-state.button-title"},"Add service account")),message:(0,b.t)("service-accounts.empty-state.title","You haven't created any service accounts yet")},e.createElement(b.x6,{i18nKey:"service-accounts.empty-state.more-info"},"Remember, you can provide specific permissions for API access to other applications")),(l||D.length!==0)&&e.createElement(z,{services:D,showPaging:!0,totalPages:p,onChangePage:s,currentPage:n,onRoleChange:De,roleOptions:C,onRemoveButtonClick:Se,onDisable:ye,onEnable:Te,onAddTokenClick:pe,isLoading:l}),h&&e.createElement(e.Fragment,null,e.createElement(k.u,{isOpen:Ee,body:`Are you sure you want to delete '${h.name}'${h.tokens?` and ${h.tokens} accompanying ${a()("token",h.tokens)}`:""}?`,confirmText:"Delete",title:"Delete service account",onConfirm:ge,onDismiss:ue}),e.createElement(k.u,{isOpen:Ae,title:"Disable service account",body:`Are you sure you want to disable '${h.name}'?`,confirmText:"Disable service account",onConfirm:Pe,onDismiss:me}),e.createElement(j.z,{isOpen:ve,token:fe,serviceAccountLogin:h.login,onCreateToken:Ie,onClose:Me}))))},oe=Q(_)},98788:(se,V,t)=>{t.d(V,{z:()=>d});var B=t(32196),a=t(96540),e=t(62938),I=t(32264),A=t(40845),S=t(37390),i=t(88575),L=t(10354),w=t(94354),g=t(98239),k=t(55852),K=t(10534);const G=[{label:"No expiration",value:!1},{label:"Set expiration date",value:!0}],d=({isOpen:f,token:u,serviceAccountLogin:c,onCreateToken:o,onClose:F})=>{const m=new Date;m.setDate(m.getDate()+1);const T=new Date;I.$.tokenExpirationDayLimit!==void 0&&I.$.tokenExpirationDayLimit>-1?T.setDate(T.getDate()+I.$.tokenExpirationDayLimit+1):T.setDate(864e13);const N=I.$.tokenExpirationDayLimit!==void 0&&I.$.tokenExpirationDayLimit>0,[Y,U]=(0,a.useState)(""),[z,M]=(0,a.useState)(""),[x,O]=(0,a.useState)(N),[j,y]=(0,a.useState)(m),[ae,H]=(0,a.useState)(j!==""),Q=(0,A.of)(r);(0,a.useEffect)(()=>{f&&U(`${c}-${(0,e.A)()}`)},[c,f]);const q=n=>{H(n!==""),y(n)},_=()=>{o({name:z||Y,secondsToLive:x?b(j):void 0})},ee=()=>{M(""),U(""),O(N),y(m),H(j!==""),F()},oe=u?"Service account token created":"Add service account token";return a.createElement(S.a,{isOpen:f,title:oe,onDismiss:ee,className:Q.modal},u?a.createElement(a.Fragment,null,a.createElement(i.D,{label:"Token",description:"Copy the token now as you will not be able to see it again. Losing a token requires creating a new one."},a.createElement("div",{className:Q.modalTokenRow},a.createElement(L.p,{name:"tokenValue",value:u,readOnly:!0}),a.createElement(K.b,{className:Q.modalCopyToClipboardButton,variant:"primary",size:"md",icon:"copy",getText:()=>u},"Copy clipboard"))),a.createElement(S.a.ButtonRow,null,a.createElement(K.b,{variant:"primary",getText:()=>u,onClipboardCopy:ee},"Copy to clipboard and close"),a.createElement(k.$n,{variant:"secondary",onClick:ee},"Close"))):a.createElement("div",null,a.createElement(i.D,{label:"Display name",description:"Name to easily identify the token",required:!0},a.createElement(L.p,{name:"tokenName",value:z,placeholder:Y,onChange:n=>{M(n.currentTarget.value)}})),a.createElement(i.D,{label:"Expiration"},a.createElement(w.z,{options:G,value:x,onChange:O,size:"md"})),x&&a.createElement(i.D,{label:"Expiration date"},a.createElement(g.l,{onChange:q,value:j,placeholder:"",minDate:m,maxDate:T})),a.createElement(S.a.ButtonRow,null,a.createElement(k.$n,{onClick:_,disabled:x&&!ae},"Generate token"))))},b=f=>{const u=new Date(f),c=new Date;return Math.ceil((u.getTime()-c.getTime())/1e3)},r=f=>({modal:(0,B.css)({width:"550px"}),modalTokenRow:(0,B.css)({display:"flex"}),modalCopyToClipboardButton:(0,B.css)({marginLeft:f.spacing(.5)})})},12966:(se,V,t)=>{t.d(V,{W4:()=>G,iJ:()=>g,mV:()=>K,nM:()=>r,pJ:()=>w,qS:()=>f,yC:()=>d,yd:()=>u});var B=t(2543),a=t.n(B),e=t(17172),I=t(85927),A=t(16233),S=t(31678),i=t(1936);const L="/api/serviceaccounts";function w(){return async c=>{try{if(A.TP.licensedAccessControlEnabled()&&A.TP.hasPermission(S.AccessControlAction.ActionRolesList)){const o=await(0,I.RL)();c((0,i.ew)(o))}}catch(o){console.error(o)}}}function g({withLoadingIndicator:c}={withLoadingIndicator:!1}){return async(o,F)=>{try{if(A.TP.hasPermission(S.AccessControlAction.ServiceAccountsRead)){c&&o((0,i.FW)());const{perPage:m,page:T,query:N,serviceAccountStateFilter:Y}=F().serviceAccounts,U=await(0,e.AI)().get(`/api/serviceaccounts/search?perpage=${m}&page=${T}&query=${N}${b(Y)}&accesscontrol=true`);if(A.TP.licensedAccessControlEnabled()&&A.TP.hasPermission(S.AccessControlAction.ActionUserRolesList)){o((0,i.dJ)());const z=A.TP.user.orgId,M=U?.serviceAccounts.map(O=>O.id),x=await(0,e.AI)().post("/api/access-control/users/roles/search",{userIds:M,orgId:z});U.serviceAccounts.forEach(O=>{O.roles=x?x[O.id]||[]:[]}),o((0,i.jE)())}o((0,i.zh)(U))}}catch(m){console.error(m)}finally{o((0,i.Yh)())}}}const k=(0,B.debounce)(c=>c(g()),500,{leading:!0});function K(c){return async o=>{await(0,e.AI)().patch(`${L}/${c.id}?accesscontrol=true`,{...c}),o(g())}}function G(c){return async o=>{await(0,e.AI)().delete(`${L}/${c}`),o(g())}}function d(c,o,F){return async m=>{const T=await(0,e.AI)().post(`${L}/${c}/tokens`,o);F(T.key),m(g())}}const b=c=>{switch(c){case S.ServiceAccountStateFilter.WithExpiredTokens:return"&expiredTokens=true";case S.ServiceAccountStateFilter.Disabled:return"&disabled=true";case S.ServiceAccountStateFilter.External:return"&external=true";default:return""}};function r(c){return async o=>{o((0,i.L5)(c)),k(o)}}function f(c){return async o=>{o((0,i.c3)(c)),o(g())}}function u(c){return async o=>{o((0,i.EC)(c)),o(g())}}}}]);

//# sourceMappingURL=ServiceAccountsPage.ce6edf2f4544fa3439ae.js.map