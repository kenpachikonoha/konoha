(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4684],{35931:(lt,Be,l)=>{"use strict";l.d(Be,{H:()=>A});var Q=l(32196),Ce=l(96540),M=l(40845);function A(de){const{description:E,suffix:be,feature:V}=de,me=`Learn more about ${V}`,w=(0,M.of)(r);return Ce.createElement("span",{className:w.container},E,Ce.createElement("a",{"aria-label":me,href:`https://grafana.com/docs/grafana/next/datasources/${be}`,rel:"noreferrer",target:"_blank"},me))}const r=de=>({container:(0,Q.css)({color:de.colors.text.secondary,a:(0,Q.css)({color:de.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})})})},6191:(lt,Be,l)=>{"use strict";l.d(Be,{X:()=>A});var Q=l(32196),Ce=l(96540),M=l(40845);const A=({children:de})=>{const E=(0,M.of)(r);return Ce.createElement("div",{className:E.root},de)},r=de=>({root:(0,Q.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:de.spacing(3),minHeight:de.spacing(4)})})},31347:(lt,Be,l)=>{"use strict";l.d(Be,{Z:()=>Ce});var Q=l(96540);const Ce=({grow:M,shrink:A})=>Q.createElement("div",{style:{display:"block",flexGrow:M,flexShrink:A}})},42952:(lt,Be,l)=>{"use strict";l.d(Be,{T:()=>Ce,f:()=>Q});var Q=(M=>(M.Code="code",M.Builder="builder",M))(Q||{});const Ce="Binary operations"},60016:(lt,Be,l)=>{"use strict";l.d(Be,{TO:()=>xe,iB:()=>ke,kl:()=>Se,wU:()=>_e});var Q=l(2543),Ce=l.n(Q),M=l(96540),A=l(32264),r=l(67061),de=l(38894),E=l(94354),be=l(14186),V=l(10354),me=l(21594),w=l(56587),q=l(65650);const xe=[{value:q.U3.Range,label:"Range",description:"Run query over a range of time."},{value:q.U3.Instant,label:"Instant",description:'Run query against a single point in time. For this query, the "To" time is used.'}];A.$.featureToggles.lokiExperimentalStreaming&&xe.push({value:q.U3.Stream,label:"Stream",description:"Run a query and keep sending results on an interval"});const ke=[{value:1,label:"1/1"}].concat((0,Q.map)([2,3,4,5,10],$=>({value:$,label:"1/"+$})));function Se($){const{lineLimitValue:te,resolution:Oe,onRunQuery:Re,runOnBlur:fe,onChange:Ae}=$,B=$.query??{},$e=(0,w.Io)(B);function Qe(ee){const ue={...B,maxLines:_e(ee)};Ae(ue)}function Je(ee){const{instant:ue,range:T,...F}=B;Ae({...F,queryType:ee})}function He(ee){B.maxLines!==_e(ee.currentTarget.value)&&Qe(ee.currentTarget.value)}function N(ee){ee.key==="Enter"&&Re()}function _(ee){const ue={...B,resolution:ee.value};Ae(ue)}return M.createElement(r.B,{alignItems:"flex-start",gap:.5,"aria-label":"Loki extra field"},M.createElement(r.B,{wrap:"nowrap",gap:0,"data-testid":"queryTypeField","aria-label":"Query type field"},M.createElement(de.I,{width:"auto"},"Query type"),M.createElement(E.z,{options:xe,value:$e,onChange:ee=>{Je(ee),fe&&Re()}})),M.createElement(r.B,{wrap:"nowrap",gap:0,"data-testid":"lineLimitField","aria-label":"Line limit field"},M.createElement(be.I,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query."},M.createElement(V.p,{className:"width-4",placeholder:"auto",type:"number",min:0,onChange:He,onKeyDown:N,value:te,onBlur:()=>{fe&&Re()}})),M.createElement(be.I,{label:"Resolution",tooltip:"Resolution 1/1 sets step parameter of Loki metrics range queries such that each pixel corresponds to one data point. For better performance, lower resolutions can be picked. 1/2 only retrieves a data point for every other pixel, and 1/10 retrieves one data point per 10 pixels."},M.createElement(me.l6,{isSearchable:!1,onChange:_,options:ke,value:Oe,"aria-label":"Select resolution"}))))}var ve=(0,M.memo)(Se);function _e($){const te=parseInt($,10);if(!(isNaN(te)||te<0))return te}},95881:(lt,Be,l)=>{"use strict";l.d(Be,{W:()=>de});var Q=l(96540),Ce=l(97535);const M=Q.lazy(()=>l.e(1952).then(l.bind(l,51639))),A=E=>Q.createElement(Q.Suspense,{fallback:null},Q.createElement(M,{...E})),r=E=>{const be=(0,Q.useRef)(null),{onRunQuery:V,onChange:me,...w}=E,q=S=>{be.current=S,me(S),V()},xe=S=>{me(S)};return Q.createElement(A,{onRunQuery:q,onBlur:xe,onChange:me,...w})};class de extends Q.PureComponent{constructor(be){super(be),this._isMounted=!1,this.onChangeQuery=(V,me)=>{const{query:w,onChange:q,onRunQuery:xe}=this.props;if(q){const S={...w,expr:V};q(S),me&&xe&&xe()}},this.state={labelsLoaded:!1}}async componentDidMount(){this._isMounted=!0,await this.props.datasource.languageProvider.start(this.props.range),this._isMounted&&this.setState({labelsLoaded:!0})}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(be){const{range:V,datasource:{languageProvider:me}}=this.props;(0,Ce.WV)(V,be.range)&&me.fetchLabels({timeRange:V})}render(){const{ExtraFieldElement:be,query:V,datasource:me,history:w,onRunQuery:q,range:xe}=this.props,S=this.props.placeholder??"Enter a Loki query (run with Shift+Enter)";return Q.createElement(Q.Fragment,null,Q.createElement("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"]},Q.createElement("div",{className:"gf-form--grow flex-shrink-1 min-width-15"},Q.createElement(r,{datasource:me,history:w??[],onChange:this.onChangeQuery,onRunQuery:q,initialValue:V.expr??"",placeholder:S,timeRange:xe}))),be)}}},20065:(lt,Be,l)=>{"use strict";l.d(Be,{B:()=>Ce,a:()=>de});var Q=l(56245);function Ce(E,be,V,me){if(!E)return!1;const w=M(be,me);if(!w.length)return!1;let q=w;if(E!==be){const xe=M(E,me);q=w.flatMap(S=>xe.filter(ke=>S.text===ke.text)||S)}return q.map(xe=>A(E,V,xe)).filter(r)}function M(E,be){const V=[];return be.parse(E).iterate({enter:w=>{if(w.type.id===Q.Ql){const q=w.node;V.push({node:q,text:E.substring(q.from,q.to)})}}}),V}function A(E,be,V){if(be.length===1){const q=V.node.from===V.node.to,xe=q&&V.node.parent?V.node.parent:V.node,S=q?E.substring(xe.from,xe.to):V.text;return{startLineNumber:1,startColumn:xe.from+1,endLineNumber:1,endColumn:xe.to+1,error:S}}let me=0,w=0;for(let q=0;q<be.length;q++){if(w=me+be[q].length,V.node.from>w){me+=be[q].length+1;continue}return{startLineNumber:q+1,startColumn:V.node.from-me+1,endLineNumber:q+1,endColumn:V.node.to-me+1,error:V.text}}return null}function r(E){return E!==null}const de={__interval:{text:"1s",value:"1s"},__rate_interval:{text:"1s",value:"1s"},__auto:{text:"1s",value:"1s"},__interval_ms:{text:"1000",value:1e3},__range_ms:{text:"1000",value:1e3},__range_s:{text:"1",value:1},__range:{text:"1s",value:"1s"}}},27724:(lt,Be,l)=>{"use strict";l.d(Be,{we:()=>Lt,VQ:()=>ua,lb:()=>yr,Gf:()=>oa,M1:()=>la,ow:()=>Ia,mL:()=>Ma,In:()=>br});var Q=l(2543),Ce=l(13288),M=l(44240),A=l(62467),r=l(75505),de=l(81160),E=l(66847),be=l(59099),V=l(63720),me=l(65879),w=l(39070),q=l(9557),xe=l(76885),S=l(41987),ke=l(78368),Se=l(43659),ve=l(36195),_e=l(26657),$=l(72574),te=l(32264);const Oe=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Re=new Set,fe=typeof process=="object"&&process?process:{},Ae=(g,n,a,i)=>{typeof fe.emitWarning=="function"?fe.emitWarning(g,n,a,i):console.error(`[${a}] ${n}: ${g}`)};let B=globalThis.AbortController,$e=globalThis.AbortSignal;if(typeof B>"u"){$e=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(i,o){this._onabort.push(o)}},B=class{constructor(){n()}signal=new $e;abort(i){if(!this.signal.aborted){this.signal.reason=i,this.signal.aborted=!0;for(const o of this.signal._onabort)o(i);this.signal.onabort?.(i)}}};let g=fe.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const n=()=>{g&&(g=!1,Ae("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",n))}}const Qe=g=>!Re.has(g),Je=Symbol("type"),He=g=>g&&g===Math.floor(g)&&g>0&&isFinite(g),N=g=>He(g)?g<=Math.pow(2,8)?Uint8Array:g<=Math.pow(2,16)?Uint16Array:g<=Math.pow(2,32)?Uint32Array:g<=Number.MAX_SAFE_INTEGER?_:null:null;class _ extends Array{constructor(n){super(n),this.fill(0)}}class ee{heap;length;static#l=!1;static create(n){const a=N(n);if(!a)return[];ee.#l=!0;const i=new ee(n,a);return ee.#l=!1,i}constructor(n,a){if(!ee.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new a(n),this.length=0}push(n){this.heap[this.length++]=n}pop(){return this.heap[--this.length]}}class ue{#l;#d;#g;#h;#w;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#n;#v;#a;#r;#e;#c;#f;#o;#s;#O;#i;#y;#b;#p;#E;#S;#u;static unsafeExposeInternals(n){return{starts:n.#b,ttls:n.#p,sizes:n.#y,keyMap:n.#a,keyList:n.#r,valList:n.#e,next:n.#c,prev:n.#f,get head(){return n.#o},get tail(){return n.#s},free:n.#O,isBackgroundFetch:a=>n.#t(a),backgroundFetch:(a,i,o,u)=>n.#C(a,i,o,u),moveToTail:a=>n.#Q(a),indexes:a=>n.#P(a),rindexes:a=>n.#x(a),isStale:a=>n.#m(a)}}get max(){return this.#l}get maxSize(){return this.#d}get calculatedSize(){return this.#v}get size(){return this.#n}get fetchMethod(){return this.#w}get dispose(){return this.#g}get disposeAfter(){return this.#h}constructor(n){const{max:a=0,ttl:i,ttlResolution:o=1,ttlAutopurge:u,updateAgeOnGet:m,updateAgeOnHas:y,allowStale:P,dispose:I,disposeAfter:Y,noDisposeOnSet:Z,noUpdateTTL:ae,maxSize:se=0,maxEntrySize:Ie=0,sizeCalculation:Fe,fetchMethod:ze,noDeleteOnFetchRejection:we,noDeleteOnStaleGet:Ze,allowStaleOnFetchRejection:et,allowStaleOnFetchAbort:Ye,ignoreFetchAbort:ot}=n;if(a!==0&&!He(a))throw new TypeError("max option must be a nonnegative integer");const Ct=a?N(a):Array;if(!Ct)throw new Error("invalid max value: "+a);if(this.#l=a,this.#d=se,this.maxEntrySize=Ie||this.#d,this.sizeCalculation=Fe,this.sizeCalculation){if(!this.#d&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(ze!==void 0&&typeof ze!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#w=ze,this.#S=!!ze,this.#a=new Map,this.#r=new Array(a).fill(void 0),this.#e=new Array(a).fill(void 0),this.#c=new Ct(a),this.#f=new Ct(a),this.#o=0,this.#s=0,this.#O=ee.create(a),this.#n=0,this.#v=0,typeof I=="function"&&(this.#g=I),typeof Y=="function"?(this.#h=Y,this.#i=[]):(this.#h=void 0,this.#i=void 0),this.#E=!!this.#g,this.#u=!!this.#h,this.noDisposeOnSet=!!Z,this.noUpdateTTL=!!ae,this.noDeleteOnFetchRejection=!!we,this.allowStaleOnFetchRejection=!!et,this.allowStaleOnFetchAbort=!!Ye,this.ignoreFetchAbort=!!ot,this.maxEntrySize!==0){if(this.#d!==0&&!He(this.#d))throw new TypeError("maxSize must be a positive integer if specified");if(!He(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#X()}if(this.allowStale=!!P,this.noDeleteOnStaleGet=!!Ze,this.updateAgeOnGet=!!m,this.updateAgeOnHas=!!y,this.ttlResolution=He(o)||o===0?o:1,this.ttlAutopurge=!!u,this.ttl=i||0,this.ttl){if(!He(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#A()}if(this.#l===0&&this.ttl===0&&this.#d===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#d){const At="LRU_CACHE_UNBOUNDED";Qe(At)&&(Re.add(At),Ae("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",At,ue))}}getRemainingTTL(n){return this.#a.has(n)?1/0:0}#A(){const n=new _(this.#l),a=new _(this.#l);this.#p=n,this.#b=a,this.#D=(u,m,y=Oe.now())=>{if(a[u]=m!==0?y:0,n[u]=m,m!==0&&this.ttlAutopurge){const P=setTimeout(()=>{this.#m(u)&&this.delete(this.#r[u])},m+1);P.unref&&P.unref()}},this.#$=u=>{a[u]=n[u]!==0?Oe.now():0},this.#L=(u,m)=>{if(n[m]){const y=n[m],P=a[m];if(!y||!P)return;u.ttl=y,u.start=P,u.now=i||o();const I=u.now-P;u.remainingTTL=y-I}};let i=0;const o=()=>{const u=Oe.now();if(this.ttlResolution>0){i=u;const m=setTimeout(()=>i=0,this.ttlResolution);m.unref&&m.unref()}return u};this.getRemainingTTL=u=>{const m=this.#a.get(u);if(m===void 0)return 0;const y=n[m],P=a[m];if(!y||!P)return 1/0;const I=(i||o())-P;return y-I},this.#m=u=>{const m=a[u],y=n[u];return!!y&&!!m&&(i||o())-m>y}}#$=()=>{};#L=()=>{};#D=()=>{};#m=()=>!1;#X(){const n=new _(this.#l);this.#v=0,this.#y=n,this.#T=a=>{this.#v-=n[a],n[a]=0},this.#N=(a,i,o,u)=>{if(this.#t(i))return 0;if(!He(o))if(u){if(typeof u!="function")throw new TypeError("sizeCalculation must be a function");if(o=u(i,a),!He(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o},this.#R=(a,i,o)=>{if(n[a]=i,this.#d){const u=this.#d-n[a];for(;this.#v>u;)this.#F(!0)}this.#v+=n[a],o&&(o.entrySize=i,o.totalCalculatedSize=this.#v)}}#T=n=>{};#R=(n,a,i)=>{};#N=(n,a,i,o)=>{if(i||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#P({allowStale:n=this.allowStale}={}){if(this.#n)for(let a=this.#s;!(!this.#M(a)||((n||!this.#m(a))&&(yield a),a===this.#o));)a=this.#f[a]}*#x({allowStale:n=this.allowStale}={}){if(this.#n)for(let a=this.#o;!(!this.#M(a)||((n||!this.#m(a))&&(yield a),a===this.#s));)a=this.#c[a]}#M(n){return n!==void 0&&this.#a.get(this.#r[n])===n}*entries(){for(const n of this.#P())this.#e[n]!==void 0&&this.#r[n]!==void 0&&!this.#t(this.#e[n])&&(yield[this.#r[n],this.#e[n]])}*rentries(){for(const n of this.#x())this.#e[n]!==void 0&&this.#r[n]!==void 0&&!this.#t(this.#e[n])&&(yield[this.#r[n],this.#e[n]])}*keys(){for(const n of this.#P()){const a=this.#r[n];a!==void 0&&!this.#t(this.#e[n])&&(yield a)}}*rkeys(){for(const n of this.#x()){const a=this.#r[n];a!==void 0&&!this.#t(this.#e[n])&&(yield a)}}*values(){for(const n of this.#P())this.#e[n]!==void 0&&!this.#t(this.#e[n])&&(yield this.#e[n])}*rvalues(){for(const n of this.#x())this.#e[n]!==void 0&&!this.#t(this.#e[n])&&(yield this.#e[n])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(n,a={}){for(const i of this.#P()){const o=this.#e[i],u=this.#t(o)?o.__staleWhileFetching:o;if(u!==void 0&&n(u,this.#r[i],this))return this.get(this.#r[i],a)}}forEach(n,a=this){for(const i of this.#P()){const o=this.#e[i],u=this.#t(o)?o.__staleWhileFetching:o;u!==void 0&&n.call(a,u,this.#r[i],this)}}rforEach(n,a=this){for(const i of this.#x()){const o=this.#e[i],u=this.#t(o)?o.__staleWhileFetching:o;u!==void 0&&n.call(a,u,this.#r[i],this)}}purgeStale(){let n=!1;for(const a of this.#x({allowStale:!0}))this.#m(a)&&(this.delete(this.#r[a]),n=!0);return n}info(n){const a=this.#a.get(n);if(a===void 0)return;const i=this.#e[a],o=this.#t(i)?i.__staleWhileFetching:i;if(o===void 0)return;const u={value:o};if(this.#p&&this.#b){const m=this.#p[a],y=this.#b[a];if(m&&y){const P=m-(Oe.now()-y);u.ttl=P,u.start=Date.now()}}return this.#y&&(u.size=this.#y[a]),u}dump(){const n=[];for(const a of this.#P({allowStale:!0})){const i=this.#r[a],o=this.#e[a],u=this.#t(o)?o.__staleWhileFetching:o;if(u===void 0||i===void 0)continue;const m={value:u};if(this.#p&&this.#b){m.ttl=this.#p[a];const y=Oe.now()-this.#b[a];m.start=Math.floor(Date.now()-y)}this.#y&&(m.size=this.#y[a]),n.unshift([i,m])}return n}load(n){this.clear();for(const[a,i]of n){if(i.start){const o=Date.now()-i.start;i.start=Oe.now()-o}this.set(a,i.value,i)}}set(n,a,i={}){if(a===void 0)return this.delete(n),this;const{ttl:o=this.ttl,start:u,noDisposeOnSet:m=this.noDisposeOnSet,sizeCalculation:y=this.sizeCalculation,status:P}=i;let{noUpdateTTL:I=this.noUpdateTTL}=i;const Y=this.#N(n,a,i.size||0,y);if(this.maxEntrySize&&Y>this.maxEntrySize)return P&&(P.set="miss",P.maxEntrySizeExceeded=!0),this.delete(n),this;let Z=this.#n===0?void 0:this.#a.get(n);if(Z===void 0)Z=this.#n===0?this.#s:this.#O.length!==0?this.#O.pop():this.#n===this.#l?this.#F(!1):this.#n,this.#r[Z]=n,this.#e[Z]=a,this.#a.set(n,Z),this.#c[this.#s]=Z,this.#f[Z]=this.#s,this.#s=Z,this.#n++,this.#R(Z,Y,P),P&&(P.set="add"),I=!1;else{this.#Q(Z);const ae=this.#e[Z];if(a!==ae){if(this.#S&&this.#t(ae)){ae.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:se}=ae;se!==void 0&&!m&&(this.#E&&this.#g?.(se,n,"set"),this.#u&&this.#i?.push([se,n,"set"]))}else m||(this.#E&&this.#g?.(ae,n,"set"),this.#u&&this.#i?.push([ae,n,"set"]));if(this.#T(Z),this.#R(Z,Y,P),this.#e[Z]=a,P){P.set="replace";const se=ae&&this.#t(ae)?ae.__staleWhileFetching:ae;se!==void 0&&(P.oldValue=se)}}else P&&(P.set="update")}if(o!==0&&!this.#p&&this.#A(),this.#p&&(I||this.#D(Z,o,u),P&&this.#L(P,Z)),!m&&this.#u&&this.#i){const ae=this.#i;let se;for(;se=ae?.shift();)this.#h?.(...se)}return this}pop(){try{for(;this.#n;){const n=this.#e[this.#o];if(this.#F(!0),this.#t(n)){if(n.__staleWhileFetching)return n.__staleWhileFetching}else if(n!==void 0)return n}}finally{if(this.#u&&this.#i){const n=this.#i;let a;for(;a=n?.shift();)this.#h?.(...a)}}}#F(n){const a=this.#o,i=this.#r[a],o=this.#e[a];return this.#S&&this.#t(o)?o.__abortController.abort(new Error("evicted")):(this.#E||this.#u)&&(this.#E&&this.#g?.(o,i,"evict"),this.#u&&this.#i?.push([o,i,"evict"])),this.#T(a),n&&(this.#r[a]=void 0,this.#e[a]=void 0,this.#O.push(a)),this.#n===1?(this.#o=this.#s=0,this.#O.length=0):this.#o=this.#c[a],this.#a.delete(i),this.#n--,a}has(n,a={}){const{updateAgeOnHas:i=this.updateAgeOnHas,status:o}=a,u=this.#a.get(n);if(u!==void 0){const m=this.#e[u];if(this.#t(m)&&m.__staleWhileFetching===void 0)return!1;if(this.#m(u))o&&(o.has="stale",this.#L(o,u));else return i&&this.#$(u),o&&(o.has="hit",this.#L(o,u)),!0}else o&&(o.has="miss");return!1}peek(n,a={}){const{allowStale:i=this.allowStale}=a,o=this.#a.get(n);if(o===void 0||!i&&this.#m(o))return;const u=this.#e[o];return this.#t(u)?u.__staleWhileFetching:u}#C(n,a,i,o){const u=a===void 0?void 0:this.#e[a];if(this.#t(u))return u;const m=new B,{signal:y}=i;y?.addEventListener("abort",()=>m.abort(y.reason),{signal:m.signal});const P={signal:m.signal,options:i,context:o},I=(Fe,ze=!1)=>{const{aborted:we}=m.signal,Ze=i.ignoreFetchAbort&&Fe!==void 0;if(i.status&&(we&&!ze?(i.status.fetchAborted=!0,i.status.fetchError=m.signal.reason,Ze&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),we&&!Ze&&!ze)return Z(m.signal.reason);const et=se;return this.#e[a]===se&&(Fe===void 0?et.__staleWhileFetching?this.#e[a]=et.__staleWhileFetching:this.delete(n):(i.status&&(i.status.fetchUpdated=!0),this.set(n,Fe,P.options))),Fe},Y=Fe=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=Fe),Z(Fe)),Z=Fe=>{const{aborted:ze}=m.signal,we=ze&&i.allowStaleOnFetchAbort,Ze=we||i.allowStaleOnFetchRejection,et=Ze||i.noDeleteOnFetchRejection,Ye=se;if(this.#e[a]===se&&(!et||Ye.__staleWhileFetching===void 0?this.delete(n):we||(this.#e[a]=Ye.__staleWhileFetching)),Ze)return i.status&&Ye.__staleWhileFetching!==void 0&&(i.status.returnedStale=!0),Ye.__staleWhileFetching;if(Ye.__returned===Ye)throw Fe},ae=(Fe,ze)=>{const we=this.#w?.(n,u,P);we&&we instanceof Promise&&we.then(Ze=>Fe(Ze===void 0?void 0:Ze),ze),m.signal.addEventListener("abort",()=>{(!i.ignoreFetchAbort||i.allowStaleOnFetchAbort)&&(Fe(void 0),i.allowStaleOnFetchAbort&&(Fe=Ze=>I(Ze,!0)))})};i.status&&(i.status.fetchDispatched=!0);const se=new Promise(ae).then(I,Y),Ie=Object.assign(se,{__abortController:m,__staleWhileFetching:u,__returned:void 0});return a===void 0?(this.set(n,Ie,{...P.options,status:void 0}),a=this.#a.get(n)):this.#e[a]=Ie,Ie}#t(n){if(!this.#S)return!1;const a=n;return!!a&&a instanceof Promise&&a.hasOwnProperty("__staleWhileFetching")&&a.__abortController instanceof B}async fetch(n,a={}){const{allowStale:i=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:u=this.noDeleteOnStaleGet,ttl:m=this.ttl,noDisposeOnSet:y=this.noDisposeOnSet,size:P=0,sizeCalculation:I=this.sizeCalculation,noUpdateTTL:Y=this.noUpdateTTL,noDeleteOnFetchRejection:Z=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:ae=this.allowStaleOnFetchRejection,ignoreFetchAbort:se=this.ignoreFetchAbort,allowStaleOnFetchAbort:Ie=this.allowStaleOnFetchAbort,context:Fe,forceRefresh:ze=!1,status:we,signal:Ze}=a;if(!this.#S)return we&&(we.fetch="get"),this.get(n,{allowStale:i,updateAgeOnGet:o,noDeleteOnStaleGet:u,status:we});const et={allowStale:i,updateAgeOnGet:o,noDeleteOnStaleGet:u,ttl:m,noDisposeOnSet:y,size:P,sizeCalculation:I,noUpdateTTL:Y,noDeleteOnFetchRejection:Z,allowStaleOnFetchRejection:ae,allowStaleOnFetchAbort:Ie,ignoreFetchAbort:se,status:we,signal:Ze};let Ye=this.#a.get(n);if(Ye===void 0){we&&(we.fetch="miss");const ot=this.#C(n,Ye,et,Fe);return ot.__returned=ot}else{const ot=this.#e[Ye];if(this.#t(ot)){const Er=i&&ot.__staleWhileFetching!==void 0;return we&&(we.fetch="inflight",Er&&(we.returnedStale=!0)),Er?ot.__staleWhileFetching:ot.__returned=ot}const Ct=this.#m(Ye);if(!ze&&!Ct)return we&&(we.fetch="hit"),this.#Q(Ye),o&&this.#$(Ye),we&&this.#L(we,Ye),ot;const At=this.#C(n,Ye,et,Fe),_t=At.__staleWhileFetching!==void 0&&i;return we&&(we.fetch=Ct?"stale":"refresh",_t&&Ct&&(we.returnedStale=!0)),_t?At.__staleWhileFetching:At.__returned=At}}get(n,a={}){const{allowStale:i=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:u=this.noDeleteOnStaleGet,status:m}=a,y=this.#a.get(n);if(y!==void 0){const P=this.#e[y],I=this.#t(P);return m&&this.#L(m,y),this.#m(y)?(m&&(m.get="stale"),I?(m&&i&&P.__staleWhileFetching!==void 0&&(m.returnedStale=!0),i?P.__staleWhileFetching:void 0):(u||this.delete(n),m&&i&&(m.returnedStale=!0),i?P:void 0)):(m&&(m.get="hit"),I?P.__staleWhileFetching:(this.#Q(y),o&&this.#$(y),P))}else m&&(m.get="miss")}#I(n,a){this.#f[a]=n,this.#c[n]=a}#Q(n){n!==this.#s&&(n===this.#o?this.#o=this.#c[n]:this.#I(this.#f[n],this.#c[n]),this.#I(this.#s,n),this.#s=n)}delete(n){let a=!1;if(this.#n!==0){const i=this.#a.get(n);if(i!==void 0)if(a=!0,this.#n===1)this.clear();else{this.#T(i);const o=this.#e[i];if(this.#t(o)?o.__abortController.abort(new Error("deleted")):(this.#E||this.#u)&&(this.#E&&this.#g?.(o,n,"delete"),this.#u&&this.#i?.push([o,n,"delete"])),this.#a.delete(n),this.#r[i]=void 0,this.#e[i]=void 0,i===this.#s)this.#s=this.#f[i];else if(i===this.#o)this.#o=this.#c[i];else{const u=this.#f[i];this.#c[u]=this.#c[i];const m=this.#c[i];this.#f[m]=this.#f[i]}this.#n--,this.#O.push(i)}}if(this.#u&&this.#i?.length){const i=this.#i;let o;for(;o=i?.shift();)this.#h?.(...o)}return a}clear(){for(const n of this.#x({allowStale:!0})){const a=this.#e[n];if(this.#t(a))a.__abortController.abort(new Error("deleted"));else{const i=this.#r[n];this.#E&&this.#g?.(a,i,"delete"),this.#u&&this.#i?.push([a,i,"delete"])}}if(this.#a.clear(),this.#e.fill(void 0),this.#r.fill(void 0),this.#p&&this.#b&&(this.#p.fill(0),this.#b.fill(0)),this.#y&&this.#y.fill(0),this.#o=0,this.#s=0,this.#O.length=0,this.#v=0,this.#n=0,this.#u&&this.#i){const n=this.#i;let a;for(;a=n?.shift();)this.#h?.(...a)}}}var T=l(40187),F=l(43127),K=l(97535),z=l(56587),p=l(60706),L=l(75723),v=l(65650);const C=1e6,X="{}";class U extends T.Is{constructor(n,a){super(),this.started=!1,this.seriesCache=new ue({max:10}),this.labelsCache=new ue({max:10}),this.request=async(i,o)=>{try{return await this.datasource.metadataRequest(i,o)}catch(u){console.error(u)}},this.start=i=>{const o=i??this.getDefaultTimeRange();return(!this.startTask||this.startedTimeRange?.from.isSame(o.from)===!1||this.startedTimeRange?.to.isSame(o.to)===!1)&&(this.startedTimeRange=o,this.startTask=this.fetchLabels({timeRange:o}).then(()=>(this.started=!0,[]))),this.startTask},this.fetchSeriesLabels=async(i,o)=>{const u=this.datasource.interpolateString(i),m="series",y=o?.timeRange??this.getDefaultTimeRange(),{start:P,end:I}=this.datasource.getTimeRangeParams(y),Y=this.generateCacheKey(m,P,I,u);let Z=this.seriesCache.get(Y);if(!Z){const ae={"match[]":u,start:P,end:I},se=await this.request(m,ae);if(!Array.isArray(se))return{};const{values:Ie}=(0,K.P7)(se);Z=Ie,this.seriesCache.set(Y,Z)}return Z},this.fetchSeries=async(i,o)=>{const u="series",m=o?.timeRange??this.getDefaultTimeRange(),{start:y,end:P}=this.datasource.getTimeRangeParams(m),I={"match[]":i,start:y,end:P};return await this.request(u,I)},this.datasource=n,this.labelKeys=[],Object.assign(this,a)}getLabelKeys(){return this.labelKeys}importFromAbstractQuery(n){return{refId:n.refId,expr:(0,K.tt)(n),queryType:v.U3.Range}}exportToAbstractQuery(n){if(!n.expr||n.expr.length===0)return{refId:n.refId,labelMatchers:[]};const i=(0,z.pk)(n.expr).map(o=>(0,p.u_)(o).query.labels.map(y=>({name:y.label,value:y.value,operator:K.sM[y.op]})));return{refId:n.refId,labelMatchers:(0,Q.flatten)(i)}}async fetchLabels(n){if(!n||!n.streamSelector)return this.fetchLabelsByLabelsEndpoint(n);{const a=await this.fetchSeriesLabels(n.streamSelector,{timeRange:n.timeRange});return Object.keys(a??{})}}async fetchLabelsByLabelsEndpoint(n){const a="labels",i=n?.timeRange??this.getDefaultTimeRange(),o=this.datasource.getTimeRangeParams(i),u=await this.request(a,o);if(Array.isArray(u)){const m=u.slice().sort().filter(y=>y!=="__name__");return this.labelKeys=m,this.labelKeys}return[]}generateCacheKey(n,a,i,o){return[n,this.roundTime(a),this.roundTime(i),o].join()}roundTime(n){return n?Math.floor(n/C/1e3/60/5):0}async fetchLabelValues(n,a){const i=encodeURIComponent(this.datasource.interpolateString(n)),o=a?.streamSelector&&a.streamSelector!==X?this.datasource.interpolateString(a.streamSelector):void 0,u=`label/${i}/values`,m=a?.timeRange??this.getDefaultTimeRange(),y=this.datasource.getTimeRangeParams(m),{start:P,end:I}=y,Y={start:P,end:I};let Z=i;o&&(Y.query=o,Z+=o);const ae=this.generateCacheKey(u,P,I,Z);let se=this.labelsCache.get(ae);if(!se){this.labelsCache.set(ae,[]);const Ie=await this.request(u,Y);Array.isArray(Ie)&&(se=Ie.slice().sort(),this.labelsCache.set(ae,se))}return se??[]}async getParserAndLabelKeys(n,a){const i={extractedLabelKeys:[],structuredMetadataKeys:[],unwrapLabelKeys:[],hasJSON:!1,hasLogfmt:!1,hasPack:!1};if(!te.$.featureToggles.lokiQueryHints)return i;const o=await this.datasource.getDataSamples({expr:n,refId:"data-samples",maxLines:a?.maxLines||Lt},a?.timeRange??this.getDefaultTimeRange());if(!o.length)return i;const{hasLogfmt:u,hasJSON:m,hasPack:y}=(0,L.YB)(o[0]);return{extractedLabelKeys:[...(0,L.fV)(o[0],v.HD.Indexed),...(0,L.fV)(o[0],v.HD.Parsed)],structuredMetadataKeys:(0,L.fV)(o[0],v.HD.StructuredMetadata),unwrapLabelKeys:(0,L.aN)(o[0]),hasJSON:m,hasPack:y,hasLogfmt:u}}getDefaultTimeRange(){return(0,F.E2)()}}var Pe=l(39697),Te=l(37748),We=l(69862),je=l(69850),ut=l(31635),vt=l(13752),Xt=l(75508),or=l(88483),Xr=l(64423),Lr=l(39741),lr={url:"",deserializer:function(g){return JSON.parse(g.data)},serializer:function(g){return JSON.stringify(g)}},Ur="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",Br=function(g){(0,ut.__extends)(n,g);function n(a,i){var o=g.call(this)||this;if(o._socket=null,a instanceof or.c)o.destination=i,o.source=a;else{var u=o._config=(0,ut.__assign)({},lr);if(o._output=new vt.B,typeof a=="string")u.url=a;else for(var m in a)a.hasOwnProperty(m)&&(u[m]=a[m]);if(!u.WebSocketCtor&&WebSocket)u.WebSocketCtor=WebSocket;else if(!u.WebSocketCtor)throw new Error("no WebSocket constructor can be found");o.destination=new Lr.m}return o}return n.prototype.lift=function(a){var i=new n(this._config,this.destination);return i.operator=a,i.source=this,i},n.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new Lr.m),this._output=new vt.B},n.prototype.multiplex=function(a,i,o){var u=this;return new or.c(function(m){try{u.next(a())}catch(P){m.error(P)}var y=u.subscribe({next:function(P){try{o(P)&&m.next(P)}catch(I){m.error(I)}},error:function(P){return m.error(P)},complete:function(){return m.complete()}});return function(){try{u.next(i())}catch(P){m.error(P)}y.unsubscribe()}})},n.prototype._connectSocket=function(){var a=this,i=this._config,o=i.WebSocketCtor,u=i.protocol,m=i.url,y=i.binaryType,P=this._output,I=null;try{I=u?new o(m,u):new o(m),this._socket=I,y&&(this._socket.binaryType=y)}catch(Z){P.error(Z);return}var Y=new Xr.yU(function(){a._socket=null,I&&I.readyState===1&&I.close()});I.onopen=function(Z){var ae=a._socket;if(!ae){I.close(),a._resetState();return}var se=a._config.openObserver;se&&se.next(Z);var Ie=a.destination;a.destination=Xt.vU.create(function(Fe){if(I.readyState===1)try{var ze=a._config.serializer;I.send(ze(Fe))}catch(we){a.destination.error(we)}},function(Fe){var ze=a._config.closingObserver;ze&&ze.next(void 0),Fe&&Fe.code?I.close(Fe.code,Fe.reason):P.error(new TypeError(Ur)),a._resetState()},function(){var Fe=a._config.closingObserver;Fe&&Fe.next(void 0),I.close(),a._resetState()}),Ie&&Ie instanceof Lr.m&&Y.add(Ie.subscribe(a.destination))},I.onerror=function(Z){a._resetState(),P.error(Z)},I.onclose=function(Z){I===a._socket&&a._resetState();var ae=a._config.closeObserver;ae&&ae.next(Z),Z.wasClean?P.complete():P.error(Z)},I.onmessage=function(Z){try{var ae=a._config.deserializer;P.next(ae(Z))}catch(se){P.error(se)}}},n.prototype._subscribe=function(a){var i=this,o=this.source;return o?o.subscribe(a):(this._socket||this._connectSocket(),this._output.subscribe(a),a.add(function(){var u=i._socket;i._output.observers.length===0&&(u&&(u.readyState===1||u.readyState===0)&&u.close(),i._resetState())}),a)},n.prototype.unsubscribe=function(){var a=this._socket;a&&(a.readyState===1||a.readyState===0)&&a.close(),this._resetState(),g.prototype.unsubscribe.call(this)},n}(vt.k);function Ba(g){return new Br(g)}var Zr=l(33526),it=l(11261),ha=l(38823),Wa=l(8227);function _a(g){if(!(0,Wa.A)(g))throw TypeError("Invalid UUID");let n;const a=new Uint8Array(16);return a[0]=(n=parseInt(g.slice(0,8),16))>>>24,a[1]=n>>>16&255,a[2]=n>>>8&255,a[3]=n&255,a[4]=(n=parseInt(g.slice(9,13),16))>>>8,a[5]=n&255,a[6]=(n=parseInt(g.slice(14,18),16))>>>8,a[7]=n&255,a[8]=(n=parseInt(g.slice(19,23),16))>>>8,a[9]=n&255,a[10]=(n=parseInt(g.slice(24,36),16))/1099511627776&255,a[11]=n/4294967296&255,a[12]=n>>>24&255,a[13]=n>>>16&255,a[14]=n>>>8&255,a[15]=n&255,a}const Wr=_a;function _r(g){g=unescape(encodeURIComponent(g));const n=[];for(let a=0;a<g.length;++a)n.push(g.charCodeAt(a));return n}const va="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Oa="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Ot(g,n,a){function i(o,u,m,y){var P;if(typeof o=="string"&&(o=_r(o)),typeof u=="string"&&(u=Wr(u)),((P=u)===null||P===void 0?void 0:P.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let I=new Uint8Array(16+o.length);if(I.set(u),I.set(o,u.length),I=a(I),I[6]=I[6]&15|n,I[8]=I[8]&63|128,m){y=y||0;for(let Y=0;Y<16;++Y)m[y+Y]=I[Y];return m}return(0,ha.k)(I)}try{i.name=g}catch{}return i.DNS=va,i.URL=Oa,i}function Gt(g,n,a,i){switch(g){case 0:return n&a^~n&i;case 1:return n^a^i;case 2:return n&a^n&i^a&i;case 3:return n^a^i}}function qr(g,n){return g<<n|g>>>32-n}function ea(g){const n=[1518500249,1859775393,2400959708,3395469782],a=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof g=="string"){const m=unescape(encodeURIComponent(g));g=[];for(let y=0;y<m.length;++y)g.push(m.charCodeAt(y))}else Array.isArray(g)||(g=Array.prototype.slice.call(g));g.push(128);const i=g.length/4+2,o=Math.ceil(i/16),u=new Array(o);for(let m=0;m<o;++m){const y=new Uint32Array(16);for(let P=0;P<16;++P)y[P]=g[m*64+P*4]<<24|g[m*64+P*4+1]<<16|g[m*64+P*4+2]<<8|g[m*64+P*4+3];u[m]=y}u[o-1][14]=(g.length-1)*8/Math.pow(2,32),u[o-1][14]=Math.floor(u[o-1][14]),u[o-1][15]=(g.length-1)*8&4294967295;for(let m=0;m<o;++m){const y=new Uint32Array(80);for(let se=0;se<16;++se)y[se]=u[m][se];for(let se=16;se<80;++se)y[se]=qr(y[se-3]^y[se-8]^y[se-14]^y[se-16],1);let P=a[0],I=a[1],Y=a[2],Z=a[3],ae=a[4];for(let se=0;se<80;++se){const Ie=Math.floor(se/20),Fe=qr(P,5)+Gt(Ie,I,Y,Z)+ae+n[Ie]+y[se]>>>0;ae=Z,Z=Y,Y=qr(I,30)>>>0,I=P,P=Fe}a[0]=a[0]+P>>>0,a[1]=a[1]+I>>>0,a[2]=a[2]+Y>>>0,a[3]=a[3]+Z>>>0,a[4]=a[4]+ae>>>0}return[a[0]>>24&255,a[0]>>16&255,a[0]>>8&255,a[0]&255,a[1]>>24&255,a[1]>>16&255,a[1]>>8&255,a[1]&255,a[2]>>24&255,a[2]>>16&255,a[2]>>8&255,a[2]&255,a[3]>>24&255,a[3]>>16&255,a[3]>>8&255,a[3]&255,a[4]>>24&255,a[4]>>16&255,a[4]>>8&255,a[4]&255]}const Va=Ot("v5",80,ea),ya="6ec946da-0f49-47a8-983a-1d76d17e7c92";function Yt(g,n){const a=g.streams;if(!a||!a.length)return;const i=n.fields[0],o=n.fields[1],u=n.fields[2],m={};for(const y of a){const P=Object.entries(y.stream).map(([I,Y])=>`${I}="${Y}"`).sort().join("");for(const[I,Y]of y.values)i.values.push(new Date(parseInt(I.slice(0,-6),10)).toISOString()),o.values.push(Y),u.values.push(Jt(I,P,Y,m,n.refId))}}function Jt(g,n,a,i,o){let u=Va(`${g}_${n}_${a}`,ya);if(u in i){const m=i[u]+1;i[u]=m,u=`${u}_${m}`}else i[u]=0;return o?`${o}_${u}`:u}class Ut{constructor(){this.streams={}}getStream(n,a=5e3){let i=this.streams[n.url];if(i)return i;const o=new Zr.x({capacity:n.size});return o.addField({name:"Time",type:it.PU.time,config:{}}),o.addField({name:"Line",type:it.PU.string}),o.addField({name:"id",type:it.PU.string}),o.meta={...o.meta,preferredVisualisationType:"logs"},o.refId=n.refId,i=Ba(n.url).pipe((0,de.T)(u=>(Yt(u,o),[o])),(0,Te.l)(u=>u.pipe((0,We.Z)((m,y)=>{const P=y+1;return m.code===1006&&P<30?(P>10&&console.warn(`Websocket connection is being disrupted. We keep reconnecting but consider starting new live tailing again. Error: ${m.reason}`),(0,Pe.O)(a)):(0,Ce.$)(m)}))),(0,je.j)(()=>{delete this.streams[n.url]})),this.streams[n.url]=i,i}}var yt=l(47232),ba=l(85404),bt=l(32196),ye=l(96540),Sr=l(16817),Zt=l(36663),Ea=l(92762),$t=l(14110),mt=l(40845),$r=l(42418),dt=l(56034),ja=l(55852),za=l(82762),Pa=l(14578),qt=l(62930),ta=l(60029),Tr=l(21594),Bt=l(39268),kt=l(14186),xa=l(44522),ur=l(15292),ra=l(71713);function kr(g){return{labels:(0,bt.css)`
      display: flex;
      gap: ${g.spacing(.5)};
    `,wrapper:(0,bt.css)`
      display: flex;
      flex-direction: column;
      flex: 1;
      gap: ${g.spacing(.5)};
      position: relative;
    `,textWrapper:(0,bt.css)`
      display: flex;
      align-items: center;
    `,hidden:(0,bt.css)`
      visibility: hidden;
    `,label:(0,bt.css)`
      max-width: 100%;
      &:first-of-type {
        margin-bottom: ${g.spacing(2)};
      }
      &:not(:first-of-type) {
        margin: ${g.spacing(2)} 0;
      }
    `,rawQueryContainer:(0,bt.css)`
      text-align: start;
      line-break: anywhere;
      margin-top: -${g.spacing(.25)};
      margin-right: ${g.spacing(6)};
      min-height: ${g.spacing(4)};
    `,ui:(0,bt.css)`
      background-color: ${g.colors.background.secondary};
      padding: ${g.spacing(2)};
    `,notification:(0,bt.css)({position:"absolute",zIndex:g.zIndex.portal,top:0,right:0}),rawQuery:(0,bt.css)`
      display: inline;
    `,queryDescription:(0,bt.css)`
      margin-left: ${g.spacing(.5)};
    `,iconButton:(0,bt.css)`
      position: absolute;
      top: ${g.spacing(1)};
      right: ${g.spacing(1)};
      z-index: ${g.zIndex.navbarFixed};
    `,operationsToggle:(0,bt.css)`
      margin: ${g.spacing(1)} 0 ${g.spacing(-1)} 0;
      & > div {
        margin: 0;
        & > label {
          padding: 0;
        }
      }
    `}}const aa="isLogContextQueryUiOpen";function Ka(g){const{row:n,logContextProvider:a,updateFilter:i,onClose:o,origQuery:u,runContextQuery:m}=g,y=(0,mt.of)(kr),[P,I]=(0,ye.useState)([]),[Y,Z]=(0,ye.useState)(!1),[ae,se]=(0,ye.useState)(!1),[Ie,Fe]=(0,ye.useState)(!1),[ze,we]=(0,ye.useState)(window.localStorage.getItem(aa)==="true"),[Ze,et]=(0,ye.useState)(window.localStorage.getItem(Qt)==="true"),Ye=ye.useRef(),ot=ye.useRef(!1),Ct=ye.useRef([]),At=(0,ye.useMemo)(()=>!(ae&&P.some(W=>W.nonIndexed===W.enabled)||Ze&&a.queryContainsValidPipelineStages(u)),[P,Ze,ae,a,u]);(0,ye.useEffect)(()=>{if(ae){if(!ot.current){ot.current=ae;return}if(P.filter(({enabled:W,nonIndexed:Le})=>W&&!Le).length===0){I(Ct.current);return}return Ct.current=structuredClone(P),Ye.current&&clearTimeout(Ye.current),Fe(!0),Ye.current=window.setTimeout(()=>{i(P.filter(({enabled:Le})=>Le));const W={removedLabels:[],selectedExtractedLabels:[]};P.forEach(({enabled:Le,nonIndexed:Ne,label:Xe})=>{!Le&&!Ne&&W.removedLabels.push(Xe),Le&&Ne&&W.selectedExtractedLabels.push(Xe)}),window.localStorage.setItem(ft,JSON.stringify(W)),Fe(!1)},1500),()=>{clearTimeout(Ye.current)}}},[P,ae]),(0,ye.useEffect)(()=>()=>{clearTimeout(Ye.current),o()},[o]),(0,Sr.A)(async()=>{Fe(!0);const W=await a.getInitContextFilters(n,u,{from:(0,yt.KQ)(n.timeEpochMs),to:(0,yt.KQ)(n.timeEpochMs),raw:{from:(0,yt.KQ)(n.timeEpochMs),to:(0,yt.KQ)(n.timeEpochMs)}});I(W.contextFilters),Z(W.preservedFiltersApplied),se(!0),Fe(!1)}),(0,ye.useEffect)(()=>{Y&&setTimeout(()=>{Z(!1)},2e3)},[Y]),(0,ye.useEffect)(()=>((0,$t.rR)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:n.uid,type:"load"}),()=>{(0,$t.rR)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:n.uid,type:"unload"})}),[n.uid]);const Nr=P.filter(({nonIndexed:W})=>!W),_t=Nr.filter(({enabled:W})=>W),Er=P.filter(({nonIndexed:W})=>W),k=Er.filter(({enabled:W})=>W),H=(0,ye.useCallback)(W=>({label:`${W.label}="${(0,K.Bb)(W.value)}"`,value:W.label}),[]),ne=Er.length>0;let re=a.prepareExpression(P.filter(({enabled:W})=>W),u);return ye.createElement("div",{className:y.wrapper},Y&&ye.createElement($r.F,{className:y.notification,title:"Previously used filters have been applied.",severity:"info",elevated:!0}),ye.createElement(dt.m,{content:"Revert to initial log context query."},ye.createElement("div",{className:y.iconButton},ye.createElement(ja.$n,{"data-testid":"revert-button",icon:"history-alt",variant:"secondary",disabled:At,onClick:W=>{(0,$t.rR)("grafana_explore_logs_loki_log_context_reverted",{logRowUid:n.uid}),I(Le=>Le.map(Ne=>({...Ne,enabled:!Ne.nonIndexed}))),window.localStorage.removeItem(ft),window.localStorage.removeItem(Qt),et(!1)}}))),ye.createElement(za.S,{collapsible:!0,isOpen:ze,onToggle:()=>{window.localStorage.setItem(aa,(!ze).toString()),we(W=>!W),(0,$t.rR)("grafana_explore_logs_loki_log_context_toggled",{logRowUid:n.uid,action:ze?"close":"open"})},label:ye.createElement("div",{className:y.rawQueryContainer},ae?ye.createElement(ye.Fragment,null,ye.createElement(Ea.Z,{language:{grammar:ra.vB,name:"loki"},query:re,className:y.rawQuery}),ye.createElement(dt.m,{content:"The initial log context query is created from all labels defining the stream for the selected log line. Use the editor below to customize the log context query."},ye.createElement(Pa.I,{name:"info-circle",size:"sm",className:y.queryDescription}))):ye.createElement(qt.y,null))},ye.createElement("div",{className:y.ui},ye.createElement(ta.J,{className:y.label,description:"The initial log context query is created from all labels defining the stream for the selected log line. You can broaden your search by removing one or more of the label filters."},"Widen the search"),ye.createElement(Tr.KF,{isLoading:Ie,options:Nr.map(H),value:_t.map(H),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",onChange:(W,Le)=>(Le.action==="select-option"&&(0,$t.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:n.uid,type:"label",action:"select"}),Le.action==="remove-value"&&(0,$t.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:n.uid,type:"label",action:"remove"}),I(P.map(Ne=>(Ne.nonIndexed||(Ne.enabled=W.some(Xe=>Xe.value===Ne.label)),Ne))))}),ne&&ye.createElement(ye.Fragment,null,ye.createElement(ta.J,{className:y.label,description:"By using a parser in your original query, you can use filters for extracted labels. Refine your search by applying extracted labels created from the selected log line."},"Refine the search"),ye.createElement(Tr.KF,{isLoading:Ie,options:Er.map(H),value:k.map(H),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",isClearable:!0,onChange:(W,Le)=>{Le.action==="select-option"&&(0,$t.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:n.uid,type:"parsed_label",action:"select"}),Le.action==="remove-value"&&(0,$t.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:n.uid,type:"parsed_label",action:"remove"}),I(P.map(Ne=>(Ne.nonIndexed&&(Ne.enabled=W.some(Xe=>Xe.value===Ne.label)),Ne)))}})),a.queryContainsValidPipelineStages(u)&&ye.createElement(Bt.C,{className:y.operationsToggle},ye.createElement(kt.I,{label:"Include LogQL pipeline operations",tooltip:ye.createElement(xa.I,{content:(0,Zt.G)("This will include LogQL operations such as `line_format` or `label_format`. It won't include line or label filter operations.")})},ye.createElement(ur.K,{value:Ze,showLabel:!0,transparent:!0,onChange:W=>{(0,$t.rR)("grafana_explore_logs_loki_log_context_pipeline_toggled",{logRowUid:n.uid,action:W.currentTarget.checked?"enable":"disable"}),window.localStorage.setItem(Qt,W.currentTarget.checked.toString()),et(W.currentTarget.checked),m&&m()}}))))))}var Ge=l(12798),Vr=(g=>(g[g.Ascending=0]="Ascending",g[g.Descending=1]="Descending",g))(Vr||{});function La(g,n){const a=g.values,{nanos:i}=g,o=Array(a.length);for(let m=0;m<o.length;m++)o[m]=m;const u=n===0;return o.sort((m,y)=>{const P=a[m],I=a[y];if(P<I)return u?-1:1;if(P>I)return u?1:-1;if(i===void 0)return 0;const Y=i[m],Z=i[y];return Y<Z?u?-1:1:Y>Z?u?1:-1:0}),o}function Tt(g,n){const{fields:a,...i}=g,o=a.find(m=>m.type===it.PU.time);if(o===void 0)throw new Error("missing timestamp field. should never happen");const u=La(o,n);return{...i,fields:a.map(m=>({...m,values:er(m.values,u),nanos:m.nanos===void 0?void 0:er(m.nanos,u)}))}}function er(g,n){return g.map((a,i)=>g[n[i]])}const ft="lokiLogContextPreservedLabels",Qt="lokiLogContextShouldIncludePipelineOperations";class Et{constructor(n){this.getLogRowContextQuery=async(a,i,o,u=!0)=>{const{query:m}=await this.getQueryAndRange(a,i,o,u);return u||(this.cachedContextFilters=[]),m},this.getLogRowContext=async(a,i,o)=>{const u=i&&i.direction||q.ZF.Backward,{query:m,range:y}=await this.getQueryAndRange(a,i,o),P=Y=>{const ae=Y.data.map(se=>Tt(se,Vr.Descending));return{...Y,data:ae}},I=S.Jk.Explore;return(0,r.s)(this.datasource.query(br(m,y,I,`${la}${u}`)).pipe((0,E.W)(Y=>{throw{message:"Error during context query. Please check JS console logs.",status:Y.status,statusText:Y.statusText}}),(0,V.n)(Y=>(0,A.of)(P(Y)))))},this.processContextFiltersToExpr=(a,i)=>{let u=`{${a.map(m=>!m.nonIndexed&&m.enabled?`${m.label}="${(0,K.Qn)(m.value)}"`:"").filter(m=>!!m).join(",")}}`;if(i){let m=!1;if((0,z.MX)(i.expr).parserCount===1){m=!0;const P=(0,z.aw)(i.expr);P&&(u=(0,Ge.aH)(u,P))}const y=a.filter(P=>P.nonIndexed&&P.enabled);for(const P of y)P.enabled&&(u=(0,Ge.tE)(u,P.label,"=",P.value,m?v.HD.Parsed:v.HD.StructuredMetadata))}return u},this.processPipelineStagesToExpr=(a,i)=>{let o=a;const u=i?.expr??"";if((0,z.MX)(u).parserCount>1)return o;const m=(0,z.TQ)(u,[ve.t3,ve.iT,ve.c$,ve.LM,ve.CX,ve.bY]),y=m.filter(I=>I.type?.id===ve.t3),P=m.filter(I=>I.type?.id!==ve.t3);for(const I of y)P.some(Y=>I.contains(Y))||(o+=` ${I.getExpression(u)}`);return o},this.queryContainsValidPipelineStages=a=>{const i=a?.expr??"",o=(0,z.TQ)(i,[ve.t3,ve.iT,ve.CX,ve.bY]),u=o.filter(y=>y.type?.id===ve.t3),m=o.filter(y=>y.type?.id!==ve.t3);return u.some(y=>m.every(P=>y.contains(P)===!1))},this.getInitContextFilters=async(a,i,o)=>{let u=!1;if(!i||(0,Q.isEmpty)(a.labels))return{contextFilters:[],preservedFiltersApplied:u};const m=a.labels;let y=[];if(!(0,z.MX)(i.expr).queryWithParser)await this.datasource.languageProvider.start(o),y=this.datasource.languageProvider.getLabelKeys();else{const Z=(0,z.pk)(i.expr);y=await this.datasource.languageProvider.fetchLabels({streamSelector:Z[0],timeRange:o})}const P=[];Object.entries(m).forEach(([Z,ae])=>{const se=(0,K.Ed)(Z,a.dataFrame,a.rowIndex),Ie={label:Z,value:ae,enabled:y.includes(Z),nonIndexed:se!==null&&se!==v.HD.Indexed};P.push(Ie)});let I;const Y=window.localStorage.getItem(ft);if(Y)try{I=JSON.parse(Y)}catch{}if(I){let Z=!1;const ae=P.map(Ie=>I.removedLabels.includes(Ie.label)?(Z=!0,{...Ie,enabled:!1}):I.selectedExtractedLabels.includes(Ie.label)?(Z=!0,{...Ie,enabled:!0}):{...Ie});return ae.some(({enabled:Ie,nonIndexed:Fe})=>Ie&&!Fe)?(Z&&(u=!0),{contextFilters:ae,preservedFiltersApplied:u}):{contextFilters:P,preservedFiltersApplied:u}}else return{contextFilters:P,preservedFiltersApplied:u}},this.datasource=n,this.cachedContextFilters=[]}async getQueryAndRange(n,a,i,o=!0){const u=a&&a.direction||q.ZF.Backward,m=a&&a.limit||this.datasource.maxLines;if(this.cachedContextFilters.length===0||!o){const y=(await this.getInitContextFilters(n,i,{from:(0,yt.KQ)(n.timeEpochMs),to:(0,yt.KQ)(n.timeEpochMs),raw:{from:(0,yt.KQ)(n.timeEpochMs),to:(0,yt.KQ)(n.timeEpochMs)}})).contextFilters.filter(P=>P.enabled);this.cachedContextFilters=y}return await this.prepareLogRowContextQueryTarget(n,m,u,i)}async prepareLogRowContextQueryTarget(n,a,i,o){const u=this.prepareExpression(this.cachedContextFilters,o),m=2*60*60*1e3,y=i===q.ZF.Forward?v.ti.Forward:v.ti.Backward,P={expr:u,queryType:v.U3.Range,refId:`${la}_${Math.random().toString()}`,maxLines:a,direction:y,datasource:{uid:this.datasource.uid,type:this.datasource.type}},Y=new ba.L(n.dataFrame).getFirstFieldOfType(it.PU.time);if(Y===void 0)throw new Error("loki: data frame missing time-field, should never happen");const Z=Y.values[n.rowIndex],ae=(0,yt.yT)(Z),se=y===v.ti.Forward?{from:ae,to:(0,yt.yT)(n.timeEpochMs+m)}:{from:(0,yt.yT)(n.timeEpochMs-m),to:ae};return{query:P,range:{from:se.from,to:se.to,raw:se}}}getLogRowContextUi(n,a,i){const o=u=>{this.cachedContextFilters=u,a&&a()};return this.onContextClose=this.onContextClose??(()=>{this.cachedContextFilters=[]}),Ka({row:n,origQuery:i,updateFilter:o,onClose:this.onContextClose,logContextProvider:this,runContextQuery:a})}prepareExpression(n,a){let i=this.processContextFiltersToExpr(n,a);return window.localStorage.getItem(Qt)==="true"&&(i=this.processPipelineStagesToExpr(i,a)),i}}var Dt=l(65474),Nt=l(29505),tr=l(84596),Rt=l(10354);const jr=/^label_names\(\)\s*$/,dr=/^label_values\((?:(.+),\s*)?([a-zA-Z_$][a-zA-Z0-9_]*)\)\s*$/;function fr(g){if(typeof g!="string")return g;const n={refId:"LokiVariableQueryEditor-VariableQuery",type:v.ie.LabelNames};if(g.match(jr))return{...n,type:v.ie.LabelNames};const i=g.match(dr);return i?{...n,type:v.ie.LabelValues,label:i[2]?i[2]:i[1],stream:i[2]?i[1]:void 0}:n}const na=[{label:"Label names",value:v.ie.LabelNames},{label:"Label values",value:v.ie.LabelValues}],Ha="LokiVariableQueryEditor-VariableQuery",Ga=({onChange:g,query:n,datasource:a,range:i})=>{const[o,u]=(0,ye.useState)(void 0),[m,y]=(0,ye.useState)(""),[P,I]=(0,ye.useState)([]),[Y,Z]=(0,ye.useState)(""),ae=(0,tr.A)(o);(0,ye.useEffect)(()=>{if(!n)return;const we=typeof n=="string"?fr(n):n;u(we.type),y(we.label||""),Z(we.stream||"")},[n]),(0,ye.useEffect)(()=>{o!==v.ie.LabelValues||ae===o||a.languageProvider.fetchLabels({timeRange:i}).then(we=>{I(we.map(Ze=>({label:Ze,value:Ze})))})},[a,o,i,ae]);const se=we=>{u(we.value),we.value!==void 0&&g({type:we.value,label:m,stream:Y,refId:Ha})},Ie=we=>{y(we.value||"")},Fe=we=>{Z(we.currentTarget.value)},ze=()=>{o!==void 0&&g({type:o,label:m,stream:Y,refId:"LokiVariableQueryEditor-VariableQuery"})};return ye.createElement(ye.Fragment,null,ye.createElement(Bt.C,null,ye.createElement(kt.I,{label:"Query type",labelWidth:20},ye.createElement(Tr.l6,{"aria-label":"Query type",onChange:se,onBlur:ze,value:o,options:na,width:16})),o===v.ie.LabelValues&&ye.createElement(ye.Fragment,null,ye.createElement(kt.I,{label:"Label",labelWidth:20},ye.createElement(Tr.l6,{"aria-label":"Label",onChange:Ie,onBlur:ze,value:{label:m,value:m},options:P,width:16,allowCustomValue:!0})))),o===v.ie.LabelValues&&ye.createElement(Bt.C,null,ye.createElement(kt.I,{label:"Stream selector",labelWidth:20,grow:!0,tooltip:ye.createElement("div",null,'Optional. If defined, a list of values for the specified log stream selector is returned. For example: {label="value"} or {label="$variable"}')},ye.createElement(Rt.p,{type:"text","aria-label":"Stream selector",placeholder:"Optional stream selector",value:Y,onChange:Fe,onBlur:ze}))))};class wt extends Nt.f5{constructor(n){super(),this.datasource=n,this.editor=Ga}async execute(n,a,i){return this.datasource.metricFindQuery(n,{scopedVars:a,range:i})}query(n){const a=this.execute(n.targets[0],n.scopedVars,n.range);return(0,Dt.H)(a).pipe((0,de.T)(i=>({data:i})))}}var Wt=l(14236),Qr=l(19347);function Pt(g,n){if(!n.length)return[];const a=(0,Q.groupBy)(n,"name"),i=Object.values(a).map(Ft),o=g.fields.find(m=>m.type===it.PU.string);if(o===void 0)throw new Error("invalid logs-dataframe, string-field missing");const u=g.fields.find(m=>m.type===it.PU.other&&m.name==="labels");for(let m=0;m<o.values.length;m++)for(const y of i)if(a[y.name][0].matcherType==="label"&&u){const P=u.values[m];if(P){const I=Object.keys(P).find(Y=>a[y.name][0].matcherRegex===Y);if(I){y.values.push(P[I]);continue}}y.values.push(null)}else if(a[y.name][0].matcherType==="regex"||a[y.name][0].matcherType===void 0){const I=o.values[m].match(a[y.name][0].matcherRegex);if(I&&I[1]){y.values.push(I[1]);continue}y.values.push(null)}else y.values.push(null);return i}function Ft(g){const n=(0,Qr.l)(),a=g.reduce((i,o)=>{if(o.datasourceUid){const u=n.getInstanceSettings(o.datasourceUid),m=y=>{switch(y){case"tempo":return"traceql";case"grafana-x-ray-datasource":return"getTrace";default:return}};i.push({title:o.urlDisplayLabel||"",url:"",internal:{query:{query:o.url,queryType:m(u?.type)},datasourceUid:o.datasourceUid,datasourceName:u?.name??"Data source not found"}})}else o.url&&i.push({title:o.urlDisplayLabel||"",url:o.url});return i},[]);return{name:g[0].name,type:it.PU.string,config:{links:a},values:[]}}function Sa(g){const n=g.filter(i=>i.refId!==void 0),a=(0,Q.groupBy)(n,i=>i.refId);return Object.entries(a).map(([i,o])=>$a(o,i))}function $a(g,n){const a={name:"Time",config:{},values:[],type:it.PU.time},i={name:`Value #${n}`,config:{},values:[],type:it.PU.number},o=new Set(g.map(y=>y.fields.map(P=>Object.keys(P.labels??{})).flat()).flat()),m=Array.from(o).sort().map(y=>({name:y,config:{filterable:!0},values:[],type:it.PU.string}));return g.forEach(y=>{const P=y.fields.find(se=>se.type===it.PU.time),I=y.fields.find(se=>se.type===it.PU.number);if(P==null||I==null)return;const Y=P.values,Z=I.values;for(let se of Y)a.values.push(se);for(let se of Z)i.values.push(se);const ae=I.labels??{};for(let se of m){const Ie=ae[se.name]??"";for(let Fe=0;Fe<Z.length;Fe++)se.values.push(Ie)}}),{fields:[a,...m,i],refId:n,meta:{preferredVisualisationType:"table"},length:a.values.length}}function Vt(g){return g.fields.every(n=>n.type===it.PU.time||n.type===it.PU.number)}function Mt(g,n){const{meta:a,...i}=g,o={...a,...n};return{...i,meta:o}}function Ta(g,n,a){const i={...g.meta?.custom,lokiQueryStatKey:"Summary: total bytes processed"};(0,L.nE)(g)&&(i.error="Error when parsing some of the logs");const o={preferredVisualisationType:"logs",limit:n?.maxLines,searchWords:n!==void 0?(0,z.H0)(n.expr):void 0,custom:i},u=Mt(g,o),m=Pt(u,a);return{...u,fields:[...u.fields,...m]}}function rr(g,n,a){return g.map(i=>{const o=i.refId!==void 0?n.get(i.refId):void 0;return Ta(i,o,a)})}function wr(g){return g.length>0?Sa(g):[]}function sa(g){const n={preferredVisualisationType:"graph"};return g.map(a=>Mt(a,n))}function Qa(g,n){const a=[],i=[],o=[];return g.forEach(u=>{Vt(u)?u.refId!=null&&n.get(u.refId)?.queryType===v.U3.Instant?i.push(u):o.push(u):a.push(u)}),{streamsFrames:a,metricInstantFrames:i,metricRangeFrames:o}}function pr(g,n){if(g===void 0)return g;const{refId:a,message:i}=g;if(a===void 0||i===void 0)return g;const o=n.get(a);return o===void 0?g:i.includes("escape")&&o.expr.includes("\\")?{...g,message:`${i}. Make sure that all special characters are escaped with \\. For more information on escaping of special characters visit LogQL documentation at https://grafana.com/docs/loki/latest/logql/.`}:g}function gt(g,n,a){const{data:i,error:o,...u}=g,m=i.map(Z=>{if(!(0,Wt.ci)(Z))throw new Error("transformation only supports dataframe responses");return Z}),y=new Map(n.map(Z=>[Z.refId,Z])),{streamsFrames:P,metricInstantFrames:I,metricRangeFrames:Y}=Qa(m,y);return{...u,error:pr(o,y),data:[...sa(Y),...wr(I),...rr(P,y,a)]}}var xt=l(9e4),ht=l(81580),nt=l(67061),mr=l(60016),jt=l(95881);const gr=(0,ye.memo)(function(n){const{annotation:a,onAnnotationChange:i,history:o}=n;if(a===void 0||i===void 0)return null;const u=y=>{const P=(0,z.vV)(y).queryType===v.U3.Instant;i({...a,expr:y.expr,maxLines:y.maxLines,instant:P})},m={refId:"",expr:a.expr,maxLines:a.maxLines,instant:a.instant,queryType:a.queryType};return ye.createElement(nt.B,{gap:5,direction:"column"},ye.createElement(nt.B,{gap:0,direction:"column"},ye.createElement(jt.W,{datasource:n.datasource,query:m,onChange:u,onRunQuery:()=>{},history:o,ExtraFieldElement:ye.createElement(mr.kl,{lineLimitValue:m?.maxLines?.toString()||"",resolution:m.resolution||1,query:m,onRunQuery:()=>{},onChange:u})})),ye.createElement(xt.U,null,ye.createElement(ht.c,{label:"Title",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance."},ye.createElement(Rt.p,{type:"text",placeholder:"alertname",value:a.titleFormat,onChange:y=>{i({...a,titleFormat:y.currentTarget.value})}})),ye.createElement(ht.c,{label:"Tags"},ye.createElement(Rt.p,{type:"text",placeholder:"label1,label2",value:a.tagKeys,onChange:y=>{i({...a,tagKeys:y.currentTarget.value})}})),ye.createElement(ht.c,{label:"Text",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance."},ye.createElement(Rt.p,{type:"text",placeholder:"instance",value:a.textFormat,onChange:y=>{i({...a,textFormat:y.currentTarget.value})}}))))});var ar=l(20065);function Ya(g,n){if(n.length===0)return[];const a=[],{queryWithParser:i,parserCount:o}=(0,z.MX)(g);if(!i){const{hasLogfmt:y,hasJSON:P,hasPack:I}=(0,L.YB)(n[0]);P&&(I?a.push({type:"ADD_UNPACK_PARSER",label:"Selected log stream selector has packed logs.",fix:{title:"add unpack parser",label:"Consider using unpack parser.",action:{type:"ADD_UNPACK_PARSER",query:g}}}):a.push({type:"ADD_JSON_PARSER",label:"Selected log stream selector has JSON formatted logs.",fix:{title:"add json parser",label:"Consider using JSON parser.",action:{type:"ADD_JSON_PARSER",query:g}}})),y&&a.push({type:"ADD_LOGFMT_PARSER",label:"Selected log stream selector has logfmt formatted logs.",fix:{title:"add logfmt parser",label:"Consider using logfmt parser to turn key-value pairs in your log lines to labels.",action:{type:"ADD_LOGFMT_PARSER",query:g}}})}if(i){if(o===1){const P=(0,z.d_)(g);(0,L.db)(n[0])&&!P&&a.push({type:"ADD_NO_PIPELINE_ERROR",label:"Some logs in your selected log streams have parsing error.",fix:{title:"remove pipeline errors",label:"Consider filtering out logs with parsing errors.",action:{type:"ADD_NO_PIPELINE_ERROR",query:g}}})}(0,z.pS)(g)||a.push({type:"ADD_LABEL_FILTER",label:"Consider filtering logs by their label and value.",fix:{title:"add label filter",label:"",action:{type:"ADD_LABEL_FILTER",query:g}}})}if(!(0,z._i)(g)){const y=(0,L.Ac)(n[0]),P=(0,L.sz)(n[0]);!y&&P&&a.push({type:"ADD_LEVEL_LABEL_FORMAT",label:`Some logs in your selected log stream have "${P}" label.`,fix:{title:"add label level format",label:`If ${P} label has level values, consider using label_format to rename it to "level". Level label can be then visualized in log volumes.`,action:{type:"ADD_LEVEL_LABEL_FORMAT",query:g,options:{renameTo:"level",originalLabel:P}}}})}return(0,z.Rn)(g)||a.push({type:"ADD_LINE_FILTER",label:"Consider filtering logs for specific string.",fix:{title:"add line filter",label:"",action:{type:"ADD_LINE_FILTER",query:g}}}),a}var ia=l(62938),Rr=l(33948),Ja=l(52622),Fr=l(70416),wa=l(80822);function Za(g,n,a){if(n-g<=a)return[[g,n]];const i=[];for(let o=n;o>g;o-=a){const u=Math.max(o-a,g);i.push([u,o])}return i.reverse(),i}function qa(g,n,a,i){if(i<a)return[[g,n]];const o=Math.trunc(i/a)*a,u=g-g%a,m=[];for(let y=u;y<n;y+=o){const P=Math.min(y+o-a,n);m.push([y,P])}return m}var Ra=l(79007);function Fa(g,n,a,i){const o=n.from.toDate().getTime(),u=n.to.toDate().getTime();return(g?Za(o,u,i):qa(o,u,a,i)).map(([y,P])=>{const I=(0,yt.KQ)(y),Y=(0,yt.KQ)(P);return{from:I,to:Y,raw:{from:I,to:Y}}})}function en(g,n){return n?g.map(a=>{if(!a.maxLines||!(0,z.sI)(a.expr))return a;const i=n.data.find(u=>u.refId===a.refId);if(!i)return a;const o=a.maxLines-i.length;return{...a,maxLines:o<0?0:o}}).filter(a=>a.maxLines===void 0||a.maxLines>0):g}function tn(g,n){const a=n.length?n[0].request.queryGroupId:(0,ia.A)();let i={data:[],state:w.Gu.Streaming,key:a};const o=Math.max(...n.map(({partition:Y})=>Y.length)),u=n.filter(({partition:Y})=>Y.length===o)[0].partition;let m=!1,y=null;const P=(Y,Z,ae)=>{if(m){Y.complete();return}const se=()=>{i.state=w.Gu.Done,Y.next(i),Y.complete()},Ie=()=>{const{nextRequestN:et,nextRequestGroup:Ye}=hr(n,ae,Z);if(et>0&&Ye>=0){P(Y,et,Ye);return}se()},Fe=n[ae],ze=Fe.partition[Z-1],we=en(Fe.request.targets,i);if(!we.length){Ie();return}const Ze={...n[ae].request,range:ze,targets:we};Fe.request.requestId&&(Ze.requestId=`${Fe.request.requestId}_${Z}`),y=g.runQuery(Ze).subscribe({next:et=>{i=(0,wa.Wn)(i,et),i=Cr(i,Ze,u,Z),((i.errors??[]).length>0||i.error!=null)&&(m=!0)},complete:()=>{Y.next(i),Ie()},error:et=>{Y.error(et)}})};return new or.c(Y=>(P(Y,o,0),()=>{m=!0,y?.unsubscribe()}))}const Ca="loki-splitting-progress";function Cr(g,n,a,i){if((0,z.sI)(n.targets[0].expr)||(g.data=g.data.filter(u=>u.name!==Ca),i<=1))return g;const o=(0,Rr.I)([{time:a[0].from.valueOf(),timeEnd:a[i-2].to.valueOf(),isRegion:!0,color:"rgba(120, 120, 120, 0.1)"}]);return o.name=Ca,o.meta={dataTopic:Ja.QR.Annotations},g.data.push(o),g}function hr(g,n,a){for(let i=n+1;i<g.length;i++)if(g[i].partition[a-1])return{nextRequestGroup:i,nextRequestN:a};return{nextRequestGroup:g.findIndex(i=>i?.partition[a-1]!==void 0),nextRequestN:a-1}}function Ar(g){return g.queryType!==v.U3.Instant&&!(0,z.Cg)(g.expr)}function vr(g,n){const a=n.targets.filter(ae=>!ae.hide).filter(ae=>ae.expr),[i,o]=(0,Q.partition)(a,ae=>!Ar(ae)),[u,m]=(0,Q.partition)(o,ae=>(0,z.sI)(ae.expr));n.queryGroupId=(0,ia.A)();const y=24*60*60*1e3,P=(0,Q.groupBy)(u,ae=>ae.splitDuration?(0,Fr.WT)((0,Fr.E9)(ae.splitDuration)):y),I=(0,Q.groupBy)(m,ae=>ae.splitDuration?(0,Fr.WT)((0,Fr.E9)(ae.splitDuration)):y),Y=[];for(const[ae,se]of Object.entries(P)){const Ie=(0,Q.groupBy)(se,Fe=>Fe.resolution||1);for(const Fe in Ie)Y.push({request:{...n,targets:Ie[Fe]},partition:Fa(!0,n.range,n.intervalMs,Number(ae))})}for(const[ae,se]of Object.entries(I)){const Ie=(0,Q.groupBy)(se,Fe=>Dr(n.intervalMs,n.range,Fe.resolution||1,Fe.step));for(const Fe in Ie){const ze=Ie[Fe].map(we=>{const{maxLines:Ze,...et}=we;return et});Y.push({request:{...n,targets:ze},partition:Fa(!1,n.range,Number(Fe),Number(ae))})}}i.length&&Y.push({request:{...n,targets:i},partition:[n.range]});const Z=new Date;return tn(g,Y).pipe((0,be.M)(ae=>{ae.state===w.Gu.Done&&(0,Ra.uJ)(ae,Y,n,Z,{predefinedOperations:g.predefinedOperations})}))}function Dr(g,n,a,i){const o=/(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])/;if(i?.match(o))return me.intervalToMs(i)*a;const u=g*a,m=Math.round((n.to.valueOf()-n.from.valueOf())/11e3);return Math.max(u,m)}var Aa=l(56245),rn=l(72316),Da=l(9631),zt=l(55004),an=l(78731);async function zr(g){const n=JSON.stringify({expr:g.expr}),a=new TextEncoder().encode(n),i=await crypto.subtle.digest("SHA-1",a);return Array.from(new Uint8Array(i.slice(0,8))).map(u=>u.toString(16).padStart(2,"0")).join("")}function nr(g,n,a){const i=a.range,o=i.to.valueOf()-i.from.valueOf()+1e3;let u=a.maxDataPoints??1e3;u>100&&(u*=2);let m;const y=P=>{if(P?.message){const I=P.message;m?m.push(I):m=Da.k9.fromDataFrameJSON(I,{maxLength:u,maxDelta:o,displayNameFormat:g.legendFormat})}return m};return(0,rn.v)(()=>zr(g)).pipe((0,We.Z)(P=>(0,an.oF)().getStream({scope:zt.qD.DataSource,namespace:n.uid,path:`tail/${P}`,data:{...g,timeRange:{from:i.from.valueOf().toString(),to:i.to.valueOf().toString()}}}).pipe((0,de.T)(I=>{const Y=y(I);return{data:Y?[Y]:[],state:w.Gu.Streaming}}))))}const Kr=g=>{let a=`${window.location.protocol==="https:"?"wss://":"ws://"}${window.location.host}${te.$.appSubUrl}`;return a.endsWith("/")&&(a=a.slice(0,-1)),`${a}${g}`},Na=1e3,Lt=10,Or="/loki/api/v1",yr="loki-data-samples",oa="annotation-",la="log-row-context-query-",Ma="log-volume-",Ia="log-sample-",nn="log-stats-",ca=1e6;function br(g,n,a,i,o){const u=me.calculateInterval(n,1);return{targets:[g],requestId:i,interval:u.interval,intervalMs:u.intervalMs,range:n,scopedVars:{},timezone:"UTC",app:a,startTime:Date.now(),hideFromInspector:o}}class ua extends _e.iy{constructor(n,a=(0,$.w)()){super(n),this.instanceSettings=n,this.templateSrv=a,this.streams=new Ut,this.runLiveQuery=(o,u)=>{const m=this.createLiveTarget(o,u);return this.streams.getStream(m).pipe((0,de.T)(y=>({data:y||[],key:`loki-${m.refId}`,state:w.Gu.Streaming})),(0,E.W)(y=>(0,Ce.$)(()=>`Live tailing was stopped due to following error: ${y.reason}`)))},this.getLogRowContext=async(o,u,m)=>await this.logContextProvider.getLogRowContext(o,u,(0,z.sc)(m)),this.getLogRowContextQuery=async(o,u,m,y)=>await this.logContextProvider.getLogRowContextQuery(o,u,(0,z.sc)(m),y),this.languageProvider=new U(this);const i=n.jsonData||{};this.maxLines=parseInt(i.maxLines??"0",10)||Na,this.predefinedOperations=i.predefinedOperations??"",this.annotations={QueryEditor:gr},this.variables=new wt(this),this.logContextProvider=new Et(this)}getSupplementaryRequest(n,a,i){switch(n){case q.cF.LogsVolume:const o=i?.type===q.cF.LogsVolume?i:{type:n};return this.getLogsVolumeDataProvider(a,o);case q.cF.LogsSample:const u=i?.type===q.cF.LogsSample?i:{type:n};return this.getLogsSampleDataProvider(a,u);default:return}}getSupportedSupplementaryQueryTypes(){return[q.cF.LogsVolume,q.cF.LogsSample]}getSupplementaryQuery(n,a){const i=(0,z.vV)(a);let o=(0,Ge.Lv)(i.expr),u=!1;switch(n.type){case q.cF.LogsVolume:if(u=!!(o&&(0,z.sI)(o)&&i.queryType===v.U3.Range),!u)return;const m=`${o} | drop __error__`,y=n.field||"level";return(0,z.FV)(this.interpolateString(m,ar.a))===!1&&(o=m),{...i,refId:`${Ma}${i.refId}`,queryType:v.U3.Range,supportingQueryType:v.Q$.LogsVolume,expr:`sum by (${y}) (count_over_time(${o}[$__auto]))`,legendFormat:`{{ ${y} }}`};case q.cF.LogsSample:return u=!!(o&&!(0,z.sI)(o)),u?{...i,queryType:v.U3.Range,refId:`${Ia}${i.refId}`,expr:(0,z.OT)(o),maxLines:Number.isNaN(Number(n.limit))?this.maxLines:Number(n.limit)}:void 0;default:return}}getLogsVolumeDataProvider(n,a){const i=(0,Q.cloneDeep)(n),o=i.targets.map(u=>this.getSupplementaryQuery(a,u)).filter(u=>!!u);if(o.length)return{...i,targets:o}}getLogsSampleDataProvider(n,a){const i=(0,Q.cloneDeep)(n),o=i.targets.map(u=>this.getSupplementaryQuery({type:q.cF.LogsSample,limit:100},u)).filter(u=>!!u);if(o.length)return{...i,targets:o}}query(n){const a=n.targets.map(z.vV).map(m=>({...m,maxLines:m.maxLines??this.maxLines})),i={...n,targets:a},o=i.targets.filter(m=>m.queryType===v.U3.Stream);if(te.$.featureToggles.lokiExperimentalStreaming&&o.length>0&&i.rangeRaw?.to==="now"){const m={...i,targets:o};return(0,M.h)(...o.map(y=>nr(this.applyTemplateVariables(y,n.scopedVars,n.filters),this,m)))}if(i.liveStreaming)return this.runLiveQueryThroughBackend(i);if(te.$.featureToggles.lokiQuerySplitting&&(0,z.gy)(i.targets))return vr(this,i);const u=new Date;return this.runQuery(i).pipe((0,be.M)(m=>(0,Ra.Ex)(m,i,u,{predefinedOperations:this.predefinedOperations})))}runQuery(n){return super.query(n).pipe((0,de.T)(a=>gt(a,n.targets,this.instanceSettings.jsonData.derivedFields??[])))}runLiveQueryThroughBackend(n){const a=n.targets.filter(o=>o.expr!==""&&(0,z.sI)(o.expr));if(a.length===0)return(0,A.of)({data:[],state:w.Gu.Done});const i=a.map(o=>{const u=this.applyTemplateVariables(o,n.scopedVars,n.filters),m=u.maxLines||this.maxLines;return this.runLiveQuery(u,m)});return(0,M.h)(...i)}createLiveTarget(n,a){const i=n.expr,o=this.instanceSettings.url,u=xe.kM.serializeParams({query:i});return{query:i,url:Kr(`${o}/loki/api/v1/tail?${u}`),refId:n.refId,size:a}}interpolateVariablesInQueries(n,a,i){let o=n;return n&&n.length&&(o=n.map(u=>({...u,datasource:this.getRef(),expr:this.addAdHocFilters(this.templateSrv.replace(u.expr,a,this.interpolateQueryExpr),i)}))),o}getQueryDisplayText(n){return n.expr}getTimeRangeParams(n){return{start:n.from.valueOf()*ca,end:n.to.valueOf()*ca}}async importFromAbstractQueries(n){await this.languageProvider.start();const a=this.languageProvider.labelKeys;return a&&a.length&&(n=n.map(i=>(i.labelMatchers=i.labelMatchers.filter(o=>a.includes(o.name)),i))),n.map(i=>this.languageProvider.importFromAbstractQuery(i))}async exportToAbstractQueries(n){return n.map(a=>this.languageProvider.exportToAbstractQuery(a))}async metadataRequest(n,a,i){if(n.startsWith("/"))throw new Error(`invalid metadata request url: ${n}`);return(await this.getResource(n,a,i)).data||[]}async statsMetadataRequest(n,a,i){if(n.startsWith("/"))throw new Error(`invalid metadata request url: ${n}`);return await this.getResource(n,a,i)}async getQueryStats(n,a){if((0,z.FV)(this.interpolateString(n.expr,ar.a)))return;const i=(0,z.pk)(n.expr);let o={streams:0,chunks:0,bytes:0,entries:0};for(const u in i){const{start:m,end:y}=this.getStatsTimeRange(n,Number(u),a);if(m===void 0||y===void 0)return{streams:0,chunks:0,bytes:0,entries:0,message:"Query size estimate not available."};try{const P=await this.statsMetadataRequest("index/stats",{query:i[u],start:m,end:y},{showErrorAlert:!1,requestId:`${nn}${n.refId}`});o={streams:o.streams+P.streams,chunks:o.chunks+P.chunks,bytes:o.bytes+P.bytes,entries:o.entries+P.entries}}catch{break}}return o}getStatsTimeRange(n,a,i){let o,u;const P=(0,z.QH)(n.expr,[ve.dw]).map(I=>n.expr.substring(I.from,I.to));return(0,z.sI)(n.expr)?n.queryType===v.U3.Instant?{start:void 0,end:void 0}:this.getTimeRangeParams(i):n.queryType===v.U3.Instant?P[a]?(u=this.getTimeRangeParams(i).end,o=u-me.intervalToMs(P[a])*1e6,{start:o,end:u}):/(\$__auto|\$__range)/.test(n.expr)?this.getTimeRangeParams(i):{start:void 0,end:void 0}:this.getTimeRangeParams(i)}async getStats(n,a){if(!n.expr)return null;const i=await this.getQueryStats(n,a);return i?Object.values(i).every(o=>o===0)?null:i:null}async metricFindQuery(n,a){if(!n)return Promise.resolve([]);let i;return typeof n=="string"?i=this.parseStringToVariableQuery(this.interpolateString(n,a?.scopedVars)):i={...n,label:this.interpolateString(n.label||"",a?.scopedVars),stream:this.interpolateString(n.stream||"",a?.scopedVars)},i?await this.processMetricFindQuery(i,a?.range):Promise.resolve([])}async processMetricFindQuery(n,a){return n.type===v.ie.LabelNames?(await this.languageProvider.fetchLabels({timeRange:a})).map(u=>({text:u})):n.label?(await this.languageProvider.fetchLabelValues(n.label,{streamSelector:n.stream,timeRange:a})).map(o=>({text:o})):[]}parseStringToVariableQuery(n){const a="LokiVariableQueryEditor-VariableQuery";if(n.match(jr))return{type:v.ie.LabelNames,refId:a};const o=n.match(dr);if(o)return{type:v.ie.LabelValues,label:o[2],stream:o[1],refId:a}}async getDataSamples(n,a){if(!(0,z.sI)(n.expr)||(0,z.FV)(this.interpolateString(n.expr,ar.a)))return[];const i={expr:n.expr,queryType:v.U3.Range,refId:yr,maxLines:n.maxLines||Lt,supportingQueryType:v.Q$.DataSample},o=br(i,a,S.Jk.Unknown,yr,!0);return await(0,r.s)(this.query(o).pipe((0,V.n)(u=>(0,A.of)(u.data))))}async getTagKeys(n){return(await this.languageProvider.fetchLabels({timeRange:n?.timeRange})).map(i=>({text:i}))}async getTagValues(n){return(await this.languageProvider.fetchLabelValues(n.key,{timeRange:n.timeRange})).map(i=>({text:i}))}interpolateQueryExpr(n,a){return!a.multi&&!a.includeAll?Kt(n):typeof n=="string"?da(n):(0,Q.map)(n,da).join("|")}toggleQueryFilter(n,a){let i=n.expr??"";const o=(0,K.Ed)(a.options.key,a.frame,0);switch(a.type){case"FILTER_FOR":{if(a.options?.key&&a.options?.value){const u=(0,K.Bb)(a.options.value);i=(0,Ge.je)(i,a.options.key,"=",u)?(0,Ge.FN)(i,a.options.key,"=",u):(0,Ge.tE)(i,a.options.key,"=",u,o)}break}case"FILTER_OUT":{if(a.options?.key&&a.options?.value){const u=(0,K.Bb)(a.options.value);(0,Ge.je)(i,a.options.key,"=",u)&&(i=(0,Ge.FN)(i,a.options.key,"=",u)),i=(0,Ge.tE)(i,a.options.key,"!=",u,o)}break}default:break}return{...n,expr:i}}queryHasFilter(n,a){let i=n.expr??"";return(0,Ge.je)(i,a.key,"=",a.value)}modifyQuery(n,a){let i=n.expr??"";switch(a.type){case"ADD_FILTER":{if(a.options?.key&&a.options?.value){const o=(0,K.Ed)(a.options.key,a.frame,0),u=(0,K.Bb)(a.options.value);i=(0,Ge.tE)(i,a.options.key,"=",u,o)}break}case"ADD_FILTER_OUT":{if(a.options?.key&&a.options?.value){const o=(0,K.Ed)(a.options.key,a.frame,0),u=(0,K.Bb)(a.options.value);i=(0,Ge.tE)(i,a.options.key,"!=",u,o)}break}case"ADD_LOGFMT_PARSER":{i=(0,Ge.aH)(i,"logfmt");break}case"ADD_JSON_PARSER":{i=(0,Ge.aH)(i,"json");break}case"ADD_UNPACK_PARSER":{i=(0,Ge.aH)(i,"unpack");break}case"ADD_NO_PIPELINE_ERROR":{i=(0,Ge.yI)(i);break}case"ADD_LEVEL_LABEL_FORMAT":{a.options?.originalLabel&&a.options?.renameTo&&(i=(0,Ge.o9)(i,{renameTo:a.options.renameTo,originalLabel:a.options.originalLabel}));break}case"ADD_LABEL_FILTER":{const o=(0,Ge.cH)(n.expr),u=(0,Ge.lN)(n.expr),m=(0,Ge.lq)([...o,...u]),y=(0,Ge.i6)("","","=");i=(0,Ge.cQ)(i,[m],y);break}case"ADD_STRING_FILTER":case"ADD_LINE_FILTER":{i=(0,Ge.OS)(i,a.options?.value);break}case"ADD_STRING_FILTER_OUT":case"ADD_LINE_FILTER_OUT":{i=(0,Ge.OS)(i,a.options?.value,"!=");break}default:break}return{...n,expr:i}}getSupportedQueryModifications(){return["ADD_FILTER","ADD_FILTER_OUT","ADD_LOGFMT_PARSER","ADD_JSON_PARSER","ADD_UNPACK_PARSER","ADD_NO_PIPELINE_ERROR","ADD_LEVEL_LABEL_FORMAT","ADD_LABEL_FILTER","ADD_STRING_FILTER","ADD_STRING_FILTER_OUT"]}getLogRowContextUi(n,a,i){return this.logContextProvider.getLogRowContextUi(n,a,(0,z.sc)(i))}async annotationQuery(n){const{expr:a,maxLines:i,instant:o,tagKeys:u="",titleFormat:m="",textFormat:y=""}=n.annotation;if(!a)return[];const P=`${oa}${n.annotation.name}`,I={refId:P,expr:a,maxLines:i,instant:o,queryType:o?v.U3.Instant:v.U3.Range},Y=br(I,n.range,S.Jk.Dashboard,P),{data:Z}=await(0,r.s)(this.query(Y)),ae=[],se=u.split(",").filter(Ie=>Ie!=="");for(const Ie of Z)new ke.R(Ie).forEach(ze=>{const{labels:we}=ze,Ze=Object.entries(we).map(([Ye,ot])=>[Ye,ot.trim()]).filter(([Ye,ot])=>!(ot===""||se.length&&!se.includes(Ye))).map(([Ye,ot])=>ot),et=Array.from(new Set(Ze));ae.push({time:new Date(ze.Time).valueOf(),title:(0,Se.j)(m,we),text:(0,Se.j)(y,we)||ze.Line,tags:et})});return ae}addAdHocFilters(n,a){if(!a)return n;let i=(0,Aa.qk)(n);return i=a.reduce((o,u)=>{const{key:m,operator:y}=u;let{value:P}=u;return(0,K.N4)(y)?P=Kt(P):P=(0,K.Bb)(P,y),(0,Ge.tE)(o,m,y,P)},i),(0,Aa.If)(i)}filterQuery(n){return!(n.hide||n.expr==="")}applyTemplateVariables(n,a,i){const{__auto:o,__interval:u,__interval_ms:m,__range:y,__range_s:P,__range_ms:I,...Y}=a||{},Z={...Y,__interval:{value:"$__interval"},__interval_ms:{value:"$__interval_ms"}},ae=this.addAdHocFilters(this.templateSrv.replace(n.expr,Z,this.interpolateQueryExpr),i);return{...n,legendFormat:this.templateSrv.replace(n.legendFormat,Y),expr:ae}}interpolateString(n,a){return this.templateSrv.replace(n,a,this.interpolateQueryExpr)}getVariables(){return this.templateSrv.getVariables().map(n=>`$${n.name}`)}getQueryHints(n,a){return Ya(n.expr,a)}getDefaultQuery(n){const a={refId:"A",expr:""};return n===S.Jk.UnifiedAlerting?{...a,queryType:v.U3.Instant}:{...a,queryType:v.U3.Range}}}function Kt(g){return typeof g=="string"?g.replace(/'/g,"\\\\'"):g}function da(g){return typeof g=="string"?Kt(g.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]+?.()|]/g,"\\\\$&")):g}},97535:(lt,Be,l)=>{"use strict";l.d(Be,{Bb:()=>xe,Cs:()=>q,Ed:()=>Se,N4:()=>S,P7:()=>te,Qn:()=>me,WV:()=>E,qv:()=>w,sM:()=>_e,tY:()=>ke,tt:()=>$});var Q=l(2543),Ce=l.n(Q),M=l(73372),A=l(65650);function r(fe){return de(fe/1e3)}function de(fe){return Math.floor(fe/60)}function E(fe,Ae){if(fe&&Ae){const B=r(fe.from.valueOf())===r(Ae.from.valueOf()),$e=r(fe.to.valueOf())===r(Ae.to.valueOf());return!(B&&$e)}return!1}const be=/[*+?()|\\.\[\]{}^$]/g;function V(fe){return fe.replace(be,"\\$&")}function me(fe){return fe.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function w(fe){return fe.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function q(fe){return me(V(fe))}function xe(fe,Ae){return S(Ae)?q(fe):me(fe)}function S(fe){return!!(fe&&(fe.includes("=~")||fe.includes("!~")))}function ke(fe){const Ae=["b","kib","Kib","kb","KB","mib","Mib","mb","MB","gib","Gib","gb","GB","tib","Tib","tb","TB","pib","Pib","pb","PB","eib","Eib","eb","EB"],B=new RegExp(`^(?:-?\\d+(?:\\.\\d+)?)(?:${Ae.join("|")})$`);return!!fe.match(B)}function Se(fe,Ae,B){if(!Ae||B===void 0)return null;const $e=Ae.fields.find(Qe=>Qe.name==="labelTypes")?.values[B];if(!$e)return null;switch($e[fe]){case"I":return A.HD.Indexed;case"S":return A.HD.StructuredMetadata;case"P":return A.HD.Parsed;default:return null}}const ve={[M.D_.Equal]:"=",[M.D_.NotEqual]:"!=",[M.D_.EqualRegEx]:"=~",[M.D_.NotEqualRegEx]:"!~"},_e=(0,Q.invert)(ve);function $(fe){const Ae=fe.labelMatchers.map(B=>{const $e=ve[B.operator];return $e?`${B.name}${$e}"${B.value}"`:""}).filter(B=>B!=="").join(", ");return Ae?`{${Ae}}`:""}function te(fe){const Ae={};fe.forEach($e=>{Object.keys($e).forEach(Qe=>{Ae[Qe]||(Ae[Qe]=new Set),Ae[Qe].has($e[Qe])||Ae[Qe].add($e[Qe])})});const B={};return Re(Object.keys(Ae)).forEach($e=>{B[$e]=Re(Array.from(Ae[$e]))}),{values:B,keys:Object.keys(B)}}const Oe=1e4;function Re(fe){return fe.slice(0,Oe)}},12798:(lt,Be,l)=>{"use strict";l.d(Be,{Ch:()=>V,FN:()=>w,Lv:()=>te,OS:()=>_,aH:()=>ve,cH:()=>Re,cQ:()=>Je,i6:()=>$e,je:()=>me,lN:()=>fe,lq:()=>T,o9:()=>$,tE:()=>ke,yB:()=>Oe,yI:()=>_e});var Q=l(2543),Ce=l.n(Q),M=l(36195),A=l(97535),r=l(56587),de=l(43548),E=l(60706),be=l(65650);class V{constructor(L,v,C){this.from=L,this.to=v,this.type=C}static fromNode(L){return new V(L.from,L.to,L.type)}contains(L){return this.from<=L.from&&this.to>=L.to}getExpression(L){return L.substring(this.from,this.to)}}function me(p,L,v,C){return S(p,L,v,C).length>0}function w(p,L,v,C){const X=S(p,L,v,C);for(const U of X)p=U.parent?.type.id===M.bY?q(p,U):xe(p,U);return p}function q(p,L){const v=L.parent?.parent;return!v||v.type.id!==M.t3?p:(p.substring(0,v.from)+p.substring(v.to)).trim()}function xe(p,L){let v=L;do v=v.parent;while(v&&v.type.id!==M.MD);const C=L.getChild(M.gw);if(!v||!C)return p;const X=p.substring(C.from,C.to),U=p.substring(0,v.from),Pe=p.substring(v.to),Te=(0,E.u_)(p.substring(v.from,v.to));return Te.query.labels=Te.query.labels.filter(We=>We.label!==X),U+de.y.renderQuery(Te.query)+Pe}function S(p,L,v,C){const X=M.K3.parse(p),U=[];return X.iterate({enter:({type:Pe,node:Te})=>{Pe.id===M.g$&&U.push(Te)}}),U.filter(Pe=>{const Te=Pe.getChild(M.gw),We=Te?.nextSibling,je=Pe.getChild(M.Qf);if(!Te||!We||!je||p.substring(Te.from,Te.to)!==L)return!1;const vt=p.substring(je.from,je.to);return!((0,E.w4)(vt)!==(0,A.qv)(C)||p.substring(We.from,We.to)!==v)})}function ke(p,L,v,C,X){if(!L||!C)throw new Error("Need label to add to query.");const U=Oe(p);if(!U.length)return p;const Pe=Re(p),Te=fe(p),We=z(p),je=(0,r.TQ)(p,[M.J_]),ut=U.every(Xt=>We.some(or=>or.from>=Xt.from&&or.to<=Xt.to)),vt=$e(L,C,v);if(X===be.HD.Parsed||X===be.HD.StructuredMetadata){const Xt=Se(p,[...U,...Te,...Pe,...je]);return Je(p,Xt,vt)}else{if(X===be.HD.Indexed)return Qe(p,U,vt);if(Pe.length===0||ut===!1)return Qe(p,U,vt);{const Xt=Se(p,[...Pe,...Te,...je]);return Je(p,Xt,vt)}}}function Se(p,L){const v=F((0,r.TQ)(p,[M.GN])),C=[...L];return v.map(U=>T(C.filter(Pe=>U.contains(Pe))))}function ve(p,L){const v=Ae(p);if(v.length)return He(p,v,L);{const C=Oe(p);return C.length?He(p,C,L):p}}function _e(p){const L=Re(p);if(!L.length)return p;const v=$e("__error__","","=");return Je(p,L,v)}function $(p,L){const v=B(p);return N(p,v,L)}function te(p){const L=ee(p);if(!L.length)return p;let v="",C=0;for(let X of L)v=v+p.substring(C,X.from),C=X.to;return v=v+p.substring(C),v}function Oe(p){const L=M.K3.parse(p),v=[];return L.iterate({enter:({type:C,node:X})=>{if(C.id===M.MD)return v.push(V.fromNode(X)),!1}}),v}function Re(p){const L=M.K3.parse(p),v=[],C=[M.iT,M.eF,M.Zj,M.Tz];return L.iterate({enter:({type:X,node:U})=>{if(C.includes(X.id))return v.push(V.fromNode(U)),!1}}),v}function fe(p){const L=M.K3.parse(p),v=[];return L.iterate({enter:({type:C,node:X})=>{if(C.id===M.bY)return v.push(V.fromNode(X)),!1}}),v}function Ae(p){const L=M.K3.parse(p),v=[];return L.iterate({enter:({type:C,node:X})=>{if(C.id===M.CX)return v.push(V.fromNode(X)),!1}}),v}function B(p){const L=M.K3.parse(p),v=[];return L.iterate({enter:({type:C,node:X})=>{if(C.id===M.UK)return v.push(V.fromNode(X)),!1;if(C.id===M.xo){const U=[],Pe=X.getChild(M.MD);Pe&&U.push(V.fromNode(Pe));const Te=X.getChild(M.AL);Te&&U.push(V.fromNode(Te));const We=X.getChild(M.HV);We&&U.push(V.fromNode(We));const je=(0,Q.sortBy)(U,ut=>ut.to);return v.push(new V(je[0].from,je[je.length-1].to)),!1}}}),v}function $e(p,L,v){return{label:p,op:v,value:L}}function Qe(p,L,v){let C="",X=0;for(let U=0;U<L.length;U++){const Pe=L[U],Te=U===L.length-1,We=p.substring(X,Pe.from),je=Te?p.substring(Pe.to):"",ut=(0,E.u_)(p.substring(Pe.from,Pe.to));ue(ut.query.labels,v)||ut.query.labels.push(v);const vt=de.y.renderQuery(ut.query);C+=We+vt+je,X=Pe.to}return C}function Je(p,L,v){let C="",X=0;for(let U=0;U<L.length;U++){const Pe=L[U],Te=U===L.length-1,We=p.substring(X,Pe.to),je=Te?p.substring(Pe.to):"";let ut="";!Number.isNaN(Number(v.value))&&(v.op==="<"||v.op===">")?ut=` | ${v.label}${v.op}${Number(v.value)}`:ut=` | ${v.label}${v.op}\`${(0,A.qv)(v.value)}\``,C+=We+ut+je,X=Pe.to}return C}function He(p,L,v){let C="",X=0;for(let U=0;U<L.length;U++){const Pe=L[U],Te=U===L.length-1,We=p.substring(X,Pe.to),je=Te?p.substring(Pe.to):"";C+=We+` | ${v}`+je,X=Pe.to}return C}function N(p,L,v){let C="",X=0;for(let U=0;U<L.length;U++){const Pe=L[U],Te=U===L.length-1,We=p.substring(X,Pe.to),je=Te?p.substring(Pe.to):"",ut=` | label_format ${v.renameTo}=${v.originalLabel}`;C+=We+ut+je,X=Pe.to}return C}function _(p,L="",v="|="){const C=Oe(p);if(!C.length)return p;const X=C[0].to;return p.slice(0,X)+` ${v} \`${L}\``+p.slice(X)}function ee(p){const L=M.K3.parse(p),v=[];return L.iterate({enter:({type:C,from:X,to:U})=>{if(C.id===M.uk)return v.push(new V(X,U,C)),!1}}),v}function ue(p,L){return p.find(v=>v.label===L.label&&v.value===L.value)}function T(p){return p.length?p.reduce((L,v)=>L.to>v.to?L:v):new V(0,0)}function F(p){return p.filter(L=>p.every(v=>L.contains(v)===!1||L===v))}function K(p,L){if(p.type.id===L)return[V.fromNode(p)];const v=[];let C=0,X=p.childAfter(C);for(;X;)v.push(...K(X,L)),C=X.to,X=p.childAfter(C);return v}function z(p){const L=M.K3.parse(p),v=[];return L.iterate({enter:({node:C})=>{C.type.id===M.MD&&v.push(...K(C,M.g$))}}),v}},24684:(lt,Be,l)=>{"use strict";l.r(Be),l.d(Be,{plugin:()=>Ro});var Q=l(40187),Ce=l(69129),M=l(3591),A=l(2543),r=l(96540),de=l(14110),E=l(97535);const be=['{job="default/prometheus"}'],V=["job","app","k8s_app"],me=5,w=[{title:"Log pipeline",expression:'{job="mysql"} |= "metrics" | logfmt | duration > 10s',label:'This query targets the MySQL job, keeps logs that contain the substring "metrics", and then parses and filters the logs further.'},{title:"Count over time",expression:'count_over_time({job="mysql"}[5m])',label:"This query counts all the log lines within the last five minutes for the MySQL job."},{title:"Rate",expression:'rate(({job="mysql"} |= "error" != "timeout")[10s])',label:"This query gets the per-second rate of all non-timeout errors within the last ten seconds for the MySQL job."},{title:"Aggregate, count, and group",expression:'sum(count_over_time({job="mysql"}[5m])) by (level)',label:"Get the count of logs during the last five minutes, grouping by level."}];class q extends r.PureComponent{constructor(){super(...arguments),this.state={userExamples:[]},this.checkUserLabels=async()=>{const t=this.props.datasource?.languageProvider;if(t.started){const s=t.getLabelKeys()||[],c=V.find(d=>s.includes(d));if(c){const d=await t.fetchLabelValues(c),f=(0,A.shuffle)(d).slice(0,me).map(b=>`{${c}="${(0,E.Qn)(b)}"}`);this.setState({userExamples:f})}}else this.scheduleUserLabelChecking()}}componentDidMount(){this.scheduleUserLabelChecking(),(0,de.rR)("grafana_loki_cheatsheet_opened",{})}componentWillUnmount(){clearTimeout(this.userLabelTimer)}scheduleUserLabelChecking(){this.userLabelTimer=setTimeout(this.checkUserLabels,1e3)}renderExpression(t){const{onClickExample:s}=this.props,c=d=>{s(d),(0,de.rR)("grafana_loki_cheatsheet_example_clicked",{})};return r.createElement("button",{type:"button",className:"cheat-sheet-item__example",key:t,onClick:()=>c({refId:"A",expr:t})},r.createElement("code",null,t))}render(){const{userExamples:t}=this.state,s=t.length>0;return r.createElement("div",null,r.createElement("h2",null,"Loki Cheat Sheet"),r.createElement("div",{className:"cheat-sheet-item"},r.createElement("div",{className:"cheat-sheet-item__title"},"See your logs"),r.createElement("div",{className:"cheat-sheet-item__label"},"Start by selecting a log stream from the Label browser, or alternatively you can write a stream selector into the query field."),s?r.createElement("div",null,r.createElement("div",{className:"cheat-sheet-item__label"},"Here are some example streams from your logs:"),t.map(c=>this.renderExpression(c))):r.createElement("div",null,r.createElement("div",{className:"cheat-sheet-item__label"},"Here is an example of a log stream:"),this.renderExpression(be[0]))),r.createElement("div",{className:"cheat-sheet-item"},r.createElement("div",{className:"cheat-sheet-item__title"},"Combine stream selectors"),this.renderExpression('{app="cassandra",namespace="prod"}'),r.createElement("div",{className:"cheat-sheet-item__label"},"Returns all log lines from streams that have both labels.")),r.createElement("div",{className:"cheat-sheet-item"},r.createElement("div",{className:"cheat-sheet-item__title"},"Filtering for search terms."),this.renderExpression('{app="cassandra"} |~ "(duration|latency)s*(=|is|of)s*[d.]+"'),this.renderExpression('{app="cassandra"} |= "exact match"'),this.renderExpression('{app="cassandra"} != "do not match"'),r.createElement("div",{className:"cheat-sheet-item__label"},r.createElement("a",{href:"https://grafana.com/docs/loki/latest/logql/#log-pipeline",target:"logql"},"LogQL")," ","supports exact and regular expression filters.")),w.map(c=>r.createElement("div",{className:"cheat-sheet-item",key:c.expression},r.createElement("div",{className:"cheat-sheet-item__title"},c.title),this.renderExpression(c.expression),r.createElement("div",{className:"cheat-sheet-item__label"},c.label))))}}var xe=l(41987),S=l(84596),ke=l(39070),Se=l(13544),ve=l(42952),_e=l(6191),$=l(32196),te=l(40845),Oe=l(15292),Re=l(46819),fe=Object.defineProperty,Ae=Object.defineProperties,B=Object.getOwnPropertyDescriptors,$e=Object.getOwnPropertySymbols,Qe=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,He=(e,t,s)=>t in e?fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,N=(e,t)=>{for(var s in t||(t={}))Qe.call(t,s)&&He(e,s,t[s]);if($e)for(var s of $e(t))Je.call(t,s)&&He(e,s,t[s]);return e},_=(e,t)=>Ae(e,B(t)),ee=(e,t)=>{var s={};for(var c in e)Qe.call(e,c)&&t.indexOf(c)<0&&(s[c]=e[c]);if(e!=null&&$e)for(var c of $e(e))t.indexOf(c)<0&&Je.call(e,c)&&(s[c]=e[c]);return s};function ue(e){var t=e,{label:s}=t,c=ee(t,["label"]);const d=s.replace(" ","-"),f=(0,r.useRef)((0,A.uniqueId)(`switch-${d}`)),b=(0,te.of)(T);return r.createElement(Re.B,{gap:1},r.createElement("label",{htmlFor:f.current,className:b.switchLabel},s),r.createElement(Oe.d,_(N({},c),{id:f.current})))}const T=e=>({switchLabel:(0,$.css)({color:e.colors.text.secondary,cursor:"pointer",fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.text.primary}})});var F=l(31347),K=l(94354);const z=[{label:"Builder",value:ve.f.Builder},{label:"Code",value:ve.f.Code}];function p({mode:e,onChange:t}){return r.createElement("div",{"data-testid":"QueryEditorModeToggle"},r.createElement(K.z,{options:z,size:"sm",value:e,onChange:t}))}var L=l(71087),v=l(32264),C=l(96374),X=l(67061),U=l(55852),Pe=l(68402);class Te{get(t){return window.localStorage[t]}set(t,s){window.localStorage[t]=s}getBool(t,s){return s!==void 0&&!this.exists(t)?s:window.localStorage[t]==="true"}getObject(t,s){let c=s;if(this.exists(t)){const d=window.localStorage[t];try{c=JSON.parse(d)}catch(f){console.error(`Error parsing store object: ${t}. Returning default: ${s}. [${f}]`)}}return c}setObject(t,s){let c;try{c=JSON.stringify(s)}catch(d){throw new Error(`Could not stringify object: ${t}. [${d}]`)}try{this.set(t,c)}catch(d){const f=new Error(`Could not save item in localStorage: ${t}. [${d}]`);throw d instanceof Error&&(f.name=d.name),f}return!0}exists(t){return window.localStorage[t]!==void 0}delete(t){window.localStorage.removeItem(t)}}const We=new Te,je=e=>{const{children:t,storageKey:s,defaultValue:c}=e,[d,f]=(0,r.useState)({value:We.getObject(e.storageKey,e.defaultValue)});(0,r.useEffect)(()=>{const h=x=>{x.key===s&&f({value:We.getObject(e.storageKey,e.defaultValue)})};return window.addEventListener("storage",h),()=>{window.removeEventListener("storage",h)}});const b=h=>{try{We.setObject(s,h)}catch(x){console.error(x)}f({value:h})},O=()=>{try{We.delete(s)}catch(h){console.log(h)}f({value:c})};return r.createElement(r.Fragment,null,t(d.value,b,O))};var ut=l(37390),vt=l(39558),Xt=l(91793),or=l(9830),Xr=l(60029),Lr=l(54438),lr=l(10354);const Ur=1e3,Br=1e4,Ba=4,Zr="{}";function it(e){const t=[];for(const s of e)if(s.selected&&s.values&&s.values.length>0){const c=s.values.filter(d=>d.selected).map(d=>d.name);c.length>1?t.push(`${s.name}=~"${c.map(E.Cs).join("|")}"`):c.length===1&&t.push(`${s.name}="${(0,E.Qn)(c[0])}"`)}return["{",t.join(","),"}"].join("")}function ha(e,t,s){return e.map(c=>{const d=t[c.name];if(d){let f;if(c.name===s&&c.values)f=c.values;else{const b=new Set(c.values?.filter(O=>O.selected).map(O=>O.name)||[]);f=d.map(O=>({name:O,selected:b.has(O)}))}return{...c,loading:!1,values:f,facets:f.length}}return{...c,loading:!1,hidden:!d,values:void 0,facets:0}})}const Wa=e=>({wrapper:(0,$.css)`
    background-color: ${e.colors.background.secondary};
    width: 100%;
  `,wrapperPadding:(0,$.css)`
    padding: ${e.spacing(2)};
  `,list:(0,$.css)`
    margin-top: ${e.spacing(1)};
    display: flex;
    flex-wrap: wrap;
    max-height: 200px;
    overflow: auto;
  `,section:(0,$.css)`
    & + & {
      margin: ${e.spacing(2,0)};
    }

    position: relative;
  `,footerSectionStyles:(0,$.css)`
    padding: ${e.spacing(1)};
    background-color: ${e.colors.background.primary};
    position: sticky;
    bottom: -${e.spacing(3)}; /* offset the padding on modal */
    left: 0;
  `,selector:(0,$.css)`
    font-family: ${e.typography.fontFamilyMonospace};
    margin-bottom: ${e.spacing(1)};
    width: 100%;
  `,status:(0,$.css)`
    margin-bottom: ${e.spacing(1)};
    color: ${e.colors.text.secondary};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: opacity 100ms linear;
    opacity: 0;
    font-size: ${e.typography.bodySmall.fontSize};
    height: calc(${e.typography.bodySmall.fontSize} + 10px);
  `,statusShowing:(0,$.css)`
    opacity: 1;
  `,error:(0,$.css)`
    color: ${e.colors.error.main};
  `,valueList:(0,$.css)`
    margin-right: ${e.spacing(1)};
    resize: horizontal;
  `,valueListWrapper:(0,$.css)`
    border-left: 1px solid ${e.colors.border.medium};
    margin: ${e.spacing(1,0)};
    padding: ${e.spacing(1,0,1,1)};
  `,valueListArea:(0,$.css)`
    display: flex;
    flex-wrap: wrap;
    margin-top: ${e.spacing(1)};
  `,valueTitle:(0,$.css)`
    margin-left: -${e.spacing(.5)};
    margin-bottom: ${e.spacing(1)};
  `,validationStatus:(0,$.css)`
    padding: ${e.spacing(.5)};
    margin-bottom: ${e.spacing(1)};
    color: ${e.colors.text.maxContrast};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  `});class _a extends r.Component{constructor(){super(...arguments),this.state={labels:[],searchTerm:"",status:"Ready",error:"",validationStatus:""},this.onChangeSearch=t=>{this.setState({searchTerm:t.target.value})},this.onClickRunLogsQuery=()=>{(0,de.rR)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsButton"});const t=it(this.state.labels);this.props.onChange(t)},this.onClickRunMetricsQuery=()=>{(0,de.rR)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsRateButton"});const s=`rate(${it(this.state.labels)}[$__auto])`;this.props.onChange(s)},this.onClickClear=()=>{this.setState(t=>({labels:t.labels.map(c=>({...c,values:void 0,selected:!1,loading:!1,hidden:!1,facets:void 0})),searchTerm:"",status:"",error:"",validationStatus:""})),this.props.deleteLastUsedLabels()},this.onClickLabel=(t,s,c)=>{const d=this.state.labels.find(O=>O.name===t);if(!d)return;const f=!d.selected;let b={selected:f};if(d.values&&!f){const O=d.values.map(h=>({...h,selected:!1}));b={...b,facets:0,values:O}}this.setState({searchTerm:""}),this.updateLabelState(t,b,"",()=>this.doFacettingForLabel(t))},this.onClickValue=(t,s,c)=>{const d=this.state.labels.find(b=>b.name===t);if(!d||!d.values)return;this.setState({searchTerm:""});const f=d.values.map(b=>({...b,selected:b.name===s?!b.selected:b.selected}));this.updateLabelState(t,{values:f},"",()=>this.doFacetting(t))},this.onClickValidate=()=>{const t=it(this.state.labels);this.validateSelector(t)},this.doFacetting=t=>{const s=it(this.state.labels);if(s===Zr){const c=this.state.labels.map(d=>({...d,facets:0,values:void 0,hidden:!1}));this.setState({labels:c},()=>{this.state.labels.forEach(d=>d.selected&&this.fetchValues(d.name,s))})}else this.fetchSeries(s,t)}}updateLabelState(t,s,c="",d){this.setState(f=>{const b=f.labels.map(h=>h.name===t?{...h,...s}:h),O=c?"":f.error;return{labels:b,status:c,error:O,validationStatus:""}},d)}componentDidMount(){const{languageProvider:t,autoSelect:s=Ba,lastUsedLabels:c,timeRange:d}=this.props;if(t){const f=c;t.start(d).then(()=>{let b=t.getLabelKeys();if(b.length>Ur){const h=`Too many labels found (showing only ${Ur} of ${b.length})`;b=b.slice(0,Ur),this.setState({error:h})}const O=b.map((h,x,D)=>({name:h,selected:D.length<=s&&f.length===0||f.includes(h),loading:!1}));this.setState({labels:O},()=>{this.state.labels.forEach(h=>{h.selected&&this.fetchValues(h.name,Zr)})})})}}doFacettingForLabel(t){const s=this.state.labels.find(d=>d.name===t);if(!s)return;const c=this.state.labels.filter(d=>d.selected).map(d=>d.name);this.props.storeLastUsedLabels(c),s.selected?s.values||this.fetchValues(t,it(this.state.labels)):this.doFacetting()}async fetchValues(t,s){const{languageProvider:c,timeRange:d}=this.props;this.updateLabelState(t,{loading:!0},`Fetching values for ${t}`);try{let f=await c.fetchLabelValues(t,{timeRange:d});if(s!==it(this.state.labels)){this.updateLabelState(t,{loading:!1},"");return}if(f.length>Br){const O=`Too many values for ${t} (showing only ${Br} of ${f.length})`;f=f.slice(0,Br),this.setState({error:O})}const b=f.map(O=>({name:O}));this.updateLabelState(t,{values:b,loading:!1})}catch(f){console.error(f)}}async fetchSeries(t,s){const{languageProvider:c,timeRange:d}=this.props;s&&this.updateLabelState(s,{loading:!0},`Loading labels for ${t}`);try{const f=await c.fetchSeriesLabels(t,{timeRange:d});if(t!==it(this.state.labels)){s&&this.updateLabelState(s,{loading:!1});return}if(Object.keys(f).length===0){this.setState({error:`Empty results, no matching label for ${t}`});return}const b=ha(this.state.labels,f,s);this.setState({labels:b,error:""}),s&&this.updateLabelState(s,{loading:!1})}catch(f){console.error(f)}}async validateSelector(t){const{languageProvider:s,timeRange:c}=this.props;this.setState({validationStatus:`Validating selector ${t}`,error:""});const d=await s.fetchSeries(t,{timeRange:c});this.setState({validationStatus:`Selector is valid (${d.length} streams found)`})}render(){const{theme:t}=this.props,{labels:s,searchTerm:c,status:d,error:f,validationStatus:b}=this.state;if(s.length===0)return r.createElement(vt._,{text:"Loading labels..."});const O=Wa(t),h=it(this.state.labels),x=h===Zr;let D=s.filter(R=>R.selected&&R.values);return c?D=D.map(R=>{const G=R.values.filter(j=>{if(j.selected)return j.highlightParts=void 0,!0;const Ee=(0,or.I)(j.name.toLowerCase(),c.toLowerCase());return Ee.found?(j.highlightParts=Ee.ranges,j.order=Ee.distance,!0):!1});return{...R,values:(0,A.sortBy)(G,j=>j.selected?-1/0:j.order)}}):D=this.state.labels.filter(R=>R.selected&&R.values).map(R=>({...R,values:R?.values?R.values.map(G=>({...G,highlightParts:void 0})):[]})),r.createElement(r.Fragment,null,r.createElement("div",{className:O.wrapper},r.createElement("div",{className:(0,$.cx)(O.section,O.wrapperPadding)},r.createElement(Xr.J,{description:"Which labels would you like to consider for your search?"},"1. Select labels to search in"),r.createElement("div",{className:O.list},s.map(R=>r.createElement(Lr.J,{key:R.name,name:R.name,loading:R.loading,active:R.selected,hidden:R.hidden,facets:R.facets,onClick:this.onClickLabel})))),r.createElement("div",{className:(0,$.cx)(O.section,O.wrapperPadding)},r.createElement(Xr.J,{description:"Choose the label values that you would like to use for the query. Use the search field to find values across selected labels."},"2. Find values for the selected labels"),r.createElement("div",null,r.createElement(lr.p,{onChange:this.onChangeSearch,"aria-label":"Filter expression for values",value:c,placeholder:"Enter a label value"})),r.createElement("div",{className:O.valueListArea},D.map(R=>r.createElement("div",{role:"list",key:R.name,className:O.valueListWrapper},r.createElement("div",{className:O.valueTitle,"aria-label":`Values for ${R.name}`},r.createElement(Lr.J,{name:R.name,loading:R.loading,active:R.selected,hidden:R.hidden,facets:R.facets||R.values?.length,onClick:this.onClickLabel})),r.createElement(Xt.Y1,{height:200,itemCount:R.values?.length||0,itemSize:28,itemKey:G=>R.values?.[G].name??G,width:200,className:O.valueList},({index:G,style:j})=>{const Ee=R.values?.[G];return Ee?r.createElement("div",{style:j},r.createElement(Lr.J,{name:R.name,value:Ee?.name,active:Ee?.selected,highlightParts:Ee?.highlightParts,onClick:this.onClickValue,searchTerm:c})):null})))))),r.createElement("div",{className:O.footerSectionStyles},r.createElement(Xr.J,null,"3. Resulting selector"),r.createElement("pre",{"aria-label":"selector",className:O.selector},h),b&&r.createElement("div",{className:O.validationStatus},b),r.createElement("div",{className:(0,$.cx)(O.status,(d||f)&&O.statusShowing)},r.createElement("span",{className:f?O.error:""},f||d)),r.createElement(X.B,{gap:1},r.createElement(U.$n,{"aria-label":"Use selector as logs button",disabled:x,onClick:this.onClickRunLogsQuery},"Show logs"),r.createElement(U.$n,{"aria-label":"Use selector as metrics button",variant:"secondary",disabled:x,onClick:this.onClickRunMetricsQuery},"Show logs rate"),r.createElement(U.$n,{"aria-label":"Validate submit button",variant:"secondary",disabled:x,onClick:this.onClickValidate},"Validate selector"),r.createElement(U.$n,{"aria-label":"Selector clear button",variant:"secondary",onClick:this.onClickClear},"Clear"))))}}const Wr=(0,te.cV)(_a),_r=e=>{const{isOpen:t,onClose:s,datasource:c,app:d,timeRange:f}=e,[b,O]=(0,r.useState)(!1),[h,x]=(0,r.useState)(!1),D="grafana.datasources.loki.browser.labels",R=(0,te.of)(va);(0,r.useEffect)(()=>{t&&c.languageProvider.fetchLabels({timeRange:f}).then(J=>{O(!0),x(J.length>0)})},[c,t,f]);const G=J=>{const{query:le,onChange:ge,onRunQuery:ie}=e,he={...le,expr:J};ge(he),ie()},j=J=>{G(J),s()},Ee=()=>{(0,de.rR)("grafana_loki_label_browser_closed",{app:d,closeType:"modalClose"}),s()};return r.createElement(ut.a,{isOpen:t,title:"Label browser",onDismiss:Ee,className:R.modal},!b&&r.createElement(vt._,{text:"Loading labels..."}),b&&!h&&r.createElement("p",null,"No labels found."),b&&h&&r.createElement(je,{storageKey:D,defaultValue:[]},(J,le,ge)=>r.createElement(Wr,{languageProvider:c.languageProvider,onChange:j,lastUsedLabels:J,storeLastUsedLabels:le,deleteLastUsedLabels:ge,app:d,timeRange:f})))},va=e=>({modal:(0,$.css)`
      width: 85vw;
      ${e.breakpoints.down("md")} {
        width: 100%;
      }
    `});var Oa=l(65307),Ot=l(43548),Gt=l(60706),qr=l(43127),ea=l(9e4),cr=l(81580),ka=l(97801),Va=l(85269),ya=l(44600),Yt=l(50877),Jt=l(14186),Ut=l(21594),yt=l(81392),ba=l(3721),bt=Object.defineProperty,ye=Object.defineProperties,Sr=Object.getOwnPropertyDescriptors,Zt=Object.getOwnPropertySymbols,Ea=Object.prototype.hasOwnProperty,$t=Object.prototype.propertyIsEnumerable,mt=(e,t,s)=>t in e?bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,$r=(e,t)=>{for(var s in t||(t={}))Ea.call(t,s)&&mt(e,s,t[s]);if(Zt)for(var s of Zt(t))$t.call(t,s)&&mt(e,s,t[s]);return e},dt=(e,t)=>ye(e,Sr(t));const ja="You have conflicting label filters";function za({item:e,items:t,defaultOp:s,onChange:c,onDelete:d,onGetLabelNames:f,onGetLabelValues:b,invalidLabel:O,invalidValue:h,multiValueSeparator:x="|"}){var D;const[R,G]=(0,r.useState)({}),[j,Ee]=(0,r.useState)(!1),[J,le]=(0,r.useState)(!1),ge=(oe=e.op)=>{var Me;return(Me=Pa.find(pe=>pe.label===oe))==null?void 0:Me.isMultiValue},ie=oe=>oe?oe.indexOf(x)>0?oe.split(x):[oe]:[],he=()=>{const oe=R.labelValues?[...R.labelValues]:[],Me=ie(e?.value).map(Yt.z);return(0,A.uniqBy)([...Me,...oe],"value")},ce=qt(e,t),{current:De}=(0,r.useRef)((0,ya.A)());return r.createElement("div",{"data-testid":"visual-query-builder-dimensions-filter-item"},r.createElement(Jt.I,{error:ja,invalid:ce?!0:void 0},r.createElement(yt.M,null,r.createElement(Ut.l6,{placeholder:"Select label","data-testid":Se.Tp.components.QueryBuilder.labelSelect,inputId:`visual-query-builder-dimensions-filter-item-key-${De}`,width:"auto",value:e.label?(0,Yt.z)(e.label):null,allowCustomValue:!0,onOpenMenu:async()=>{G({isLoadingLabelNames:!0});const oe=await f(e);Ee(!0),G({labelNames:oe,isLoadingLabelNames:void 0})},onCloseMenu:()=>{Ee(!1)},isOpen:j,isLoading:R.isLoadingLabelNames,options:R.labelNames,onChange:oe=>{var Me;oe.value&&c(dt($r({},e),{op:(Me=e.op)!=null?Me:s,label:oe.value}))},invalid:ce||O}),r.createElement(Ut.l6,{"data-testid":Se.Tp.components.QueryBuilder.matchOperatorSelect,value:(0,Yt.z)((D=e.op)!=null?D:s),options:Pa,width:"auto",onChange:oe=>{oe.value&&c(dt($r({},e),{op:oe.value,value:ge(oe.value)?e.value:ie(e?.value)[0]}))},invalid:ce}),r.createElement(Ut.l6,{placeholder:"Select value","data-testid":Se.Tp.components.QueryBuilder.valueSelect,inputId:`visual-query-builder-dimensions-filter-item-value-${De}`,width:"auto",value:ge()?ie(e?.value).map(Yt.z):ie(e?.value).map(Yt.z)[0],allowCustomValue:!0,onOpenMenu:async()=>{G({isLoadingLabelValues:!0});const oe=await b(e);G(dt($r({},R),{labelValues:oe,isLoadingLabelValues:void 0})),le(!0)},onCloseMenu:()=>{le(!1)},isOpen:J,isMulti:ge(),isLoading:R.isLoadingLabelValues,options:he(),onChange:oe=>{var Me,pe;if(oe.value)c(dt($r({},e),{value:oe.value,op:(Me=e.op)!=null?Me:s}));else{const Ve=oe.map(Ke=>{if(Ke.value)return Ke.value}).filter(Ke=>Ke!==void 0).join(x);c(dt($r({},e),{value:Ve,op:(pe=e.op)!=null?pe:s}))}},invalid:ce||h}),r.createElement(ba.Z,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:d}))))}const Pa=[{label:"=",value:"=",description:"Equals",isMultiValue:!1},{label:"!=",value:"!=",description:"Does not equal",isMultiValue:!1},{label:"=~",value:"=~",description:"Matches regex",isMultiValue:!0},{label:"!~",value:"!~",description:"Does not match regex",isMultiValue:!0}];function qt(e,t){if(!e.label||!e.op||!e.value||t.length<2)return!1;const s=e.op.toString().startsWith("!");return t.filter(f=>f.label===e.label&&f.value===e.value&&f.op!==e.op).some(f=>{var b,O;return!!(s&&((b=f?.op)==null?void 0:b.toString().startsWith("!"))===!1||s===!1&&((O=f?.op)!=null&&O.toString().startsWith("!")))})}const ta="Select at least 1 label filter (label and value)";function Tr({labelsFilters:e,onChange:t,onGetLabelNames:s,onGetLabelValues:c,labelFilterRequired:d,multiValueSeparator:f}){const b="=",[O,h]=(0,r.useState)([{op:b}]);(0,r.useEffect)(()=>{e.length>0?h(e):h([{op:b}])},[e]);const x=R=>{h(R);const G=R.filter(j=>j.label!==void 0&&j.value!==void 0);(0,A.isEqual)(G,e)||t(G)},D=O.some(R=>R.label&&R.value);return r.createElement(ka.B,null,r.createElement(cr.c,{label:"Label filters",error:ta,invalid:d&&!D},r.createElement(Va.o,{items:O,onChange:x,renderItem:(R,G,j)=>r.createElement(za,{item:R,items:O,defaultOp:b,onChange:G,onDelete:j,onGetLabelNames:s,onGetLabelValues:c,invalidLabel:d&&!R.label,invalidValue:d&&!R.value,multiValueSeparator:f})})))}var Bt=l(36663);function kt({title:e,stepNumber:t,markdown:s,children:c}){const d=(0,te.of)(xa);return r.createElement("div",{className:d.box},t!==void 0&&r.createElement("div",{className:d.stepNumber},t),r.createElement("div",{className:d.boxInner},e&&r.createElement("div",{className:d.header},r.createElement("span",null,e)),r.createElement("div",{className:d.body},s&&r.createElement("div",{dangerouslySetInnerHTML:{__html:(0,Bt.G)(s)}}),c)))}const xa=e=>({box:(0,$.css)({background:e.colors.background.secondary,padding:e.spacing(1),borderRadius:e.shape.radius.default,position:"relative"}),boxInner:(0,$.css)({marginLeft:e.spacing(4)}),stepNumber:(0,$.css)({fontWeight:e.typography.fontWeightMedium,background:e.colors.secondary.main,width:"20px",height:"20px",borderRadius:e.shape.radius.circle,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"10px",left:"11px",fontSize:e.typography.bodySmall.fontSize}),header:(0,$.css)({paddingBottom:e.spacing(.5),display:"flex",alignItems:"center",fontFamily:e.typography.fontFamilyMonospace}),body:(0,$.css)({color:e.colors.text.secondary,"p:last-child":{margin:0},a:{color:e.colors.text.link,textDecoration:"underline"}})});var ur=l(92762),ra=l(21103),kr=l(75494),aa=l(1604),Ka=l(3988),Ge=l(56034),Vr=l(14578),La=l(98587),Tt=l(58168),er=l(40961);function ft(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Qt(e){var t=ft(e).Element;return e instanceof t||e instanceof Element}function Et(e){var t=ft(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function Dt(e){if(typeof ShadowRoot>"u")return!1;var t=ft(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}var Nt=Math.max,tr=Math.min,Rt=Math.round;function jr(){var e=navigator.userAgentData;return e!=null&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function dr(){return!/^((?!chrome|android).)*safari/i.test(jr())}function fr(e,t,s){t===void 0&&(t=!1),s===void 0&&(s=!1);var c=e.getBoundingClientRect(),d=1,f=1;t&&Et(e)&&(d=e.offsetWidth>0&&Rt(c.width)/e.offsetWidth||1,f=e.offsetHeight>0&&Rt(c.height)/e.offsetHeight||1);var b=Qt(e)?ft(e):window,O=b.visualViewport,h=!dr()&&s,x=(c.left+(h&&O?O.offsetLeft:0))/d,D=(c.top+(h&&O?O.offsetTop:0))/f,R=c.width/d,G=c.height/f;return{width:R,height:G,top:D,right:x+R,bottom:D+G,left:x,x,y:D}}function na(e){var t=ft(e),s=t.pageXOffset,c=t.pageYOffset;return{scrollLeft:s,scrollTop:c}}function Ha(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function Ga(e){return e===ft(e)||!Et(e)?na(e):Ha(e)}function wt(e){return e?(e.nodeName||"").toLowerCase():null}function Wt(e){return((Qt(e)?e.ownerDocument:e.document)||window.document).documentElement}function Qr(e){return fr(Wt(e)).left+na(e).scrollLeft}function Pt(e){return ft(e).getComputedStyle(e)}function Ft(e){var t=Pt(e),s=t.overflow,c=t.overflowX,d=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+d+c)}function Sa(e){var t=e.getBoundingClientRect(),s=Rt(t.width)/e.offsetWidth||1,c=Rt(t.height)/e.offsetHeight||1;return s!==1||c!==1}function $a(e,t,s){s===void 0&&(s=!1);var c=Et(t),d=Et(t)&&Sa(t),f=Wt(t),b=fr(e,d,s),O={scrollLeft:0,scrollTop:0},h={x:0,y:0};return(c||!c&&!s)&&((wt(t)!=="body"||Ft(f))&&(O=Ga(t)),Et(t)?(h=fr(t,!0),h.x+=t.clientLeft,h.y+=t.clientTop):f&&(h.x=Qr(f))),{x:b.left+O.scrollLeft-h.x,y:b.top+O.scrollTop-h.y,width:b.width,height:b.height}}function Vt(e){var t=fr(e),s=e.offsetWidth,c=e.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-c)<=1&&(c=t.height),{x:e.offsetLeft,y:e.offsetTop,width:s,height:c}}function Mt(e){return wt(e)==="html"?e:e.assignedSlot||e.parentNode||(Dt(e)?e.host:null)||Wt(e)}function Ta(e){return["html","body","#document"].indexOf(wt(e))>=0?e.ownerDocument.body:Et(e)&&Ft(e)?e:Ta(Mt(e))}function rr(e,t){var s;t===void 0&&(t=[]);var c=Ta(e),d=c===((s=e.ownerDocument)==null?void 0:s.body),f=ft(c),b=d?[f].concat(f.visualViewport||[],Ft(c)?c:[]):c,O=t.concat(b);return d?O:O.concat(rr(Mt(b)))}function wr(e){return["table","td","th"].indexOf(wt(e))>=0}function sa(e){return!Et(e)||Pt(e).position==="fixed"?null:e.offsetParent}function Qa(e){var t=/firefox/i.test(jr()),s=/Trident/i.test(jr());if(s&&Et(e)){var c=Pt(e);if(c.position==="fixed")return null}var d=Mt(e);for(Dt(d)&&(d=d.host);Et(d)&&["html","body"].indexOf(wt(d))<0;){var f=Pt(d);if(f.transform!=="none"||f.perspective!=="none"||f.contain==="paint"||["transform","perspective"].indexOf(f.willChange)!==-1||t&&f.willChange==="filter"||t&&f.filter&&f.filter!=="none")return d;d=d.parentNode}return null}function pr(e){for(var t=ft(e),s=sa(e);s&&wr(s)&&Pt(s).position==="static";)s=sa(s);return s&&(wt(s)==="html"||wt(s)==="body"&&Pt(s).position==="static")?t:s||Qa(e)||t}var gt="top",xt="bottom",ht="right",nt="left",mr="auto",jt=[gt,xt,ht,nt],gr="start",ar="end",Ya="clippingParents",ia="viewport",Rr="popper",Ja="reference",Fr=jt.reduce(function(e,t){return e.concat([t+"-"+gr,t+"-"+ar])},[]),wa=[].concat(jt,[mr]).reduce(function(e,t){return e.concat([t,t+"-"+gr,t+"-"+ar])},[]),Za="beforeRead",qa="read",Ra="afterRead",Fa="beforeMain",en="main",tn="afterMain",Ca="beforeWrite",Cr="write",hr="afterWrite",Ar=[Za,qa,Ra,Fa,en,tn,Ca,Cr,hr];function vr(e){var t=new Map,s=new Set,c=[];e.forEach(function(f){t.set(f.name,f)});function d(f){s.add(f.name);var b=[].concat(f.requires||[],f.requiresIfExists||[]);b.forEach(function(O){if(!s.has(O)){var h=t.get(O);h&&d(h)}}),c.push(f)}return e.forEach(function(f){s.has(f.name)||d(f)}),c}function Dr(e){var t=vr(e);return Ar.reduce(function(s,c){return s.concat(t.filter(function(d){return d.phase===c}))},[])}function Aa(e){var t;return function(){return t||(t=new Promise(function(s){Promise.resolve().then(function(){t=void 0,s(e())})})),t}}function rn(e){var t=e.reduce(function(s,c){var d=s[c.name];return s[c.name]=d?Object.assign({},d,c,{options:Object.assign({},d.options,c.options),data:Object.assign({},d.data,c.data)}):c,s},{});return Object.keys(t).map(function(s){return t[s]})}var Da={placement:"bottom",modifiers:[],strategy:"absolute"};function zt(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return!t.some(function(c){return!(c&&typeof c.getBoundingClientRect=="function")})}function an(e){e===void 0&&(e={});var t=e,s=t.defaultModifiers,c=s===void 0?[]:s,d=t.defaultOptions,f=d===void 0?Da:d;return function(O,h,x){x===void 0&&(x=f);var D={placement:"bottom",orderedModifiers:[],options:Object.assign({},Da,f),modifiersData:{},elements:{reference:O,popper:h},attributes:{},styles:{}},R=[],G=!1,j={state:D,setOptions:function(ge){var ie=typeof ge=="function"?ge(D.options):ge;J(),D.options=Object.assign({},f,D.options,ie),D.scrollParents={reference:Qt(O)?rr(O):O.contextElement?rr(O.contextElement):[],popper:rr(h)};var he=Dr(rn([].concat(c,D.options.modifiers)));return D.orderedModifiers=he.filter(function(ce){return ce.enabled}),Ee(),j.update()},forceUpdate:function(){if(!G){var ge=D.elements,ie=ge.reference,he=ge.popper;if(zt(ie,he)){D.rects={reference:$a(ie,pr(he),D.options.strategy==="fixed"),popper:Vt(he)},D.reset=!1,D.placement=D.options.placement,D.orderedModifiers.forEach(function(Ke){return D.modifiersData[Ke.name]=Object.assign({},Ke.data)});for(var ce=0;ce<D.orderedModifiers.length;ce++){if(D.reset===!0){D.reset=!1,ce=-1;continue}var De=D.orderedModifiers[ce],oe=De.fn,Me=De.options,pe=Me===void 0?{}:Me,Ve=De.name;typeof oe=="function"&&(D=oe({state:D,options:pe,name:Ve,instance:j})||D)}}}},update:Aa(function(){return new Promise(function(le){j.forceUpdate(),le(D)})}),destroy:function(){J(),G=!0}};if(!zt(O,h))return j;j.setOptions(x).then(function(le){!G&&x.onFirstUpdate&&x.onFirstUpdate(le)});function Ee(){D.orderedModifiers.forEach(function(le){var ge=le.name,ie=le.options,he=ie===void 0?{}:ie,ce=le.effect;if(typeof ce=="function"){var De=ce({state:D,name:ge,instance:j,options:he}),oe=function(){};R.push(De||oe)}})}function J(){R.forEach(function(le){return le()}),R=[]}return j}}var zr=null,nr={passive:!0};function Kr(e){var t=e.state,s=e.instance,c=e.options,d=c.scroll,f=d===void 0?!0:d,b=c.resize,O=b===void 0?!0:b,h=ft(t.elements.popper),x=[].concat(t.scrollParents.reference,t.scrollParents.popper);return f&&x.forEach(function(D){D.addEventListener("scroll",s.update,nr)}),O&&h.addEventListener("resize",s.update,nr),function(){f&&x.forEach(function(D){D.removeEventListener("scroll",s.update,nr)}),O&&h.removeEventListener("resize",s.update,nr)}}const Na={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Kr,data:{}};function Lt(e){return e.split("-")[0]}function Or(e){return e.split("-")[1]}function yr(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function oa(e){var t=e.reference,s=e.element,c=e.placement,d=c?Lt(c):null,f=c?Or(c):null,b=t.x+t.width/2-s.width/2,O=t.y+t.height/2-s.height/2,h;switch(d){case gt:h={x:b,y:t.y-s.height};break;case xt:h={x:b,y:t.y+t.height};break;case ht:h={x:t.x+t.width,y:O};break;case nt:h={x:t.x-s.width,y:O};break;default:h={x:t.x,y:t.y}}var x=d?yr(d):null;if(x!=null){var D=x==="y"?"height":"width";switch(f){case gr:h[x]=h[x]-(t[D]/2-s[D]/2);break;case ar:h[x]=h[x]+(t[D]/2-s[D]/2);break;default:}}return h}function la(e){var t=e.state,s=e.name;t.modifiersData[s]=oa({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const Ma={name:"popperOffsets",enabled:!0,phase:"read",fn:la,data:{}};var Ia={top:"auto",right:"auto",bottom:"auto",left:"auto"};function nn(e,t){var s=e.x,c=e.y,d=t.devicePixelRatio||1;return{x:Rt(s*d)/d||0,y:Rt(c*d)/d||0}}function ca(e){var t,s=e.popper,c=e.popperRect,d=e.placement,f=e.variation,b=e.offsets,O=e.position,h=e.gpuAcceleration,x=e.adaptive,D=e.roundOffsets,R=e.isFixed,G=b.x,j=G===void 0?0:G,Ee=b.y,J=Ee===void 0?0:Ee,le=typeof D=="function"?D({x:j,y:J}):{x:j,y:J};j=le.x,J=le.y;var ge=b.hasOwnProperty("x"),ie=b.hasOwnProperty("y"),he=nt,ce=gt,De=window;if(x){var oe=pr(s),Me="clientHeight",pe="clientWidth";if(oe===ft(s)&&(oe=Wt(s),Pt(oe).position!=="static"&&O==="absolute"&&(Me="scrollHeight",pe="scrollWidth")),oe=oe,d===gt||(d===nt||d===ht)&&f===ar){ce=xt;var Ve=R&&oe===De&&De.visualViewport?De.visualViewport.height:oe[Me];J-=Ve-c.height,J*=h?1:-1}if(d===nt||(d===gt||d===xt)&&f===ar){he=ht;var Ke=R&&oe===De&&De.visualViewport?De.visualViewport.width:oe[pe];j-=Ke-c.width,j*=h?1:-1}}var at=Object.assign({position:O},x&&Ia),St=D===!0?nn({x:j,y:J},ft(s)):{x:j,y:J};if(j=St.x,J=St.y,h){var pt;return Object.assign({},at,(pt={},pt[ce]=ie?"0":"",pt[he]=ge?"0":"",pt.transform=(De.devicePixelRatio||1)<=1?"translate("+j+"px, "+J+"px)":"translate3d("+j+"px, "+J+"px, 0)",pt))}return Object.assign({},at,(t={},t[ce]=ie?J+"px":"",t[he]=ge?j+"px":"",t.transform="",t))}function br(e){var t=e.state,s=e.options,c=s.gpuAcceleration,d=c===void 0?!0:c,f=s.adaptive,b=f===void 0?!0:f,O=s.roundOffsets,h=O===void 0?!0:O,x={placement:Lt(t.placement),variation:Or(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:d,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,ca(Object.assign({},x,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:b,roundOffsets:h})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,ca(Object.assign({},x,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:h})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const ua={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:br,data:{}};function Kt(e){var t=e.state;Object.keys(t.elements).forEach(function(s){var c=t.styles[s]||{},d=t.attributes[s]||{},f=t.elements[s];!Et(f)||!wt(f)||(Object.assign(f.style,c),Object.keys(d).forEach(function(b){var O=d[b];O===!1?f.removeAttribute(b):f.setAttribute(b,O===!0?"":O)}))})}function da(e){var t=e.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach(function(c){var d=t.elements[c],f=t.attributes[c]||{},b=Object.keys(t.styles.hasOwnProperty(c)?t.styles[c]:s[c]),O=b.reduce(function(h,x){return h[x]="",h},{});!Et(d)||!wt(d)||(Object.assign(d.style,O),Object.keys(f).forEach(function(h){d.removeAttribute(h)}))})}}const g={name:"applyStyles",enabled:!0,phase:"write",fn:Kt,effect:da,requires:["computeStyles"]};function n(e,t,s){var c=Lt(e),d=[nt,gt].indexOf(c)>=0?-1:1,f=typeof s=="function"?s(Object.assign({},t,{placement:e})):s,b=f[0],O=f[1];return b=b||0,O=(O||0)*d,[nt,ht].indexOf(c)>=0?{x:O,y:b}:{x:b,y:O}}function a(e){var t=e.state,s=e.options,c=e.name,d=s.offset,f=d===void 0?[0,0]:d,b=wa.reduce(function(D,R){return D[R]=n(R,t.rects,f),D},{}),O=b[t.placement],h=O.x,x=O.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=h,t.modifiersData.popperOffsets.y+=x),t.modifiersData[c]=b}const i={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:a};var o={left:"right",right:"left",bottom:"top",top:"bottom"};function u(e){return e.replace(/left|right|bottom|top/g,function(t){return o[t]})}var m={start:"end",end:"start"};function y(e){return e.replace(/start|end/g,function(t){return m[t]})}function P(e,t){var s=ft(e),c=Wt(e),d=s.visualViewport,f=c.clientWidth,b=c.clientHeight,O=0,h=0;if(d){f=d.width,b=d.height;var x=dr();(x||!x&&t==="fixed")&&(O=d.offsetLeft,h=d.offsetTop)}return{width:f,height:b,x:O+Qr(e),y:h}}function I(e){var t,s=Wt(e),c=na(e),d=(t=e.ownerDocument)==null?void 0:t.body,f=Nt(s.scrollWidth,s.clientWidth,d?d.scrollWidth:0,d?d.clientWidth:0),b=Nt(s.scrollHeight,s.clientHeight,d?d.scrollHeight:0,d?d.clientHeight:0),O=-c.scrollLeft+Qr(e),h=-c.scrollTop;return Pt(d||s).direction==="rtl"&&(O+=Nt(s.clientWidth,d?d.clientWidth:0)-f),{width:f,height:b,x:O,y:h}}function Y(e,t){var s=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(s&&Dt(s)){var c=t;do{if(c&&e.isSameNode(c))return!0;c=c.parentNode||c.host}while(c)}return!1}function Z(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function ae(e,t){var s=fr(e,!1,t==="fixed");return s.top=s.top+e.clientTop,s.left=s.left+e.clientLeft,s.bottom=s.top+e.clientHeight,s.right=s.left+e.clientWidth,s.width=e.clientWidth,s.height=e.clientHeight,s.x=s.left,s.y=s.top,s}function se(e,t,s){return t===ia?Z(P(e,s)):Qt(t)?ae(t,s):Z(I(Wt(e)))}function Ie(e){var t=rr(Mt(e)),s=["absolute","fixed"].indexOf(Pt(e).position)>=0,c=s&&Et(e)?pr(e):e;return Qt(c)?t.filter(function(d){return Qt(d)&&Y(d,c)&&wt(d)!=="body"}):[]}function Fe(e,t,s,c){var d=t==="clippingParents"?Ie(e):[].concat(t),f=[].concat(d,[s]),b=f[0],O=f.reduce(function(h,x){var D=se(e,x,c);return h.top=Nt(D.top,h.top),h.right=tr(D.right,h.right),h.bottom=tr(D.bottom,h.bottom),h.left=Nt(D.left,h.left),h},se(e,b,c));return O.width=O.right-O.left,O.height=O.bottom-O.top,O.x=O.left,O.y=O.top,O}function ze(){return{top:0,right:0,bottom:0,left:0}}function we(e){return Object.assign({},ze(),e)}function Ze(e,t){return t.reduce(function(s,c){return s[c]=e,s},{})}function et(e,t){t===void 0&&(t={});var s=t,c=s.placement,d=c===void 0?e.placement:c,f=s.strategy,b=f===void 0?e.strategy:f,O=s.boundary,h=O===void 0?Ya:O,x=s.rootBoundary,D=x===void 0?ia:x,R=s.elementContext,G=R===void 0?Rr:R,j=s.altBoundary,Ee=j===void 0?!1:j,J=s.padding,le=J===void 0?0:J,ge=we(typeof le!="number"?le:Ze(le,jt)),ie=G===Rr?Ja:Rr,he=e.rects.popper,ce=e.elements[Ee?ie:G],De=Fe(Qt(ce)?ce:ce.contextElement||Wt(e.elements.popper),h,D,b),oe=fr(e.elements.reference),Me=oa({reference:oe,element:he,strategy:"absolute",placement:d}),pe=Z(Object.assign({},he,Me)),Ve=G===Rr?pe:oe,Ke={top:De.top-Ve.top+ge.top,bottom:Ve.bottom-De.bottom+ge.bottom,left:De.left-Ve.left+ge.left,right:Ve.right-De.right+ge.right},at=e.modifiersData.offset;if(G===Rr&&at){var St=at[d];Object.keys(Ke).forEach(function(pt){var It=[ht,xt].indexOf(pt)>=0?1:-1,rt=[gt,xt].indexOf(pt)>=0?"y":"x";Ke[pt]+=St[rt]*It})}return Ke}function Ye(e,t){t===void 0&&(t={});var s=t,c=s.placement,d=s.boundary,f=s.rootBoundary,b=s.padding,O=s.flipVariations,h=s.allowedAutoPlacements,x=h===void 0?wa:h,D=Or(c),R=D?O?Fr:Fr.filter(function(Ee){return Or(Ee)===D}):jt,G=R.filter(function(Ee){return x.indexOf(Ee)>=0});G.length===0&&(G=R);var j=G.reduce(function(Ee,J){return Ee[J]=et(e,{placement:J,boundary:d,rootBoundary:f,padding:b})[Lt(J)],Ee},{});return Object.keys(j).sort(function(Ee,J){return j[Ee]-j[J]})}function ot(e){if(Lt(e)===mr)return[];var t=u(e);return[y(e),t,y(t)]}function Ct(e){var t=e.state,s=e.options,c=e.name;if(!t.modifiersData[c]._skip){for(var d=s.mainAxis,f=d===void 0?!0:d,b=s.altAxis,O=b===void 0?!0:b,h=s.fallbackPlacements,x=s.padding,D=s.boundary,R=s.rootBoundary,G=s.altBoundary,j=s.flipVariations,Ee=j===void 0?!0:j,J=s.allowedAutoPlacements,le=t.options.placement,ge=Lt(le),ie=ge===le,he=h||(ie||!Ee?[u(le)]:ot(le)),ce=[le].concat(he).reduce(function(ga,Ir){return ga.concat(Lt(Ir)===mr?Ye(t,{placement:Ir,boundary:D,rootBoundary:R,padding:x,flipVariations:Ee,allowedAutoPlacements:J}):Ir)},[]),De=t.rects.reference,oe=t.rects.popper,Me=new Map,pe=!0,Ve=ce[0],Ke=0;Ke<ce.length;Ke++){var at=ce[Ke],St=Lt(at),pt=Or(at)===gr,It=[gt,xt].indexOf(St)>=0,rt=It?"width":"height",Ue=et(t,{placement:at,boundary:D,rootBoundary:R,altBoundary:G,padding:x}),st=It?pt?ht:nt:pt?xt:gt;De[rt]>oe[rt]&&(st=u(st));var Ht=u(st),ir=[];if(f&&ir.push(Ue[St]<=0),O&&ir.push(Ue[st]<=0,Ue[Ht]<=0),ir.every(function(ga){return ga})){Ve=at,pe=!1;break}Me.set(at,ir)}if(pe)for(var Gr=Ee?3:1,ma=function(Ir){var Ua=ce.find(function(mn){var Yr=Me.get(mn);if(Yr)return Yr.slice(0,Ir).every(function(Tn){return Tn})});if(Ua)return Ve=Ua,"break"},xr=Gr;xr>0;xr--){var pn=ma(xr);if(pn==="break")break}t.placement!==Ve&&(t.modifiersData[c]._skip=!0,t.placement=Ve,t.reset=!0)}}const At={name:"flip",enabled:!0,phase:"main",fn:Ct,requiresIfExists:["offset"],data:{_skip:!1}};function Nr(e){return e==="x"?"y":"x"}function _t(e,t,s){return Nt(e,tr(t,s))}function Er(e,t,s){var c=_t(e,t,s);return c>s?s:c}function k(e){var t=e.state,s=e.options,c=e.name,d=s.mainAxis,f=d===void 0?!0:d,b=s.altAxis,O=b===void 0?!1:b,h=s.boundary,x=s.rootBoundary,D=s.altBoundary,R=s.padding,G=s.tether,j=G===void 0?!0:G,Ee=s.tetherOffset,J=Ee===void 0?0:Ee,le=et(t,{boundary:h,rootBoundary:x,padding:R,altBoundary:D}),ge=Lt(t.placement),ie=Or(t.placement),he=!ie,ce=yr(ge),De=Nr(ce),oe=t.modifiersData.popperOffsets,Me=t.rects.reference,pe=t.rects.popper,Ve=typeof J=="function"?J(Object.assign({},t.rects,{placement:t.placement})):J,Ke=typeof Ve=="number"?{mainAxis:Ve,altAxis:Ve}:Object.assign({mainAxis:0,altAxis:0},Ve),at=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,St={x:0,y:0};if(oe){if(f){var pt,It=ce==="y"?gt:nt,rt=ce==="y"?xt:ht,Ue=ce==="y"?"height":"width",st=oe[ce],Ht=st+le[It],ir=st-le[rt],Gr=j?-pe[Ue]/2:0,ma=ie===gr?Me[Ue]:pe[Ue],xr=ie===gr?-pe[Ue]:-Me[Ue],pn=t.elements.arrow,ga=j&&pn?Vt(pn):{width:0,height:0},Ir=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:ze(),Ua=Ir[It],mn=Ir[rt],Yr=_t(0,Me[Ue],ga[Ue]),Tn=he?Me[Ue]/2-Gr-Yr-Ua-Ke.mainAxis:ma-Yr-Ua-Ke.mainAxis,Fo=he?-Me[Ue]/2+Gr+Yr+mn+Ke.mainAxis:xr+Yr+mn+Ke.mainAxis,Qn=t.elements.arrow&&pr(t.elements.arrow),Co=Qn?ce==="y"?Qn.clientTop||0:Qn.clientLeft||0:0,cs=(pt=at?.[ce])!=null?pt:0,Ao=st+Tn-cs-Co,Do=st+Fo-cs,us=_t(j?tr(Ht,Ao):Ht,st,j?Nt(ir,Do):ir);oe[ce]=us,St[ce]=us-st}if(O){var ds,No=ce==="x"?gt:nt,Mo=ce==="x"?xt:ht,Jr=oe[De],gn=De==="y"?"height":"width",fs=Jr+le[No],ps=Jr-le[Mo],wn=[gt,nt].indexOf(ge)!==-1,ms=(ds=at?.[De])!=null?ds:0,gs=wn?fs:Jr-Me[gn]-pe[gn]-ms+Ke.altAxis,hs=wn?Jr+Me[gn]+pe[gn]-ms-Ke.altAxis:ps,vs=j&&wn?Er(gs,Jr,hs):_t(j?gs:fs,Jr,j?hs:ps);oe[De]=vs,St[De]=vs-Jr}t.modifiersData[c]=St}}const H={name:"preventOverflow",enabled:!0,phase:"main",fn:k,requiresIfExists:["offset"]};var ne=function(t,s){return t=typeof t=="function"?t(Object.assign({},s.rects,{placement:s.placement})):t,we(typeof t!="number"?t:Ze(t,jt))};function re(e){var t,s=e.state,c=e.name,d=e.options,f=s.elements.arrow,b=s.modifiersData.popperOffsets,O=Lt(s.placement),h=yr(O),x=[nt,ht].indexOf(O)>=0,D=x?"height":"width";if(!(!f||!b)){var R=ne(d.padding,s),G=Vt(f),j=h==="y"?gt:nt,Ee=h==="y"?xt:ht,J=s.rects.reference[D]+s.rects.reference[h]-b[h]-s.rects.popper[D],le=b[h]-s.rects.reference[h],ge=pr(f),ie=ge?h==="y"?ge.clientHeight||0:ge.clientWidth||0:0,he=J/2-le/2,ce=R[j],De=ie-G[D]-R[Ee],oe=ie/2-G[D]/2+he,Me=_t(ce,oe,De),pe=h;s.modifiersData[c]=(t={},t[pe]=Me,t.centerOffset=Me-oe,t)}}function W(e){var t=e.state,s=e.options,c=s.element,d=c===void 0?"[data-popper-arrow]":c;d!=null&&(typeof d=="string"&&(d=t.elements.popper.querySelector(d),!d)||Y(t.elements.popper,d)&&(t.elements.arrow=d))}const Le={name:"arrow",enabled:!0,phase:"main",fn:re,effect:W,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ne(e,t,s){return s===void 0&&(s={x:0,y:0}),{top:e.top-t.height-s.y,right:e.right-t.width+s.x,bottom:e.bottom-t.height+s.y,left:e.left-t.width-s.x}}function Xe(e){return[gt,ht,xt,nt].some(function(t){return e[t]>=0})}function tt(e){var t=e.state,s=e.name,c=t.rects.reference,d=t.rects.popper,f=t.modifiersData.preventOverflow,b=et(t,{elementContext:"reference"}),O=et(t,{altBoundary:!0}),h=Ne(b,c),x=Ne(O,d,f),D=Xe(h),R=Xe(x);t.modifiersData[s]={referenceClippingOffsets:h,popperEscapeOffsets:x,isReferenceHidden:D,hasPopperEscaped:R},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":D,"data-popper-escaped":R})}var ct=[Na,Ma,ua,g,i,At,H,Le,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:tt}],sr=an({defaultModifiers:ct}),Pr=l(30115),fa=l.n(Pr),sn=function(t){return Array.isArray(t)?t[0]:t},hn=function(t){if(typeof t=="function"){for(var s=arguments.length,c=new Array(s>1?s-1:0),d=1;d<s;d++)c[d-1]=arguments[d];return t.apply(void 0,c)}},Io=function(t,s){if(typeof t=="function")return hn(t,s);t!=null&&(t.current=s)},Rn=function(t){return t.reduce(function(s,c){var d=c[0],f=c[1];return s[d]=f,s},{})},Fn=typeof window<"u"&&window.document&&window.document.createElement?r.useLayoutEffect:r.useEffect,Os=[],ys=function(t,s,c){c===void 0&&(c={});var d=r.useRef(null),f={onFirstUpdate:c.onFirstUpdate,placement:c.placement||"bottom",strategy:c.strategy||"absolute",modifiers:c.modifiers||Os},b=r.useState({styles:{popper:{position:f.strategy,left:"0",top:"0"},arrow:{position:"absolute"}},attributes:{}}),O=b[0],h=b[1],x=r.useMemo(function(){return{name:"updateState",enabled:!0,phase:"write",fn:function(j){var Ee=j.state,J=Object.keys(Ee.elements);er.flushSync(function(){h({styles:Rn(J.map(function(le){return[le,Ee.styles[le]||{}]})),attributes:Rn(J.map(function(le){return[le,Ee.attributes[le]]}))})})},requires:["computeStyles"]}},[]),D=r.useMemo(function(){var G={onFirstUpdate:f.onFirstUpdate,placement:f.placement,strategy:f.strategy,modifiers:[].concat(f.modifiers,[x,{name:"applyStyles",enabled:!1}])};return fa()(d.current,G)?d.current||G:(d.current=G,G)},[f.onFirstUpdate,f.placement,f.strategy,f.modifiers,x]),R=r.useRef();return Fn(function(){R.current&&R.current.setOptions(D)},[D]),Fn(function(){if(!(t==null||s==null)){var G=c.createPopper||sr,j=G(t,s,D);return R.current=j,function(){j.destroy(),R.current=null}}},[t,s,c.createPopper]),{state:R.current?R.current.state:null,styles:O.styles,attributes:O.attributes,update:R.current?R.current.update:null,forceUpdate:R.current?R.current.forceUpdate:null}};function Cn(e){var t=r.useRef(e);return t.current=e,r.useCallback(function(){return t.current},[])}var bs=function(){};function Es(e){var t=e.initial,s=e.value,c=e.onChange,d=c===void 0?bs:c;if(t===void 0&&s===void 0)throw new TypeError('Either "value" or "initial" variable must be set. Now both are undefined');var f=r.useState(t),b=f[0],O=f[1],h=Cn(b),x=r.useCallback(function(R){var G=h(),j=typeof R=="function"?R(G):R;typeof j.persist=="function"&&j.persist(),O(j),typeof d=="function"&&d(j)},[h,d]),D=s!==void 0;return[D?s:b,D?d:x]}function An(e,t){return e===void 0&&(e=0),t===void 0&&(t=0),function(){return{width:0,height:0,top:t,right:e,bottom:t,left:e,x:0,y:0,toJSON:function(){return null}}}}var Ps=["styles","attributes"],Dn={getBoundingClientRect:An()},Nn={closeOnOutsideClick:!0,closeOnTriggerHidden:!1,defaultVisible:!1,delayHide:0,delayShow:0,followCursor:!1,interactive:!1,mutationObserverOptions:{attributes:!0,childList:!0,subtree:!0},offset:[0,6],trigger:"hover"};function xs(e,t){var s,c,d;e===void 0&&(e={}),t===void 0&&(t={});var f=Object.keys(Nn).reduce(function(rt,Ue){var st;return(0,Tt.A)({},rt,(st={},st[Ue]=rt[Ue]!==void 0?rt[Ue]:Nn[Ue],st))},e),b=r.useMemo(function(){return[{name:"offset",options:{offset:f.offset}}]},Array.isArray(f.offset)?f.offset:[]),O=(0,Tt.A)({},t,{placement:t.placement||f.placement,modifiers:t.modifiers||b}),h=r.useState(null),x=h[0],D=h[1],R=r.useState(null),G=R[0],j=R[1],Ee=Es({initial:f.defaultVisible,value:f.visible,onChange:f.onVisibleChange}),J=Ee[0],le=Ee[1],ge=r.useRef();r.useEffect(function(){return function(){return clearTimeout(ge.current)}},[]);var ie=ys(f.followCursor?Dn:x,G,O),he=ie.styles,ce=ie.attributes,De=(0,La.A)(ie,Ps),oe=De.update,Me=Cn({visible:J,triggerRef:x,tooltipRef:G,finalConfig:f}),pe=r.useCallback(function(rt){return Array.isArray(f.trigger)?f.trigger.includes(rt):f.trigger===rt},Array.isArray(f.trigger)?f.trigger:[f.trigger]),Ve=r.useCallback(function(){clearTimeout(ge.current),ge.current=window.setTimeout(function(){return le(!1)},f.delayHide)},[f.delayHide,le]),Ke=r.useCallback(function(){clearTimeout(ge.current),ge.current=window.setTimeout(function(){return le(!0)},f.delayShow)},[f.delayShow,le]),at=r.useCallback(function(){Me().visible?Ve():Ke()},[Me,Ve,Ke]);r.useEffect(function(){if(Me().finalConfig.closeOnOutsideClick){var rt=function(st){var Ht,ir=Me(),Gr=ir.tooltipRef,ma=ir.triggerRef,xr=(st.composedPath==null||(Ht=st.composedPath())==null?void 0:Ht[0])||st.target;xr instanceof Node&&Gr!=null&&ma!=null&&!Gr.contains(xr)&&!ma.contains(xr)&&Ve()};return document.addEventListener("mousedown",rt),function(){return document.removeEventListener("mousedown",rt)}}},[Me,Ve]),r.useEffect(function(){if(!(x==null||!pe("click")))return x.addEventListener("click",at),function(){return x.removeEventListener("click",at)}},[x,pe,at]),r.useEffect(function(){if(!(x==null||!pe("double-click")))return x.addEventListener("dblclick",at),function(){return x.removeEventListener("dblclick",at)}},[x,pe,at]),r.useEffect(function(){if(!(x==null||!pe("right-click"))){var rt=function(st){st.preventDefault(),at()};return x.addEventListener("contextmenu",rt),function(){return x.removeEventListener("contextmenu",rt)}}},[x,pe,at]),r.useEffect(function(){if(!(x==null||!pe("focus")))return x.addEventListener("focus",Ke),x.addEventListener("blur",Ve),function(){x.removeEventListener("focus",Ke),x.removeEventListener("blur",Ve)}},[x,pe,Ke,Ve]),r.useEffect(function(){if(!(x==null||!pe("hover")))return x.addEventListener("mouseenter",Ke),x.addEventListener("mouseleave",Ve),function(){x.removeEventListener("mouseenter",Ke),x.removeEventListener("mouseleave",Ve)}},[x,pe,Ke,Ve]),r.useEffect(function(){if(!(G==null||!pe("hover")||!Me().finalConfig.interactive))return G.addEventListener("mouseenter",Ke),G.addEventListener("mouseleave",Ve),function(){G.removeEventListener("mouseenter",Ke),G.removeEventListener("mouseleave",Ve)}},[G,pe,Ke,Ve,Me]);var St=De==null||(s=De.state)==null||(c=s.modifiersData)==null||(d=c.hide)==null?void 0:d.isReferenceHidden;r.useEffect(function(){f.closeOnTriggerHidden&&St&&Ve()},[f.closeOnTriggerHidden,Ve,St]),r.useEffect(function(){if(!f.followCursor||x==null)return;function rt(Ue){var st=Ue.clientX,Ht=Ue.clientY;Dn.getBoundingClientRect=An(st,Ht),oe?.()}return x.addEventListener("mousemove",rt),function(){return x.removeEventListener("mousemove",rt)}},[f.followCursor,x,oe]),r.useEffect(function(){if(!(G==null||oe==null||f.mutationObserverOptions==null)){var rt=new MutationObserver(oe);return rt.observe(G,f.mutationObserverOptions),function(){return rt.disconnect()}}},[f.mutationObserverOptions,G,oe]);var pt=function(Ue){return Ue===void 0&&(Ue={}),(0,Tt.A)({},Ue,{style:(0,Tt.A)({},Ue.style,he.popper)},ce.popper,{"data-popper-interactive":f.interactive})},It=function(Ue){return Ue===void 0&&(Ue={}),(0,Tt.A)({},Ue,ce.arrow,{style:(0,Tt.A)({},Ue.style,he.arrow),"data-popper-arrow":!0})};return(0,Tt.A)({getArrowProps:It,getTooltipProps:pt,setTooltipRef:j,setTriggerRef:D,tooltipRef:G,triggerRef:x,visible:J},De)}var Ls=l(17464),Ss=Object.defineProperty,$s=Object.defineProperties,Ts=Object.getOwnPropertyDescriptors,Mn=Object.getOwnPropertySymbols,Qs=Object.prototype.hasOwnProperty,ws=Object.prototype.propertyIsEnumerable,In=(e,t,s)=>t in e?Ss(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Rs=(e,t)=>{for(var s in t||(t={}))Qs.call(t,s)&&In(e,s,t[s]);if(Mn)for(var s of Mn(t))ws.call(t,s)&&In(e,s,t[s]);return e},Fs=(e,t)=>$s(e,Ts(t));const Xn=r.memo(({definition:e,operation:t,innerQueryPlaceholder:s})=>{const c=(0,te.of)(Cs),[d,f]=(0,r.useState)(!1),{getTooltipProps:b,setTooltipRef:O,setTriggerRef:h,visible:x}=xs({placement:"top",visible:d,offset:[0,16],onVisibleChange:f,interactive:!0,trigger:["click"]});return r.createElement(r.Fragment,null,r.createElement(U.$n,{title:"Click to show description",ref:h,icon:"info-circle",size:"sm",variant:"secondary",fill:"text"}),x&&r.createElement(Ls.ZL,null,r.createElement("div",Fs(Rs({ref:O},b()),{className:c.docBox}),r.createElement("div",{className:c.docBoxHeader},r.createElement("span",null,e.renderer(t,e,s)),r.createElement(F.Z,{grow:1}),r.createElement(U.$n,{icon:"times",onClick:()=>f(!1),fill:"text",variant:"secondary",title:"Remove operation"})),r.createElement("div",{className:c.docBoxBody,dangerouslySetInnerHTML:{__html:As(e,t)}}))))});Xn.displayName="OperationDocs";const Cs=e=>({docBox:(0,$.css)({overflow:"hidden",background:e.colors.background.primary,border:`1px solid ${e.colors.border.strong}`,boxShadow:e.shadows.z3,maxWidth:"600px",padding:e.spacing(1),borderRadius:e.shape.radius.default,zIndex:e.zIndex.tooltip}),docBoxHeader:(0,$.css)({fontSize:e.typography.h5.fontSize,fontFamily:e.typography.fontFamilyMonospace,paddingBottom:e.spacing(1),display:"flex",alignItems:"center"}),docBoxBody:(0,$.css)({marginBottom:e.spacing(-1),color:e.colors.text.secondary}),signature:(0,$.css)({fontSize:e.typography.bodySmall.fontSize,fontFamily:e.typography.fontFamilyMonospace}),dropdown:(0,$.css)({opacity:0,color:e.colors.text.secondary})});function As(e,t){var s;return(0,Bt.G)(e.explainHandler?e.explainHandler(t,e):(s=e.documentation)!=null?s:"no docs")}var Ds=Object.defineProperty,Ns=Object.defineProperties,Ms=Object.getOwnPropertyDescriptors,Un=Object.getOwnPropertySymbols,Is=Object.prototype.hasOwnProperty,Xs=Object.prototype.propertyIsEnumerable,Bn=(e,t,s)=>t in e?Ds(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,vn=(e,t)=>{for(var s in t||(t={}))Is.call(t,s)&&Bn(e,s,t[s]);if(Un)for(var s of Un(t))Xs.call(t,s)&&Bn(e,s,t[s]);return e},Wn=(e,t)=>Ns(e,Ms(t));const _n=r.memo(({operation:e,definition:t,index:s,onChange:c,onRemove:d,queryModeller:f,dragHandleProps:b})=>{var O;const h=(0,te.of)(Us),[x,D]=(0,r.useState)({}),R=()=>{if(x.isOpen)D(Wn(vn({},x),{isOpen:!1}));else{const G=f.getAlternativeOperations(t.alternativesKey).map(j=>({label:j.name,value:j}));D({isOpen:!0,alternatives:G})}};return r.createElement("div",{className:h.header},!x.isOpen&&r.createElement(r.Fragment,null,r.createElement("div",vn({},b),(O=t.name)!=null?O:t.id),r.createElement(F.Z,{grow:1}),r.createElement("div",{className:`${h.operationHeaderButtons} operation-header-show-on-hover`},r.createElement(U.$n,{icon:"angle-down",size:"sm",onClick:R,fill:"text",variant:"secondary",title:"Click to view alternative operations"}),r.createElement(Xn,{definition:t,operation:e,innerQueryPlaceholder:f.innerQueryPlaceholder}),r.createElement(U.$n,{icon:"times",size:"sm",onClick:()=>d(s),fill:"text",variant:"secondary",title:"Remove operation"}))),x.isOpen&&r.createElement("div",{className:h.selectWrapper},r.createElement(Ut.l6,{autoFocus:!0,openMenuOnFocus:!0,placeholder:"Replace with",options:x.alternatives,isOpen:!0,onCloseMenu:R,onChange:G=>{if(G.value){const j=f.getOperationDefinition(G.value.id),Ee=[...j.defaultParams];for(let le=0;le<Math.min(e.params.length,Ee.length);le++)j.params[le].type===t.params[le].type&&(Ee[le]=e.params[le]);const J=Wn(vn({},e),{params:Ee,id:G.value.id});c(s,t.changeTypeHandler?t.changeTypeHandler(J,j):J)}}})))});_n.displayName="OperationHeader";const Us=e=>({header:(0,$.css)({borderBottom:`1px solid ${e.colors.border.medium}`,padding:e.spacing(.5,.5,.5,1),display:"flex",alignItems:"center"}),operationHeaderButtons:(0,$.css)({opacity:1}),selectWrapper:(0,$.css)({paddingRight:e.spacing(2)})});var pa=l(51440),Bs=l(10880);function Ws(e){if(e.editor)return e.editor;if(e.options)return Vs;switch(e.type){case"boolean":return ks;case"number":case"string":default:return _s}}function _s(e){var t;return r.createElement(pa.D,{id:on(e.operationId,e.index),defaultValue:(t=e.value)==null?void 0:t.toString(),minWidth:e.paramDef.minWidth,placeholder:e.paramDef.placeholder,title:e.paramDef.description,maxWidth:(e.paramDef.minWidth||20)*3,onCommitChange:s=>{e.onChange(e.index,s.currentTarget.value),e.paramDef.runQueryOnEnter&&s.type==="keydown"&&e.onRunQuery()}})}function ks(e){return r.createElement(Bs.S,{id:on(e.operationId,e.index),value:!!e.value,onChange:t=>e.onChange(e.index,t.currentTarget.checked)})}function Vs({paramDef:e,value:t,index:s,operationId:c,onChange:d}){var f,b;const O=(0,te.of)(js);let h=e.options;(f=h[0])!=null&&f.label||(h=e.options.map(D=>({label:D.toString(),value:D})));let x=(b=h.find(D=>D.value===t))!=null?b:(0,Yt.z)(t);return!t&&e.optional?r.createElement("div",{className:O.optionalParam},r.createElement(U.$n,{size:"sm",variant:"secondary",title:`Add ${e.name}`,icon:"plus",onClick:()=>d(s,h[0].value)},e.name)):r.createElement(Re.B,{gap:.5,direction:"row",alignItems:"center"},r.createElement(Ut.l6,{id:on(c,s),value:x,options:h,placeholder:e.placeholder,allowCustomValue:!0,onChange:D=>d(s,D.value),width:e.minWidth||"auto"}),e.optional&&r.createElement(U.$n,{"data-testid":`operations.${s}.remove-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${e.name}`,onClick:()=>d(s,"")}))}const js=e=>({optionalParam:(0,$.css)({marginTop:e.spacing(1)})});function on(e,t){return`operations.${e}.param.${t}`}var zs=Object.defineProperty,Ks=Object.defineProperties,Hs=Object.getOwnPropertyDescriptors,kn=Object.getOwnPropertySymbols,Gs=Object.prototype.hasOwnProperty,Ys=Object.prototype.propertyIsEnumerable,Vn=(e,t,s)=>t in e?zs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,ln=(e,t)=>{for(var s in t||(t={}))Gs.call(t,s)&&Vn(e,s,t[s]);if(kn)for(var s of kn(t))Ys.call(t,s)&&Vn(e,s,t[s]);return e},cn=(e,t)=>Ks(e,Hs(t));function Js({provided:e,flash:t,isConflicting:s,highlight:c,index:d,queryModeller:f,onChange:b,onRemove:O,operation:h,definition:x,query:D,timeRange:R,onRunQuery:G,datasource:j}){const Ee=(0,te.$j)(),J=Zs(Ee,s),le=qs(t),{current:ge}=(0,r.useRef)((0,ya.A)()),ie=(oe,Me)=>{const pe=cn(ln({},h),{params:[...h.params]});pe.params[oe]=Me,On(x,pe,d,oe,b)},he=()=>{const oe=cn(ln({},h),{params:[...h.params,""]});On(x,oe,d,h.params.length,b)},ce=oe=>{const Me=cn(ln({},h),{params:[...h.params.slice(0,oe),...h.params.slice(oe+1)]});On(x,Me,d,oe,b)};let De;if(x.params.length>0){const oe=x.params[x.params.length-1];oe.restParam&&(De=ei(oe,he,d,h.params.length,J))}return r.createElement("div",cn(ln({className:(0,$.cx)(J.card,(le||c)&&J.cardHighlight,s&&J.cardError),ref:e.innerRef},e.draggableProps),{"data-testid":`operations.${d}.wrapper`}),r.createElement(_n,{operation:h,dragHandleProps:e.dragHandleProps,definition:x,index:d,onChange:b,onRemove:O,queryModeller:f}),r.createElement("div",{className:J.body},h.params.map((oe,Me)=>{const pe=x.params[Math.min(x.params.length-1,Me)],Ve=Ws(pe);return r.createElement("div",{className:J.paramRow,key:`${Me}-1`},!pe.hideName&&r.createElement("div",{className:J.paramName},r.createElement("label",{htmlFor:on(ge,Me)},pe.name),pe.description&&r.createElement(Ge.m,{placement:"top",content:pe.description,theme:"info"},r.createElement(Vr.I,{name:"info-circle",size:"sm",className:J.infoIcon}))),r.createElement("div",{className:J.paramValue},r.createElement(Re.B,{gap:.5,direction:"row",alignItems:"center",wrap:!1},r.createElement(Ve,{index:Me,paramDef:pe,value:h.params[Me],operation:h,operationId:ge,onChange:ie,onRunQuery:G,query:D,datasource:j,timeRange:R,queryModeller:f}),pe.restParam&&(h.params.length>x.params.length||pe.optional)&&r.createElement(U.$n,{"data-testid":`operations.${d}.remove-rest-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${pe.name}`,onClick:()=>ce(Me)}))))})),De,d<D.operations.length-1&&r.createElement("div",{className:J.arrow},r.createElement("div",{className:J.arrowLine}),r.createElement("div",{className:J.arrowArrow})))}const Zs=(e,t)=>({cardWrapper:(0,$.css)({alignItems:"stretch"}),error:(0,$.css)({marginBottom:e.spacing(1)}),card:(0,$.css)({background:e.colors.background.primary,border:`1px solid ${e.colors.border.medium}`,cursor:"grab",borderRadius:e.shape.radius.default,position:"relative",transition:"all 0.5s ease-in 0s",height:t?"auto":"100%"}),cardError:(0,$.css)({boxShadow:`0px 0px 4px 0px ${e.colors.warning.main}`,border:`1px solid ${e.colors.warning.main}`}),cardHighlight:(0,$.css)({boxShadow:`0px 0px 4px 0px ${e.colors.primary.border}`,border:`1px solid ${e.colors.primary.border}`}),infoIcon:(0,$.css)({marginLeft:e.spacing(.5),color:e.colors.text.secondary,":hover":{color:e.colors.text.primary}}),body:(0,$.css)({margin:e.spacing(1,1,.5,1),display:"table"}),paramRow:(0,$.css)({label:"paramRow",display:"table-row",verticalAlign:"middle"}),paramName:(0,$.css)({display:"table-cell",padding:e.spacing(0,1,0,0),fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,verticalAlign:"middle",height:"32px"}),paramValue:(0,$.css)({label:"paramValue",display:"table-cell",verticalAlign:"middle"}),restParam:(0,$.css)({padding:e.spacing(0,1,1,1)}),arrow:(0,$.css)({position:"absolute",top:"0",right:"-18px",display:"flex"}),arrowLine:(0,$.css)({height:"2px",width:"8px",backgroundColor:e.colors.border.strong,position:"relative",top:"14px"}),arrowArrow:(0,$.css)({width:0,height:0,borderTop:"5px solid transparent",borderBottom:"5px solid transparent",borderLeft:`7px solid ${e.colors.border.strong}`,position:"relative",top:"10px"})});function qs(e){const[t,s]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let c;return e?c=setTimeout(()=>{s(!1)},1e3):s(!0),()=>clearTimeout(c)},[e]),t&&e}function On(e,t,s,c,d){e.paramChangedHandler?d(s,e.paramChangedHandler(c,t,e)):d(s,t)}function ei(e,t,s,c,d){return r.createElement("div",{className:d.restParam,key:`${c}-2`},r.createElement(U.$n,{size:"sm",icon:"plus",title:`Add ${e.name}`.trimEnd(),variant:"secondary",onClick:t,"data-testid":`operations.${s}.add-rest-param`},e.name))}function ti({operation:e,index:t,onRemove:s,onChange:c,onRunQuery:d,queryModeller:f,query:b,datasource:O,flash:h,highlight:x,timeRange:D,isConflictingOperation:R}){const G=f.getOperationDefinition(e.id),j=(0,te.$j)(),Ee=R?R(e,b.operations):!1,J=ri(j);if(!G)return r.createElement("span",null,"Operation ",e.id," not found");const le=ge=>{if(!ge)return Ee?!0:void 0};return r.createElement(kr.sx,{draggableId:`operation-${t}`,index:t},(ge,ie)=>r.createElement(Jt.I,{error:"You have conflicting label filters",invalid:le(ie.isDragging),className:(0,$.cx)(J.error,J.cardWrapper)},r.createElement(Js,{provided:ge,flash:h,highlight:x,isConflicting:Ee,index:t,operation:e,definition:G,onChange:c,onRemove:s,queryModeller:f,query:b,timeRange:D,onRunQuery:d,datasource:O})))}const ri=(e,t)=>({cardWrapper:(0,$.css)({alignItems:"stretch"}),error:(0,$.css)({marginBottom:e.spacing(1)})});var ai=Object.defineProperty,ni=Object.defineProperties,si=Object.getOwnPropertyDescriptors,jn=Object.getOwnPropertySymbols,ii=Object.prototype.hasOwnProperty,oi=Object.prototype.propertyIsEnumerable,zn=(e,t,s)=>t in e?ai(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,un=(e,t)=>{for(var s in t||(t={}))ii.call(t,s)&&zn(e,s,t[s]);if(jn)for(var s of jn(t))oi.call(t,s)&&zn(e,s,t[s]);return e},yn=(e,t)=>ni(e,si(t));function li({query:e,datasource:t,queryModeller:s,onChange:c,onRunQuery:d,highlightedOp:f,timeRange:b,isConflictingOperation:O}){const h=(0,te.of)(di),{operations:x}=e,D=ci(x),[R,G]=(0,r.useState)(!1),j=(he,ce)=>{const De=[...x];De.splice(he,1,ce),c(yn(un({},e),{operations:De}))},Ee=he=>{const ce=[...x.slice(0,he),...x.slice(he+1)];c(yn(un({},e),{operations:ce}))},J=s.getCategories().map(he=>({value:he,label:he,items:s.getOperationsForCategory(he).map(ce=>({value:ce.id,label:ce.name,isLeaf:!0}))})),le=he=>{const ce=s.getOperationDefinition(he);ce&&(c(ce.addOperationHandler(ce,e,s)),G(!1))},ge=he=>{if(!he.destination)return;const ce=[...x],De=ce[he.source.index];ce.splice(he.source.index,1),ce.splice(he.destination.index,0,De),c(yn(un({},e),{operations:ce}))},ie=()=>{G(!1)};return r.createElement(Re.B,{gap:1,direction:"column"},r.createElement(Re.B,{gap:1},x.length>0&&r.createElement(kr.JY,{onDragEnd:ge},r.createElement(kr.gL,{droppableId:"sortable-field-mappings",direction:"horizontal"},he=>r.createElement("div",un({className:h.operationList,ref:he.innerRef},he.droppableProps),x.map((ce,De)=>r.createElement(ti,{key:ce.id+JSON.stringify(ce.params)+De,queryModeller:s,index:De,operation:ce,query:e,datasource:t,onChange:j,onRemove:Ee,onRunQuery:d,flash:D[De],highlight:f===ce,timeRange:b,isConflictingOperation:O})),he.placeholder))),r.createElement("div",{className:h.addButton},R?r.createElement(Ka.v,{options:J,onSelect:le,onBlur:ie,autoFocus:!0,alwaysOpen:!0,hideActiveLevelLabel:!0,placeholder:"Search"}):r.createElement(U.$n,{icon:"plus",variant:"secondary",onClick:()=>G(!0),title:"Add operation"},"Operations"))))}function ci(e){const t=(0,aa.A)(),s=(0,S.A)(e);if(!t())return e.map(()=>!1);if(!s)return e.map(()=>!0);let c=[];if(s.length-1===e.length&&e.every(d=>s.includes(d)))return e.map(()=>!1);if(s.length+1===e.length&&s.every(d=>e.includes(d))){const d=e.find(f=>!s.includes(f));c=e.map(f=>f===d)}else c=e.map((d,f)=>{var b;return!ui(d.id,(b=s[f])==null?void 0:b.id)});return c}function ui(e,t){return e===t||`__${e}_by`===t||e===`__${t}_by`}const di=e=>({heading:(0,$.css)({label:"heading",fontSize:12,fontWeight:e.typography.fontWeightMedium,marginBottom:0}),operationList:(0,$.css)({label:"operationList",display:"flex",flexWrap:"wrap",gap:e.spacing(2)}),addButton:(0,$.css)({label:"addButton",width:126,paddingBottom:e.spacing(1)})}),Kn=({datasource:e,query:t,onChange:s,data:c,queryModeller:d,buildVisualQueryFromString:f,buildDataQueryFromQueryString:b,buildQueryStringFromDataQuery:O})=>{const[h,x]=(0,r.useState)([]),D=(0,te.of)(fi);return(0,r.useEffect)(()=>{var R;const G=b(d.renderQuery(t)),j=(R=e.getQueryHints)==null?void 0:R.call(e,G,c?.series||[]).filter(Ee=>{var J;return(J=Ee.fix)==null?void 0:J.action});x(j??[])},[e,t,c,d,b]),r.createElement(r.Fragment,null,h.length>0&&r.createElement("div",{className:D.container},h.map(R=>{var G,j,Ee,J;return r.createElement(Ge.m,{content:`${R.label} ${(G=R.fix)==null?void 0:G.label}`,key:R.type},r.createElement(U.$n,{onClick:()=>{var le,ge,ie;if((0,de.rR)("grafana_query_builder_hints_clicked",{hint:R.type,datasourceType:e.type}),(le=R?.fix)!=null&&le.action){const he=b(d.renderQuery(t)),ce=(ge=e.modifyQuery)==null?void 0:ge.call(e,he,R.fix.action);if(ce){const De=f((ie=O(ce))!=null?ie:"");return s(De.query)}}},fill:"outline",size:"sm",className:D.hint},"hint: ",((j=R.fix)==null?void 0:j.title)||((J=(Ee=R.fix)==null?void 0:Ee.action)==null?void 0:J.type.toLowerCase().replace("_"," "))))})))};Kn.displayName="QueryBuilderHints";const fi=e=>({container:(0,$.css)`
      display: flex;
      align-items: start;
    `,hint:(0,$.css)`
      margin-right: ${e.spacing(1)};
    `});function Hn({query:e,queryModeller:t,stepNumber:s,language:c,onMouseEnter:d,onMouseLeave:f}){return r.createElement(r.Fragment,null,e.operations.map((b,O)=>{var h;const x=t.getOperationDefinition(b.id);if(!x)return`Operation ${b.id} not found`;const D=x.renderer(b,x,t.innerQueryPlaceholder),R=x.explainHandler?x.explainHandler(b,x):(h=x.documentation)!=null?h:"no docs";return r.createElement("div",{key:O,onMouseEnter:()=>d?.(b,O),onMouseLeave:()=>f?.(b,O)},r.createElement(kt,{stepNumber:O+s,title:r.createElement(ur.Z,{query:D,language:c}),markdown:R}))}))}var dn=l(71713),pi=l(11216),Hr=l(54623);const Gn="Fetch all log lines matching label filters.",Yn=r.memo(({query:e})=>{const t=(0,Gt.u_)(e||"").query,s={grammar:dn.vB,name:"lokiql"};return r.createElement(X.B,{gap:0,direction:"column"},r.createElement(kt,{stepNumber:1,title:r.createElement(ur.Z,{query:`${Ot.y.renderLabels(t.labels)}`,language:s})},Gn),r.createElement(Hn,{stepNumber:2,queryModeller:Ot.y,query:t,language:s}))});Yn.displayName="LokiQueryBuilderExplained";var mi=l(29158),gi=l(58592);const Jn=r.memo(({nestedQuery:e,index:t,datasource:s,onChange:c,onRemove:d,onRunQuery:f,showExplain:b})=>{const O=(0,te.of)(vi);return r.createElement("div",{className:O.card},r.createElement("div",{className:O.header},r.createElement("div",{className:O.name},"Operator"),r.createElement(Ut.l6,{"aria-label":"Select operator",width:"auto",options:hi,value:(0,Yt.z)(e.operator),onChange:h=>{c(t,{...e,operator:h.value})}}),r.createElement("div",{className:O.name},"Vector matches"),r.createElement("div",{className:O.vectorMatchWrapper},r.createElement(Ut.l6,{width:"auto",value:e.vectorMatchesType||"on",allowCustomValue:!0,options:[{value:"on",label:"on"},{value:"ignoring",label:"ignoring"}],onChange:h=>{c(t,{...e,vectorMatchesType:h.value})}}),r.createElement(pa.D,{className:O.vectorMatchInput,minWidth:20,defaultValue:e.vectorMatches,onCommitChange:h=>{c(t,{...e,vectorMatches:h.currentTarget.value,vectorMatchesType:e.vectorMatchesType||"on"})}})),r.createElement(F.Z,{grow:1}),r.createElement(mi.K,{name:"times",size:"sm",onClick:()=>d(t),tooltip:"Remove nested query"})),r.createElement("div",{className:O.body},r.createElement(L.D,null,r.createElement(bn,{showExplain:b,query:e.query,datasource:s,onRunQuery:f,onChange:h=>{c(t,{...e,query:h})}}))))}),hi=gi.C.map(e=>({label:e.sign,value:e.sign}));Jn.displayName="NestedQuery";const vi=e=>({card:(0,$.css)({label:"card",display:"flex",flexDirection:"column",gap:e.spacing(.5)}),header:(0,$.css)({label:"header",padding:e.spacing(.5,.5,.5,1),gap:e.spacing(1),display:"flex",alignItems:"center"}),name:(0,$.css)({label:"name",whiteSpace:"nowrap"}),body:(0,$.css)({label:"body",paddingLeft:e.spacing(2)}),vectorMatchInput:(0,$.css)({label:"vectorMatchInput",marginLeft:-1}),vectorMatchWrapper:(0,$.css)({label:"vectorMatchWrapper",display:"flex"})});function Oi({query:e,datasource:t,onChange:s,onRunQuery:c,showExplain:d}){const f=e.binaryQueries??[],b=(h,x)=>{const D=[...f];D.splice(h,1,x),s({...e,binaryQueries:D})},O=h=>{const x=[...f.slice(0,h),...f.slice(h+1)];s({...e,binaryQueries:x})};return r.createElement(X.B,{direction:"column",gap:1},f.map((h,x)=>r.createElement(Jn,{key:x.toString(),nestedQuery:h,index:x,onChange:b,datasource:t,onRemove:O,onRunQuery:c,showExplain:d})))}const Zn=5*60*1e3,bn=r.memo(({datasource:e,query:t,onChange:s,onRunQuery:c,showExplain:d,timeRange:f})=>{const[b,O]=(0,r.useState)(),[h,x]=(0,r.useState)(void 0),D=(0,S.A)(t),R=(0,S.A)(f),G=ie=>{s({...t,labels:ie})},j=async ie=>{const he=await ie;return[...e.getVariables(),...he].map(ce=>({label:ce,value:ce}))},Ee=async ie=>{const he=t.labels.filter(pe=>pe!==ie),ce=he.find(pe=>pe.op==="="||pe.op==="=~"&&new RegExp(pe.value).test("")===!1);if(he.length===0||!ce)return await e.languageProvider.fetchLabels({timeRange:f});const De=Ot.y.renderLabels(he),oe=await e.languageProvider.fetchLabels({streamSelector:De,timeRange:f}),Me=he.map(pe=>pe.label);return oe.filter(pe=>!Me.includes(pe)).sort()},J=async ie=>{if(!ie.label)return[];let he;const ce=t.labels.filter(oe=>oe!==ie),De=ce.find(oe=>oe.op==="="||oe.op==="=~"&&new RegExp(oe.value).test("")===!1);if(ce.length===0||!De)he=await e.languageProvider.fetchLabelValues(ie.label,{timeRange:f});else{const oe=Ot.y.renderLabels(ce);he=await e.languageProvider.fetchLabelValues(ie.label,{streamSelector:oe,timeRange:f})}return he?he.map(oe=>(0,E.Bb)(oe,ie.op)):[]},le=(0,r.useMemo)(()=>{const{labels:ie,operations:he}=t;return!ie.length&&he.length?!(he.length===1&&he[0].id===Hr.EF.LineContains&&he[0].params[0]===""):!1},[t]);(0,r.useEffect)(()=>{const ie=async()=>{const De={expr:Ot.y.renderQuery(t),refId:"data-samples"},oe=f??(0,qr.E2)(),pe={series:await e.getDataSamples(De,oe),state:ke.Gu.Done,timeRange:oe};O(pe)},he=R&&f&&(Math.abs(f.to.valueOf()-R.to.valueOf())>Zn||Math.abs(f.from.valueOf()-R.from.valueOf())>Zn),ce=!(0,A.isEqual)(D,t);v.$.featureToggles.lokiQueryHints&&(he||ce)&&ie().catch(console.error)},[e,t,f,D,R]);const ge={grammar:dn.Ay,name:"logql"};return r.createElement("div",{"data-testid":Pn.editor},r.createElement(ea.U,null,r.createElement(Tr,{onGetLabelNames:ie=>j(Ee(ie)),onGetLabelValues:ie=>j(J(ie)),labelsFilters:t.labels,onChange:G,labelFilterRequired:le})),d&&r.createElement(kt,{stepNumber:1,title:r.createElement(ur.Z,{query:`${Ot.y.renderLabels(t.labels)}`,language:ge})},Gn),r.createElement(ra.i,null,r.createElement(li,{queryModeller:Ot.y,query:t,onChange:s,onRunQuery:c,datasource:e,highlightedOp:h,isConflictingOperation:(ie,he)=>ie.id===Hr.EF.LabelFilter&&(0,pi.hh)(ie,he)}),r.createElement(Kn,{datasource:e,query:t,onChange:s,data:b,queryModeller:Ot.y,buildVisualQueryFromString:Gt.u_,buildDataQueryFromQueryString:ie=>({expr:ie,refId:"hints"}),buildQueryStringFromDataQuery:ie=>ie.expr})),d&&r.createElement(Hn,{stepNumber:2,queryModeller:Ot.y,query:t,language:ge,onMouseEnter:ie=>{x(ie)},onMouseLeave:()=>{x(void 0)}}),t.binaryQueries&&t.binaryQueries.length>0&&r.createElement(Oi,{query:t,datasource:e,onChange:s,onRunQuery:c,showExplain:d}))});bn.displayName="LokiQueryBuilder";function yi({query:e}){return r.createElement(ea.U,null,r.createElement(ka.B,null,r.createElement(ur.Z,{query:e,language:{grammar:dn.vB,name:"lokiql"}})))}function bi(e){const{query:t,onChange:s,onRunQuery:c,datasource:d,showExplain:f,timeRange:b}=e,[O,h]=(0,r.useReducer)(qn.reducer,{expr:t.expr,visQuery:t.expr===""?{labels:[],operations:[{id:"__line_contains",params:[""]}]}:void 0});(0,r.useEffect)(()=>{h(xi(t.expr))},[t.expr]);const x=D=>{const R=Ot.y.renderQuery(D);h(Pi({visQuery:D,expr:R})),s({...e.query,expr:R})};return O.visQuery?r.createElement(r.Fragment,null,r.createElement(bn,{query:O.visQuery,datasource:d,onChange:x,onRunQuery:c,showExplain:f,"data-testid":Pn.editor,timeRange:b}),t.expr!==""&&r.createElement(yi,{query:t.expr})):null}const Ei={expr:""},qn=(0,Oa.Z0)({name:"loki-builder-container",initialState:Ei,reducers:{visualQueryChange:(e,t)=>{e.expr=t.payload.expr,e.visQuery=t.payload.visQuery},exprChanged:(e,t)=>{if(!e.visQuery||e.expr!==t.payload){e.expr=t.payload;const s=(0,Gt.u_)(t.payload);e.visQuery=s.query}}}}),{visualQueryChange:Pi,exprChanged:xi}=qn.actions;var es=l(70416),Li=l(42941),Si=l(83195),ts=l(82762);function $i({title:e,children:t,collapsedInfo:s,queryStats:c}){const[d,f]=(0,Li.A)(!1),b=(0,te.of)(Ti);return r.createElement("div",{className:b.wrapper},r.createElement(ts.S,{className:b.collapse,collapsible:!0,isOpen:d,onToggle:f,label:r.createElement(Re.B,{gap:0},r.createElement("h6",{className:b.title},e),!d&&r.createElement("div",{className:b.description},s.map((O,h)=>r.createElement("span",{key:h},O))))},r.createElement("div",{className:b.body},t)),c&&v.$.featureToggles.lokiQuerySplitting&&r.createElement(Ge.m,{content:"Note: the query will be split into multiple parts and executed in sequence. Query limits will only apply each individual part."},r.createElement(Vr.I,{tabIndex:0,name:"info-circle",className:b.tooltip,size:"sm"})),c&&r.createElement("p",{className:b.stats},Qi(c)))}const Ti=e=>({collapse:(0,$.css)({backgroundColor:"unset",border:"unset",marginBottom:0,"> button":{padding:e.spacing(0,1)}}),wrapper:(0,$.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,$.css)({flexGrow:1,overflow:"hidden",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,margin:0}),description:(0,$.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.bodySmall.fontWeight,paddingLeft:e.spacing(2),gap:e.spacing(2),display:"flex"}),body:(0,$.css)({display:"flex",gap:e.spacing(2),flexWrap:"wrap"}),stats:(0,$.css)({margin:"0px",color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize}),tooltip:(0,$.css)({marginRight:e.spacing(.25)})}),Qi=e=>e.message?e.message:`This query will process approximately ${wi(e)}.`,wi=e=>{const{text:t,suffix:s}=(0,Si.j_)("bytes")(e.bytes,1);return t+s};var Ri=l(42418),Xa=l(60016),rs=l(56587);const as=r.memo(({app:e,query:t,onChange:s,onRunQuery:c,maxLines:d,queryStats:f})=>{const[b,O]=(0,r.useState)(!0),h=ge=>{s({...t,queryType:ge}),c()},x=ge=>{(0,de.rR)("grafana_loki_resolution_clicked",{app:e,resolution:ge.value}),s({...t,resolution:ge.value}),c()},D=ge=>{const ie=ge.currentTarget.value;if(!(0,es.di)(ie)){O(!1);return}O(!0),s({...t,splitDuration:ie}),c()},R=ge=>{s({...t,legendFormat:ge.currentTarget.value}),c()};function G(ge){const ie=(0,Xa.wU)(ge.currentTarget.value);t.maxLines!==ie&&(s({...t,maxLines:ie}),c())}function j(ge){s({...t,step:(0,A.trim)(ge.currentTarget.value)}),c()}const Ee=(0,rs.Io)(t),J=(0,rs.sI)(t.expr),le=(0,r.useMemo)(()=>!!(!t.step||(0,es.V3)(t.step)||!isNaN(Number(t.step))),[t.step]);return r.createElement(ea.U,null,r.createElement($i,{title:"Options",collapsedInfo:Fi(t,Ee,d,J,le),queryStats:f},r.createElement(cr.c,{label:"Legend",tooltip:"Series name override or template. Ex. {{hostname}} will be replaced with label value for hostname."},r.createElement(pa.D,{placeholder:"{{label}}",type:"string",minWidth:14,defaultValue:t.legendFormat,onCommitChange:R})),r.createElement(cr.c,{label:"Type"},r.createElement(K.z,{options:Xa.TO,value:Ee,onChange:h})),J&&r.createElement(cr.c,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query."},r.createElement(pa.D,{className:"width-4",placeholder:d.toString(),type:"number",min:0,defaultValue:t.maxLines?.toString()??"",onCommitChange:G})),!J&&r.createElement(r.Fragment,null,r.createElement(cr.c,{label:"Step",tooltip:"Use the step parameter when making metric queries to Loki. If not filled, Grafana's calculated interval will be used. Example valid values: 1s, 5m, 10h, 1d.",invalid:!le,error:"Invalid step. Example valid values: 1s, 5m, 10h, 1d."},r.createElement(pa.D,{className:"width-6",placeholder:"auto",type:"string",defaultValue:t.step??"",onCommitChange:j})),t.resolution!==void 0&&t.resolution>1&&r.createElement(r.Fragment,null,r.createElement(cr.c,{label:"Resolution",tooltip:"Changes the step parameter of Loki metrics range queries. With a resolution of 1/1, each pixel corresponds to one data point. 1/10 retrieves one data point per 10 pixels. Lower resolutions perform better."},r.createElement(Ut.l6,{isSearchable:!1,onChange:x,options:Xa.iB,value:t.resolution||1,"aria-label":"Select resolution"})),r.createElement(Ri.F,{severity:"warning",title:"The 'Resolution' is deprecated. Use 'Step' editor instead to change step parameter."}))),v.$.featureToggles.lokiQuerySplittingConfig&&v.$.featureToggles.lokiQuerySplitting&&r.createElement(cr.c,{label:"Split Duration",tooltip:"Defines the duration of a single query when query splitting is enabled."},r.createElement(pa.D,{minWidth:14,type:"string",min:0,defaultValue:t.splitDuration??"1d",onCommitChange:D,invalid:!b}))))});function Fi(e,t,s,c,d){const f=Xa.TO.find(h=>h.value===t),b=Xa.iB.find(h=>h.value===(e.resolution??1)),O=[];return e.legendFormat&&O.push(`Legend: ${e.legendFormat}`),O.push(`Type: ${f?.label}`),c&&O.push(`Line limit: ${e.maxLines??s}`),c||(e.step&&O.push(`Step: ${d?e.step:"Invalid value"}`),e.resolution&&O.push(`Resolution: ${b?.label}`)),O}as.displayName="LokiQueryBuilderOptions";var ns=l(95881);function Ci({query:e,datasource:t,range:s,onRunQuery:c,onChange:d,data:f,app:b,showExplain:O,history:h}){const x=(0,te.of)(Ai);return r.createElement("div",{className:x.wrapper},r.createElement(ns.W,{datasource:t,query:e,range:s,onRunQuery:c,onChange:d,history:h,data:f,app:b,"data-testid":Pn.editor}),O&&r.createElement(Yn,{query:e.expr}))}const Ai=e=>({wrapper:(0,$.css)`
      max-width: 100%;
      .gf-form {
        margin-bottom: 0.5;
      }
    `,buttonGroup:(0,$.css)`
      border: 1px solid ${e.colors.border.medium};
      border-top: none;
      padding: ${e.spacing(.5,.5,.5,.5)};
      margin-bottom: ${e.spacing(.5)};
      display: flex;
      flex-grow: 1;
      justify-content: end;
      font-size: ${e.typography.bodySmall.fontSize};
    `,hint:(0,$.css)`
      color: ${e.colors.text.disabled};
      white-space: nowrap;
      cursor: help;
    `});var Di=l(77789),Ni=l(83657),En=l(10860);const Mi=e=>{const{pattern:t,onPatternSelect:s,hasNewQueryOption:c,hasPreviousQuery:d,selectedPatternName:f,setSelectedPatternName:b}=e,O=(0,te.of)(Ii),h={grammar:dn.Ay,name:"logql"};return r.createElement(En.Z,{className:O.card},r.createElement(En.Z.Heading,null,t.name),r.createElement("div",{className:O.rawQueryContainer},r.createElement(ur.Z,{query:Ot.y.renderQuery({labels:[],operations:t.operations}),language:h,className:O.rawQuery})),r.createElement(En.Z.Actions,null,f!==t.name?r.createElement(U.$n,{size:"sm",onClick:()=>{d?b(t.name):s(t)}},"Use this query"):r.createElement(r.Fragment,null,r.createElement("div",{className:O.spacing},`If you would like to use this query, ${c?"you can either replace your current query or create a new query":"your current query will be replaced"}.`),r.createElement(U.$n,{size:"sm",fill:"outline",onClick:()=>b(null)},"Back"),r.createElement(U.$n,{size:"sm",onClick:()=>{s(t)}},"Apply to query"),c&&r.createElement(U.$n,{size:"sm",onClick:()=>{s(t,!0)}},"Create new query"))))},Ii=e=>({card:(0,$.css)`
      width: 49.5%;
      display: flex;
      flex-direction: column;
    `,rawQueryContainer:(0,$.css)`
      flex-grow: 1;
    `,rawQuery:(0,$.css)`
      background-color: ${e.colors.background.primary};
      padding: ${e.spacing(1)};
      margin-top: ${e.spacing(1)};
    `,spacing:(0,$.css)`
      margin-bottom: ${e.spacing(1)};
    `}),Xi=[Hr.Ln.Formats,Hr.Ln.LineFilters,Hr.Ln.LabelFilters],Ui=[Hr.EF.Unwrap],Bi=Ni.sp.filter(e=>e.category&&Xi.includes(e.category)&&!Ui.includes(e.id)).map(e=>e.id),Wi=e=>{const{isOpen:t,onClose:s,onChange:c,onAddQuery:d,query:f,queries:b,app:O}=e,[h,x]=(0,r.useState)([]),[D,R]=(0,r.useState)(null),G=(0,te.of)(_i),j=!!d,Ee=(0,r.useMemo)(()=>(0,Gt.u_)(f.expr).query.operations.length>0,[f.expr]),J=(le,ge=!1)=>{const ie=(0,Gt.u_)(ge?"":f.expr);(0,de.rR)("grafana_loki_query_patterns_selected",{version:"v2",app:O??"",editorMode:f.editorMode,selectedPattern:le.name,preSelectedOperationsCount:ie.query.operations.length,preSelectedLabelsCount:ie.query.labels.length,createNewQuery:j&&ge}),ie.query.operations=ie.query.operations.filter(ce=>Bi.includes(ce.id));const he=le.operations.filter(ce=>ie.query.operations.findIndex(De=>De.id===ce.id)<0);ie.query.operations=[...ie.query.operations,...he],j&&ge?d({...f,refId:(0,Di.M)(b??[f]),expr:Ot.y.renderQuery(ie.query)}):c({...f,expr:Ot.y.renderQuery(ie.query)}),R(null),s()};return r.createElement(ut.a,{isOpen:t,title:"Kick start your query",onDismiss:s,className:G.modal},r.createElement("div",{className:G.spacing},"Kick start your query by selecting one of these queries. You can then continue to complete your query."),Object.values(Hr.IQ).map(le=>r.createElement(ts.S,{key:le,label:`${(0,A.capitalize)(le)} query starters`,isOpen:h.includes(le),collapsible:!0,onToggle:()=>x(ge=>ge.includes(le)?ge.filter(ie=>ie!==le):[...ge,le])},r.createElement("div",{className:G.cardsContainer},Ot.y.getQueryPatterns().filter(ge=>ge.type===le).map(ge=>r.createElement(Mi,{key:ge.name,pattern:ge,hasNewQueryOption:j,hasPreviousQuery:Ee,onPatternSelect:J,selectedPatternName:D,setSelectedPatternName:R}))))),r.createElement(U.$n,{variant:"secondary",onClick:s},"Close"))},_i=e=>({cardsContainer:(0,$.css)`
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: space-between;
    `,spacing:(0,$.css)`
      margin-bottom: ${e.spacing(1)};
    `,modal:(0,$.css)`
      width: 85vw;
      ${e.breakpoints.down("md")} {
        width: 100%;
      }
    `});var ki=l(65650);const ss="LokiQueryEditorModeDefault";function Vi(e,t,s){e.expr===""&&window.localStorage.setItem(ss,t),s({...e,editorMode:t})}function ji(e){if(e!=null&&e!=="")return ve.f.Code;switch(window.localStorage.getItem(ss)){case"code":return ve.f.Code;case"builder":default:return ve.f.Builder}}function zi(e){let t=e;return e.editorMode||(t={...e,editorMode:ji(e.expr)}),e.expr==null&&(t={...t,expr:""}),e.queryType==null&&(t={...t,queryType:ki.U3.Range}),t}var Ki=l(47232);function is(e,t){return!e||!t?!1:(0,Ki.Ar)(e)?e.isSame(t):e===t}function Hi(e,t,s,c,d,f){return t===void 0||e.trim()!==t.trim()||d!==f?!0:!(is(s?.raw.from,c?.raw.from)&&is(s?.raw.to,c?.raw.to))}const Pn={editor:"loki-editor"},os="LokiQueryEditorExplainDefault",ls=r.memo(e=>{const t=(0,r.useId)(),{onChange:s,onRunQuery:c,onAddQuery:d,data:f,app:b,queries:O,datasource:h,range:x}=e,[D,R]=(0,r.useState)(!1),[G,j]=(0,r.useState)(!1),[Ee,J]=(0,r.useState)(!1),[le,ge]=(0,r.useState)(!1),[ie,he]=(0,r.useState)(null),[ce,De]=(0,r.useState)(window.localStorage.getItem(os)==="true"),oe=h.predefinedOperations,Me=(0,S.A)(x),pe=zi(e.query);v.$.featureToggles.lokiPredefinedOperations&&!pe.expr&&oe&&(pe.expr=`{} ${oe}`);const Ve=(0,S.A)(pe.expr),Ke=(0,S.A)(pe.queryType),at=pe.editorMode,St=Ue=>{window.localStorage.setItem(os,Ue.currentTarget.checked?"true":"false"),De(Ue.currentTarget.checked)},pt=(0,r.useCallback)(Ue=>{if((0,de.rR)("grafana_loki_editor_mode_clicked",{newEditor:Ue,previousEditor:pe.editorMode??"",newQuery:!pe.expr,app:b??""}),Ue===ve.f.Builder&&(0,Gt.u_)(pe.expr||"").errors.length){R(!0);return}Vi(pe,Ue,s)},[s,pe,b]);(0,r.useEffect)(()=>{J(!1)},[f]);const It=Ue=>{(0,A.isEqual)(Ue,e.query)||J(!0),s(Ue)},rt=()=>{(0,de.rR)("grafana_loki_label_browser_opened",{app:b}),ge(Ue=>!Ue)};return(0,r.useEffect)(()=>{Hi(pe.expr,Ve,x,Me,pe.queryType,Ke)&&x&&(async()=>{const Ht=await h.getStats({...pe,refId:`${t}_${pe.refId}`},x);he(Ht)})()},[h,x,Me,pe,Ve,Ke,he,t]),r.createElement(r.Fragment,null,r.createElement(C.u,{isOpen:D,title:"Query parsing",body:"There were errors while trying to parse the query. Continuing to visual builder may lose some parts of the query.",confirmText:"Continue",onConfirm:()=>{s({...pe,editorMode:ve.f.Builder}),R(!1)},onDismiss:()=>R(!1)}),r.createElement(Wi,{isOpen:G,onClose:()=>j(!1),query:pe,queries:O,app:b,onChange:s,onAddQuery:d}),r.createElement(_r,{isOpen:le,datasource:h,query:pe,app:b,onClose:()=>ge(!1),onChange:It,onRunQuery:c,timeRange:x}),r.createElement(_e.X,null,r.createElement(X.B,{gap:1},r.createElement(U.$n,{"data-testid":Se.Tp.components.QueryBuilder.queryPatterns,variant:"secondary",size:"sm",onClick:()=>{j(st=>!st);const Ue=(0,Gt.u_)(pe.expr||"");(0,de.rR)("grafana_loki_query_patterns_opened",{version:"v2",app:b??"",editorMode:pe.editorMode,preSelectedOperationsCount:Ue.query.operations.length,preSelectedLabelsCount:Ue.query.labels.length})}},"Kick start your query"),r.createElement(U.$n,{variant:"secondary",size:"sm",onClick:rt,"data-testid":"label-browser-button"},"Label browser")),r.createElement(ue,{label:"Explain query",value:ce,onChange:St}),r.createElement(F.Z,{grow:1}),b!==xe.Jk.Explore&&b!==xe.Jk.Correlations&&r.createElement(U.$n,{variant:Ee?"primary":"secondary",size:"sm",onClick:c,icon:f?.state===ke.Gu.Loading?"spinner":void 0,disabled:f?.state===ke.Gu.Loading},O&&O.length>1?"Run queries":"Run query"),r.createElement(p,{mode:at,onChange:pt})),r.createElement(Pe.$,{v:.5}),r.createElement(L.D,null,at===ve.f.Code&&r.createElement(Ci,{...e,query:pe,onChange:It,showExplain:ce}),at===ve.f.Builder&&r.createElement(bi,{datasource:e.datasource,query:pe,onChange:It,onRunQuery:e.onRunQuery,showExplain:ce,timeRange:x}),r.createElement(as,{query:pe,onChange:s,onRunQuery:c,app:b,maxLines:h.maxLines,queryStats:ie})))});ls.displayName="LokiQueryEditor";function Gi(e){const{query:t,data:s,datasource:c,onChange:d,onRunQuery:f,history:b}=e;return r.createElement(ns.W,{datasource:c,query:t,onChange:d,onRunQuery:f,history:b,data:s,placeholder:"Enter a Loki query","data-testid":Yi.editor})}const Yi={editor:"loki-editor-cloud-alerting"};function Ji(e){const{app:t}=e;switch(t){case xe.Jk.CloudAlerting:return r.createElement(Gi,{...e});default:return r.createElement(ls,{...e})}}const Zi=(0,r.memo)(Ji),Xo={editor:"loki-editor"};var qi=l(68704),eo=l(77657),to=l(39748),ro=l(66025),ao=l(91062),no=l(32346),xn=l(25994),so=l(17081),Ln=l(29020),Sn=l(35931);function io({options:e,onOptionsChange:t}){return r.createElement(Ln.I,{title:"Alerting",description:r.createElement(Sn.H,{description:"Manage alert rules for the Loki data source.",suffix:"loki/configure-loki-data-source/#alerting",feature:"alerting"})},r.createElement(Jt.I,{labelWidth:29,label:"Manage alert rules in Alerting UI",disabled:e.readOnly,tooltip:"Manage alert rules for this data source. To manage other alerting resources, add an Alertmanager data source."},r.createElement(Oe.K,{value:e.jsonData.manageAlerts!==!1,onChange:s=>t({...e,jsonData:{...e.jsonData,manageAlerts:s.currentTarget.checked}})})))}var oo=l(6709),lo=l(91890),co=l(72574),uo=l(21744);const fo=e=>{const{derivedFields:t,className:s}=e,[c,d]=(0,r.useState)("");let f=[];return c&&t&&(f=mo(t,c)),r.createElement("div",{className:s},r.createElement(Jt.I,{label:"Debug log message",labelWidth:24,grow:!0},r.createElement(uo.f,{type:"text","aria-label":"Loki query",placeholder:"Paste an example log line here to test the regular expressions of your derived fields",value:c,onChange:b=>d(b.currentTarget.value)})),!!f.length&&r.createElement(po,{fields:f}))},po=({fields:e})=>r.createElement("table",{className:"filter-table"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,"Name"),r.createElement("th",null,"Value"),r.createElement("th",null,"Url"))),r.createElement("tbody",null,e.map(t=>{let s=t.value;return t.error&&t.error instanceof Error?s=t.error.message:t.href&&(s=r.createElement("a",{href:t.href},s)),r.createElement("tr",{key:`${t.name}=${t.value}`},r.createElement("td",null,t.name),r.createElement("td",null,s),r.createElement("td",null,t.href?r.createElement("a",{href:t.href},t.href):""))})));function mo(e,t){return e.filter(s=>s.name&&s.matcherRegex).map(s=>{try{const c=t.match(s.matcherRegex);let d;const f=c&&c[1];return f&&(d=(0,co.w)().replace(s.url,{__value:{value:{raw:f},text:"Raw value"}})),{name:s.name,value:f||"<no match>",href:d}}catch(c){return{name:s.name,error:c}}})}var go=l(55882),Mr=l(88575),ho=l(64078);const vo=e=>({row:(0,$.css)`
    display: flex;
    align-items: baseline;
  `,nameField:(0,$.css)`
    flex: 2;
    margin-right: ${e.spacing(.5)};
  `,regexField:(0,$.css)`
    flex: 3;
    margin-right: ${e.spacing(.5)};
  `,urlField:(0,$.css)`
    flex: 1;
    margin-right: ${e.spacing(.5)};
  `,urlDisplayLabelField:(0,$.css)`
    flex: 1;
  `,internalLink:(0,$.css)`
    margin-right: ${e.spacing(1)};
  `,dataSource:(0,$.css)``,nameMatcherField:(0,$.css)({width:e.spacing(20),marginRight:e.spacing(.5)})}),Oo=e=>{const{value:t,onChange:s,onDelete:c,suggestions:d,className:f,validateName:b}=e,O=(0,te.of)(vo),[h,x]=(0,r.useState)(!!t.datasourceUid),D=(0,S.A)(t.datasourceUid),[R,G]=(0,r.useState)(t.matcherType??"regex");(0,r.useEffect)(()=>{!D&&t.datasourceUid&&!h&&x(!0),D&&!t.datasourceUid&&h&&x(!1)},[D,t.datasourceUid,h]);const j=J=>le=>{s({...t,[J]:le.currentTarget.value})},Ee=!b(t.name);return r.createElement("div",{className:f,"data-testid":"derived-field"},r.createElement("div",{className:"gf-form"},r.createElement(Mr.D,{className:O.nameField,label:"Name",invalid:Ee,error:"The name is already in use"},r.createElement(lr.p,{value:t.name,onChange:j("name"),placeholder:"Field name",invalid:Ee})),r.createElement(Mr.D,{className:O.nameMatcherField,label:r.createElement(fn,{label:"Type",content:"Derived fields can be created from labels or by applying a regular expression to the log message."})},r.createElement(Ut.l6,{options:[{label:"Regex in log line",value:"regex"},{label:"Label",value:"label"}],value:R,onChange:J=>{(J.value==="label"||J.value==="regex")&&(G(J.value),s({...t,matcherType:J.value}))}})),r.createElement(Mr.D,{className:O.regexField,label:r.createElement(r.Fragment,null,R==="regex"&&r.createElement(fn,{label:"Regex",content:"Use to parse and capture some part of the log message. You can use the captured groups in the template."}),R==="label"&&r.createElement(fn,{label:"Label",content:"Use to derive the field from a label."}))},r.createElement(lr.p,{value:t.matcherRegex,onChange:j("matcherRegex")})),r.createElement(Mr.D,{label:""},r.createElement(U.$n,{variant:"destructive",title:"Remove field",icon:"times",onClick:J=>{J.preventDefault(),c()}}))),r.createElement("div",{className:"gf-form"},r.createElement(Mr.D,{label:h?"Query":"URL",className:O.urlField},r.createElement(ho.l,{placeholder:h?"${__value.raw}":"http://example.com/${__value.raw}",value:t.url||"",onChange:J=>s({...t,url:J}),suggestions:d})),r.createElement(Mr.D,{className:O.urlDisplayLabelField,label:r.createElement(fn,{label:"URL Label",content:"Use to override the button label when this derived field is found in a log."})},r.createElement(lr.p,{value:t.urlDisplayLabel,onChange:j("urlDisplayLabel")}))),r.createElement("div",{className:"gf-form"},r.createElement(Mr.D,{label:"Internal link",className:O.internalLink},r.createElement(Oe.d,{value:h,onChange:J=>{const{checked:le}=J.currentTarget;le||s({...t,datasourceUid:void 0}),x(le)}})),h&&r.createElement(Mr.D,{label:"",className:O.dataSource},r.createElement(go.s,{tracing:!0,onChange:J=>s({...t,datasourceUid:J.uid}),current:t.datasourceUid,noDefault:!0}))))},fn=({content:e,label:t})=>r.createElement(Xr.J,null,t,r.createElement(Ge.m,{placement:"top",content:e,theme:"info"},r.createElement(Vr.I,{tabIndex:0,name:"info-circle",size:"sm",style:{marginLeft:"10px"}}))),yo=e=>({addButton:(0,$.css)`
    margin-right: 10px;
  `,derivedField:(0,$.css)`
    margin-bottom: ${e.spacing(1)};
  `,container:(0,$.css)`
    margin-bottom: ${e.spacing(4)};
  `,debugSection:(0,$.css)`
    margin-top: ${e.spacing(4)};
  `}),bo=({fields:e=[],onChange:t})=>{const s=(0,te.$j)(),c=yo(s),[d,f]=(0,r.useState)(!1),b=(0,r.useCallback)(O=>e.filter(h=>h.name&&h.name===O).length<=1,[e]);return r.createElement(Ln.I,{title:"Derived fields",description:r.createElement(Sn.H,{description:"Derived fields can be used to extract new fields from a log message and create a link from its value.",suffix:"loki/configure-loki-data-source/#derived-fields",feature:"derived fields"})},r.createElement("div",{className:c.container},e.map((O,h)=>r.createElement(Oo,{className:c.derivedField,key:h,value:O,onChange:x=>{const D=[...e];D.splice(h,1,x),t(D)},onDelete:()=>{const x=[...e];x.splice(h,1),t(x)},validateName:b,suggestions:[{value:oo.c.valueRaw,label:"Raw value",documentation:"Exact string captured by the regular expression",origin:lo.$0.Value}]})),r.createElement("div",null,r.createElement(U.$n,{variant:"secondary",className:c.addButton,icon:"plus",onClick:O=>{O.preventDefault();const h={name:"",matcherRegex:"",urlDisplayLabel:"",url:"",matcherType:"regex"},x=[...e,h];t(x)}},"Add"),e.length>0&&r.createElement(U.$n,{variant:"secondary",type:"button",onClick:()=>f(!d)},d?"Hide example log message":"Show example log message")),d&&r.createElement("div",{className:c.debugSection},r.createElement(fo,{className:(0,$.css)`
                margin-bottom: 10px;
              `,derivedFields:e}))))};var Eo=l(39268),Po=l(39938);const xo=e=>{const{maxLines:t,onMaxLinedChange:s,predefinedOperations:c,onPredefinedOperationsChange:d}=e;return r.createElement(Ln.I,{title:"Queries",description:r.createElement(Sn.H,{description:"Additional options to customize your querying experience.",suffix:"loki/configure-loki-data-source/#queries",feature:"query settings"})},r.createElement(Jt.I,{label:"Maximum lines",htmlFor:"loki_config_maxLines",labelWidth:22,tooltip:r.createElement(r.Fragment,null,"Loki queries must contain a limit of the maximum number of lines returned (default: 1000). Increase this limit to have a bigger result set for ad-hoc analysis. Decrease this limit if your browser becomes sluggish when displaying the log results.")},r.createElement(lr.p,{type:"number",id:"loki_config_maxLines",value:t,onChange:f=>s(f.currentTarget.value),width:16,placeholder:"1000",spellCheck:!1})),v.$.featureToggles.lokiPredefinedOperations&&r.createElement(Eo.C,null,r.createElement(Jt.I,{label:"Predefined operations",htmlFor:"loki_config_predefinedOperations",labelWidth:22,tooltip:r.createElement(r.Fragment,null,'Predefined operations are used as an initial state for your queries. They are useful, if you want to unpack, parse or format all log lines. Currently we support only log operations starting with |. For example: | unpack | line_format "{{.message}}".')},r.createElement(lr.p,{type:"string",id:"loki_config_predefinedOperations",value:c,onChange:f=>d(f.currentTarget.value),width:40,placeholder:"| unpack | line_format",spellCheck:!1})),r.createElement(Jt.I,null,r.createElement(Po.E,{text:"Experimental",color:"orange",icon:"exclamation-triangle",tooltip:"Predefined operations is an experimental feature that may change in the future."}))))},$n=e=>(t,s)=>({...t,jsonData:{...t.jsonData,[e]:s}}),Lo=$n("maxLines"),So=$n("predefinedOperations"),$o=$n("derivedFields"),To=e=>{const{options:t,onOptionsChange:s}=e,c=(0,r.useCallback)(d=>{(0,de.rR)("grafana_loki_predefined_operations_changed",{value:d}),s(So(t,d))},[t,s]);return r.createElement(r.Fragment,null,r.createElement(qi.I,{dataSourceName:"Loki",docsLink:"https://grafana.com/docs/grafana/latest/datasources/loki/configure-loki-data-source/",hasRequiredFields:!1}),r.createElement(xn.c,{spacing:4}),r.createElement(eo.u,{config:t,onChange:s,urlPlaceholder:"http://localhost:3100"}),r.createElement(xn.c,{spacing:4}),r.createElement(to.N,{...(0,ro.pe)({config:t,onChange:s})}),r.createElement(xn.c,{spacing:4}),r.createElement(ao.A,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!0},r.createElement(X.B,{gap:5,direction:"column"},r.createElement(no.g,{config:t,onChange:s}),v.$.secureSocksDSProxyEnabled&&r.createElement(so.Y,{options:t,onOptionsChange:s}),r.createElement(io,{options:t,onOptionsChange:s}),r.createElement(xo,{maxLines:t.jsonData.maxLines||"",onMaxLinedChange:d=>s(Lo(t,d)),predefinedOperations:t.jsonData.predefinedOperations||"",onPredefinedOperationsChange:c}),r.createElement(bo,{fields:t.jsonData.derivedFields,onChange:d=>s($o(t,d))}))))};var Qo=l(27724),wo=l(79007);const Ro=new Q.tD(Qo.VQ).setQueryEditor(Zi).setConfigEditor(To).setQueryEditorHelp(q);(0,M.J7)().subscribe(Ce.gc,wo.jg)},56587:(lt,Be,l)=>{"use strict";l.d(Be,{$F:()=>xe,Cg:()=>He,FV:()=>$,H0:()=>E,Io:()=>me,MX:()=>Oe,OT:()=>B,QH:()=>Se,Rn:()=>Je,TQ:()=>ve,_i:()=>Ae,aw:()=>Re,d_:()=>fe,g5:()=>$e,gy:()=>_,pS:()=>Qe,pk:()=>N,sI:()=>te,sc:()=>ue,vV:()=>V});var Q=l(2543),Ce=l.n(Q),M=l(36195),A=l(12798),r=l(56245),de=l(65650);function E(T=""){const F=[],K=Se(T,[M.PN]);for(const z of K){const p=z.getChild(M.dJ)?.getChild(M.Sg),L=z.getChild(M.dJ)?.getChild(M.q5),v=be(z);if(!(!p&&!L||!v.length))for(const C of v){const X=T.substring(C.from,C.to).trim(),U=X[0]==="`",Pe=X.substring(1,X.length-1);if(!Pe)continue;let Te="";L?Te=U?Pe:Pe.replace(/\\\\/g,"\\"):Te=(0,Q.escapeRegExp)(Pe),Te&&F.push(Te)}}return F}function be(T){const F=[];let K=T;do{const z=K.getChild(M.Qf);z&&!K.getChild(M.w7)&&F.push(z),K=K.getChild(M.ih)}while(K!=null);return F}function V(T){const F=me(T),{instant:K,range:z,...p}=T;return{...p,queryType:F}}function me(T){const{queryType:F}=T;return F===de.U3.Range||F===de.U3.Instant||F===de.U3.Stream?F:T.instant===!0?de.U3.Instant:de.U3.Range}const w=["String","Identifier","LineComment","Number"],q=["__error__","__interval","__interval_ms","__auto"];function xe(T){let F=T;return M.K3.parse(T).iterate({enter:({name:z,from:p,to:L})=>{const v=T.substring(p,L);w.includes(z)&&!q.includes(v)&&(F=F.replace(v,z))}}),F}function S(T){const F=[];return parser.parse(T).iterate({enter:({name:z})=>{F.push(z)}}),F}function ke(T,F){let K=!1;return M.K3.parse(T).iterate({enter:({type:p})=>{if(p.id===F)return K=!0,!1}}),K}function Se(T,F){const K=[];return M.K3.parse(T).iterate({enter:p=>{(F===void 0||F.includes(p.type.id))&&K.push(p.node)}}),K}function ve(T,F){const K=[];return M.K3.parse(T).iterate({enter:p=>{(F===void 0||F.includes(p.type.id))&&K.push(A.Ch.fromNode(p.node))}}),K}function _e(T,F){const K=Se(T,[F]);return K.length>0?K[0]:void 0}function $(T){return ke(T,r.Ql)}function te(T){return!ke(T,M.Yw)}function Oe(T){const K=Se(T,[M.iT,M.eF,M.c$]).length;return{queryWithParser:K>0,parserCount:K}}function Re(T){const F=Se(T,[M.iT,M.LM,M.c$]);return F.length>0?T.substring(F[0].from,F[0].to).trim():void 0}function fe(T){const F=Se(T,[M.bY]);for(const K of F){const z=K.getChild(M.g$)?.getChild(M.gw);if(z&&T.substring(z.from,z.to)==="__error__")return!0}return!1}function Ae(T){return ke(T,M.J_)}function B(T){if(te(T))return T;const F=_e(T,M.MD);if(!F)return"";const K=T.substring(F.from,F.to),z=_e(T,M.AL),p=z?T.substring(z.from,z.to):"";return`${K} ${p}`.trim()}function $e(T,F){if(te(T))return T;const K=Se(T,[M.Yw]).reverse().find(z=>z.from<=F&&z.to>=F);return K?B(T.substring(K.from,K.to)):""}function Qe(T){return ke(T,M.bY)}function Je(T){return ke(T,M.PN)}function He(T){const F=Se(T,[M.Q6]);for(const K of F)if(T.substring(K.from,K.to).match(/\[\$__range(_s|_ms)?/))return!0;return!1}function N(T){return(0,A.yB)(T).map(z=>T.slice(z.from,z.to))}function _(T){return T.filter(K=>!K.hide).filter(K=>!K.refId.includes("do-not-chunk")).filter(K=>K.expr).length>0}const ee=T=>T?"expr"in T&&T.expr!==void 0:!1,ue=T=>{if(!(!T||!ee(T)))return T}},43548:(lt,Be,l)=>{"use strict";l.d(Be,{y:()=>E});var Q=l(83077),Ce=l(42952);class M{constructor(V,me){this.categories=[],this.operationsRegistry=new Q.O(()=>V),this.innerQueryPlaceholder=me||"<query>"}setOperationCategories(V){this.categories=V}getOperationsForCategory(V){return this.operationsRegistry.list().filter(me=>me.category===V&&!me.hideFromList)}getAlternativeOperations(V){return this.operationsRegistry.list().filter(me=>me.alternativesKey&&me.alternativesKey===V)}getCategories(){return this.categories}getOperationDefinition(V){return this.operationsRegistry.getIfExists(V)}hasBinaryOp(V){return V.operations.find(me=>{const w=this.getOperationDefinition(me.id);return w?.category===Ce.T})!==void 0}}var A=l(83657),r=l(54623);class de extends M{constructor(){super(A.sp,"<expr>"),this.setOperationCategories([r.Ln.Aggregations,r.Ln.RangeFunctions,r.Ln.Formats,r.Ln.BinaryOps,r.Ln.LabelFilters,r.Ln.LineFilters])}renderOperations(V,me){for(const w of me){const q=this.operationsRegistry.getIfExists(w.id);if(!q){console.error(`Could not find operation ${w.id} in the registry`);continue}V=q.renderer(w,q,V)}return V}renderBinaryQueries(V,me){if(me)for(const w of me)V=`${this.renderBinaryQuery(V,w)}`;return V}renderBinaryQuery(V,me){let w=V+` ${me.operator} `;return me.vectorMatches&&(w+=`${me.vectorMatchesType}(${me.vectorMatches}) `),w+this.renderQuery(me.query,!0)}renderLabels(V){if(V.length===0)return"{}";let me="{";for(const w of V)me!=="{"&&(me+=", "),me+=`${w.label}${w.op}"${w.value}"`;return me+"}"}renderQuery(V,me){let w=this.renderLabels(V.labels);return w=this.renderOperations(w,V.operations),!me&&this.hasBinaryOp(V)&&V.binaryQueries?.length&&(w=`(${w})`),w=this.renderBinaryQueries(w,V.binaryQueries),w}getQueryPatterns(){return[{name:"Parse log lines with logfmt parser",type:r.IQ.Log,operations:[{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log lines with JSON parser",type:r.IQ.Log,operations:[{id:r.EF.Json,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log line and parse with logfmt parser",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log lines and parse with json parser",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Json,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log line with logfmt parser and use label filter",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.LabelFilter,params:["label","=","value"]}]},{name:"Parse log lines with nested json",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Json,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.LineFormat,params:["{{.message}}"]},{id:r.EF.Json,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Reformat log lines",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.LineFormat,params:["{{.message}}"]}]},{name:"Rename lvl label to level",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.LabelFormat,params:["lvl","level"]}]},{name:"Query on value inside a log line",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.Unwrap,params:[""]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.SumOverTime,params:["$__auto"]},{id:r.EF.Sum,params:[]}]},{name:"Total requests per label of streams",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.CountOverTime,params:["$__auto"]},{id:r.EF.Sum,params:[]}]},{name:"Total requests per parsed label or label of streams",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.CountOverTime,params:["$__auto"]},{id:r.EF.Sum,params:[]}]},{name:"Bytes used by a log stream",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.BytesOverTime,params:["$__auto"]}]},{name:"Count of log lines per stream",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.CountOverTime,params:["$__auto"]}]},{name:"Top N results by label or parsed label",type:r.IQ.Metric,operations:[{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.CountOverTime,params:["$__auto"]},{id:r.EF.Sum,params:[]},{id:r.EF.TopK,params:[10]}]},{name:"Extracted quantile",type:r.IQ.Metric,operations:[{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.Unwrap,params:["latency"]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.QuantileOverTime,params:["$__auto",.5]},{id:r.EF.Sum,params:[]}]}]}}const E=new de},58592:(lt,Be,l)=>{"use strict";l.d(Be,{C:()=>M,I:()=>A});var Q=l(11216),Ce=l(54623);const M=[{id:Ce.EF.Addition,name:"Add scalar",sign:"+"},{id:Ce.EF.Subtraction,name:"Subtract scalar",sign:"-"},{id:Ce.EF.MultiplyBy,name:"Multiply by scalar",sign:"*"},{id:Ce.EF.DivideBy,name:"Divide by scalar",sign:"/"},{id:Ce.EF.Modulo,name:"Modulo by scalar",sign:"%"},{id:Ce.EF.Exponent,name:"Exponent",sign:"^"},{id:Ce.EF.EqualTo,name:"Equal to",sign:"==",comparison:!0},{id:Ce.EF.NotEqualTo,name:"Not equal to",sign:"!=",comparison:!0},{id:Ce.EF.GreaterThan,name:"Greater than",sign:">",comparison:!0},{id:Ce.EF.LessThan,name:"Less than",sign:"<",comparison:!0},{id:Ce.EF.GreaterOrEqual,name:"Greater or equal to",sign:">=",comparison:!0},{id:Ce.EF.LessOrEqual,name:"Less or equal to",sign:"<=",comparison:!0}],A=M.map(de=>{const E=[{name:"Value",type:"number"}];let be=[2];return de.comparison&&(E.push({name:"Bool",type:"boolean",description:"If checked comparison will return 0 or 1 for the value rather than filtering."}),be=[2,!1]),{id:de.id,name:de.name,params:E,defaultParams:be,alternativesKey:"binary scalar operations",category:Ce.Ln.BinaryOps,renderer:r(de.sign),addOperationHandler:Q.iZ}});function r(de){return function(be,V,me){let w=be.params[0],q="";return be.params.length===2&&(q=be.params[1]?" bool":""),`${me} ${de}${q} ${w}`}}},11216:(lt,Be,l)=>{"use strict";l.d(Be,{af:()=>Oe,VR:()=>Re,G3:()=>_,jC:()=>K,fu:()=>q,yD:()=>xe,iZ:()=>N,UF:()=>fe,OS:()=>B,hh:()=>ve,sn:()=>Se,EP:()=>_e});var Q=l(2543),Ce=l(55127),M=l.n(Ce),A=l(97535),r=l(71713),de=l(96540),E=l(21594);const be=({onChange:p,index:L,operationId:v,value:C,query:X,datasource:U,queryModeller:Pe})=>{const[Te,We]=(0,de.useState)({});return de.createElement(E.l6,{inputId:B(v,L),autoFocus:C==="",openMenuOnFocus:!0,onOpenMenu:async()=>{We({isLoading:!0});const je=await V(X,U,Pe);We({options:je,isLoading:void 0})},isLoading:Te.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:Te.options,value:me(C),onChange:je=>p(L,je.value)})};async function V(p,L,v){let C=p.labels;const X=v.renderLabels(C);return(await L.languageProvider.fetchLabels({streamSelector:X})).map(Pe=>({label:Pe,value:Pe}))}const me=p=>({label:p?.toString(),value:p});var w=l(54623);function q(p,L){const v=[Ae()],C=["$__auto"];let X;return p===w.EF.QuantileOverTime&&(C.push("0.95"),v.push({name:"Quantile",type:"number"})),L&&(v.push({name:"By label",type:"string",restParam:!0,optional:!0}),X=$e(`__${p}_by`)),{id:p,name:He(p),params:v,defaultParams:C,alternativesKey:"range function",category:w.Ln.RangeFunctions,orderRank:w.h5.RangeVectorFunction,renderer:ke,addOperationHandler:Oe,paramChangedHandler:X,explainHandler:(U,Pe)=>{let Te=r.AW.find(We=>We.insertText===U.id)?.documentation??"";return U.params[0]==="$__auto"?`${Te} \`$__auto\` is a variable that will be replaced with the [value of step](https://grafana.com/docs/grafana/next/datasources/loki/query-editor/#options) for range queries and with the value of the selected time range (calculated to - from) for instant queries.`:`${Te} The [range vector](https://grafana.com/docs/loki/latest/logql/metric_queries/#range-vector-aggregation) is set to \`${U.params[0]}\`.`}}}function xe(p){const L=q(p,!0),v=L.params.slice(0,-1);return[L,{id:`__${p}_by`,name:`${He(p)} by`,params:[...v,{name:"Label",type:"string",restParam:!0,optional:!0,editor:be}],defaultParams:[...L.defaultParams,""],alternativesKey:"range function with grouping",category:w.Ln.RangeFunctions,renderer:S(p,"by"),paramChangedHandler:Je(p),explainHandler:Qe(p,"by"),addOperationHandler:Oe,hideFromList:!0},{id:`__${p}_without`,name:`${He(p)} without`,params:[...v,{name:"Label",type:"string",restParam:!0,optional:!0,editor:be}],defaultParams:[...L.defaultParams,""],alternativesKey:"range function with grouping",category:w.Ln.RangeFunctions,renderer:S(p,"without"),paramChangedHandler:Je(p),explainHandler:Qe(p,"without"),addOperationHandler:Oe,hideFromList:!0}]}function S(p,L){return function(C,X,U){const Pe=X.params.findIndex(je=>je.restParam),Te=C.params.slice(0,Pe),We=C.params.slice(Pe);return Te.length===2&&p===w.EF.QuantileOverTime?`${p}(${Te[1]}, ${U} [${Te[0]}]) ${L} (${We.join(", ")})`:`${p}(${U} [${Te[0]}]) ${L} (${We.join(", ")})`}}function ke(p,L,v){const C=p.params??[],X=C[0]??"$__auto";if(C.length===2&&p.id===w.EF.QuantileOverTime){const U=C[1];return`${p.id}(${U}, ${v} [${X}])`}return`${p.id}(${v} [${C[0]??"$__auto"}])`}function Se(p,L,v){return["<","<=",">",">="].includes(String(p.params[1]))?`${v} | ${p.params[0]} ${p.params[1]} ${p.params[2]}`:`${v} | ${p.params[0]} ${p.params[1]} \`${p.params[2]}\``}function ve(p,L){if(!p)return!1;const v=p.params[1].toString().startsWith("!");return L.filter(U=>U.id===w.EF.LabelFilter&&U.params[0]===p.params[0]&&U.params[2]===p.params[2]).some(U=>!!(v&&U.params[1].toString().startsWith("!")===!1||v===!1&&U.params[1].toString().startsWith("!")))}function _e(p,L,v){switch(p.id){case w.EF.Logfmt:const[C=!1,X=!1,...U]=p.params;return`${v} | logfmt${C?" --strict":""}${X?" --keep-empty":""} ${U.filter(Pe=>Pe).join(", ")}`.trim();case w.EF.Json:return`${v} | json ${p.params.filter(Pe=>Pe).join(", ")}`.trim();case w.EF.Drop:return`${v} | drop ${p.params.filter(Pe=>Pe).join(", ")}`.trim();case w.EF.Keep:return`${v} | keep ${p.params.filter(Pe=>Pe).join(", ")}`.trim();default:return`${v} | ${p.id}`}}function $(p){return p.category===w.Ln.RangeFunctions}function te(p,L,v){const C=p.findIndex(X=>{const U=L.getOperationDefinition(X.id);return U?v(U):!1});return C===-1?p.length:C}function Oe(p,L,v){const C={id:p.id,params:p.defaultParams},X=[...L.operations],U=X.find(Pe=>{const Te=v.getOperationDefinition(Pe.id);return Te?$(Te):!1});switch(p.category){case w.Ln.Aggregations:case w.Ln.Functions:if(!U){const Te=te(X,v,We=>We.category===w.Ln.Functions);X.splice(Te,0,{id:w.EF.Rate,params:["$__auto"]})}X.push(C);break;case w.Ln.RangeFunctions:if(U){const Te=X.indexOf(U);X[Te]=C;break}default:const Pe=te(X,v,Te=>(p.orderRank??100)<(Te.orderRank??100));X.splice(Pe,0,C);break}return{...L,operations:X}}function Re(p,L){return{...L,binaryQueries:[...L.binaryQueries??[],{operator:"/",query:L}]}}function fe(p,L){return function(C,X,U){const Pe=C.params.some(je=>typeof je=="string"&&je.includes("`")),Te=Pe?'"':"`";let We;return Pe?We=C.params.map(je=>typeof je=="string"?(0,A.Qn)(je):je):We=C.params,L?`${U} ${p} ${Te}(?i)${We.join(`${Te} or ${Te}(?i)`)}${Te}`:`${U} ${p} ${Te}${We.join(`${Te} or ${Te}`)}${Te}`}}function Ae(){return{name:"Range",type:"string",options:["$__auto","1m","5m","10m","1h","24h"]}}function B(p,L){return`operations.${p}.param.${L}`}function $e(p){return function(v,C,X){return C.params.length===X.params.length?{...C,id:p}:C}}function Qe(p,L){return function(C){const X=C.params.map(Pe=>`\`${Pe}\``).join(" and "),U=M()("label",C.params.length);switch(L){case"by":return`Calculates ${p} over dimensions while preserving ${U} ${X}.`;case"without":return`Calculates ${p} over the dimensions ${X}. All other labels are preserved.`;default:return`Calculates ${p} over the dimensions.`}}}function Je(p){return function(v,C,X){return C.params.length<X.params.length?{...C,id:p}:C}}function He(p){return(0,Q.capitalize)(p.replace(/_/g," "))}function N(p,L){const v={id:p.id,params:p.defaultParams};return{...L,operations:[...L.operations,v]}}function _(p,L={}){return[{id:p,name:He(p),params:[{name:"By label",type:"string",restParam:!0,optional:!0}],defaultParams:[],alternativesKey:"plain aggregations",category:w.Ln.Aggregations,renderer:ue,paramChangedHandler:$e(`__${p}_by`),explainHandler:Qe(p,""),addOperationHandler:N,...L},{id:`__${p}_by`,name:`${He(p)} by`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:be}],defaultParams:[""],alternativesKey:"aggregations by",category:w.Ln.Aggregations,renderer:F(p),paramChangedHandler:Je(p),explainHandler:Qe(p,"by"),addOperationHandler:N,hideFromList:!0,...L},{id:`__${p}_without`,name:`${He(p)} without`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:be}],defaultParams:[""],alternativesKey:"aggregations by",category:w.Ln.Aggregations,renderer:ee(p),paramChangedHandler:Je(p),explainHandler:Qe(p,"without"),addOperationHandler:N,hideFromList:!0,...L}]}function ee(p){return function(v,C,X){return`${p} without(${v.params.join(", ")}) (${X})`}}function ue(p,L,v){const C=T(p,L,v),X=p.id+"(";return v&&C.push(v),X+C.join(", ")+")"}function T(p,L,v){return(p.params??[]).map((C,X)=>L.params[X].type==="string"?'"'+C+'"':C)}function F(p){return function(v,C,X){return`${p} by(${v.params.join(", ")}) (${X})`}}function K(p,L,v={}){const C=_(p,v);return C[0].params.unshift(...L.params),C[1].params.unshift(...L.params),C[2].params.unshift(...L.params),C[0].defaultParams=L.defaultParams,C[1].defaultParams=[...L.defaultParams,""],C[2].defaultParams=[...L.defaultParams,""],C[1].renderer=z(p),C[2].renderer=z(p),C}function z(p){return function(v,C,X){const U=C.params.findIndex(We=>We.restParam),Pe=v.params.slice(0,U),Te=v.params.slice(U);return`${p} by(${Te.join(", ")}) (${Pe.map((We,je)=>C.params[je].type==="string"?`"${We}"`:We).join(", ")}, ${X})`}}},83657:(lt,Be,l)=>{"use strict";l.d(Be,{VI:()=>$,y6:()=>ve,mD:()=>_e,sp:()=>Se});var Q=l(58592),Ce=l(96540),M=l(50877),A=l(43127),r=l(32264),de=l(21594),E=l(20065),be=l(27724),V=l(56587),me=l(75723),w=l(11216);function q({onChange:te,index:Oe,operationId:Re,value:fe,query:Ae,datasource:B,timeRange:$e,queryModeller:Qe}){const[Je,He]=(0,Ce.useState)({});return Ce.createElement(de.l6,{inputId:(0,w.OS)(Re,Oe),onOpenMenu:async()=>{if(B instanceof be.VQ&&r.$.featureToggles.lokiQueryHints){He({isLoading:!0});const N=await xe(Ae,B,Qe,$e);He({options:N,isLoading:void 0})}},isLoading:Je.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:Je.options,value:fe?(0,M.z)(fe.toString()):null,onChange:N=>{N.value&&te(Oe,N.value)}})}async function xe(te,Oe,Re,fe=(0,A.E2)()){const Ae=Re.renderQuery(te),B=(0,V.OT)(Ae);if((0,V.FV)(Oe.interpolateString(B,E.a)))return[];const $e=await Oe.getDataSamples({expr:B,refId:"unwrap_samples"},fe);return(0,me.aN)($e[0]).map(He=>({label:He,value:He}))}var S=l(54623);function ke(){const te=[S.EF.Sum,S.EF.Min,S.EF.Max,S.EF.Avg,S.EF.Stddev,S.EF.Stdvar,S.EF.Count].flatMap(B=>(0,w.G3)(B,{addOperationHandler:w.af,orderRank:S.h5.Last})),Oe=[S.EF.TopK,S.EF.BottomK].flatMap(B=>(0,w.jC)(B,{params:[{name:"K-value",type:"number"}],defaultParams:[5]},{addOperationHandler:w.af,orderRank:S.h5.Last})),Re=[(0,w.fu)(S.EF.Rate),(0,w.fu)(S.EF.RateCounter),(0,w.fu)(S.EF.CountOverTime),(0,w.fu)(S.EF.SumOverTime),(0,w.fu)(S.EF.BytesRate),(0,w.fu)(S.EF.BytesOverTime),(0,w.fu)(S.EF.AbsentOverTime)],fe=[...(0,w.yD)(S.EF.AvgOverTime),...(0,w.yD)(S.EF.MaxOverTime),...(0,w.yD)(S.EF.MinOverTime),...(0,w.yD)(S.EF.FirstOverTime),...(0,w.yD)(S.EF.LastOverTime),...(0,w.yD)(S.EF.StdvarOverTime),...(0,w.yD)(S.EF.StddevOverTime),...(0,w.yD)(S.EF.QuantileOverTime)];return[...te,...Oe,...Re,...fe,{id:S.EF.Json,name:"Json",params:[{name:"Expression",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'server="servers[0]"',description:"Using expressions with your json parser will extract only the specified json fields to labels. You can specify one or more expressions in this way. All expressions must be quoted."}],defaultParams:[],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:w.EP,addOperationHandler:w.af,explainHandler:()=>"This will extract keys and values from a [json](https://grafana.com/docs/loki/latest/logql/log_queries/#json) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:S.EF.Logfmt,name:"Logfmt",params:[{name:"Strict",type:"boolean",optional:!0,description:"With strict parsing enabled, the logfmt parser immediately stops scanning the log line and returns early with an error when it encounters any poorly formatted key/value pair."},{name:"Keep empty",type:"boolean",optional:!0,description:"The logfmt parser retains standalone keys (keys without a value) as labels with its value set to empty string. "},{name:"Expression",type:"string",optional:!0,restParam:!0,minWidth:18,placeholder:"field_name",description:"Using expressions with your logfmt parser will extract and rename (if provided) only the specified fields to labels. You can specify one or more expressions in this way."}],defaultParams:[!1,!1],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:w.EP,addOperationHandler:w.af,explainHandler:()=>"This will extract all keys and values from a [logfmt](https://grafana.com/docs/loki/latest/logql/log_queries/#logfmt) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:S.EF.Regexp,name:"Regexp",params:[{name:"String",type:"string",hideName:!0,placeholder:"<re>",description:"The regexp expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:(B,$e,Qe)=>`${Qe} | regexp \`${B.params[0]}\``,addOperationHandler:w.af,explainHandler:()=>'The [regexp parser](https://grafana.com/docs/loki/latest/logql/log_queries/#regular-expression) takes a single parameter | regexp "<re>" which is the regular expression using the Golang RE2 syntax. The regular expression must contain a least one named sub-match (e.g (?P<name>re)), each sub-match will extract a different label. The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.'},{id:S.EF.Pattern,name:"Pattern",params:[{name:"String",type:"string",hideName:!0,placeholder:"<pattern-expression>",description:"The expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:(B,$e,Qe)=>`${Qe} | pattern \`${B.params[0]}\``,addOperationHandler:w.af,explainHandler:()=>"The [pattern parser](https://grafana.com/docs/loki/latest/logql/log_queries/#pattern) allows the explicit extraction of fields from log lines by defining a pattern expression (| pattern `<pattern-expression>`). The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:S.EF.Unpack,name:"Unpack",params:[],defaultParams:[],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:w.EP,addOperationHandler:w.af,explainHandler:()=>"This will extract all keys and values from a JSON log line, [unpacking](https://grafana.com/docs/loki/latest/logql/log_queries/#unpack) all embedded labels in the pack stage. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:S.EF.LineFormat,name:"Line format",params:[{name:"String",type:"string",hideName:!0,placeholder:"{{.status_code}}",description:"A line template that can refer to stream labels and extracted labels.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:(B,$e,Qe)=>`${Qe} | line_format \`${B.params[0]}\``,addOperationHandler:w.af,explainHandler:()=>`This will replace log line using a specified template. The template can refer to stream labels and extracted labels.

Example: \`{{.status_code}} - {{.message}}\`

[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#line-format-expression) for more.
        `},{id:S.EF.LabelFormat,name:"Label format",params:[{name:"Label",type:"string"},{name:"Rename to",type:"string"}],defaultParams:["",""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:(B,$e,Qe)=>`${Qe} | label_format ${B.params[1]}=${B.params[0]}`,addOperationHandler:w.af,explainHandler:()=>'This will change name of label to desired new label. In the example below, label "error_level" will be renamed to "level".\n\nExample: ``error_level=`level` ``\n\n[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#labels-format-expression) for more.\n        '},{id:S.EF.LineContains,name:"Line contains",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:20,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,w.UF)("|="),addOperationHandler:w.af,explainHandler:B=>`Return log lines that contain string \`${B.params?.join("`, or `")}\`.`},{id:S.EF.LineContainsNot,name:"Line does not contain",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:26,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,w.UF)("!="),addOperationHandler:w.af,explainHandler:B=>`Return log lines that does not contain string \`${B.params?.join("`, or `")}\`.`},{id:S.EF.LineContainsCaseInsensitive,name:"Line contains case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:33,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,w.UF)("|~",!0),addOperationHandler:w.af,explainHandler:B=>`Return log lines that match regex \`(?i)${B.params?.join("`, or `(?i)")}\`.`},{id:S.EF.LineContainsNotCaseInsensitive,name:"Line does not contain case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:40,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,w.UF)("!~",!0),addOperationHandler:w.af,explainHandler:B=>`Return log lines that does not match regex \`(?i)${B.params?.join("`, or `(?i)")}\`.`},{id:S.EF.LineMatchesRegex,name:"Line contains regex match",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to match",description:"Find log lines that match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,w.UF)("|~"),addOperationHandler:w.af,explainHandler:B=>`Return log lines that match a \`RE2\` regex pattern. \`${B.params?.join("`, or `")}\`.`},{id:S.EF.LineMatchesRegexNot,name:"Line does not match regex",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to exclude",description:"Find log lines that does not match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,w.UF)("!~"),addOperationHandler:w.af,explainHandler:B=>`Return log lines that doesn't match a \`RE2\` regex pattern. \`${B.params?.join("`, or `")}\`.`},{id:S.EF.LineFilterIpMatches,name:"IP line filter expression",params:[{name:"Operator",type:"string",minWidth:16,options:[S.NS.contains,S.NS.doesNotContain]},{name:"Pattern",type:"string",placeholder:"<pattern>",minWidth:16,runQueryOnEnter:!0}],defaultParams:["|=",""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(B,$e,Qe)=>`${Qe} ${B.params[0]} ip(\`${B.params[1]}\`)`,addOperationHandler:w.af,explainHandler:B=>`Return log lines using IP matching of \`${B.params[1]}\``},{id:S.EF.LabelFilter,name:"Label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[S.NS.equals,S.NS.doesNotEqual,S.NS.matchesRegex,S.NS.doesNotMatchRegex,S.NS.greaterThan,S.NS.lessThan,S.NS.greaterThanOrEqual,S.NS.lessThanOrEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],alternativesKey:"label filter",category:S.Ln.LabelFilters,orderRank:S.h5.PipeOperations,renderer:w.sn,addOperationHandler:w.af,explainHandler:()=>"Label expression filter allows filtering using original and extracted labels."},{id:S.EF.LabelFilterIpMatches,name:"IP label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[S.NS.equals,S.NS.doesNotEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],alternativesKey:"label filter",category:S.Ln.LabelFilters,orderRank:S.h5.PipeOperations,renderer:(B,$e,Qe)=>`${Qe} | ${B.params[0]} ${B.params[1]} ip(\`${B.params[2]}\`)`,addOperationHandler:w.af,explainHandler:B=>`Return log lines using IP matching of \`${B.params[2]}\` for \`${B.params[0]}\` label`},{id:S.EF.LabelFilterNoErrors,name:"No pipeline errors",params:[],defaultParams:[],alternativesKey:"label filter",category:S.Ln.LabelFilters,orderRank:S.h5.NoErrors,renderer:(B,$e,Qe)=>`${Qe} | __error__=\`\``,addOperationHandler:w.af,explainHandler:()=>"Filter out all formatting and parsing errors."},{id:S.EF.Unwrap,name:"Unwrap",params:[{name:"Identifier",type:"string",hideName:!0,minWidth:16,placeholder:"Label key",editor:q},{name:"Conversion function",hideName:!0,type:"string",options:["duration","duration_seconds","bytes"],optional:!0}],defaultParams:["",""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Unwrap,renderer:(B,$e,Qe)=>`${Qe} | unwrap ${B.params[1]?`${B.params[1]}(${B.params[0]})`:B.params[0]}`,addOperationHandler:w.af,explainHandler:B=>{let $e=String(B.params[0]).length>0?B.params[0]:"<label>";return`Use the extracted label \`${$e}\` as sample values instead of log lines for the subsequent range aggregation.${B.params[1]?` Conversion function \`${B.params[1]}\` wrapping \`${$e}\` will attempt to convert this label from a specific format (e.g. 3k, 500ms).`:""}`}},{id:S.EF.Decolorize,name:"Decolorize",params:[],defaultParams:[],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:(B,$e,Qe)=>`${Qe} | decolorize`,addOperationHandler:w.af,explainHandler:()=>"This will remove ANSI color codes from log lines."},{id:S.EF.Drop,name:"Drop",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to drop."}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:w.EP,addOperationHandler:w.af,explainHandler:()=>"The drop expression will drop the given labels in the pipeline."},{id:S.EF.Keep,name:"Keep",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to keep."}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:w.EP,addOperationHandler:w.af,explainHandler:()=>"The keep expression will keep only the specified labels in the pipeline and drop all the other labels."},...Q.I,{id:S.EF.NestedQuery,name:"Binary operation with query",params:[],defaultParams:[],category:S.Ln.BinaryOps,renderer:(B,$e,Qe)=>Qe,addOperationHandler:w.VR}]}const Se=ke();function ve(te){return(Se.find(fe=>fe.id===te)?.explainHandler?.({id:"",params:["<value>"]})||"").replace(/\[(.*)\]\(.*\)/g,"$1")}function _e(te){return Se.find(Oe=>Oe.id===te)}function $(te,Oe){return!(Oe.length<te.params.filter(Re=>!Re.optional).length)}},60706:(lt,Be,l)=>{"use strict";l.d(Be,{u_:()=>de,w4:()=>Ae});var Q=l(36195),Ce=l(58592),M=l(83657),A=l(56245),r=l(54623);function de(N){const _=(0,A.qk)(N),ue=Q.K3.parse(_).topNode,F={query:{labels:[],operations:[]},errors:[]};try{E(_,ue,F)}catch(K){console.error(K),K instanceof Error&&F.errors.push({text:K.message})}return Qe(F.query)&&(F.errors=[]),F}function E(N,_,ee){const ue=ee.query;switch(_.type.id){case Q.g$:{ue.labels.push(be(N,_));const T=_.getChild(A.Ql);T&&ee.errors.push((0,A.xz)(N,T));break}case Q.PN:{const{operation:T,error:F}=V(N,_);T&&ue.operations.push(T),F&&ee.errors.push($e(N,_,F));break}case Q.iT:{ue.operations.push(me(N,_));break}case Q.bY:{const{operation:T,error:F}=xe(N,_);T&&ue.operations.push(T),F&&ee.errors.push($e(N,_,F));break}case Q.eF:{ue.operations.push(w(N,_));break}case Q.Zj:case Q.Tz:{const{operation:T,error:F}=q(N,_);T&&ue.operations.push(T),F&&ee.errors.push($e(N,_,F));break}case Q.pH:{ue.operations.push(S(N,_));break}case Q.e_:{ue.operations.push(ke(N,_));break}case Q.HV:{const{operation:T,error:F}=ve(N,_,ee);T&&ue.operations.push(T),F&&ee.errors.push($e(N,_,F));break}case Q.Zg:{ue.operations.push(Se());break}case Q.h1:{ue.operations.push(_e(N,_,ee));break}case Q.Rh:{ue.operations.push($(N,_,ee));break}case Q.MK:{Oe(N,_,ee);break}case A.Ql:{if(fe(_))break;ee.errors.push((0,A.xz)(N,_));break}case Q.i8:{ue.operations.push(Je(N,_,ee));break}case Q.UP:{ue.operations.push(He(N,_,ee));break}default:{let T=_.firstChild;for(;T;)E(N,T,ee),T=T.nextSibling}}}function be(N,_){const ee=_.getChild(Q.gw),ue=(0,A.AA)(N,ee),T=(0,A.AA)(N,ee?.nextSibling);let F=(0,A.AA)(N,_.getChild(Q.Qf));return F=F.substring(1,F.length-1),{label:ue,op:T,value:F}}function V(N,_){const ee=(0,A.AA)(N,_.getChild(Q.dJ)),ue=Ae((0,A.AA)(N,_.getChild(Q.Qf)));if(_.getChild(Q.w7)?.getChild(Q.Ip))return{operation:{id:r.EF.LineFilterIpMatches,params:[ee,ue]}};const F=[ue];let K=_.getChild(Q.ih);for(;K;)F.push(Ae((0,A.AA)(N,K.getChild(Q.Qf)))),K=K.getChild(Q.ih);return{operation:{id:{"|=":r.EF.LineContains,"!=":r.EF.LineContainsNot,"|~":r.EF.LineMatchesRegex,"!~":r.EF.LineMatchesRegexNot}[ee],params:F}}}function me(N,_){const ee=_.firstChild,ue=(0,A.AA)(N,ee),T=Ae((0,A.AA)(N,_.getChild(Q.Qf)));let F=T?[T]:[];const K=(0,M.mD)(ue);return K&&!(0,M.VI)(K,F)&&(F=K?.defaultParams||[]),{id:ue,params:F}}function w(N,_){const ee=_.getChild(Q.LM),ue=(0,A.AA)(N,ee),T=[...(0,A.R1)(N,_,Q.Gn)];return{id:ue,params:T}}function q(N,_){const ee=[],ue=[];let T;const F=_.from;return _.toTree().iterate({enter:z=>{z.type.id===Q.ov?ee.push(N.substring(z.from+F,z.to+F)):z.type.id===Q.Gn?ue.push(N.substring(z.from+F,z.to+F)):z.type.id===A.Ql&&(T=`Unexpected string "${N.substring(z.from+F,z.to+F)}"`)}}),{operation:{id:r.EF.Logfmt,params:[ee.includes("--strict"),ee.includes("--keep-empty"),...ue]},error:T}}function xe(N,_){if(_.getChild(Q.Or)||_.getChild(Q.KD)||_.getChild("Comma"))return{error:'Label filter with comma, "and", "or" not supported in query builder'};if(_.firstChild.type.id===Q.GA){const p=_.firstChild,L=p?.getChild(Q.gw),v=L?.nextSibling,C=p?.getChild(Q.Qf),X=Ae((0,A.AA)(N,C));return{operation:{id:r.EF.LabelFilterIpMatches,params:[(0,A.AA)(N,L),(0,A.AA)(N,v),X]}}}const ee=r.EF.LabelFilter;if(_.firstChild.type.id===Q.Jq){const L=_.firstChild.firstChild.firstChild,v=L.nextSibling,C=v.nextSibling,X=Ae((0,A.AA)(N,C));return{operation:{id:ee,params:[(0,A.AA)(N,L),(0,A.AA)(N,v),X]}}}const T=_.firstChild.firstChild,F=T.nextSibling,K=F.nextSibling,z=[(0,A.AA)(N,T),(0,A.AA)(N,F),Ae((0,A.AA)(N,K))];return z.join("")==="__error__="?{operation:{id:r.EF.LabelFilterNoErrors,params:[]}}:{operation:{id:ee,params:z}}}function S(N,_){const ee=r.EF.LineFormat,ue=Ae((0,A.AA)(N,_.getChild(Q.Qf)));return{id:ee,params:[ue]}}function ke(N,_){const ee=r.EF.LabelFormat,ue=_.getChild(Q.gw),F=ue.nextSibling.nextSibling;return{id:ee,params:[(0,A.AA)(N,F),Ae((0,A.AA)(N,ue))]}}function Se(){return{id:r.EF.Decolorize,params:[]}}function ve(N,_,ee){const ue=_.getChild(Q.HV),T=_.getChild(Q.bY),F=_.getChild(Q.sK);if(ue&&E(N,ue,ee),T&&E(N,T,ee),F){if(F.nextSibling?.type.id===Q.yW){const K=F.nextSibling,z=K.nextSibling;return{operation:{id:r.EF.Unwrap,params:[(0,A.AA)(N,z),(0,A.AA)(N,K)]}}}return{operation:{id:r.EF.Unwrap,params:[(0,A.AA)(N,F?.nextSibling),""]}}}return{}}function _e(N,_,ee){const ue=_.getChild(Q.lo),T=(0,A.AA)(N,ue),F=_.getChild(Q.wN),K=_.getChild(Q.xo),z=F!=null?[(0,A.AA)(N,F)]:[],p=K?.getChild(Q.Q6),L=p?(0,A.AA)(N,p):null,v=_.getChild(Q.aU);L&&z.unshift(L.substring(1,L.length-1)),v&&z.push(...(0,A.R1)(N,v,Q.gw));const C={id:T,params:z};return K&&E(N,K,ee),C}function $(N,_,ee){const ue=_.getChild(Q.ZQ);let T=(0,A.AA)(N,ue);const F=_.getChild(Q.aU),K=[],z=_.getChild(Q.wN);z&&K.push(Number((0,A.AA)(N,z))),F&&(F.getChild(Q.By)&&T&&(T=`__${T}_by`),F.getChild(Q.xB)&&(T=`__${T}_without`),K.push(...(0,A.R1)(N,F,Q.gw)));const p=_.getChild(Q.Yw),L={id:T,params:K};return p&&(p.firstChild?.type.id===Q.MK&&ee.errors.push({text:"Query parsing is ambiguous.",from:p.firstChild.from,to:p.firstChild?.to}),E(N,p,ee)),L}const te=Ce.C.reduce((N,_)=>(N[_.sign]={id:_.id,comparison:_.comparison},N),{});function Oe(N,_,ee){const ue=ee.query,T=_.firstChild,F=(0,A.AA)(N,T.nextSibling),K=Re(N,_.getChild(Q.o5)),z=_.lastChild,p=te[F],L=B(T,"MetricExpr.LiteralExpr.Number"),v=B(z,"MetricExpr.LiteralExpr.Number"),C=z.getChild(Q.MK);if(L||E(N,T,ee),v)ue.operations.push((0,A.rq)(p,N,z,!!K?.isBool));else if(C){const X=(0,A.z9)(z);X?.type.id===Q.wN&&ue.operations.push((0,A.rq)(p,N,X,!!K?.isBool)),E(N,z,ee)}else{ue.binaryQueries=ue.binaryQueries||[];const X={operator:F,query:{labels:[],operations:[]}};K?.isMatcher&&(X.vectorMatchesType=K.matchType,X.vectorMatches=K.matches),ue.binaryQueries.push(X),E(N,z,{query:X.query,errors:ee.errors})}}function Re(N,_){if(!_)return;const ee=_.getChild(Q.wT),ue=_.getChild(Q.x);if(!ee&&ue)return{isBool:!0,isMatcher:!1};{if(!ee)return;const T=(0,A.AA)(N,ee.getChild(Q.x$)?.getChild(Q.qJ));return{isMatcher:!0,isBool:!!ue,matches:T,matchType:ee.getChild(Q.On)?"on":"ignoring"}}}function fe(N){return N?.parent?.type.id===Q.Q6}function Ae(N){return N[0]==='"'&&N[N.length-1]==='"'?N.substring(1,N.length-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"):N.replace(/`/g,"")}function B(N,_){let ee=N;const ue=_.split(".");for(const T of ue)if(ee=ee.getChild(T),!ee)return null;return ee}function $e(N,_,ee){const ue=(0,A.xz)(N,_);return ue.text=`${ee}: ${ue.text}`,ue}function Qe(N){return N.labels.length===0&&N.operations.length===0}function Je(N,_,ee){const ue=[];let T=_.getChild(Q.LQ);for(;T;){const F=(0,A.AA)(N,T.getChild(Q.yj));F&&ue.push(F),T=T?.getChild(Q.LQ)}return ue.reverse(),{id:r.EF.Drop,params:ue}}function He(N,_,ee){const ue=[];let T=_.getChild(Q.J3);for(;T;){const F=(0,A.AA)(N,T.getChild(Q.UM));F&&ue.push(F),T=T?.getChild(Q.J3)}return ue.reverse(),{id:r.EF.Keep,params:ue}}},56245:(lt,Be,l)=>{"use strict";l.d(Be,{AA:()=>be,If:()=>E,Ql:()=>Q,R1:()=>me,SY:()=>A,qk:()=>r,rq:()=>V,xz:()=>M,z9:()=>Ce});const Q=0;function Ce(q){return q.firstChild?Ce(q.firstChild):q}function M(q,xe){return{text:be(q,xe),from:xe.from,to:xe.to,parentType:xe.parent?.name}}const A=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g;function r(q){return q.replace(A,(xe,S,ke,Se,ve,_e,$)=>{const te=Se||$;let Oe=S,Re="0";return ke&&(Oe=ke,Re="1"),ve&&(Oe=ve,Re="2"),`__V_${Re}__`+Oe+"__V__"+(te?"__F__"+te+"__F__":"")})}const de=[(q,xe)=>`$${q}`,(q,xe)=>`[[${q}${xe?`:${xe}`:""}]]`,(q,xe)=>`\${${q}${xe?`:${xe}`:""}}`];function E(q){return q.replace(/__V_(\d)__(.+?)__V__(?:__F__(\w+)__F__)?/g,(xe,S,ke,Se)=>de[parseInt(S,10)](ke,Se))}function be(q,xe){return xe?E(q.substring(xe.from,xe.to)):""}function V(q,xe,S,ke){const Se=[parseFloat(be(xe,S))];return q.comparison&&Se.push(ke),{id:q.id,params:Se}}function me(q,xe,S){if(xe.type.id===S||xe.name===S)return[be(q,xe)];const ke=[];let Se=0,ve=xe.childAfter(Se);for(;ve;)ke.push(...me(q,ve,S)),Se=ve.to,ve=xe.childAfter(Se);return ke}const w=q=>q.split(" ").map(S=>`${S}.*`).join("")},54623:(lt,Be,l)=>{"use strict";l.d(Be,{EF:()=>A,IQ:()=>Ce,Ln:()=>M,NS:()=>de,h5:()=>r});var Q=l(42952),Ce=(E=>(E.Log="log",E.Metric="metric",E))(Ce||{}),M=(E=>(E.Aggregations="Aggregations",E.RangeFunctions="Range functions",E.Functions="Functions",E.Formats="Formats",E.LineFilters="Line filters",E.LabelFilters="Label filters",E[E.BinaryOps=Q.T]="BinaryOps",E))(M||{}),A=(E=>(E.Json="json",E.Logfmt="logfmt",E.Regexp="regexp",E.Pattern="pattern",E.Unpack="unpack",E.LineFormat="line_format",E.LabelFormat="label_format",E.Decolorize="decolorize",E.Drop="drop",E.Keep="keep",E.Rate="rate",E.RateCounter="rate_counter",E.CountOverTime="count_over_time",E.SumOverTime="sum_over_time",E.AvgOverTime="avg_over_time",E.MaxOverTime="max_over_time",E.MinOverTime="min_over_time",E.FirstOverTime="first_over_time",E.LastOverTime="last_over_time",E.StdvarOverTime="stdvar_over_time",E.StddevOverTime="stddev_over_time",E.QuantileOverTime="quantile_over_time",E.BytesRate="bytes_rate",E.BytesOverTime="bytes_over_time",E.AbsentOverTime="absent_over_time",E.Sum="sum",E.Avg="avg",E.Min="min",E.Max="max",E.Stddev="stddev",E.Stdvar="stdvar",E.Count="count",E.TopK="topk",E.BottomK="bottomk",E.LineContains="__line_contains",E.LineContainsNot="__line_contains_not",E.LineContainsCaseInsensitive="__line_contains_case_insensitive",E.LineContainsNotCaseInsensitive="__line_contains_not_case_insensitive",E.LineMatchesRegex="__line_matches_regex",E.LineMatchesRegexNot="__line_matches_regex_not",E.LineFilterIpMatches="__line_filter_ip_matches",E.LabelFilter="__label_filter",E.LabelFilterNoErrors="__label_filter_no_errors",E.LabelFilterIpMatches="__label_filter_ip_marches",E.Unwrap="unwrap",E.SumBy="__sum_by",E.SumWithout="__sum_without",E.Addition="__addition",E.Subtraction="__subtraction",E.MultiplyBy="__multiply_by",E.DivideBy="__divide_by",E.Modulo="__modulo",E.Exponent="__exponent",E.NestedQuery="__nested_query",E.EqualTo="__equal_to",E.NotEqualTo="__not_equal_to",E.GreaterThan="__greater_than",E.LessThan="__less_than",E.GreaterOrEqual="__greater_or_equal",E.LessOrEqual="__less_or_equal",E))(A||{}),r=(E=>(E[E.LineFilters=1]="LineFilters",E[E.Parsers=2]="Parsers",E[E.PipeOperations=3]="PipeOperations",E[E.Unwrap=4]="Unwrap",E[E.NoErrors=5]="NoErrors",E[E.RangeVectorFunction=5]="RangeVectorFunction",E[E.Last=6]="Last",E))(r||{});const de={equals:{label:"=",value:"=",description:"Equals",isMultiValue:!1},doesNotEqual:{label:"!=",value:"!=",description:"Does not equal",isMultiValue:!1},matchesRegex:{label:"=~",value:"=~",description:"Matches regex",isMultiValue:!0},doesNotMatchRegex:{label:"!~",value:"!~",description:"Does not match regex",isMultiValue:!0},greaterThan:{label:">",value:">",description:"Greater than",isMultiValue:!1},greaterThanOrEqual:{label:">=",value:">=",description:"Greater than or equal to",isMultiValue:!1},lessThan:{label:"<",value:"<",description:"Less than",isMultiValue:!1},lessThanOrEqual:{label:"<=",value:"<=",description:"Less than or equal to",isMultiValue:!1},contains:{label:"|=",value:"|=",description:"Contains",isMultiValue:!1},doesNotContain:{label:"!=",value:"!=",description:"Does not contain",isMultiValue:!1}}},75723:(lt,Be,l)=>{"use strict";l.d(Be,{Ac:()=>me,nE:()=>V,db:()=>S,fV:()=>q,sz:()=>ke,YB:()=>w,aN:()=>xe});var Q=l(11261),Ce=l(70416),M=l(97535);function A(Se){let ve;try{ve=JSON.parse(Se)}catch{}return typeof ve=="object"}const r=/(?:^|\s)([\w\(\)\[\]\{\}]+)=(""|(?:".*?[^\\]"|[^"\s]\S*))/;function de(Se){return r.test(Se)}function E(Se){let ve;try{return ve=JSON.parse(Se),ve.hasOwnProperty("_entry")}catch{return!1}}var be=l(65650);function V(Se){return(Se.fields.find(_e=>_e.name==="labels")?.values??[]).some(_e=>_e.__error__!==void 0)}function me(Se){return(Se.fields.find(_e=>_e.name==="labels")?.values??[]).some(_e=>_e.level!==void 0)}function w(Se){const ve=Se.fields.find(Re=>Re.type===Q.PU.string);if(ve==null)return{hasJSON:!1,hasLogfmt:!1,hasPack:!1};const _e=ve.values;let $=!1,te=!1,Oe=!1;return _e.forEach(Re=>{A(Re)&&($=!0,Oe=E(Re)),de(Re)&&(te=!0)}),{hasLogfmt:te,hasJSON:$,hasPack:Oe}}function q(Se,ve=be.HD.Indexed){const _e=Se?.fields?.find(Oe=>Oe.name==="labels")?.values??[],$=Se?.fields?.find(Oe=>Oe.name==="labelTypes")?.values??[];if(!_e?.length)return[];if(!$?.length){if(ve===be.HD.Indexed){const{keys:Oe}=(0,M.P7)(_e);return Oe}return[]}let te=new Set;for(let Oe=0;Oe<_e.length;Oe++){const Re=_e[Oe],fe=$[Oe],Ae=Object.keys(Re).filter(B=>fe[B]===ve);te=new Set([...te,...Ae])}return Array.from(te)}function xe(Se){const ve=Se?.fields?.find($=>$.name==="labels")?.values??[];return ve?.length?Object.keys(ve[0]).filter($=>{const te=ve[0][$];return te?!isNaN(Number(te))||(0,Ce.pp)(te)||(0,M.tY)(te):!1}).filter($=>ve.every(te=>te[$])):[]}function S(Se){const ve=Se.fields.find($=>$.name==="labels"&&$.type===Q.PU.other);return ve==null?!1:ve.values.some($=>$.__error__)}function ke(Se){const ve=Se.fields.find(te=>te.name==="labels"&&te.type===Q.PU.other);if(ve==null)return null;const _e=ve.values.slice(0,2);let $=null;for(let te of _e){const Oe=Object.keys(te).find(Re=>Re==="lvl"||Re.includes("level"));if(Oe){$=Oe;break}}return $}},79007:(lt,Be,l)=>{"use strict";l.d(Be,{Ex:()=>ve,jg:()=>me,uJ:()=>_e});var Q=l(41987),Ce=l(42952),M=l(14110),A=l(32264),r=l(27724),de=l(51814),E=l(56587),be=l(56245),V=l(65650);const me=({payload:{dashboardId:$,orgId:te,grafanaVersion:Oe,queries:Re}})=>{try{const fe=Re[de.id]?.filter(F=>!F.hide)?.map(F=>(0,E.vV)(F));if(!fe?.length)return;const Ae=fe.filter(F=>(0,E.sI)(F.expr)),B=fe.filter(F=>!(0,E.sI)(F.expr)),$e=fe.filter(F=>F.queryType===V.U3.Instant),Qe=fe.filter(F=>F.queryType===V.U3.Range),Je=fe.filter(F=>F.editorMode===Ce.f.Builder),He=fe.filter(F=>F.editorMode===Ce.f.Code),N=fe.filter(w),_=fe.filter(q),ee=fe.filter(xe),ue=fe.filter(S),T={grafana_version:Oe,dashboard_id:$,org_id:te,queries_count:fe.length,logs_queries_count:Ae.length,metric_queries_count:B.length,instant_queries_count:$e.length,range_queries_count:Qe.length,builder_mode_queries_count:Je.length,code_mode_queries_count:He.length,queries_with_template_variables_count:N.length,queries_with_changed_resolution_count:_.length,queries_with_changed_line_limit_count:ee.length,queries_with_changed_legend_count:ue.length};(0,M.rR)("grafana_loki_dashboard_loaded",T)}catch(fe){console.error("error in loki tracking handler",fe)}},w=$=>be.SY.test($.expr),q=$=>$.resolution?$.resolution!==1:!1,xe=$=>$.maxLines!==null&&$.maxLines!==void 0,S=$=>$.legendFormat?$.legendFormat!=="":!1,ke=$=>!![r.Gf,r.M1,r.mL,r.ow,r.lb].some(Oe=>$.startsWith(Oe)),Se=$=>{let te=0;for(const Oe of $.data){const Re=Oe.meta?.custom?.lokiQueryStatKey;Re&&(te+=Oe.meta?.stats?.find(fe=>fe.displayName===Re)?.value??0)}return te};function ve($,te,Oe,Re={},fe={}){const{app:Ae,targets:B}=te;if(Ae!==Q.Jk.Explore)return;let $e=Se($);for(const Qe of B){if(ke(Qe.refId))return;(0,M.rR)("grafana_explore_loki_query_executed",{grafana_version:A.$.buildInfo.version,editor_mode:Qe.editorMode,has_data:$.data.some(Je=>Je.length>0),has_error:$.error!==void 0,legend:Qe.legendFormat,line_limit:Qe.maxLines,obfuscated_query:(0,E.$F)(Qe.expr),query_type:(0,E.sI)(Qe.expr)?"logs":"metric",query_vector_type:Qe.queryType,resolution:Qe.resolution,simultaneously_executed_query_count:B.filter(Je=>!Je.hide).length,simultaneously_hidden_query_count:B.filter(Je=>Je.hide).length,time_range_from:te?.range?.from?.toISOString(),time_range_to:te?.range?.to?.toISOString(),time_taken:Date.now()-Oe.getTime(),bytes_processed:$e,is_split:!1,predefined_operations_applied:Re.predefinedOperations?Qe.expr.includes(Re.predefinedOperations):"n/a",...fe})}}function _e($,te,Oe,Re,fe={}){const Ae={split_query_group_count:te.length,split_query_largest_partition_size:Math.max(...te.map(({partition:B})=>B.length)),split_query_total_request_count:te.reduce((B,{partition:$e})=>B+$e.length,0),is_split:!0,simultaneously_executed_query_count:Oe.targets.filter(B=>!B.hide).length,simultaneously_hidden_query_count:Oe.targets.filter(B=>B.hide).length};for(const B of te){const $e=B.partition.length;ve($,B.request,Re,fe,{...Ae,split_query_partition_size:$e})}}},30115:lt=>{var Be=typeof Element<"u",l=typeof Map=="function",Q=typeof Set=="function",Ce=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function M(A,r){if(A===r)return!0;if(A&&r&&typeof A=="object"&&typeof r=="object"){if(A.constructor!==r.constructor)return!1;var de,E,be;if(Array.isArray(A)){if(de=A.length,de!=r.length)return!1;for(E=de;E--!==0;)if(!M(A[E],r[E]))return!1;return!0}var V;if(l&&A instanceof Map&&r instanceof Map){if(A.size!==r.size)return!1;for(V=A.entries();!(E=V.next()).done;)if(!r.has(E.value[0]))return!1;for(V=A.entries();!(E=V.next()).done;)if(!M(E.value[1],r.get(E.value[0])))return!1;return!0}if(Q&&A instanceof Set&&r instanceof Set){if(A.size!==r.size)return!1;for(V=A.entries();!(E=V.next()).done;)if(!r.has(E.value[0]))return!1;return!0}if(Ce&&ArrayBuffer.isView(A)&&ArrayBuffer.isView(r)){if(de=A.length,de!=r.length)return!1;for(E=de;E--!==0;)if(A[E]!==r[E])return!1;return!0}if(A.constructor===RegExp)return A.source===r.source&&A.flags===r.flags;if(A.valueOf!==Object.prototype.valueOf)return A.valueOf()===r.valueOf();if(A.toString!==Object.prototype.toString)return A.toString()===r.toString();if(be=Object.keys(A),de=be.length,de!==Object.keys(r).length)return!1;for(E=de;E--!==0;)if(!Object.prototype.hasOwnProperty.call(r,be[E]))return!1;if(Be&&A instanceof Element)return!1;for(E=de;E--!==0;)if(!((be[E]==="_owner"||be[E]==="__v"||be[E]==="__o")&&A.$$typeof)&&!M(A[be[E]],r[be[E]]))return!1;return!0}return A!==A&&r!==r}lt.exports=function(r,de){try{return M(r,de)}catch(E){if((E.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw E}}},8227:(lt,Be,l)=>{"use strict";l.d(Be,{A:()=>M});const Q=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ce(A){return typeof A=="string"&&Q.test(A)}const M=Ce},36195:(lt,Be,l)=>{"use strict";l.d(Be,{AL:()=>qt,By:()=>Wr,CX:()=>Tr,GA:()=>Nt,GN:()=>ye,Gn:()=>Qt,HV:()=>vr,I4:()=>ft,Ip:()=>kr,J3:()=>xt,J_:()=>Mt,Jq:()=>tr,K0:()=>bt,K3:()=>U,KD:()=>va,LM:()=>Pe,LQ:()=>Qa,MD:()=>Zt,MK:()=>Kr,Nl:()=>Pt,On:()=>Br,Or:()=>Oa,PN:()=>Bt,Q6:()=>hr,Qf:()=>dt,Rh:()=>zr,Sg:()=>xa,Tz:()=>Et,UK:()=>Sr,UM:()=>ht,UP:()=>gt,Yw:()=>nt,ZQ:()=>nr,Zg:()=>ha,Zj:()=>Ge,aU:()=>zt,bY:()=>Dt,c$:()=>Te,dJ:()=>kt,dw:()=>dr,eF:()=>er,e_:()=>rr,g$:()=>$t,gw:()=>mt,h1:()=>mr,i8:()=>sa,iT:()=>Tt,ih:()=>aa,lo:()=>jt,o5:()=>Na,ov:()=>La,pH:()=>Vt,q5:()=>ur,qJ:()=>yr,sK:()=>vt,sq:()=>Ea,t3:()=>ta,uk:()=>ba,w7:()=>ra,wN:()=>Ft,wT:()=>Lt,x:()=>Ur,x$:()=>Or,xB:()=>_r,xo:()=>Cr,yW:()=>Dr,yj:()=>pr});var Q=l(48820);const Ce=1,M=2,A=3,r=4,de=5,E=6,be=7,V=8,me=9,w=10,q=11,xe=12,S=13,ke=14,Se=15,ve=16,_e=17,$=18,te=19,Oe=20,Re=21,fe=22,Ae=23,B=24,$e=25,Qe=26,Je=27,He=28,N=29,_=30,ee=31,ue=32,T=33,F=34,K=35,z=96,p={json:Ce,logfmt:M,unpack:A,pattern:r,regexp:de,label_format:be,line_format:V,label_replace:me,vector:w,offset:q,bool:xe,on:S,ignoring:ke,group_left:Se,group_right:ve,unwrap:E,decolorize:_e,drop:$,keep:te},L=k=>p[k.toLowerCase()]||-1,v={by:Oe,without:Re,and:fe,or:Ae,unless:B,sum:$e,avg:Qe,count:Je,max:He,min:N,stddev:_,stdvar:ee,bottomk:ue,topk:T,sort:F,sort_desc:K},C=k=>v[k.toLowerCase()]||-1,X={__proto__:null,ip:291,count_over_time:297,rate:299,rate_counter:301,bytes_over_time:303,bytes_rate:305,avg_over_time:307,sum_over_time:309,min_over_time:311,max_over_time:313,stddev_over_time:315,stdvar_over_time:317,quantile_over_time:319,first_over_time:321,last_over_time:323,absent_over_time:325,bytes:331,duration:333,duration_seconds:335},U=Q.U1.deserialize({version:14,states:"EtOYQPOOO#cQPO'#DUOOQO'#EP'#EPO#hQPO'#EPO$wQPO'#DTOYQPO'#DTOOQO'#Eb'#EbO%UQPO'#EaOOQO'#E}'#E}O%ZQPO'#E|Q%fQPOOO&gQPO'#FZO&lQPO'#F[OOQO'#E`'#E`OOQO'#DS'#DSOOQO'#Ec'#EcOOQO'#Ed'#EdOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjOOQO'#Ek'#EkOOQO'#El'#ElOOQO'#Em'#EmOOQO'#En'#EnOOQO'#Eo'#EoOOQO'#Ep'#EpOOQO'#Eq'#EqO&qQPO'#DWOOQO'#DV'#DVO'PQPO,59pOOQO,5:k,5:kOOQO'#Dc'#DcO'XQPO'#DbO'aQPO'#DaO(zQPO'#D`O*eQPO'#D`OOQO'#D_'#D_O,gQPO,59oO-uQPO,59oO-|QPO,5:zO.TQPO,5:{O.`QPO'#EzO0kQPO,5;hO0rQPO,5;hO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jOYQPO,5;uO3ZQPO,5;vO3`QPO,59rO#cQPO,59qOOQO1G/[1G/[OOQO'#Df'#DfO3eQPO,59|O5OQPO,59|OOQO'#Dg'#DgO5TQPO,59{OOQO,59{,59{O5]QPO'#DWO5zQPO'#DjO7kQPO'#DmO9XQPO'#DmOOQO'#Dm'#DmOOQO'#Dt'#DtOOQO'#Dr'#DrO+TQPO'#DrO9^QPO,59zO:wQPO'#ETO:|QPO'#EUOOQO'#EX'#EXO;RQPO'#EYO;WQPO'#E]OOQO,59z,59zOOQO,59y,59yOOQO1G/Z1G/ZOOQO1G0f1G0fO;]QPO'#ErO.WQPO'#ErO;qQPO1G0gO;vQPO1G0gO;{QPO,5;fO=XQPO1G1SO=`QPO1G1SO=gQPO1G1SO=nQPO'#FQO?|QPO'#FPO@WQPO'#FPOYQPO1G1UOYQPO1G1UOYQPO1G1UOYQPO1G1UOYQPO1G1UOYQPO1G1UO@bQPO1G1aO@iQPO1G1bOOQO1G/^1G/^OOQO1G/]1G/]O5TQPO1G/hO@nQPO1G/hO@sQPO'#DhOB^QPO'#DhOOQO1G/g1G/gOBtQPO,59rOBcQPO,5:aOOQO'#Dk'#DkOCOQPO,5:UODoQPO'#DpOOQO'#Do'#DoOF]QPO,5:]OGvQPO,5:YOOQO,5:X,5:XOIaQPO,5:^O+TQPO,5:^O+TQPO,5:^OOQO,5:o,5:oOIoQPO'#EWOOQO'#EV'#EVOItQPO,5:pOK_QPO'#E[OOQO'#E['#E[OOQO'#EZ'#EZOMOQPO,5:tONiQPO'#E_OOQO'#E_'#E_OOQO'#E^'#E^O!!YQPO,5:wO!#sQPO'#D`O;]QPO,5;^O!#zQPO'#EsO!$PQPO,5;^O!$jQPO,5;^O!$tQPO,5;^O!${QPO,5;^O!%QQPO7+&RO.WQPO7+&ROOQO'#E{'#E{O!&bQPO1G1QOOQO1G1Q1G1QOYQPO7+&nO!&jQPO7+&nO!'zQPO7+&nO!(RQPO7+&nO!(YQQO'#FROOQO,5;l,5;lO!*hQPO,5;kO!*oQPO,5;kO!,QQPO7+&pO!,XQPO7+&pOOQO7+&p7+&pO!,fQPO7+&pO!,mQPO7+&pO!-rQPO7+&pO!.SQPO7+&{OOQO7+&|7+&|OOQO7+%S7+%SO!.XQPO7+%SO5TQPO,5:SO!.^QPO,5:SO!.cQPO1G/yOOQO1G/{1G/{OOQO1G0S1G0SOOQO1G0U1G0UOOQO,5:V,5:VO!.hQPO1G/wO!0RQPO,5:[O!0WQPO,5:ZOOQO1G/x1G/xO!0]QPO1G/xO!1vQPO,5:rO:|QPO,5:qO;RQPO,5:uO;WQPO,5:xO!2OQPO,5;aO!$PQPO1G0xO!2^QPO1G0xO!2fQPO,5;_O+TQPO,5;aO!2kQPO1G0xO!2rQPO'#EtO!2wQPO1G0xO!2kQPO1G0xO!3PQPO1G0xO!3WQPO1G0xO;lQPO1G0xOOQO1G0x1G0xOOQO<<Im<<ImO!3cQPO<<ImO!3hQPO,5;gOOQO7+&l7+&lO!3mQPO<<JYOOQO<<JY<<JYOYQPO<<JYOOQO'#FT'#FTO!3tQPO,5;mOOQO'#FS'#FSOOQO,5;m,5;mOOQO1G1V1G1VO!3|QPO1G1VO!6VQPO<<JgOOQO<<Hn<<HnOOQO1G/n1G/nO!6[QPO1G/nO!6aQPO7+%eOOQO1G/v1G/vOOQO1G/u1G/uOOQO1G0^1G0^OOQO1G0]1G0]OOQO1G0a1G0aOOQO1G0d1G0dOOQO'#Ev'#EvOOQO1G0{1G0{O!6fQPO1G0{OOQO'#Ew'#EwOOQO'#Ex'#ExOOQO'#Ey'#EyOOQO7+&d7+&dOOQO1G0y1G0yO!6kQPO1G0{O!7PQPO7+&dOOQO,5;`,5;`O!7XQPO7+&dO;lQPO7+&dO!7`QPO7+&dO!7kQPOAN?XOOQO1G1R1G1RO!8{QPOAN?tO!:]QPOAN?tO!:dQQO1G1XOOQO1G1X1G1XOOQO7+&q7+&qO!:lQPOAN@ROOQO7+%Y7+%YO!:qQPO<<IPO!:vQPO7+&gO!:{QPO<<JOO!;TQPO<<JOO!;]QPO'#EuO!;bQPO<<JOOOQOG24sG24sOOQOG25`G25`OOQO1G1Y1G1YOOQO7+&s7+&sO!;jQPOG25mOOQOAN>kAN>kO!;oQPO<<JROOQOAN?jAN?jO!;tQPOAN?jO!;|QPOLD+XOOQOAN?mAN?mOOQO,5:p,5:pO!<RQPO!$'NsO!<WQPO!)9D_O!<]QPO!.K9yOOQO!4//e!4//eO:|QPO'#EUO!<bQPO'#D`O!=YQPO,59oO!=dQPO'#DTOYQPO1G1UOYQPO1G1UOYQPO1G1UOYQPO1G1UOYQPO1G1UOYQPO1G1UO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jO!>oQPO7+&pO!>vQPO7+&pO!?TQPO7+&pO!@]QPO7+&pO!@dQPO7+&pO!?[QPO'#FO",stateData:"!@q~O$ROStOS~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!tQO!uRO!vRO$SPO$WTO$Y_O$Z`O$[aO$]bO$^cO$_dO$`eO$afO$bgO$chO$diO$ejO$fkO$glO$hmO~O{nO~O!tqO~O!OrO!QrO!WrO!XrOfwXgwXhwX!jwX!lwX!mwX!nwX!owX!uwX!vwX#ywX#zwX#{wX#|wX~O!]vO$PwX$XwX~P#mO$W{O~Od|Oe|O$W}O~Of!QOg!POh!QO!O!UO!j!UO!l!UO!m!UO!n!UO!o!UO!u!RO!v!RO#y!SO#z!SO#{!SO#|!TO~O$W!VO~O$W!WO~O|!XO!O!XO!P!XO!Q!XO~O$T!YO$U!ZO~O}!]O$V!_O~Og!`Of!TXh!TX!O!TX!Q!TX!W!TX!X!TX!]!TX!j!TX!l!TX!m!TX!n!TX!o!TX!u!TX!v!TX#y!TX#z!TX#{!TX#|!TX$P!TX$X!TX$i!TX$T!TX~O!OrO!QrO!WrO!XrOf!SXg!SXh!SX!]!SX!j!SX!l!SX!m!SX!n!SX!o!SX!u!SX!v!SX#y!SX#z!SX#{!SX#|!SX$P!SX$X!SX$i!SX$T!SX~OP!dOQ!cOR!fOS!eOT!eOV!lOW!kOa!mOb!nOc!oO{!bO$W!iO~O!OrO!QrO!WrO!XrOfwagwahwa!jwa!lwa!mwa!nwa!owa!uwa!vwa#ywa#zwa#{wa#|wa~O!]vO$Pwa$Xwa~P+]OfvXgvXhvX!OvX!jvX!lvX!mvX!nvX!ovX!uvX!vvX#yvX#zvX#{vX#|vX~O$X!rO~P,tO$X!sO~P,tO!t!wO$SPO$W!uO~O$W!xO~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!uRO!vRO$SPO$WTO$Y_O$Z`O$[aO$]bO$^cO$_dO$`eO$afO$bgO$chO$diO$ejO$fkO$glO$hmO~O!t!yO~P.eO$W!{O~O[#OO]!|O^!|OX#sPY#sPi#sPj#sPk#sPl#sPm#sPn#sPo#sPp#sPq#sPr#sPs#sP!t#sP!u#sP!v#sP$S#sP$W#sP$Y#sP$Z#sP$[#sP$]#sP$^#sP$_#sP$`#sP$a#sP$b#sP$c#sP$d#sP$e#sP$f#sP$g#sP$h#sP~O!t#WO~O}#XO~Og#ZOf!Uah!Ua!O!Ua!Q!Ua!W!Ua!X!Ua!]!Ua!j!Ua!l!Ua!m!Ua!n!Ua!o!Ua!u!Ua!v!Ua#y!Ua#z!Ua#{!Ua#|!Ua$P!Ua$X!Ua$i!Ua$T!Ua~O$W#[O~O}#]O$V!_O~O|#`O!O#`O!P!XO!Q!XO!j#aO!l#aO!m#aO!n#aO!o#aO~O{#dO!`#bOf!^Xg!^Xh!^X!O!^X!Q!^X!W!^X!X!^X!]!^X!j!^X!l!^X!m!^X!n!^X!o!^X!u!^X!v!^X#y!^X#z!^X#{!^X#|!^X$P!^X$X!^X$i!^X$T!^X~O{#dOf!aXg!aXh!aX!O!aX!Q!aX!W!aX!X!aX!]!aX!j!aX!l!aX!m!aX!n!aX!o!aX!u!aX!v!aX#y!aX#z!aX#{!aX#|!aX$P!aX$X!aX$i!aX$T!aX~O}#hO~Of#jOg#kO$T#jOh!Sa!O!Sa!Q!Sa!W!Sa!X!Sa!]!Sa!j!Sa!l!Sa!m!Sa!n!Sa!o!Sa!u!Sa!v!Sa#y!Sa#z!Sa#{!Sa#|!Sa$P!Sa$X!Sa$i!Sa~O}#lO~O{#mO~O{#pO~O{#tO~O!OrO!QrO!WrO!XrO!]#xO$i#zO~O$X$PO~O$T$QO~O{$RO$X$TO~Of!sXg!sXh!sX!O!sX!j!sX!l!sX!m!sX!n!sX!o!sX!u!sX!v!sX#y!sX#z!sX#{!sX#|!sX$X!sX~O$T$UO~P<TO$X$VO~P,tO!t$WO~P.eO$W$YO~OX#sXY#sXi#sXj#sXk#sXl#sXm#sXn#sXo#sXp#sXq#sXr#sXs#sX!t#sX!u#sX!v#sX$S#sX$W#sX$Y#sX$Z#sX$[#sX$]#sX$^#sX$_#sX$`#sX$a#sX$b#sX$c#sX$d#sX$e#sX$f#sX$g#sX$h#sX~O_$[O`$[O~P=sO]!|O^!|O~P=sO$T$dO~P,tO$X$eO~O}$gO~Og$hOf![Xh![X!O![X!Q![X!W![X!X![X!]![X!j![X!l![X!m![X!n![X!o![X!u![X!v![X#y![X#z![X#{![X#|![X$P![X$X![X$i![X$T![X~O$W$iO~O!k$kO!q$lO!tQO!uRO!vRO~O}#XO$V!_O~PBcO{#dO!`$nOf!^ag!^ah!^a!O!^a!Q!^a!W!^a!X!^a!]!^a!j!^a!l!^a!m!^a!n!^a!o!^a!u!^a!v!^a#y!^a#z!^a#{!^a#|!^a$P!^a$X!^a$i!^a$T!^a~O|$pOf!dXg!dXh!dX!O!dX!Q!dX!W!dX!X!dX!]!dX!j!dX!l!dX!m!dX!n!dX!o!dX!u!dX!v!dX#y!dX#z!dX#{!dX#|!dX$P!dX$T!dX$X!dX$i!dX~O$T$qOf!eag!eah!ea!O!ea!Q!ea!W!ea!X!ea!]!ea!j!ea!l!ea!m!ea!n!ea!o!ea!u!ea!v!ea#y!ea#z!ea#{!ea#|!ea$P!ea$X!ea$i!ea~O$T$qOf!bag!bah!ba!O!ba!Q!ba!W!ba!X!ba!]!ba!j!ba!l!ba!m!ba!n!ba!o!ba!u!ba!v!ba#y!ba#z!ba#{!ba#|!ba$P!ba$X!ba$i!ba~Of#jOg#kO$T#jO$X$rO~O|$tO~O$T$uOf!xag!xah!xa!O!xa!Q!xa!W!xa!X!xa!]!xa!j!xa!l!xa!m!xa!n!xa!o!xa!u!xa!v!xa#y!xa#z!xa#{!xa#|!xa$P!xa$X!xa$i!xa~O|!XO!O!XO!P!XO!Q!XOf#OXg#OXh#OX!W#OX!X#OX!]#OX!j#OX!l#OX!m#OX!n#OX!o#OX!u#OX!v#OX#y#OX#z#OX#{#OX#|#OX$P#OX$T#OX$X#OX$i#OX~O$T$vOf!|ag!|ah!|a!O!|a!Q!|a!W!|a!X!|a!]!|a!j!|a!l!|a!m!|a!n!|a!o!|a!u!|a!v!|a#y!|a#z!|a#{!|a#|!|a$P!|a$X!|a$i!|a~O|!XO!O!XO!P!XO!Q!XOf#RXg#RXh#RX!W#RX!X#RX!]#RX!j#RX!l#RX!m#RX!n#RX!o#RX!u#RX!v#RX#y#RX#z#RX#{#RX#|#RX$P#RX$T#RX$X#RX$i#RX~O$T$wOf#Pag#Pah#Pa!O#Pa!Q#Pa!W#Pa!X#Pa!]#Pa!j#Pa!l#Pa!m#Pa!n#Pa!o#Pa!u#Pa!v#Pa#y#Pa#z#Pa#{#Pa#|#Pa$P#Pa$X#Pa$i#Pa~OU$xO~P*eO!k${O~O!]$|O$i#zO~O!OrO!QrO!WrO!XrO!]#xO~OZ%OO$X#fa~P!$XO$X%TO~P;]O$X%UO~Od|Oe|Of#Tqg#Tqh#Tq!O#Tq!j#Tq!l#Tq!m#Tq!n#Tq!o#Tq!u#Tq!v#Tq#y#Tq#z#Tq#{#Tq#|#Tq$P#Tq$X#Tq$T#Tq~O$T%XO$X%YO~Od|Oe|Of#pqg#pqh#pq!O#pq!j#pq!l#pq!m#pq!n#pq!o#pq!u#pq!v#pq#y#pq#z#pq#{#pq#|#pq$P#pq$X#pq$T#pq~O$T%]O~P<TO$X%[O~P,tO#x%^O$X%aO~OX#saY#sai#saj#sak#sal#sam#san#sao#sap#saq#sar#sas#sa!t#sa!u#sa!v#sa$S#sa$Y#sa$Z#sa$[#sa$]#sa$^#sa$_#sa$`#sa$a#sa$b#sa$c#sa$d#sa$e#sa$f#sa$g#sa$h#sa~O$W$YO~P!(bO_%cO`%cO$W#sa~P!(bOf!QOh!QO!O!UO!j!UO!l!UO!m!UO!n!UO!o!UO!u!RO!v!RO#y#rq#z#rq#{#rq#|#rq$P#rq$X#rq~Og#rq~P!*|Of#rqg#rqh#rq~P!+SOg!PO~P!*|O$P#rq$X#rq~P%fOf#rqg#rqh#rq!O#rq!j#rq!l#rq!m#rq!n#rq!o#rq#y#rq#z#rq#{#rq#|#rq~O!u!RO!v!RO$P#rq$X#rq~P!,wO}%dO~O$X%eO~O}%gO~O$W%hO~O$T$qOf!eig!eih!ei!O!ei!Q!ei!W!ei!X!ei!]!ei!j!ei!l!ei!m!ei!n!ei!o!ei!u!ei!v!ei#y!ei#z!ei#{!ei#|!ei$P!ei$X!ei$i!ei~O}%iO~O{#dO~Of#jO$T#jOg!fih!fi!O!fi!Q!fi!W!fi!X!fi!]!fi!j!fi!l!fi!m!fi!n!fi!o!fi!u!fi!v!fi#y!fi#z!fi#{!fi#|!fi$P!fi$X!fi$i!fi~O{%kO}%kO~O{%pO$k%rO$l%sO$m%tO~OZ%OO$X#fi~O$j%vO~O$X#fi~P!$XO!k%yO~O!]$|O$X#fi~O$X%{O~P;]O!]$|O$X%{O$i#zO~O$X%}O~O{&OO~O$X&PO~P,tO$T&RO$X&SO~O$W$YOX#siY#sii#sij#sik#sil#sim#sin#sio#sip#siq#sir#sis#si!t#si!u#si!v#si$S#si$Y#si$Z#si$[#si$]#si$^#si$_#si$`#si$a#si$b#si$c#si$d#si$e#si$f#si$g#si$h#si~O$T&UO~O$X&VO~O}&WO~O$W&XO~Of#jOg#kO$T#jO!]#ii$i#ii$X#ii~O!]$|O$X#fq~O$X#fq~P!$XOZ%OO!]&[O$X#fq~Od|Oe|Of#T!Rg#T!Rh#T!R!O#T!R!j#T!R!l#T!R!m#T!R!n#T!R!o#T!R!u#T!R!v#T!R#y#T!R#z#T!R#{#T!R#|#T!R$P#T!R$X#T!R$T#T!R~Od|Oe|Of#p!Rg#p!Rh#p!R!O#p!R!j#p!R!l#p!R!m#p!R!n#p!R!o#p!R!u#p!R!v#p!R#y#p!R#z#p!R#{#p!R#|#p!R$P#p!R$X#p!R$T#p!R~O$X&_O~P,tO#x%^O$X&aO~O}&bO~O$X&cO~O{&dO~O!]$|O$X#fy~OZ%OO$X#fy~OU$xO~O!]&[O$X#fy~O$T&gO~O$X&hO~O!]$|O$X#f!R~O}&jO~O$T&kO~O}&lO~O$X&mO~OP!dOQ!cOR!fOS!eOT!eOV&nOW!kOa!mOb!nOc!oO{!bO$W!iO~O!]&oO$Twa~P+]O!]&oO$TwX~P#mOf&yOh&yO!O&}O!j&}O!l&}O!m&}O!n&}O!o&}O!u&zO!v&zO#y#rq#z#rq#{#rq#|#rq$T#rq~Og#rq~P!=nOf#rqg#rqh#rq~P!=tOg&xO~P!=nOf&yOg&xOh&yO!O&}O!j&}O!l&}O!m&}O!n&}O!o&}O!u&zO!v&zO#y&{O#z&{O#{&{O#|&|O~O$T#rq~P!?[O!u&zO!v&zO$T#rq~P!,wO",goto:"1j$PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP$Q%P%h&W&ZPPPPPP&r'U'f't(VPP(f(n(wP)Q)VP)Q)Q)Y)c)Q)k)|)|*VPPPPPP*VP)|*`PPP)Q)Q*y+P)Q)Q+W+Z)Q+a+d+j,],r-X-X-X-X-X-X-X-X-X-X-X-X-X-X-X-n-w.[.h/Q/T/T/T/W/g,]/j,]0P0u1W1a1dPPPPP,],][YOT}!{$U%]Q$^#PQ$_#QS$`#R&tQ$a#SQ$b#TQ$c#UQ'O&rQ'P&sQ'Q&uQ'R&vQ'S&wR'T!Vt^O}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wRyTjSOT}!V!{#P#Q#R#S#T#U$U%]S!t{$QQ#}!u]&q&r&s&t&u&v&wRpPQoP^!hv!i#j#k#x$|&oQ#Y!YS#q!n$vT#u!o$wQxSQ#y!tQ$}#|Q%R#}Q%z%QR&p&q[wS!t#|#}%Q&q]!qx#y$}%R%z&piuSx!t#y#|#}$}%Q%R%z&p&qhtSx!t#y#|#}$}%Q%R%z&p&qR!auksSux!t#y#|#}$}%Q%R%z&p&qQ!^sV#^!`#Z$hW![s!`#Z$hR$j#`Q#_!`Q$f#ZR%f$hV!pv#x&oR#c!cQ#f!cQ#g!dR$o#cU#e!c!d#cR%j$qU!jv#x&oQ#i!iQ$r#jQ$s#kR%w$|_!hv!i#j#k#x$|&o_!gv!i#j#k#x$|&ov]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wT$m#`#aQ#o!lR&i&nS#n!l&nR%l$uR#s!nQ#r!nR%m$vR#w!oQ#v!oR%n$wj^O#P#Q#R#S#T#U&r&s&t&u&v&wQzTQ!z}Q#V!VQ$X!{Q%Z$UR&Q%]w]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwVOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwUOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ!v{Q$O!uR%W$QS#|!t#}W$z#y#{%R%SQ%u$yQ%|%TR&Z%{Q%Q#|Q%u$zQ&]%|R&e&ZQ#{!tS$y#y%RQ%P#|Q%S#}S%x$}%QS&Y%z%|R&f&]R%q$xR%o$xQ!OXQ%V$PQ%[$VQ&^%}R&_&PR$S!xwXOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ#P!PQ#Q!QQ#R!RQ#S!SQ#T!TQ#U!UQ&r&xQ&s&yQ&t&zQ&u&{Q&v&|R&w&}h!}!P!Q!R!S!T!U&x&y&z&{&|&}R$]#OQ$Z!|Q%b$[R&T%cR%_$YQ%`$YR&`&R",nodeNames:"\u26A0 Json Logfmt Unpack Pattern Regexp Unwrap LabelFormat LineFormat LabelReplace Vector Offset Bool On Ignoring GroupLeft GroupRight Decolorize Drop Keep By Without And Or Unless Sum Avg Count Max Min Stddev Stdvar Bottomk Topk Sort Sort_Desc LineComment LogQL Expr LogExpr Selector Matchers Matcher Identifier Eq String Neq Re Nre PipelineExpr PipelineStage LineFilters LineFilter Filter PipeExact PipeMatch FilterOp Ip OrFilter Pipe LogfmtParser LogfmtParserFlags ParserFlag LabelParser JsonExpressionParser LabelExtractionExpressionList LabelExtractionExpression LogfmtExpressionParser LabelFilter IpLabelFilter UnitFilter DurationFilter Gtr Duration Gte Lss Lte Eql BytesFilter Bytes NumberFilter LiteralExpr Number Add Sub LineFormatExpr LabelFormatExpr LabelsFormat LabelFormatMatcher DecolorizeExpr DropLabelsExpr DropLabels DropLabel KeepLabelsExpr KeepLabels KeepLabel MetricExpr RangeAggregationExpr RangeOp CountOverTime Rate RateCounter BytesOverTime BytesRate AvgOverTime SumOverTime MinOverTime MaxOverTime StddevOverTime StdvarOverTime QuantileOverTime FirstOverTime LastOverTime AbsentOverTime LogRangeExpr Range OffsetExpr UnwrapExpr ConvOp BytesConv DurationConv DurationSecondsConv Grouping Labels VectorAggregationExpr VectorOp BinOpExpr BinOpModifier OnOrIgnoringModifier GroupingLabels GroupingLabelList GroupingLabel LabelName Mul Div Mod Pow LabelReplaceExpr VectorExpr",maxTerm:167,skippedNodes:[0,36],repeatNodeCount:0,tokenData:"5b~RvX^#ipq#iqr$^rs$qst%cuv%nxy%syz%xz{%}{|&S|}&X}!O&^!O!P(l!P!Q)l!Q!R)q!R![+X![!]2X!^!_2m!_!`2z!`!a3a!c!}3n!}#O4U#P#Q4Z#Q#R4`#R#S3n#S#T4e#T#o3n#o#p4q#p#q4v#q#r5]#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~#nY$R~X^#ipq#i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~$aQ!_!`$g#r#s$l~$lO!O~~$qO!Q~~$tUOY$qZr$qrs%Ws#O$q#O#P%]#P~$q~%]O}~~%`PO~$q~%hQt~OY%cZ~%c~%sO#{~~%xO$W~~%}O$X~~&SO#y~~&XO!u~~&^O$T~~&cP!v~}!O&f~&iQ#_#`&o#g#h'|~&rP#X#Y&u~&xP#X#Y&{~'OP#d#e'R~'UP}!O'X~'[P#X#Y'_~'bP#a#b'e~'hP#d#e'k~'nP#h#i'q~'tP#m#n'w~'|O!`~~(PP#h#i(S~(VP#f#g(Y~(]P#]#^(`~(cP#V#W(f~(iP#h#i'w~(oP!Q![(r~(wR!t~!Q![(r!g!h)Q#X#Y)Q~)TR{|)^}!O)^!Q![)d~)aP!Q![)d~)iP!t~!Q![)d~)qO#z~~)ve!t~!O!P(r!Q![+X!g!h,l!i!j-Z!m!n-Z!o!p-Z!r!s-Z!v!w-Z#U#V-O#W#X-d#X#Y/f#Z#[/x#[#]-{#_#`/x#a#b0R#d#e/x#g#h/T#h#i/x#k#l0d#l#m1m#m#n1O~+^d!t~!O!P(r!Q![+X!g!h,l!i!j-Z!m!n-Z!o!p-Z!r!s-Z!v!w-Z#U#V-O#W#X-d#X#Y/f#Z#[/x#[#]-{#_#`/x#a#b0R#d#e/x#g#h/T#h#i/x#k#l0d#m#n1O~,oT{|)^}!O)^!Q![)d!d!e-O#]#^-T~-TO!q~~-WP#U#V-O~-^Q!d!e-O#]#^-T~-iP!k~!Q![-l~-oS!Q![-l#[#]-{#a#b.a#g#h/T~.QP!k~!Q![.T~.WR!Q![.T#a#b.a#g#h/T~.fQ!k~!Q![.l#g#h/O~.oR!Q![.l#a#b.x#g#h/T~.{P#g#h/O~/TO!k~~/YP!k~!Q![/]~/`Q!Q![/]#a#b.x~/iT{|)^}!O)^!Q![)d#U#V-O#]#^-T~/{Q#U#V-O#]#^-T~0WS!k~!Q![.l#U#V-O#]#^-T#g#h/O~0iP!k~!Q![0l~0oT!Q![0l#W#X-d#[#]-{#a#b.a#g#h/T~1TP!k~!Q![1W~1ZU!Q![1W#W#X-d#[#]-{#a#b.a#g#h/T#k#l0d~1pR!Q![1y!c!i1y#T#Z1y~2OR!t~!Q![1y!c!i1y#T#Z1yP2^T{P!Q![2X![!]2X!c!}2X#R#S2X#T#o2X~2rP!m~!_!`2u~2zO!n~~3PQ|~!_!`3V#r#s3[~3[O!o~~3aO!P~~3fP!j~!_!`3i~3nO!l~R3uT{P#xQ!Q![3n![!]2X!c!}3n#R#S3n#T#o3n~4ZO$i~~4`O$j~~4eO#|~~4hRO#S4e#S#T%W#T~4e~4vO$S~~4{Q!]~!_!`5R#r#s5W~5WO!W~~5]O!X~~5bO$U~",tokenizers:[0,1],topRules:{LogQL:[0,37]},specialized:[{term:43,get:(k,H)=>L(k)<<1},{term:43,get:(k,H)=>C(k)<<1|1},{term:43,get:k=>X[k]||-1}],tokenPrec:0}),Pe=1,Te=2,We=3,je=4,ut=5,vt=6,Xt=7,or=8,Xr=9,Lr=10,lr=11,Ur=12,Br=13,Ba=14,Zr=15,it=16,ha=17,Wa=18,_a=19,Wr=20,_r=21,va=22,Oa=23,Ot=24,Gt=25,qr=26,ea=27,cr=28,ka=29,Va=30,ya=31,Yt=32,Jt=33,Ut=34,yt=35,ba=36,bt=37,ye=38,Sr=39,Zt=40,Ea=41,$t=42,mt=43,$r=44,dt=45,ja=46,za=47,Pa=48,qt=49,ta=50,Tr=51,Bt=52,kt=53,xa=54,ur=55,ra=56,kr=57,aa=58,Ka=59,Ge=60,Vr=61,La=62,Tt=63,er=64,ft=65,Qt=66,Et=67,Dt=68,Nt=69,tr=70,Rt=71,jr=72,dr=73,fr=74,na=75,Ha=76,Ga=77,wt=78,Wt=79,Qr=80,Pt=81,Ft=82,Sa=83,$a=84,Vt=85,Mt=86,Ta=87,rr=88,wr=89,sa=90,Qa=91,pr=92,gt=93,xt=94,ht=95,nt=96,mr=97,jt=98,gr=99,ar=100,Ya=101,ia=102,Rr=103,Ja=104,Fr=105,wa=106,Za=107,qa=108,Ra=109,Fa=110,en=111,tn=112,Ca=113,Cr=114,hr=115,Ar=116,vr=117,Dr=118,Aa=119,rn=120,Da=121,zt=122,an=123,zr=124,nr=125,Kr=126,Na=127,Lt=128,Or=129,yr=130,oa=131,la=132,Ma=133,Ia=134,nn=135,ca=136,br=137,ua=138;function Kt(k,H){const ne=[];return U.parse(k).iterate({enter:W=>{(H===void 0||H===W.type.id)&&ne.push(W.node)}}),ne[0]}function da(k){return!Kt(k,z)}function g(k){return"  ".repeat(k)}function n(k,H){return k.split(`
`).map(re=>g(H)+re).join(`
`)}function a(k){return k.split(`
`).map(ne=>ne.trimEnd()).join(`
`)}function i(k,H){const ne=k.firstChild?.type.id===H;let re=!1;return k.firstChild&&ne&&(re=!0,k=k.firstChild),{addBrackets:re,newNode:k}}function o(k,H){const ne=[];let re=k.firstChild;for(;re;)H.includes(re.type.id)&&ne.push(re),ne.push(...o(re,H)),re=re.nextSibling;return ne}function u(k,H,ne){return H===k?` ${ne}`:`
${g(1)}${ne}`}function m(k,H){let ne=k.length-1;for(;ne>=0&&H.includes(k[ne]);)ne--;return k.substring(0,ne+1)}const y=(k,H)=>{const{addBrackets:ne,newNode:re}=i(k,Sr);k=re;const W=U.parse(H.substring(k.from,k.to));let Le="";return W.iterate({enter:Ne=>{const Xe=Ne.node;switch(Xe.type.id){case Zt:Le+=P(Xe,H);break;case qt:Xe.parent?.type.id!==qt&&(Le+=I(Xe,H));break}}}),ne?"("+Le+")":Le};function P(k,H){const ne=H.substring(k.from,k.to),re=U.parse(ne),W=[];let Le="";return re.iterate({enter:Ne=>{const Xe=Ne.node;Xe.type.id===$t&&W.push(Xe)}}),W.sort((Ne,Xe)=>{const tt=Ne.getChild(mt),qe=Xe.getChild(mt),ct=tt&&H.substring(tt.from,tt.to),sr=qe&&H.substring(qe.from,qe.to);return!ct||!sr?0:ct<sr?-1:ct>sr?1:0}),W.forEach(Ne=>{const Xe=Ne.getChild(mt),tt=Xe?Xe.nextSibling:null,qe=Ne.getChild(dt),ct=Xe?H.substring(Xe.from,Xe.to):null,sr=tt?H.substring(tt.from,tt.to):null,Pr=qe?H.substring(qe.from,qe.to):null;Le+=`${ct}${sr}${Pr}, `}),"{"+m(Le,", ")+"}"}function I(k,H){const ne=[Bt,Tt,Ge,Dt,er,Vt,Mt,wr];let re,W="";return o(k,ne).forEach(Le=>{switch(Le.type.id){case Bt:W+=u(Bt,re,Y(Le,H)),re=Bt;break;case Tt:W+=u(Tt,re,Z(Le,H)),re=Tt;break;case Ge:W+=u(Ge,re,Z(Le,H)),re=Ge;break;case er:W+=u(er,re,ae(Le,H)),re=er;break;case Dt:W+=u(Dt,re,se(Le,H)),re=Dt;break;case Vt:W+=u(Vt,re,Ie(Le,H)),re=Vt;break;case Mt:W+=u(Mt,re,Fe(Le,H)),re=Mt;break;case wr:W+=u(wr,re,ze()),re=wr;break}}),W}function Y(k,H){const ne=k.getChild(kt),re=k.getChild(ra),W=k.getChild(dt),Le=ne&&H.substring(ne.from,ne.to),Ne=W&&H.substring(W.from,W.to);return re?`${Le} ip(${Ne})`:`${Le} ${Ne}`}function Z(k,H){if(k.getChild(dt)){const W=k.getChild(ut)||k.getChild(je),Le=k.getChild(dt),Ne=W&&H.substring(W.from,W.to),Xe=Le&&H.substring(Le.from,Le.to);return`| ${Ne}${Xe}`}return`| ${H.substring(k.from,k.to)}`}function ae(k,H){const ne=o(k,[Qt]);let re="";return ne.forEach(W=>{const Le=W.getChild(mt),Ne=W.getChild(dt),Xe=Le&&H.substring(Le.from,Le.to),tt=Ne&&H.substring(Ne.from,Ne.to);re+=`${Xe}=${tt}, `}),`| json ${m(re,", ")}`}function se(k,H){const ne=k.getChild($t)||k.getChild(Nt)||k.getChild(Qr)||k.getChild(tr)?.getChild(Rt)||k.getChild(tr)?.getChild(wt);if(!ne)return"";const re=ne.type.id,W=ne.getChild(mt),Le=W&&W.nextSibling;let Ne;re===Rt?Ne=ne.getChild(dr):re===wt?Ne=ne.getChild(Wt):re===Qr?Ne=ne.getChild(Pt):Ne=ne.getChild(dt);const Xe=W&&H.substring(W.from,W.to),tt=Le&&H.substring(Le.from,Le.to),qe=Ne&&H.substring(Ne.from,Ne.to);return re===Nt?`| ${Xe}${tt}ip(${qe})`:`| ${Xe}${tt}${qe}`}function Ie(k,H){const ne=k.getChild(dt);return`| line_format ${ne&&H.substring(ne.from,ne.to)}`}function Fe(k,H){const ne=o(k,[rr]);let re="| label_format ";return ne.forEach(W=>{let Le,Ne;W.getChildren(mt).length===2?[Le,Ne]=W.getChildren(mt):(Le=W.getChild(mt),Ne=W.getChild(dt));const Xe=Le&&H.substring(Le.from,Le.to),tt=Ne&&H.substring(Ne.from,Ne.to);re+=`${Xe}=${tt}, `}),m(re,", ")}function ze(){return"| decolorize"}const we=(k,H)=>{const{addBrackets:ne,newNode:re}=i(k,nt);k=re;let W="";const Le=k.firstChild;switch(Le&&Le.type.id){case mr:W=Ze(k,H);break;case zr:W=ot(k,H);break;case Kr:W=Ct(k,H);break;case Pt:W=At(k,H);break;case br:W=Nr(k,H);break;case ua:W=_t(k,H);break}return ne?"("+W+")":W};function Ze(k,H){let ne="";return o(k,[jt,Ft,Cr,zt]).forEach(re=>{if(re.parent?.type.id===mr)switch(re.type.id){case jt:ne+=`${H.substring(re.from,re.to)}(
`;break;case Ft:ne+=`${g(1)+H.substring(re.from,re.to)},
`;break;case Cr:ne+=et(re,H);break;case zt:ne+=Ye(re,H);break}}),ne}function et(k,H){const ne=[];let re="",W="",Le="",Ne="",Xe="";o(k,[Zt,hr,Ar,vr,qt]).forEach(qe=>{if(qe.parent?.type.id===Cr)switch(ne.push(qe),qe.type.id){case Zt:{let ct=H.substring(qe.from,qe.to);re+=P({...qe,from:0,to:ct.length},ct);break}case qt:W+=I(qe,H);break;case hr:Le+=H.substring(qe.from,qe.to);break;case Ar:{const ct=qe.getChild(dr);Ne+=` offset ${ct?H.substring(ct.from,ct.to):""}`;break}case vr:o(qe,[mt,Dr,Dt]).forEach((ct,sr,Pr)=>{switch(ct.type.id){case mt:{if(ct.parent?.type.id!==vr||Pr.find(sn=>sn.type.id===Dr))return;Xe+=`| unwrap ${H.substring(ct.from,ct.to)} `;return}case Dr:{const fa=Pr.find(hn=>hn.type.id===mt),sn=fa?H.substring(fa.from,fa.to):"";Xe+=`| unwrap ${H.substring(ct.from,ct.to)}(${sn}) `;return}case Dt:Xe+=se(ct,H);return}});break}});let tt="";return ne.forEach((qe,ct,sr)=>{const Pr=sr[ct-1];qe.type.id===Zt&&(tt+=g(1)+re),qe.type.id===qt&&(tt+=n(W,1)),qe.type.id===hr&&(tt+=`
`+g(1)+Le),qe.type.id===Ar&&(tt+=Ne),qe.type.id===vr&&(Pr?.type.id!==Ar&&Pr?.type.id!==hr?tt+=`
`+g(1)+Xe:tt+=" "+Xe)}),tt+=`
)`}function Ye(k,H){let ne="";const re=o(k,[mt]).map(W=>H.substring(W.from,W.to));return o(k,[Wr,_r]).forEach(W=>{if(W.parent?.type.id===zt)switch(W.type.id){case Wr:ne=` by (${re.join(", ")}) `;break;case _r:ne=` without (${re.join(", ")}) `;break}}),ne}function ot(k,H){let ne="";return o(k,[nr,Ft,nt,zt]).forEach((re,W,Le)=>{if(re.parent?.type.id===zr)switch(re.type.id){case nr:ne+=`${H.substring(re.from,re.to)}`;break;case Ft:ne+=`(
`,ne+=`${g(1)+H.substring(re.from,re.to)},
`;break;case nt:{const Ne=Le.find(qe=>qe.type.id===Ft&&qe.parent?.type.id===zr);ne+=Ne?"":`(
`;const Xe=H.substring(re.from,re.to),tt=Kt(Xe,nt);ne+=n(we(tt,Xe),1),ne+=`
)`;break}case zt:ne+=Ye(re,H);break}}),ne}function Ct(k,H){let ne;const[re,W]=o(k,[ye]).map((Le,Ne)=>{Ne===0&&(ne=H.substring(Le.nextSibling?.from??0,Le.nextSibling?.to));const Xe=H.substring(Le.from,Le.to);let tt;return da(Xe)?(tt=Kt(Xe,Sr),y(tt,Xe)):(tt=Kt(Xe,nt),we(tt,Xe))});return re+`
`+ne+`
`+W}function At(k,H){k=k.getChild(Pt)??k;const ne=k.getChild(Sa),re=k.getChild($a),W=k.getChild(Ft);return W?ne?`+${H.substring(W.from,W.to)}`:re?`-${H.substring(W.from,W.to)}`:H.substring(W.from,W.to):""}function Nr(k,H){let ne=`label_replace(
`;return o(k,[nt,dt]).forEach(re=>{if(re.parent?.type.id===br)if(re.type.id===nt){const W=H.substring(re.from,re.to),Le=Kt(W,nt);ne+=n(we(Le,W),1)+`,
`}else ne+=g(1)+H.substring(re.from,re.to)+`,
`}),m(ne,`,
`)+`
)`}function _t(k,H){k=k.getChild(ua)??k;const ne=k.getChild(Ft);return ne?`vector(${H.substring(ne.from,ne.to)})`:""}const Er=k=>{const H=U.parse(k);let ne="";return H.iterate({enter:re=>{const W=re.node;if(!(W.parent?.type.id!==ye||W.parent?.parent?.type.id===Kr))switch(W.type.id){case nt:return ne=we(W,k),!1;case Sr:return ne=y(W,k),!1}}}),a(ne)}}}]);

//# sourceMappingURL=4684.85e58ef474e0ab7af9ec.js.map