"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8891],{88891:(pt,nt,z)=>{z.d(nt,{Mv:()=>ct,O4:()=>yt,g$:()=>dt});var Y=z(36613),rt=z(11261),ot=z(41260),J=z(77678),lt=z(83195),f=z(52622),st=z(51336),tt=z(3290),it=z(4134),V=z(52995);function ct(y){const{dataRef:l,theme:g,timeZone:s,getTimeRange:D,cellGap:p,hideLE:R,hideGE:_,yAxisConfig:E,ySizeDivisor:x,selectionMode:O=V.iS.X}=y,U="x";let h=!0;l.current?.heatmap?.fields[0].type!==rt.PU.time&&(h=!1);const C=devicePixelRatio;let X=l.current?.heatmap?.meta?.type;const $=g.visualization.getColorByName(y.exemplarColor);let F,d,c=new st.e(s);c.addHook("init",e=>{e.root.querySelectorAll(".u-cursor-pt").forEach(i=>{Object.assign(i.style,{borderRadius:"0",border:"1px solid white",background:"transparent"})})}),h&&c.addHook("setData",e=>{let{min:i,max:t}=e.scales.x,n=D().from.valueOf(),a=D().to.valueOf();(i!==n||t!==a)&&queueMicrotask(()=>{e.setScale(U,{min:n,max:a})})}),c.addHook("drawClear",e=>{F=F||new it.C$(0,0,e.bbox.width,e.bbox.height),F.clear(),e.series.forEach((i,t)=>{t>0&&(i._paths=null)})}),c.setMode(2),c.addScale({scaleKey:U,isTime:h,orientation:f.Lt.Horizontal,direction:f.ON.Right,range:(e,i,t)=>{if(h)return[D().from.valueOf(),D().to.valueOf()];if(l.current?.xLayout===f.D7.le)return[i-l.current?.xBucketSize,t];if(l.current?.xLayout===f.D7.ge)return[i,t+l.current?.xBucketSize];{let n=l.current?.xBucketSize/2;return[i-n,t+n]}}});let B;if(!h){B=[];for(let e=0;e<10;e++)B.push(e*l.current?.xBucketSize)}c.addAxis({scaleKey:U,placement:f.vM.Bottom,incrs:B,isTime:h,theme:g,timeZone:s});const A=l.current?.heatmap?.fields[1];if(!A)return c;const I=A.config?.custom?.scaleDistribution??{type:f.L4.Linear},H=!!E.reverse,m=X===ot.m.HeatmapCells&&!(0,tt.Nb)(l.current?.heatmap),W=I.type!==f.L4.Linear||m,w=(0,tt.eE)(l.current?.heatmap).yOrdinalDisplay!=null,b="y_"+(Math.random()+1).toString(36).substring(7);c.addScale({scaleKey:b,isTime:!1,orientation:f.Lt.Vertical,direction:H?f.ON.Down:f.ON.Up,distribution:W?f.L4.Log:f.L4.Linear,log:I.log??2,range:m?(e,i,t)=>{let n=e.data[1][2][0]/e.data[1][1][0];t*=n;let a,r;if([a,r]=W?Y.A.rangeLog(i,t,I.log??2,!0):[i,t],W&&!w){let u=e.scales[b].log,o=u===2?Math.log2:Math.log10,{min:M,max:L}=E;if(M!=null&&M>0){let K=o(M);a=u**(0,J.rs)(K,1)}if(L!=null&&L>0){let K=o(L);r=u**(0,J.Uh)(K,1)}}return[a,r]}:(e,i,t)=>{let n=i,a=t,{min:r,max:u}=E;if(W){let o=e.scales[b].log,M=!1,L=!1,K=o===2?Math.log2:Math.log10;if(x!==1){let N=K(i),G=K(t);Number.isInteger(N)||(n=o**(0,J.rs)(N,1),M=!0),Number.isInteger(G)||(a=o**(0,J.Uh)(G,1),L=!0)}if(l.current?.yLayout===f.D7.le?M||(n/=o):l.current?.yLayout===f.D7.ge?L||(a*=o):(n/=o/2,a*=o/2),!w){if(r!=null&&r>0){let N=K(r);n=o**(0,J.rs)(N,1)}if(u!=null&&u>0){let N=K(u);a=o**(0,J.Uh)(N,1)}}}else{let o=l.current?.yBucketSize;o===0&&(o=1),o&&(l.current?.yLayout===f.D7.le?n-=o:l.current?.yLayout===f.D7.ge?a+=o:(n-=o/2,a+=o/2)),w||(n=r??n,a=u??a)}return[n,a]}});const Q=A.display??(0,lt.j_)("short");c.addAxis({scaleKey:b,show:E.axisPlacement!==f.vM.Hidden,placement:E.axisPlacement||f.vM.Left,size:E.axisWidth||null,label:E.axisLabel,theme:g,formatValue:(e,i)=>(0,lt.cN)(Q(e,i)),splits:w?e=>{const i=(0,tt.eE)(l.current?.heatmap);if(!i.yOrdinalDisplay)return[0,1];let t=i.yOrdinalDisplay.map((n,a)=>a);switch(l.current?.yLayout){case f.D7.le:t.unshift(-1);break;case f.D7.ge:t.push(t.length);break}if(e.height<60)t=[t[0],t[t.length-1]];else for(;t.length>3&&(e.height-15)/t.length<10;)t=t.filter((n,a)=>a%2===0);return t}:void 0,values:w?(e,i)=>{const t=(0,tt.eE)(l.current?.heatmap);return t.yOrdinalDisplay?i.map(n=>n<0?t.yMinDisplay??"":t.yOrdinalDisplay[n]??""):i}:void 0});const v=m?xt:ft;c.addSeries({facets:[{scale:U,auto:!0,sorted:1},{scale:b,auto:!0}],pathBuilder:v({each:(e,i,t,n,a,r,u)=>{F.add({x:n-e.bbox.left,y:a-e.bbox.top,w:r,h:u,sidx:i,didx:t})},gap:p,hideLE:R,hideGE:_,xAlign:l.current?.xLayout===f.D7.le?-1:l.current?.xLayout===f.D7.ge?1:0,yAlign:(l.current?.yLayout===f.D7.le?-1:l.current?.yLayout===f.D7.ge?1:0)*(H?-1:1),ySizeDivisor:x,disp:{fill:{values:(e,i)=>l.current?.heatmapColors?.values,index:l.current?.heatmapColors?.palette}}}),theme:g,scaleKey:""}),c.addSeries({facets:[{scale:U,auto:!0,sorted:1},{scale:b,auto:!0}],pathBuilder:ht({each:(e,i,t,n,a,r,u)=>{F.add({x:n-e.bbox.left,y:a-e.bbox.top,w:r,h:u,sidx:i,didx:t})}},$,l.current.yLayout),theme:g,scaleKey:""});const P=O===V.iS.X||O===V.iS.Xy,k=O===V.iS.Y||O===V.iS.Xy,Z={drag:{x:P,y:k,setScale:!1},dataIdx:(e,i)=>{if(i===1){d=null;let t=e.cursor.left*C,n=e.cursor.top*C;F.get(t,n,1,1,a=>{(0,it.ur)(t,n,a.x,a.y,a.x+a.w,a.y+a.h)&&(d=a)})}return d&&i===d.sidx?d.didx:null},focus:{prox:1e3,dist:(e,i)=>d?.sidx===i?0:1/0},points:{fill:"rgba(255,255,255, 0.3)",bbox:(e,i)=>{let t=d&&i===d.sidx;return{left:t?d.x/C:-10,top:t?d.y/C:-10,width:t?d.w/C:0,height:t?d.h/C:0}}}};return c.setCursor(Z),c}const at=4;function ft(y){const{disp:l,each:g,gap:s=1,hideLE:D=-1/0,hideGE:p=1/0,xAlign:R=1,yAlign:_=1,ySizeDivisor:E=1}=y,x=devicePixelRatio,O=s>=at?Math.round:h=>h,U=Math.round(s*x);return(h,C)=>(Y.A.orient(h,C,(X,$,F,d,c,B,A,T,I,H,m,W,w,b,Q)=>{let v=h.data[C];const P=v[0],k=v[1],Z=v[2],e=P.length;let i=l.fill.values(h,C),t=l.fill.index??[...new Set(i)],n=t.map(S=>new Path2D),a=e-k.lastIndexOf(k[0]),r=e/a,u=k[1]-k[0]||c.max-c.min,o=P[a]-P[0],M,L;d.distr===3?M=Math.abs(B(P[0]*d.log,d,H,T)-B(P[0],d,H,T)):M=Math.abs(B(o,d,H,T)-B(0,d,H,T)),c.distr===3?L=Math.abs(A(k[0]*c.log,c,m,I)-A(k[0],c,m,I))/E:L=Math.abs(A(u,c,m,I)-A(0,c,m,I))/E,M=Math.max(1,O(M-U)),L=Math.max(1,O(L-U));let K=R===-1?-M:R===0?-M/2:0,N=_===1?-L:_===0?-L/2:0,G=k.slice(0,a).map(S=>O(A(S,c,m,I)+N)),q=Array.from({length:r},(S,j)=>O(B(P[j*a],d,H,T)+K));for(let S=0;S<e;S++)if(Z[S]>D&&Z[S]<p){let j=q[~~(S/a)],et=G[S%a],gt=n[i[S]];b(gt,j,et,M,L),g(h,1,S,j,et,M,L)}return h.ctx.save(),h.ctx.rect(h.bbox.left,h.bbox.top,h.bbox.width,h.bbox.height),h.ctx.clip(),n.forEach((S,j)=>{h.ctx.fillStyle=t[j],h.ctx.fill(S)}),h.ctx.restore(),null}),null)}function ht(y,l,g){return(s,D)=>(Y.A.orient(s,D,(p,R,_,E,x,O,U,h,C,X,$,F,d,c,B)=>{let A=new Path2D,T=[A],I=[l??"rgba(255,0,255,0.7)"],H=g===f.D7.le?-.5:g===f.D7.ge?.5:0;for(let m=0;m<R.length;m++){let W=_[m];x.distr===3&&x.log===2||(W+=H);let b=O(R[m],E,X,h),Q=U(W,x,$,C),v=8,P=8;c(A,b-v/2,Q-P/2,v,P),y.each(s,D,m,b-v/2,Q-P/2,v,P)}s.ctx.save(),s.ctx.rect(s.bbox.left,s.bbox.top,s.bbox.width,s.bbox.height),s.ctx.clip(),T.forEach((m,W)=>{s.ctx.fillStyle=I[W],s.ctx.fill(m)}),s.ctx.restore()}),null)}function xt(y){const{disp:l,each:g,gap:s=1,hideLE:D=-1/0,hideGE:p=1/0}=y,R=devicePixelRatio,_=s>=at?Math.round:x=>x,E=Math.round(s*R);return(x,O)=>(Y.A.orient(x,O,(U,h,C,X,$,F,d,c,B,A,T,I,H,m,W)=>{let w=x.data[O];const b=w[0],Q=w[1],v=w[2],P=w[3],k=b.length;let Z=l.fill.values(x,O),e=l.fill.index??[...new Set(Z)],i=e.map(r=>new Path2D),t=new Map,n=new Map;for(let r=0;r<b.length;r++){let u=b[r],o=Q[r],M=v[r];t.has(u)||t.set(u,_(F(u,X,A,c))),n.has(o)||n.set(o,_(d(o,$,T,B))),n.has(M)||n.set(M,_(d(M,$,T,B)))}let a=t.get(b.find(r=>r!==b[0]))-t.get(b[0]);for(let r=0;r<k;r++){if(P[r]<=D||P[r]>=p)continue;let u=b[r],o=Q[r],M=v[r],L=t.get(u),K=n.get(o),N=n.get(M),G=a,q=K-N;G=Math.max(1,G-E),q=Math.max(1,q-E);let S=L-E/2-G,j=N+E/2,et=i[Z[r]];m(et,S,j,G,q),g(x,1,r,S,j,G,q)}x.ctx.save(),x.ctx.rect(x.bbox.left,x.bbox.top,x.bbox.width,x.bbox.height),x.ctx.clip(),i.forEach((r,u)=>{x.ctx.fillStyle=e[u],x.ctx.fill(r)}),x.ctx.restore()}),null)}const dt=(y,l,g,s=-1/0,D=1/0)=>{if(l==null){l=1/0;for(let p=0;p<y.length;p++)y[p]>s&&y[p]<D&&(l=Math.min(l,y[p]))}if(g==null){g=-1/0;for(let p=0;p<y.length;p++)y[p]>s&&y[p]<D&&(g=Math.max(g,y[p]))}return[l,g]},yt=(y,l,g,s)=>{let D=s-g||1,p=l.length,R=Array(y.length);for(let _=0;_<y.length;_++)R[_]=y[_]<g?0:y[_]>s?p-1:Math.min(p-1,Math.floor(p*(y[_]-g)/D));return R}}}]);

//# sourceMappingURL=8891.1cd6d38be3dfe500d415.js.map