"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9347],{69645:(W,D,t)=>{t.r(D),t.d(D,{default:()=>Qe});var e=t(96540),E=t(24180),o=t(66602),y=t(17272),I=t(37959),O=t(57895),P=t(98569),d=t(32196),T=t(85858),S=t(40845),u=t(39558),h=t(42418),f=t(67061),v=t(55852),Q=t(57418),z=t(14578),b=t(25994),j=t(50720),K=t(83277),C=t(8484),J=t(91540),ne=t(77583),V=t(55740),Y=t(57220),B=t(60021),ae=t(82843),U=t(19073),G=t(98164),M=t(56361),le=t(64853),re=t(75591),se=t(64149);const ie=({matchers:n})=>{const l=(0,S.of)(ce);return e.createElement("div",null,e.createElement(se.L,{className:l.tags,tags:n.map(r=>`${r.name}${(0,G.MN)(r)}${r.value}`)}))},ce=()=>({tags:(0,d.css)({justifyContent:"flex-start"})});var oe=t(69529),de=t(76442),ue=t(16233),me=t(75471);const ge=({alertManagerSourceName:n})=>{const l=(0,me.jy)(n);return ue.TP.hasPermission(l.create)?e.createElement(oe.p,{variant:"call-to-action",button:e.createElement(v.z9,{href:(0,M.nL)("alerting/silence/new",n),icon:"bell-slash",size:"lg"},e.createElement(C.x6,{i18nKey:"silences.empty-state.button-title"},"Create silence")),message:(0,C.t)("silences.empty-state.title","You haven't created any silences yet")}):e.createElement(de.c,{callToActionElement:e.createElement("div",null),message:"No silences found."})};var Z=t(70416),Ee=t(4554),fe=t(69087),ve=t(64047),ye=t(97754);const he=({alert:n,className:l})=>{const[r,s]=(0,e.useState)(!0),i=(0,Z.dU)({start:new Date(n.startsAt),end:new Date(n.endsAt)}),m=Object.entries(n.labels).reduce((c,[g,a])=>((g==="alertname"||g==="__alert_rule_title__")&&(c=a),c),"");return e.createElement(e.Fragment,null,e.createElement("tr",{className:l},e.createElement("td",null,e.createElement(ve.e,{isCollapsed:r,onToggle:c=>s(c)})),e.createElement("td",null,e.createElement(ye.y,{state:n.status.state})),e.createElement("td",null,"for ",i),e.createElement("td",null,m)),!r&&e.createElement("tr",{className:l},e.createElement("td",null),e.createElement("td",{colSpan:5},e.createElement(fe.m,{labels:n.labels,size:"sm"}))))},Ae=({silencedAlerts:n})=>{const l=(0,S.of)(Ee.L),r=(0,S.of)(pe);return n.length?e.createElement("table",{className:(0,d.cx)(l.table,r.tableMargin)},e.createElement("colgroup",null,e.createElement("col",{className:l.colExpand}),e.createElement("col",{className:r.colState}),e.createElement("col",null),e.createElement("col",{className:r.colName})),e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,e.createElement(C.x6,{i18nKey:"silences-table.header.state"},"State")),e.createElement("th",null),e.createElement("th",null,e.createElement(C.x6,{i18nKey:"silences-table.header.alert-name"},"Alert name")))),e.createElement("tbody",null,n.map((s,i)=>e.createElement(he,{key:s.fingerprint,alert:s,className:i%2===0?l.evenRow:""})))):null},pe=n=>({tableMargin:(0,d.css)({marginBottom:n.spacing(1)}),colState:(0,d.css)({width:"110px"}),colName:(0,d.css)({width:"65%"})}),Se=Ae,Ce=({silence:n})=>{const{startsAt:l,endsAt:r,comment:s,createdBy:i,silencedAlerts:m}=n,c=(0,S.of)(xe),g="YYYY-MM-DD HH:mm",a=T.parse(l),A=T.parse(r),p=(0,Z.dU)({start:new Date(l),end:new Date(r)});return e.createElement("div",{className:c.container},e.createElement("div",{className:c.title},"Comment"),e.createElement("div",null,s),e.createElement("div",{className:c.title},"Schedule"),e.createElement("div",null,`${a?.format(g)} - ${A?.format(g)}`),e.createElement("div",{className:c.title},"Duration"),e.createElement("div",null,p),e.createElement("div",{className:c.title},"Created by"),e.createElement("div",null,i),Array.isArray(m)&&e.createElement(e.Fragment,null,e.createElement("div",{className:c.title},"Affected alerts"),e.createElement(Se,{silencedAlerts:m})))},xe=n=>({container:(0,d.css)({display:"grid",gridTemplateColumns:"1fr 9fr",gridRowGap:"1rem",paddingBottom:n.spacing(2)}),title:(0,d.css)({color:n.colors.text.primary}),row:(0,d.css)({margin:n.spacing(1,0)})});var De=t(65415);const Ie={[B.RC.Active]:"good",[B.RC.Expired]:"neutral",[B.RC.Pending]:"neutral"},Pe=({state:n})=>e.createElement(De.O,{state:Ie[n]},n);var X=t(2543),Te=t(88575),Me=t(60029),Re=t(56034),Le=t(10354);const w=()=>(0,X.uniqueId)("query-string-"),Oe=()=>{const[n,l]=(0,e.useState)(w()),[r,s]=(0,K.s)(),{queryString:i}=(0,M.qy)(r),m=(0,S.of)(be),c=(0,X.debounce)(A=>{const p=A.target;s({queryString:p.value||null})},400),g=()=>{s({queryString:null,silenceState:null}),setTimeout(()=>l(w()))},a=i&&i.length>3?(0,G.J$)(i).length===0:!1;return e.createElement("div",{className:m.flexRow},e.createElement(Te.D,{className:m.rowChild,label:e.createElement(Me.J,null,e.createElement(f.B,{gap:.5},e.createElement("span",null,"Search by matchers"),e.createElement(Re.m,{content:e.createElement("div",null,"Filter silences by using a comma separated list of matchers, e.g.:",e.createElement("pre",null,"severity=critical, env=production"))},e.createElement(z.I,{name:"info-circle",size:"sm"})))),invalid:a,error:a?"Query must use valid matcher syntax":null},e.createElement(Le.p,{key:n,className:m.searchInput,prefix:e.createElement(z.I,{name:"search"}),onChange:c,defaultValue:i??"",placeholder:"Search","data-testid":"search-query-input"})),i&&e.createElement("div",{className:m.rowChild},e.createElement(v.$n,{variant:"secondary",icon:"times",onClick:g},"Clear filters")))},be=n=>({searchInput:(0,d.css)({width:"360px"}),flexRow:(0,d.css)({display:"flex",flexDirection:"row",alignItems:"flex-end",paddingBottom:n.spacing(3),borderBottom:`1px solid ${n.colors.border.medium}`}),rowChild:(0,d.css)({marginRight:n.spacing(1),marginBottom:0,maxHeight:"52px"}),fieldLabel:(0,d.css)({fontSize:"12px",fontWeight:500})}),k={pollingInterval:V.wG,refetchOnFocus:!0},Be=({alertManagerSourceName:n})=>{const[l,r]=(0,U.L7)(U.QI.PreviewSilencedInstances),s=l&&r,{data:i=[],isLoading:m}=ae.m.endpoints.getAlertmanagerAlerts.useQuery({amSourceName:n,filter:{silenced:!0,active:!0,inhibited:!0}},{...k,skip:!s}),{data:c=[],isLoading:g,error:a}=J.F.endpoints.getSilences.useQuery({datasourceUid:(0,Y.w5)(n),ruleMetadata:!0,accessControl:!0},k),{currentData:A}=ne.L.useDiscoverAmFeaturesQuery({amSourceName:n??""},{skip:!n}),p=(0,M.JZ)(a).includes("the Alertmanager is not configured")&&A?.lazyConfigInit,R=(0,S.of)(Ne),[L]=(0,K.s)(),$=_(c,!1),te=_(c,!0),{silenceState:Ye}=(0,M.qy)(L),Ge=Ye===B.RC.Expired,He=(0,e.useMemo)(()=>{const F=x=>i.filter(N=>N.status.silencedBy.includes(x));return $.map(x=>{const N=s?F(x.id):void 0;return{id:x.id,data:{...x,silencedAlerts:N}}})},[$,i,s]),H=(0,e.useMemo)(()=>{const F=x=>i.filter(N=>N.status.silencedBy.includes(x));return te.map(x=>{const N=s?F(x.id):void 0;return{id:x.id,data:{...x,silencedAlerts:N}}})},[te,i,s]);if(g||m)return e.createElement(u._,{text:"Loading silences..."});if(p)return e.createElement(h.F,{title:"The selected Alertmanager has no configuration",severity:"warning"},e.createElement(C.x6,{i18nKey:"silences.table.noConfig"},"Create a new contact point to create a configuration using the default values or contact your administrator to set up the Alertmanager."));if(a){const F=(0,M.JZ)(a)||"Unknown error.";return e.createElement(h.F,{severity:"error",title:"Error loading silences"},F)}return e.createElement("div",{"data-testid":"silences-table"},!!c.length&&e.createElement(f.B,{direction:"column"},e.createElement(Oe,null),e.createElement(le._,{actions:[U.QI.CreateSilence]},e.createElement(f.B,{justifyContent:"end"},e.createElement(v.z9,{href:(0,M.nL)("/alerting/silence/new",n),icon:"plus"},e.createElement(C.x6,{i18nKey:"silences.table.add-silence-button"},"Add Silence")))),e.createElement(q,{items:He,alertManagerSourceName:n,dataTestId:"not-expired-table"}),H.length>0&&e.createElement(Q.M,{label:`Expired silences (${H.length})`,isOpen:Ge},e.createElement("div",{className:R.callout},e.createElement(z.I,{className:R.calloutIcon,name:"info-circle"}),e.createElement("span",null,e.createElement(C.x6,{i18nKey:"silences.table.expired-silences"},"Expired silences are automatically deleted after 5 days."))),e.createElement(q,{items:H,alertManagerSourceName:n,dataTestId:"expired-table"}))),!c.length&&e.createElement(ge,{alertManagerSourceName:n}))};function q({items:n,alertManagerSourceName:l,dataTestId:r}){const s=ze(l);return n.length?e.createElement(re.E,{pagination:{itemsPerPage:25},items:n,cols:s,isExpandable:!0,dataTestId:r,renderExpandedContent:({data:i})=>e.createElement(e.Fragment,null,e.createElement(b.c,null),e.createElement(Ce,{silence:i}))}):e.createElement(C.x6,{i18nKey:"silences.table.no-matching-silences"},"No matching silences found;")}const _=(n,l=!1)=>{const[r]=(0,K.s)();return(0,e.useMemo)(()=>{const{queryString:s}=(0,M.qy)(r),i=r?.silenceIds;return n.filter(m=>typeof i=="string"&&!i.split(",").includes(m.id)||s&&!(0,G.J$)(s).every(a=>m.matchers?.some(({name:A,value:p,isEqual:R,isRegex:L})=>a.name===A&&a.value===p&&a.isEqual===R&&a.isRegex===L))?!1:l?m.status.state===B.RC.Expired:m.status.state!==B.RC.Expired)},[r,n,l])},Ne=n=>({callout:(0,d.css)({backgroundColor:n.colors.background.secondary,borderTop:`3px solid ${n.colors.info.border}`,borderRadius:n.shape.radius.default,height:"62px",display:"flex",flexDirection:"row",alignItems:"center","& > *":{marginLeft:n.spacing(1)}}),calloutIcon:(0,d.css)({color:n.colors.info.text})});function ze(n){const[l,r]=(0,U.L7)(U.QI.UpdateSilence),[s]=J.F.endpoints.expireSilence.useMutation(),i=n===Y.hY;return(0,e.useMemo)(()=>{const m=g=>{s({datasourceUid:(0,Y.w5)(n),silenceId:g})},c=[{id:"state",label:"State",renderCell:function({data:{status:a}}){return e.createElement(Pe,{state:a.state})},size:3},{id:"alert-rule",label:"Alert rule targeted",renderCell:function({data:{metadata:a}}){return a?.rule_title?e.createElement(j.N,{href:`/alerting/grafana/${a?.rule_uid}/view?returnTo=${encodeURIComponent("/alerting/silences")}`},a.rule_title):"None"},size:8},{id:"matchers",label:"Matching labels",renderCell:function({data:{matchers:a}}){const A=a?.filter(p=>p.name!==V.kW)||[];return e.createElement(ie,{matchers:A})},size:7},{id:"alerts",label:"Alerts silenced",renderCell:function({data:{silencedAlerts:a}}){return e.createElement("span",{"data-testid":"alerts"},Array.isArray(a)?a.length:"-")},size:2},{id:"schedule",label:"Schedule",renderCell:function({data:{startsAt:a,endsAt:A}}){const p=T.parse(a),R=T.parse(A),L="YYYY-MM-DD HH:mm";return`${p?.format(L)} - ${R?.format(L)}`},size:7}];return l&&c.push({id:"actions",label:"Actions",renderCell:function({data:a}){const A=a.status.state===B.RC.Expired,p=a?.accessControl?.create,R=a?.accessControl?.write,L=A&&(i?p:r),$=!A&&(i?R:r);return e.createElement(f.B,{gap:.5,wrap:"wrap"},L&&e.createElement(v.z9,{title:"Recreate",size:"sm",variant:"secondary",icon:"sync",href:(0,M.nL)(`/alerting/silence/${a.id}/edit`,n)},e.createElement(C.x6,{i18nKey:"silences.table.recreate-button"},"Recreate")),$&&e.createElement(e.Fragment,null,e.createElement(v.z9,{title:"Unsilence",size:"sm",variant:"secondary",icon:"bell",onClick:()=>m(a.id)},e.createElement(C.x6,{i18nKey:"silences.table.unsilence-button"},"Unsilence")),e.createElement(v.z9,{title:"Edit",size:"sm",variant:"secondary",icon:"pen",href:(0,M.nL)(`/alerting/silence/${a.id}/edit`,n)},e.createElement(C.x6,{i18nKey:"silences.table.edit-button"},"Edit"))))},size:5}),c},[n,s,i,r,l])}const Ke=Be,ee={icon:"bell-slash"};function Ue(){const{isExact:n,path:l}=(0,E.W5)(),[r,s]=(0,e.useState)();return(0,e.useEffect)(()=>{l==="/alerting/silence/new"?s({...ee,id:"silence-new",text:"Silence alert rule",subTitle:"Configure silences to stop notifications from a particular alert rule"}):l==="/alerting/silence/:id/edit"&&s({...ee,id:"silence-edit",text:"Edit silence",subTitle:"Recreate existing silence to stop notifications from a particular alert rule"})},[l,n]),r}var Fe=t(70383);const We=()=>{const{selectedAlertmanager:n}=(0,Fe.VI)();return n?e.createElement(e.Fragment,null,e.createElement(O.M,{currentAlertmanager:n}),e.createElement(E.dO,null,e.createElement(E.qh,{exact:!0,path:"/alerting/silences"},e.createElement(Ke,{alertManagerSourceName:n})),e.createElement(E.qh,{exact:!0,path:"/alerting/silence/new"},({location:l})=>{const r=new URLSearchParams(l.search),s=(0,y.Di)((0,y.LP)(r));return e.createElement(P.G,{formValues:s,alertManagerSourceName:n})}),e.createElement(E.qh,{exact:!0,path:"/alerting/silence/:id/edit"},({match:l})=>l?.params.id&&e.createElement(P.A,{silenceId:l.params.id,alertManagerSourceName:n})))):null};function $e(){const n=Ue();return e.createElement(I.y,{navId:"silences",pageNav:n,accessType:"instance"},e.createElement(We,null))}const Qe=(0,o.Xc)($e,{style:"page"})},64853:(W,D,t)=>{t.d(D,{_:()=>I});var e=t(2543),E=t.n(e),o=t(96540),y=t(19073);const I=({actions:u,children:h})=>{const f=(0,e.filter)(u,T),v=(0,e.filter)(u,S);return f.length?o.createElement(O,{actions:f},h):v.length?o.createElement(P,{actions:v},h):null},O=({actions:u,children:h})=>{const f=(0,y.iI)();return d(f,u)?o.createElement(o.Fragment,null,h):null},P=({actions:u,children:h})=>{const f=(0,y.e2)();return d(f,u)?o.createElement(o.Fragment,null,h):null};function d(u,h){return(0,e.chain)(u).pick(h).values().value().some(([f,v])=>v===!0)}function T(u){return Object.values(y.QI).includes(u)}function S(u){return Object.values(y.RY).includes(u)}},64047:(W,D,t)=>{t.d(D,{e:()=>o});var e=t(96540),E=t(55852);const o=({isCollapsed:y,onToggle:I,idControlled:O,className:P,text:d,size:T="xl",...S})=>e.createElement(E.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!y,"aria-controls":O,className:P,icon:y?"angle-right":"angle-down",onClick:()=>I(!y),...S},d)},57895:(W,D,t)=>{t.d(D,{M:()=>T});var e=t(32196),E=t(96540),o=t(40845),y=t(42418),I=t(60021),O=t(82843),P=t(19073),d=t(57220);function T({currentAlertmanager:u}){const h=(0,o.of)(S),f=u!==d.hY,[v,Q]=(0,P.Ej)(P.RY.ReadConfigurationStatus),z=v&&Q,{currentData:b}=O.m.endpoints.getGrafanaAlertingConfigurationStatus.useQuery(void 0,{skip:f||!z});if(!(b?.alertmanagersChoice&&[I.nA.External,I.nA.All].includes(b?.alertmanagersChoice))||f)return null;const K=b.numExternalAlertmanagers>0;return b.alertmanagersChoice===I.nA.External?E.createElement(y.F,{title:"Grafana alerts are not delivered to Grafana Alertmanager"},"Grafana is configured to send alerts to external Alertmanagers only. Changing Grafana Alertmanager configuration will not affect delivery of your alerts.",E.createElement("div",{className:h.adminHint},"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator.")):b.alertmanagersChoice===I.nA.All&&K?E.createElement(y.F,{title:"You have additional Alertmanagers to configure",severity:"warning"},"Ensure you make configuration changes in the correct Alertmanagers; both internal and external. Changing one will not affect the others.",E.createElement("div",{className:h.adminHint},"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator.")):null}const S=u=>({adminHint:(0,e.css)({fontSize:u.typography.bodySmall.fontSize,fontWeight:u.typography.bodySmall.fontWeight})})},4554:(W,D,t)=>{t.d(D,{L:()=>E});var e=t(32196);const E=o=>({table:(0,e.css)({width:"100%",borderRadius:o.shape.radius.default,border:`solid 1px ${o.colors.border.weak}`,backgroundColor:o.colors.background.secondary,th:{padding:o.spacing(1)},td:{padding:`0 ${o.spacing(1)}`},tr:{height:"38px"}}),evenRow:(0,e.css)({backgroundColor:o.colors.background.primary}),colExpand:(0,e.css)({width:"36px"}),nameCell:(0,e.css)({gap:o.spacing(1)}),actionsCell:(0,e.css)({textAlign:"right",width:"1%",whiteSpace:"nowrap","& > * + *":{marginLeft:o.spacing(.5)}})})}}]);

//# sourceMappingURL=AlertSilences.b546d631062903d141f0.js.map