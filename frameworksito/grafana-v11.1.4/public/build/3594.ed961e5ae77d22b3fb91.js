"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3594],{87965:(Y,I,t)=>{t.d(I,{E3:()=>i,vj:()=>o});const n=`{{ define "__subject" }}[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ if gt (.Alerts.Resolved | len) 0 }}, RESOLVED:{{ .Alerts.Resolved | len }}{{ end }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join " " }}{{ end }}){{ end }}{{ end }}

{{ define "__text_values_list" }}{{ if len .Values }}{{ $first := true }}{{ range $refID, $value := .Values -}}
{{ if $first }}{{ $first = false }}{{ else }}, {{ end }}{{ $refID }}={{ $value }}{{ end -}}
{{ else }}[no value]{{ end }}{{ end }}

{{ define "__text_alert_list" }}{{ range . }}
Value: {{ template "__text_values_list" . }}
Labels:
{{ range .Labels.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}Annotations:
{{ range .Annotations.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}{{ if gt (len .GeneratorURL) 0 }}Source: {{ .GeneratorURL }}
{{ end }}{{ if gt (len .SilenceURL) 0 }}Silence: {{ .SilenceURL }}
{{ end }}{{ if gt (len .DashboardURL) 0 }}Dashboard: {{ .DashboardURL }}
{{ end }}{{ if gt (len .PanelURL) 0 }}Panel: {{ .PanelURL }}
{{ end }}{{ end }}{{ end }}

{{ define "default.title" }}{{ template "__subject" . }}{{ end }}

{{ define "default.message" }}{{ if gt (len .Alerts.Firing) 0 }}**Firing**
{{ template "__text_alert_list" .Alerts.Firing }}{{ if gt (len .Alerts.Resolved) 0 }}

{{ end }}{{ end }}{{ if gt (len .Alerts.Resolved) 0 }}**Resolved**
{{ template "__text_alert_list" .Alerts.Resolved }}{{ end }}{{ end }}

{{ define "__teams_text_alert_list" }}{{ range . }}
Value: {{ template "__text_values_list" . }}
Labels:
{{ range .Labels.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}
Annotations:
{{ range .Annotations.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}
{{ if gt (len .GeneratorURL) 0 }}Source: [{{ .GeneratorURL }}]({{ .GeneratorURL }})

{{ end }}{{ if gt (len .SilenceURL) 0 }}Silence: [{{ .SilenceURL }}]({{ .SilenceURL }})

{{ end }}{{ if gt (len .DashboardURL) 0 }}Dashboard: [{{ .DashboardURL }}]({{ .DashboardURL }})

{{ end }}{{ if gt (len .PanelURL) 0 }}Panel: [{{ .PanelURL }}]({{ .PanelURL }})

{{ end }}
{{ end }}{{ end }}

{{ define "teams.default.message" }}{{ if gt (len .Alerts.Firing) 0 }}**Firing**
{{ template "__teams_text_alert_list" .Alerts.Firing }}{{ if gt (len .Alerts.Resolved) 0 }}

{{ end }}{{ end }}{{ if gt (len .Alerts.Resolved) 0 }}**Resolved**
{{ template "__teams_text_alert_list" .Alerts.Resolved }}{{ end }}{{ end }}`;var A=t(22153),B=t(49962);const d="/api/alertmanager/grafana/config/api/v1/templates/test",i=B.H.injectEndpoints({endpoints:m=>({previewTemplate:m.mutation({query:({template:c,alerts:D,name:R})=>({url:d,data:{template:c,alerts:D,name:R},method:"POST"})}),getDefaultTemplates:m.query({queryFn:async()=>({data:(0,A.D)(n)})})})}),{usePreviewTemplateMutation:o}=i},41965:(Y,I,t)=>{t.d(I,{D:()=>o});var n=t(32196),A=t(96540),B=t(40845),d=t(60029),i=t(67061);function o({label:c,actions:D}){const R=(0,B.of)(m);return A.createElement("div",{className:R.container},A.createElement(d.J,{className:R.label},c),A.createElement(i.B,{direction:"row",gap:1},D))}const m=c=>({container:(0,n.css)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:c.spacing(1,2),backgroundColor:c.colors.background.secondary,borderBottom:`1px solid ${c.colors.border.medium}`}),label:(0,n.css)({margin:0})})},33594:(Y,I,t)=>{t.d(I,{By:()=>ft,R_:()=>ye});var n=t(32196),A=t(13999);function B(a,r){return(0,A.f)(a,-r)}const d=null;var i=t(87836),o=t(2940);function m(a,r){return(0,i.A)(a,r*o.Cg)}const c=null;function D(a,r){return(0,i.A)(a,r*o.s0)}const R=null;function O(a,r){return D(a,-r)}const K=null;var e=t(96540),U=t(49785),ce=t(42941),X=t(70713),ae=t(17172),W=t(40845),E=t(21633),v=t(67061),x=t(55852),j=t(42418),k=t(84167),Z=t(14186),q=t(10354),de=t(90613),me=t(87978),ue=t(40715),le=t(13726),fe=t(31678),ge=t(75269),pe=t(61410),Pe=t(23770),Se=t(57220),Te=t(56361),Ne=t(88467),Ie=t(5586),be=t(48205),Ae=t(41965),Be=t(83122),_=t(38138),Me=t(60782),Ue=t(32372),De=t(91793),we=t(14578),We=t(56034),Fe=t(78369),se=t(37390),Ke=t(67647),xe=t(39558),je=t(82843),ee=t(75214),Ce=t(70026);function ze({onSelect:a,isOpen:r,onClose:h}){const l=(0,W.of)(Ve),[s,w]=(0,e.useState)(),[y,L]=(0,e.useState)(null),{useGetAlertmanagerAlertsQuery:z}=je.m,{currentData:P=[],isFetching:T,isError:V}=z({amSourceName:Se.hY,filter:{inhibited:!0,silenced:!0,active:!0}}),[F,$]=(0,e.useState)(""),M=(0,e.useMemo)(()=>{const f={};return!T&&P&&P.forEach(u=>{f[u.labels.alertname]||(f[u.labels.alertname]=[]),f[u.labels.alertname].push(u)}),f},[T,P]),N=(0,e.useCallback)(f=>{w(f),L(null)},[]),S=(0,e.useMemo)(()=>{const f=Object.keys(M).filter(C=>C.toLowerCase().includes(F.toLowerCase())),u={};return f.forEach(C=>{u[C]=M[C]}),u},[M,F]);if(V)return null;const p=Object.keys(S||[]),b=({index:f,style:u})=>{if(!S)return null;const C=p[f],g=C===s;return e.createElement("button",{type:"button",title:C,style:u,className:(0,n.cx)(l.rowButton,{[l.rowOdd]:f%2===1,[l.rowSelected]:g}),onClick:()=>N(C)},e.createElement("div",{className:(0,n.cx)(l.ruleTitle,l.rowButtonTitle)},C),e.createElement("div",{className:l.alertFolder},e.createElement(e.Fragment,null,e.createElement(we.I,{name:"folder"})," ",S[C][0].labels.grafana_folder??"")))},J=(f,u)=>{const g=f.map(Q=>Q.labels).map(ee.Dd),H=(0,Ce.Q)(g),G=(0,Ce.$)((0,ee.Dd)(u.labels),H);return G.length?(0,ee.M4)((0,ee.zm)(G)):(0,ee.M4)(u.labels)},te=({index:f,style:u})=>{const C=(0,e.useMemo)(()=>s?M[s]:[],[]),g=C[f],H=y?.includes(g),G=(0,e.useMemo)(()=>J(C,g),[C,g]),ie=()=>{if(H&&y){L(y.filter(Q=>Q!==g));return}L([...y||[],g])};return e.createElement("button",{type:"button",style:u,className:(0,n.cx)(l.rowButton,l.instanceButton,{[l.rowOdd]:f%2===1,[l.rowSelected]:H}),onClick:ie},e.createElement("div",{className:l.rowButtonTitle,title:g.labels.alertname},e.createElement(We.m,{placement:"bottom",content:e.createElement("pre",null,JSON.stringify(g,null,2)),theme:"info"},e.createElement("div",null,G.map((Q,he)=>e.createElement(Fe.v,{key:he,name:Q,className:l.tag}))))))},ve=()=>{const f=y?.map(u=>({status:"firing",annotations:u.annotations,labels:u.labels,startsAt:u.startsAt,endsAt:u.endsAt,generatorURL:u.generatorURL,fingerprint:u.fingerprint}))||[];a(f),ne()},ne=()=>{w(void 0),L(null),$(""),re("")},oe=()=>{ne(),h()},re=f=>{$(f)};return e.createElement("div",null,e.createElement(se.a,{title:"Select alert instances",className:l.modal,closeOnEscape:!0,isOpen:r,onDismiss:oe,contentClassName:l.modalContent},e.createElement("div",{className:l.container},e.createElement(Ke.Z,{value:F,onChange:re,title:"Search alert rule",placeholder:"Search alert rule",autoFocus:!0}),e.createElement("div",null,s&&"Select one or more instances from the list below"||""),e.createElement("div",{className:l.column},T&&e.createElement(xe._,{text:"Loading rules...",className:l.loadingPlaceholder}),!T&&e.createElement(X.Ay,null,({height:f,width:u})=>e.createElement(De.Y1,{itemSize:50,height:f,width:u,itemCount:p.length},b))),e.createElement("div",{className:l.column},!s&&!T&&e.createElement("div",{className:l.selectedRulePlaceholder},e.createElement("div",null,"Select an alert rule to get a list of available firing instances")),T&&e.createElement(xe._,{text:"Loading rule...",className:l.loadingPlaceholder}),s&&M[s].length&&!T&&e.createElement(X.Ay,null,({width:f,height:u})=>e.createElement(De.Y1,{itemSize:32,height:u,width:f,itemCount:M[s].length||0},te)))),e.createElement(se.a.ButtonRow,null,e.createElement(x.$n,{type:"button",variant:"secondary",onClick:oe},"Cancel"),e.createElement(x.$n,{type:"button",variant:"primary",disabled:!(s&&y),onClick:()=>{s&&y&&ve()}},"Add alert data to payload"))))}const Ve=a=>{const r=(0,x.my)(a);return{container:(0,n.css)({display:"grid",gridTemplateColumns:"1fr 1.5fr",gridTemplateRows:"min-content auto",gap:a.spacing(2),flex:1}),tag:(0,n.css)({margin:"5px"}),column:(0,n.css)({flex:"1 1 auto"}),alertLabels:(0,n.css)({overflowX:"auto",height:"32px"}),ruleTitle:(0,n.css)({height:"22px",fontWeight:a.typography.fontWeightBold}),rowButton:(0,n.css)(r,{padding:a.spacing(.5),overflow:"hidden",textOverflow:"ellipsis",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer",border:"2px solid transparent","&:disabled":{cursor:"not-allowed",color:a.colors.text.disabled}}),rowButtonTitle:(0,n.css)({overflowX:"auto"}),rowSelected:(0,n.css)({borderColor:a.colors.primary.border}),rowOdd:(0,n.css)({backgroundColor:a.colors.background.secondary}),instanceButton:(0,n.css)({display:"flex",gap:a.spacing(1),justifyContent:"space-between",alignItems:"center"}),loadingPlaceholder:(0,n.css)({height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),selectedRulePlaceholder:(0,n.css)({width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",fontWeight:a.typography.fontWeightBold}),modal:(0,n.css)({height:"100%"}),modalContent:(0,n.css)({flex:1,display:"flex",flexDirection:"column"}),modalAlert:(0,n.css)({flexGrow:0}),warnIcon:(0,n.css)({fill:a.colors.warning.main}),labels:(0,n.css)({justifyContent:"flex-start"}),alertFolder:(0,n.css)({height:"20px",fontSize:a.typography.bodySmall.fontSize,color:a.colors.text.secondary,display:"flex",flexDirection:"row",justifyContent:"flex-start",columnGap:a.spacing(1),alignItems:"center"})}},Ge=[{name:"Receiver",type:"string",notes:"Name of the contact point that the notification is being sent to."},{name:"Status",type:"string",notes:"firing if at least one alert is firing, otherwise resolved"},{name:"Alerts",type:"[]Alert",notes:"List of alert objects that are included in this notification."},{name:"Alerts.Firing",type:"[]Alert",notes:"List of firing alerts"},{name:"Alerts.Resolved",type:"[]Alert",notes:"List of resolved alerts"},{name:"GroupLabels",type:"KeyValue",notes:"Labels these alerts were grouped by."},{name:"CommonLabels",type:"KeyValue",notes:"Labels common to all the alerts included in this notification."},{name:"CommonAnnotations",type:"KeyValue",notes:"Annotations common to all the alerts included in this notification."},{name:"ExternalURL",type:"string",notes:"Back link to the Grafana that sent the notification."}],$e=[{name:"labels",type:"Object{}",notes:"Set of labels attached to the alert."},{name:"annotations",type:"Object{}",notes:"Set of annotations attached to the alert."},{name:"startsAt",type:"string (ISO8601)",notes:"Time the alert started firing."},{name:"endsAt",type:"string (ISO8601)",notes:"Time the alert ends firing."}],Je=[{name:"Status",type:"string",notes:"firing or resolved."},{name:"Labels",type:"KeyValue",notes:"Set of labels attached to the alert."},{name:"Annotations",type:"KeyValue",notes:"Set of annotations attached to the alert."},{name:"Values",type:"KeyValue",notes:"The values of all instant queries, reduce and math expressions, and classic conditions for the alert. It does not contain time series data."},{name:"StartsAt",type:"time.Time",notes:"Time the alert started firing."},{name:"EndsAt",type:"time.Time",notes:"Only set if the end time of an alert is known. Otherwise set to a configurable timeout period from the time since the last alert was received."},{name:"GeneratorURL",type:"string",notes:"A back link to Grafana or external Alertmanager."},{name:"SilenceURL",type:"string",notes:"Link to Grafana silence for with labels for this alert pre-filled. Only for Grafana managed alerts."},{name:"DashboardURL",type:"string",notes:"Link to Grafana dashboard, if alert rule belongs to one. Only for Grafana managed alerts."},{name:"PanelURL",type:"string",notes:"Link to Grafana dashboard panel, if alert rule belongs to one. Only for Grafana managed alerts."},{name:"Fingerprint",type:"string",notes:"Fingerprint that can be used to identify the alert."},{name:"ValueString",type:"string",notes:"String that contains the labels and value of each reduced expression in the alert."}],He=[{name:"SortedPairs",returns:"KeyValue",notes:"Returns sorted list of key & value string pairs"},{name:"Remove",args:"[]string",returns:"KeyValue",notes:"Returns a copy of the Key/Value map without the given keys."},{name:"Names",returns:"[]string",notes:"List of label names"},{name:"Values",returns:"[]string",notes:"List of label values"}],Ye=`{
  "summary": "alert summary",
  "description": "alert description"
}
`;var Re=t(35108);function Ze(){const a=(0,W.of)(Qe),r=e.createElement(Ee,{caption:e.createElement("h4",{className:a.header},"Alert template data ",e.createElement("span",null,"Available only when in the context of an Alert (e.g. inside .Alerts loop)")),dataItems:Je});return e.createElement(v.B,{gap:2},e.createElement(Ee,{caption:e.createElement("h4",{className:a.header},"Template Data"),dataItems:Ge,typeRenderer:h=>h==="[]Alert"?e.createElement(Re.j,{content:r},e.createElement("div",{className:a.interactiveType},h)):h==="KeyValue"?e.createElement(Re.j,{content:e.createElement(Xe,null)},e.createElement("div",{className:a.interactiveType},h)):h}))}const Qe=a=>({header:(0,n.css)({color:a.colors.text.primary,span:{color:a.colors.text.secondary,fontSize:a.typography.bodySmall.fontSize}}),interactiveType:(0,n.css)({color:a.colors.text.link})});function Ee({dataItems:a,caption:r,typeRenderer:h}){const l=(0,W.of)(Oe);return e.createElement("table",{className:l.table},r&&e.createElement("caption",null,r),e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Name"),e.createElement("th",null,"Type"),e.createElement("th",null,"Notes"))),e.createElement("tbody",null,a.map(({name:s,type:w,notes:y},L)=>e.createElement("tr",{key:L},e.createElement("td",null,s),e.createElement("td",null,h?h(w):w),e.createElement("td",null,y)))))}function Xe(){const a=(0,W.of)(Oe);return e.createElement("div",null,"KeyValue is a set of key/value string pairs that represent labels and annotations.",e.createElement("pre",null,e.createElement("code",null,Ye)),e.createElement("table",{className:a.table},e.createElement("caption",null,"Key-value methods"),e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Name"),e.createElement("th",null,"Arguments"),e.createElement("th",null,"Returns"),e.createElement("th",null,"Notes"))),e.createElement("tbody",null,He.map(({name:r,args:h,returns:l,notes:s})=>e.createElement("tr",{key:r},e.createElement("td",null,r),e.createElement("td",null,h),e.createElement("td",null,l),e.createElement("td",null,s))))))}const Oe=a=>({table:(0,n.css)({borderCollapse:"collapse",width:"100%",caption:{captionSide:"top"},"td, th":{padding:a.spacing(1,1)},thead:{fontWeight:a.typography.fontWeightBold},"tbody tr:nth-child(2n + 1)":{backgroundColor:a.colors.background.secondary},"tbody td:nth-child(1)":{fontWeight:a.typography.fontWeightBold},"tbody td:nth-child(2)":{fontStyle:"italic"}})});var ke=t(2543),qe=t(10860),_e=t(94354),et=t(31099),tt=t(97171);const nt={annotations:[{key:"",value:""}],labels:[{key:"",value:""}],status:"firing"},at=({isOpen:a,onDismiss:r,onAccept:h})=>{const l=(0,W.of)(lt),[s,w]=(0,e.useState)([]),y=(0,U.mN)({defaultValues:nt,mode:"onBlur"}),L=y.watch("annotations"),z=y.watch("labels"),[P,T]=(0,e.useState)("firing"),V=()=>{const N={annotations:L.filter(({key:S,value:p})=>!!S&&!!p).reduce((S,{key:p,value:b})=>({...S,[p]:b}),{}),labels:z.filter(({key:S,value:p})=>!!S&&!!p).reduce((S,{key:p,value:b})=>({...S,[p]:b}),{}),startsAt:"2023-04-01T00:00:00Z",endsAt:P==="firing"?(0,A.f)(new Date,1).toISOString():B(new Date,1).toISOString(),status:P,fingerprint:(0,ke.uniqueId)("fingerprint_")};w(S=>[...S,N]),y.reset()},F=()=>{h(s),w([]),y.reset(),T("firing")},$=()=>{const N=z.some(p=>p.key!==""&&p.value!==""),S=L.some(p=>p.key!==""&&p.value!=="");return N||S},M=[{label:"Firing",value:"firing"},{label:"Resolved",value:"resolved"}];return e.createElement(se.a,{onDismiss:r,isOpen:a,title:"Add custom alerts"},e.createElement(U.Op,{...y},e.createElement("form",{onSubmit:N=>{N.preventDefault(),N.stopPropagation(),y.reset(),T("firing")}},e.createElement(e.Fragment,null,e.createElement(qe.Z,null,e.createElement(v.B,{direction:"column",gap:1},e.createElement("div",{className:l.section},e.createElement(et.A,null)),e.createElement("div",{className:l.section},e.createElement(tt.Ay,null)),e.createElement("div",{className:l.flexWrapper},e.createElement(_e.z,{value:P,options:M,onChange:N=>T(N)}),e.createElement(x.$n,{onClick:V,className:l.onAddButton,icon:"plus-circle",type:"button",variant:"secondary",disabled:!$()},"Add alert data"))))),e.createElement("div",{className:l.onSubmitWrapper}),s.length>0&&e.createElement(v.B,{direction:"column",gap:1},e.createElement("h5",null," Review alert data to add to the payload:"),e.createElement("pre",{className:l.result,"data-testid":"payloadJSON"},JSON.stringify(s,null,2))),e.createElement("div",{className:l.onSubmitWrapper},e.createElement(se.a.ButtonRow,null,e.createElement(x.$n,{onClick:F,disabled:s.length===0,className:l.onSubmitButton},"Add alert data to payload"))))))},lt=a=>({section:(0,n.css)({marginBottom:a.spacing(2)}),onAddButton:(0,n.css)({flex:"none",width:"fit-content",paddingRight:a.spacing(1),marginLeft:"auto"}),flexWrapper:(0,n.css)({display:"flex",flexDirection:"row",justifyContent:"space-between"}),onSubmitWrapper:(0,n.css)({display:"flex",flexDirection:"row",alignItems:"baseline",justifyContent:"flex-end"}),onSubmitButton:(0,n.css)({marginLeft:a.spacing(2)}),result:(0,n.css)({width:"570px",height:"363px"})}),st="Reset to defaults";function ot({payload:a,setPayload:r,defaultPayload:h,setPayloadFormatError:l,payloadFormatError:s,className:w}){const y=(0,W.of)(it),L=()=>{r(h)},[z,P]=(0,e.useState)(!1),T=()=>{P(!1)},V=s!==null,F=()=>{try{const b=JSON.parse(a);JSON.stringify([...b]),l(null)}catch(b){throw l(b instanceof Error?b.message:"Invalid JSON."),b}},$=()=>{try{F(),P(!0)}catch{}},M=()=>{try{F(),p(!0)}catch{}},N=b=>{T(),p(!1),r(J=>{const te=JSON.parse(J);return JSON.stringify([...te,...b],void 0,2)})},[S,p]=(0,e.useState)(!1);return e.createElement(e.Fragment,null,e.createElement("div",{className:(0,n.cx)(y.wrapper,w)},e.createElement(Ae.D,{label:"Payload",actions:e.createElement(v.B,{direction:"row",alignItems:"center",gap:.5},e.createElement(Be.m,{overlay:e.createElement(_.W,null,e.createElement(_.W.Item,{label:"Use existing alert instances",disabled:V,onClick:M}),e.createElement(_.W.Item,{label:"Add custom alert instance",disabled:V,onClick:$}),e.createElement(_.W.Divider,null),e.createElement(_.W.Item,{label:st,onClick:L,destructive:!0}))},e.createElement(x.$n,{variant:"secondary",size:"sm",icon:"angle-down"},"Edit payload")),e.createElement(Me.G,{content:e.createElement(rt,null),placement:"top",fitContent:!0},e.createElement(x.$n,{variant:"secondary",fill:"outline",size:"sm",icon:"question-circle"},"Help")))}),e.createElement("div",{className:y.editorWrapper},e.createElement(X.Ay,null,({width:b,height:J})=>e.createElement(Ue.B,{containerStyles:y.editorContainer,width:b,height:J,language:"json",showLineNumbers:!0,showMiniMap:!1,value:a,readOnly:!1,onBlur:r,monacoOptions:{scrollBeyondLastLine:!1}})))),e.createElement(at,{isOpen:z,onDismiss:T,onAccept:N}),e.createElement(ze,{onSelect:N,isOpen:S,onClose:()=>p(!1)}))}const rt=()=>e.createElement(Ee,{dataItems:$e}),it=a=>({wrapper:(0,n.css)({display:"flex",flexDirection:"column",height:"100%"}),tooltip:(0,n.css)({paddingLeft:a.spacing(1)}),label:(0,n.css)({margin:0}),editorWrapper:(0,n.css)({flex:1}),editorContainer:(0,n.css)({width:"fit-content",border:"none"}),templateDataDocsHeader:(0,n.css)({color:a.colors.text.primary,span:{color:a.colors.text.secondary,fontSize:a.typography.bodySmall.fontSize}})});var ct=t(96615),dt=t(78253),mt=t(57954);const ut=Object.freeze({name:"",content:""}),yt=a=>a.pathname.endsWith("/duplicate"),ft=({existing:a,alertManagerSourceName:r,config:h,provenance:l})=>{const s=(0,W.of)(Le),w=(0,fe.useDispatch)();(0,ue.o)(g=>g.unifiedAlerting.saveAMConfig=Ne.jA);const y=(0,e.useRef)(null),L=r===Se.hY,{loading:z,error:P}=(0,pe.$)(g=>g.saveAMConfig),[T,V]=(0,ce.A)(!1),[F,$]=(0,e.useState)(ye),[M,N]=(0,e.useState)(null),S=(0,E.h)({direction:"column",initialSize:L?.5:1,dragPosition:"middle"}),p=(0,E.h)({direction:"row",initialSize:L?.6:1,dragPosition:"middle"}),b=g=>{const H=(0,Ie.o)(g.name,g.content),G={...h.template_files,[g.name]:H};a&&a.name!==g.name&&delete G[a.name];const ie=[...(h.alertmanager_config.templates??[]).filter(he=>he!==a?.name),g.name],Q={template_files:G,alertmanager_config:{...h.alertmanager_config,templates:ie}};w((0,Pe.RW)({alertManagerSourceName:r,newConfig:Q,oldConfig:h,successMessage:"Template saved.",redirectPath:"/alerting/notifications",redirectSearch:`tab=${le.ActiveTab.NotificationTemplates}`}))},J=(0,U.mN)({mode:"onSubmit",defaultValues:a??ut}),{handleSubmit:te,register:ve,formState:{errors:ne},getValues:oe,setValue:re,watch:f}=J,u=g=>!h.template_files[g]||a?.name===g?!0:"Another template with this name already exists.",C=e.createElement(v.B,null,e.createElement(x.$n,{onClick:()=>y.current?.requestSubmit(),variant:"primary",size:"sm",disabled:z},"Save"),e.createElement(x.z9,{disabled:z,href:(0,Te.nL)("alerting/notifications",r,{tab:le.ActiveTab.NotificationTemplates}),variant:"secondary",size:"sm"},"Cancel"));return e.createElement(e.Fragment,null,e.createElement(U.Op,{...J},e.createElement(ge.H,{actions:C}),e.createElement("form",{onSubmit:te(b),ref:y,className:s.form},P&&e.createElement(j.F,{severity:"error",title:"Error saving template"},P.message||(0,ae.NF)(P)&&P.data?.message||String(P)),l&&e.createElement(be.Yi,{resource:be.hk.Template}),e.createElement(k.n,{disabled:!!l,className:s.fieldset},e.createElement(Z.I,{label:"Template name",error:ne?.name?.message,invalid:!!ne.name?.message,required:!0,className:s.nameField},e.createElement(q.p,{...ve("name",{required:{value:!0,message:"Required."},validate:{nameIsUnique:u}}),placeholder:"Give your template a name",width:42,autoFocus:!0,id:"new-template-name"})),e.createElement("div",{...p.containerProps,className:s.contentContainer},e.createElement("div",{...p.primaryProps},e.createElement("div",{...S.containerProps,className:s.contentField},e.createElement("div",{...S.primaryProps},e.createElement("div",{className:(0,n.cx)(s.flexColumn,s.containerWithBorderAndRadius,s.minEditorSize)},e.createElement(Ae.D,{label:"Template",actions:e.createElement(x.$n,{icon:"question-circle",size:"sm",fill:"outline",variant:"secondary",onClick:V},"Help")}),e.createElement(de.a,{flex:1},e.createElement(X.Ay,null,({width:g,height:H})=>e.createElement(ct.K,{value:oe("content"),onBlur:G=>re("content",G),containerStyles:s.editorContainer,width:g,height:H}))))),L&&e.createElement(e.Fragment,null,e.createElement("div",{...S.splitterProps}),e.createElement("div",{...S.secondaryProps},e.createElement("div",{className:(0,n.cx)(s.containerWithBorderAndRadius,s.minEditorSize,s.payloadEditor,s.flexFull)},e.createElement(ot,{payload:F,defaultPayload:ye,setPayload:$,setPayloadFormatError:N,payloadFormatError:M})))))),L&&e.createElement(e.Fragment,null,e.createElement("div",{...p.secondaryProps},e.createElement("div",{...p.splitterProps}),e.createElement(dt.p,{payload:F,templateName:f("name"),setPayloadFormatError:N,payloadFormatError:M,className:(0,n.cx)(s.templatePreview,s.minEditorSize)}))))))),T&&e.createElement(me._,{title:"Templating cheat sheet",onClose:V,size:"lg"},e.createElement(pt,null)))};function gt(){const a=(0,W.of)(Le);return e.createElement(j.F,{title:"How to",severity:"info"},e.createElement(v.B,{direction:"row"},e.createElement("div",null,"Grafana uses Go templating language to create notification messages.",e.createElement("br",null),"To find out more about templating please visit our documentation."),e.createElement("div",null,e.createElement(x.z9,{href:"https://grafana.com/docs/grafana/latest/alerting/manage-notifications/template-notifications/",target:"_blank",icon:"external-link-alt",variant:"secondary"},"Templating documentation"))),e.createElement("div",{className:a.snippets},"For auto-completion of common templating code, type the following keywords in the content editor:",e.createElement("div",{className:a.code},Object.values(mt.L).map(r=>r.label).join(", "))))}function pt(){return e.createElement(v.B,{direction:"column",gap:1},e.createElement(gt,null),e.createElement(Ze,null))}const Le=a=>{const r=a.breakpoints.down("md");return{flexFull:(0,n.css)({flex:1}),minEditorSize:(0,n.css)({minHeight:300,minWidth:300}),payloadEditor:(0,n.css)({minHeight:0}),containerWithBorderAndRadius:(0,n.css)({borderRadius:a.shape.radius.default,border:`1px solid ${a.colors.border.medium}`}),flexColumn:(0,n.css)({display:"flex",flex:1,flexDirection:"column"}),form:(0,n.css)({label:"template-form",height:"100%",display:"flex",flexDirection:"column"}),fieldset:(0,n.css)({label:"template-fieldset",flex:1,display:"flex",flexDirection:"column"}),label:(0,n.css)({margin:0}),nameField:(0,n.css)({marginBottom:a.spacing(1)}),contentContainer:(0,n.css)({flex:1,display:"flex",flexDirection:"row"}),contentField:(0,n.css)({display:"flex",flexDirection:"column",flex:1,marginBottom:0}),templatePreview:(0,n.css)({flex:1,display:"flex"}),templatePayload:(0,n.css)({flex:1}),editorContainer:(0,n.css)({width:"fit-content",border:"none"}),payloadCollapseButton:(0,n.css)({backgroundColor:a.colors.info.transparent,margin:0,[r]:{display:"none"}}),snippets:(0,n.css)({marginTop:a.spacing(2),fontSize:a.typography.bodySmall.fontSize}),code:(0,n.css)({color:a.colors.text.secondary,fontWeight:a.typography.fontWeightBold})}},Et=[{status:"firing",annotations:{summary:"Instance instance1 has been down for more than 5 minutes"},labels:{alertname:"InstanceDown",instance:"instance1"},startsAt:B(new Date,1).toISOString(),endsAt:m(new Date,5).toISOString(),fingerprint:"a5331f0d5a9d81d4",generatorURL:"http://grafana.com/alerting/grafana/cdeqmlhvflz40f/view"},{status:"resolved",annotations:{summary:"CPU usage above 90%"},labels:{alertname:"CpuUsage",instance:"instance1"},startsAt:O(new Date,4).toISOString(),endsAt:new Date().toISOString(),fingerprint:"b77d941310f9d381",generatorURL:"http://grafana.com/alerting/grafana/oZSMdGj7z/view"}],ye=JSON.stringify(Et,null,2)},78253:(Y,I,t)=>{t.d(I,{P:()=>W,p:()=>U});var n=t(32196),A=t(2543),B=t.n(A),d=t(96540),i=t(49785),o=t(70713),m=t(40845),c=t(55852),D=t(90613),R=t(42418),O=t(56361),K=t(41965),e=t(10506);function U({payload:E,templateName:v,payloadFormatError:x,setPayloadFormatError:j,className:k}){const Z=(0,m.of)(ae),{watch:q}=(0,i.xW)(),de=q("content"),{data:me,isLoading:ue,onPreview:le,error:fe}=(0,e.g)(de,v,E,j),ge=W(fe,x,me);return d.createElement("div",{className:(0,n.cx)(Z.container,k)},d.createElement(K.D,{label:"Preview",actions:d.createElement(c.$n,{disabled:ue,icon:"sync","aria-label":"Refresh preview",onClick:le,size:"sm",variant:"secondary"},"Refresh")}),d.createElement(D.a,{flex:1},d.createElement(o.Ay,{disableWidth:!0},({height:pe})=>d.createElement("div",{className:Z.viewerContainer({height:pe})},ge))))}function ce({previews:E}){const v=(0,m.of)(ae),x=E.length===1;return d.createElement("ul",{className:v.viewer.container},E.map(j=>d.createElement("li",{className:v.viewer.box,key:j.name},x?null:d.createElement("header",{className:v.viewer.header},j.name),d.createElement("pre",{className:v.viewer.pre},j.text??"<Empty>"))))}function X({errors:E}){return E.map(v=>d.createElement(R.F,{key:(0,A.uniqueId)("errors-list"),title:(0,A.compact)([v.name,v.kind]).join(" \u2013 ")},v.message))}const ae=E=>({container:(0,n.css)({label:"template-preview-container",display:"flex",flexDirection:"column",borderRadius:E.shape.radius.default,border:`1px solid ${E.colors.border.medium}`}),viewerContainer:({height:v})=>(0,n.css)({height:v,overflow:"auto",backgroundColor:E.colors.background.primary}),viewer:{container:(0,n.css)({display:"flex",flexDirection:"column",height:"inherit"}),box:(0,n.css)({display:"flex",flexDirection:"column",borderBottom:`1px solid ${E.colors.border.medium}`,height:"inherit"}),header:(0,n.css)({fontSize:E.typography.bodySmall.fontSize,padding:E.spacing(1,2),borderBottom:`1px solid ${E.colors.border.medium}`,backgroundColor:E.colors.background.secondary}),errorText:(0,n.css)({color:E.colors.error.text}),pre:(0,n.css)({backgroundColor:"transparent",margin:0,border:"none",padding:E.spacing(2)})}});function W(E,v,x){const j=E?(0,O.JZ)(E):void 0,k=v||j,Z=x?.results??[],q=x?.errors;return d.createElement(d.Fragment,null,k&&d.createElement(R.F,{severity:"error",title:"Error"},k),q&&d.createElement(X,{errors:q}),Z&&d.createElement(ce,{previews:Z}))}},22153:(Y,I,t)=>{t.d(I,{D:()=>n,G7:()=>d,Jl:()=>A,gY:()=>B});function n(i){const o={},m=[],c=/{{(-?\s*)(define|end|if|range|else|with|template)(\s*.*?)?(-?\s*)}}/gs;let D,R=0;for(;(D=c.exec(i))!==null;){const[,,O,K]=D;if(R=D.index,O==="define"){const e=K?.match(/"([^"]+)"/);e&&m.push({type:"define",startIndex:R,name:e[1]})}else if(O==="end"){let e=m.pop();for(;e&&e.type!=="define"&&e.type!=="if"&&e.type!=="range"&&e.type!=="with";)e=m.pop();if(e){const U=c.lastIndex;e.type==="define"&&!e.name?.startsWith("__")&&(o[e.name]={name:e.name,content:i.slice(e.startIndex,U)})}}else(O==="if"||O==="range"||O==="else"||O==="with")&&m.push({type:O,startIndex:R})}for(const O of Object.values(o)){const K=/{{ template "([^"]+)" }}/g;let e;for(;(e=K.exec(O.content))!==null;){const U=e[1];o[U]?.content&&(O.content+=`
`+o[U]?.content,delete o[U])}}return Object.values(o)}function A(i){return`{{ template "${i}" . }}`}function B(i){const o=i.match(/\{\{\s*template\s*"(.*)"\s*\.\s*\}\}/);return o?o[1]:""}function d(i){const o=/\{\{\s*template\s*".*?"\s*\.\s*\}\}/g;if(i.match(o)?.length!==1)return!1;const c=i.split(o);for(const D of c)if(D.trim()!=="")return!1;return!0}},10506:(Y,I,t)=>{t.d(I,{g:()=>B});var n=t(96540),A=t(87965);function B(d,i,o,m){const[c,{data:D,error:R,isLoading:O}]=(0,A.vj)(),K=(0,n.useCallback)(()=>{try{const e=JSON.parse(o);JSON.stringify([...e]),c({template:d,alerts:e,name:i}),m(null)}catch(e){m(e instanceof Error?e.message:"Invalid JSON.")}},[d,i,o,m,c]);return(0,n.useEffect)(()=>K(),[K]),{data:D,error:R,isLoading:O,onPreview:K}}},70026:(Y,I,t)=>{t.d(I,{$:()=>B,Q:()=>d});var n=t(2543),A=t.n(n);function B(i,o){return i.filter(m=>!o.find(c=>JSON.stringify(c)===JSON.stringify(m)))}function d(i){const o=i.flatMap(c=>c);return(0,n.uniqBy)(o.filter(c=>o.filter(R=>(0,n.isEqual)(c,R)).length===Object.keys(i).length),c=>JSON.stringify(c))}},5586:(Y,I,t)=>{t.d(I,{a:()=>d,o:()=>B});var n=t(2543),A=t.n(n);function B(i,o){let m=o.trim();if(!m.match(/\{\{\s*define/)){const c=m.split(`
`).map(D=>"  "+D).join(`
`);m=`{{ define "${i}" }}
${c}
{{ end }}`}return m}function d(i){const o=(m,c)=>`{{ define "${c}_NEW_${(0,n.now)()}" }}`;return i.replace(/\{\{\s*define\s*\"(?<defineName>.*)\"\s*\}\}/g,o)}}}]);

//# sourceMappingURL=3594.ed961e5ae77d22b3fb91.js.map