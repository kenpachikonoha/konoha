"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4176],{63606:(W,_,t)=>{t.r(_),t.d(_,{ServiceAccountCreatePage:()=>A,default:()=>S});var n=t(96540),d=t(17172),O=t(12131),D=t(84167),u=t(88575),R=t(10354),C=t(55852),p=t(72235),v=t(67608),I=t(89062),P=t(85927),a=t(10096),s=t(31678),M=t(5133);const U=async c=>{const l=await(0,d.AI)().post("/api/serviceaccounts/",c);return await a.contextSrv.fetchUserPermissions(),l},f=async(c,l)=>(0,d.AI)().patch(`/api/serviceaccounts/${c}`,l),A=({})=>{const[c,l]=(0,n.useState)([]),[E,L]=(0,n.useState)([]),m=a.contextSrv.user.orgId,[r,h]=(0,n.useState)({id:0,orgId:a.contextSrv.user.orgId,role:a.contextSrv.licensedAccessControlEnabled()?s.OrgRole.None:s.OrgRole.Viewer,tokens:0,name:"",login:"",isDisabled:!1,createdAt:"",teams:[]});(0,n.useEffect)(()=>{async function o(){try{if(a.contextSrv.hasPermission(s.AccessControlAction.ActionRolesList)){let e=await(0,P.RL)(m);l(e)}}catch(e){console.error("Error loading options",e)}}a.contextSrv.licensedAccessControlEnabled()&&o()},[m]);const B=(0,n.useCallback)(async o=>{o.role=r.role;const e=await U(o);try{const i={avatarUrl:e.avatarUrl,id:e.id,isDisabled:e.isDisabled,login:e.login,name:e.name,orgId:e.orgId,role:e.role,tokens:e.tokens};await f(e.id,o),a.contextSrv.licensedAccessControlEnabled()&&a.contextSrv.hasPermission(s.AccessControlAction.ActionUserRolesAdd)&&a.contextSrv.hasPermission(s.AccessControlAction.ActionUserRolesRemove)&&await(0,P.eA)(E,i.id,i.orgId)}catch(i){console.error(i)}O.Ny.push(`/org/serviceaccounts/${e.id}`)},[r.role,E]),g=o=>{h({...r,role:o})},T=(o,e,i)=>{L(o)};return n.createElement(v.Y,{navId:"serviceaccounts",pageNav:{text:"Create service account"}},n.createElement(v.Y.Contents,null,n.createElement(p.l,{onSubmit:B,validateOn:"onSubmit"},({register:o,errors:e})=>n.createElement(n.Fragment,null,n.createElement(D.n,null,n.createElement(u.D,{label:"Display name",required:!0,invalid:!!e.name,error:e.name?"Display name is required":void 0},n.createElement(R.p,{id:"display-name-input",...o("name",{required:!0}),autoFocus:!0})),n.createElement(u.D,{label:"Role"},a.contextSrv.licensedAccessControlEnabled()?n.createElement(I.y,{apply:!0,userId:r.id||0,orgId:r.orgId,basicRole:r.role,onBasicRoleChange:g,roleOptions:c,onApplyRoles:T,pendingRoles:E,maxWidth:"100%"}):n.createElement(M.r,{"aria-label":"Role",value:r.role,onChange:g}))),n.createElement(C.$n,{type:"submit"},"Create")))))},S=A}}]);

//# sourceMappingURL=ServiceAccountCreatePage.f5b7dc59263c37b22fe2.js.map