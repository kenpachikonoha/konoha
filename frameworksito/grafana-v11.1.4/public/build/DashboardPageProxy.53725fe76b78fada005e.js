"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9136],{63392:(Ct,Q,o)=>{o.r(Q),o.d(Q,{default:()=>gr});var t=o(96540),W=o(16817),D=o(32264),O=o(64388),z=o(67608),ne=o(39419),K=o(33390),U=o(20470),y=o(31678),m=o(32196),f=o(24180),g=o(12131),w=o(71678),b=o(40845),x=o(37390),h=o(55852),B=o(16233);const ye=t.memo(({dashboard:e})=>{const a=(0,t.useMemo)(()=>g.Ny.getLocation().pathname,[e]),{showModal:n,hideModal:r}=(0,t.useContext)(w.wE);(0,t.useEffect)(()=>{const i=d=>{Pe(e,e.getInitialSaveModel())||e.state.isDirty&&(d.preventDefault(),d.returnValue="")};return window.addEventListener("beforeunload",i),()=>window.removeEventListener("beforeunload",i)},[e]);const s=i=>a===i.pathname||Pe(e,e.getInitialSaveModel())||!e.state.isDirty?!0:(n(Tt,{dashboard:e,onSaveDashboardClick:()=>{r(),e.openSaveDrawer({onSaveSuccess:()=>{be(i)}})},onDiscard:()=>{e.exitEditMode({skipConfirm:!0}),r(),be(i)},onDismiss:r}),!1);return t.createElement(f.XG,{when:!0,message:s})});ye.displayName="DashboardPrompt";function be(e){e&&setTimeout(()=>g.Ny.push(e),10)}const Tt=({onDiscard:e,onDismiss:a,onSaveDashboardClick:n})=>{const r=(0,b.of)(Dt);return t.createElement(x.a,{isOpen:!0,title:"Unsaved changes",onDismiss:a,icon:"exclamation-triangle",className:r.modal},t.createElement("h5",null,"Do you want to save your changes?"),t.createElement(x.a.ButtonRow,null,t.createElement(h.$n,{variant:"secondary",onClick:a,fill:"outline"},"Cancel"),t.createElement(h.$n,{variant:"destructive",onClick:e},"Discard"),t.createElement(h.$n,{onClick:n},"Save dashboard")))},Dt=()=>({modal:(0,m.css)({width:"500px"})});function Pe(e,a){if(!a||a.version===0||!B.TP.isSignedIn||!e)return!0;const{canSave:n,fromScript:r,fromFile:s}=e.state.meta;return!B.TP.isEditor&&!n?!0:!n||r||s}var Se=o(72255);function Nt({match:e,route:a,queryParams:n,history:r}){const s=(0,Se.sP)(),{dashboard:i,isLoading:d,loadError:l}=s.useState(),u=r.location.state?.routeReloadCounter,c=(0,t.useMemo)(()=>!!K.A.getObject(U.us),[e.params.uid,e.params.slug,e.params.type]);return(0,t.useEffect)(()=>(a.routeName===y.DashboardRoutes.Normal&&e.params.type==="snapshot"?s.loadSnapshot(e.params.slug):s.loadDashboard({uid:e.params.uid??"",route:a.routeName,urlFolderUid:n.folderUid,keepDashboardFromExploreInLocalStorage:!1}),()=>{s.clearState()}),[s,e.params.uid,a.routeName,n.folderUid,u,e.params.slug,e.params.type]),(0,t.useEffect)(()=>{i&&c&&a.routeName!==y.DashboardRoutes.New&&i.onEnterEditMode(c)},[i,c,a.routeName]),i?e.params.type!=="snapshot"&&i.state.uid&&i.state.uid!==e.params.uid&&a.routeName!==y.DashboardRoutes.Home?null:t.createElement(t.Fragment,null,t.createElement(i.Component,{model:i,key:i.state.key}),t.createElement(ye,{dashboard:i})):t.createElement(z.Y,{layout:O.k.Canvas,"data-testid":"dashboard-scene-page"},d&&t.createElement(ne.A,null),l&&t.createElement("h2",null,l))}const Ce=Nt;var j=o(71468),xt=o(71733),P=o(13544),Te=o(82467),Mt=o(7392),It=o(76888),De=o(3169);function Lt(e){switch(e.kiosk){case"tv":return y.KioskMode.TV;case"1":case!0:return y.KioskMode.Full;default:return null}}var Rt=o(91219),re=o(17422),Ne=o(6473),xe=o(14110),V=o(42418),wt=o(61680);const At="grafana.angularDeprecation.dashboardNoticeAndMigration.isDismissed";function Ft(e){return At+"."+e}function Ut(){const e="__feature.autoMigrateOldPanels",a=new URL(window.location.toString());a.searchParams.has(e)||a.searchParams.append(e,"true"),window.open(a.toString(),"_self")}function Ot({dashboardUid:e,showAutoMigrateLink:a}){return t.createElement(wt.b,{storageKey:Ft(e),defaultValue:!1},(n,r)=>n?null:t.createElement("div",null,t.createElement(V.F,{severity:"warning",title:"This dashboard depends on Angular, which is deprecated and will stop working in future releases of Grafana.",onRemove:()=>{(0,xe.rR)("angular_deprecation_notice_dismissed"),r(!0)}},t.createElement("div",{className:"markdown-html"},t.createElement("a",{href:"https://grafana.com/docs/grafana/latest/developers/angular_deprecation/",className:"external-link",target:"_blank",rel:"noreferrer"},"Read our deprecation notice and migration advice."),t.createElement("br",null),a&&t.createElement(h.$n,{fill:"outline",size:"sm",onClick:Ut,style:{marginTop:10}},"Try migration")))))}var zt=o(8480);const Bt=()=>{const e=new URL(window.location.toString()),a=new URLSearchParams(e.search);a.forEach((n,r)=>{if(r.startsWith("__feature.")){const s=r.substring(10);zt.mz.has(s)&&a.delete(r)}}),window.location.href=new URL(e.origin+e.pathname+"?"+a.toString()).toString()},Vt=()=>{window.open("https://github.com/grafana/grafana/issues/new?assignees=&labels=&projects=&template=0-bug-report.yaml&title=Product+Area%3A+Short+description+of+bug")};function $t({dashboardUid:e}){const a=(0,b.of)(Wt),[n,r]=(0,t.useState)(!0);return n?t.createElement(V.F,{severity:"info",title:"This dashboard was migrated from Angular. Please make sure everything is behaving as expected and save and refresh this dashboard to persist the migration.",onRemove:()=>r(!1)},t.createElement("div",{className:"markdown-html"},t.createElement(h.$n,{fill:"outline",size:"sm",className:a.linkButton,onClick:Vt},"Report issue"),t.createElement(h.$n,{fill:"outline",size:"sm",className:a.linkButton,onClick:Bt},"Revert migration"))):null}const Wt=e=>({linkButton:(0,m.css)({marginRight:10})});var fr=o(53652);function vr(e){const a=e.match.params.slug??"",n=useAsync(()=>getGrafanaStorage().list("content/"+a),[a]),r=a.length>0?`g/${a}/`:"g/",s=Me(a),i=()=>n.value?n.value.fields[0].values.map(u=>{let c=u;const p=c.indexOf(".")<0,v=!p&&c.endsWith(".json"),E=`${r}${c}`;return React.createElement(Card,{key:c,href:p||v?E:void 0},React.createElement(Card.Heading,null,c),React.createElement(Card.Figure,null,React.createElement(Icon,{name:p?"folder":v?"gf-grid":"file-alt",size:"sm"})))}):n.loading?React.createElement(Spinner,null):React.createElement("div",null,"?"),d=Ie();return React.createElement(Page,{navModel:d,pageNav:s},i())}function Me(e){const a=e.split("/");let n=[],r="g",s;for(let i=0;i<a.length;i++)r+=`/${a[i]}`,n.push({text:a[i],url:r,parentItem:s}),s=n[n.length-1];return s}function Ie(){return{main:{text:"C:"},node:{text:"Content",url:"/g"}}}const Er=null;var A=o(28444),Le=o(72401),Gt=o(75096),Re=o(10354),J=o(14578),se=o(40276),we=o(36974),kt=o(48889),Ae=o(17706);const Ht=()=>{const e=(0,b.of)(Qt),[a,n]=(0,t.useState)(""),r=(0,y.useSelector)(l=>l.dashboard.getModel()),s=(0,t.useMemo)(()=>(0,Ae.nr)(),[]),i=(0,t.useMemo)(()=>(0,Ae.CO)(s,a),[s,a]),d=()=>{g.Ny.partial({addWidget:null})};return t.createElement(x.a,{title:"Select widget type",closeOnEscape:!0,closeOnBackdropClick:!0,isOpen:!0,className:e.modal,onClickBackdrop:d,onDismiss:d},t.createElement(Re.p,{type:"search",autoFocus:!0,className:e.searchInput,value:a,prefix:t.createElement(J.I,{name:"search"}),placeholder:"Search widget",onChange:l=>{n(l.currentTarget.value)}}),t.createElement(se.E,null,t.createElement("div",{className:e.grid},i.map((l,u)=>t.createElement(kt.f,{disabled:!1,key:l.id,isCurrent:!1,plugin:l,onClick:c=>{const p=(0,we.ob)(r,l.id);g.Ny.partial({editPanel:p,addWidget:null})}})))))},Qt=e=>({modal:(0,m.css)({width:"65%",maxWidth:"960px",[e.breakpoints.down("md")]:{width:"100%"}}),searchInput:(0,m.css)({marginBottom:e.spacing(2)}),grid:(0,m.css)({display:"grid",gridGap:e.spacing(1)})});var Kt=o(16495),jt=o(82138),Jt=o(9980),Z=o(2543),Zt=o(28138),Xt=o(40996),Yt=o(57767),qt=o(43535),_t=o(88861);const Fe=({panel:e,folderUid:a,isUnsavedPrompt:n,onDismiss:r,onConfirm:s,onDiscard:i})=>{const[d,l]=(0,t.useState)(""),u=(0,W.A)(async()=>{const C=await(0,Yt.xV)(e.libraryPanel.uid);return C.length>0?C.map(I=>I.title):[]},[e.libraryPanel.uid]),[c,p]=(0,t.useState)([]);(0,Xt.A)(()=>u.value?p(u.value.filter(C=>C.toLowerCase().includes(d.toLowerCase()))):p([]),300,[u.value,d]);const{saveLibraryPanel:v}=(0,_t.b)(),E=(0,b.of)(qt.o),M=(0,t.useCallback)(()=>{i()},[i]),S=n?"Unsaved library panel changes":"Save library panel";return t.createElement(x.a,{title:S,icon:"save",onDismiss:r,isOpen:!0},t.createElement("div",null,t.createElement("p",{className:E.textInfo},"This update will affect ",t.createElement("strong",null,e.libraryPanel.meta?.connectedDashboards," ",e.libraryPanel.meta?.connectedDashboards===1?"dashboard":"dashboards","."),"The following dashboards using the panel will be affected:"),t.createElement(Re.p,{className:E.dashboardSearch,prefix:t.createElement(J.I,{name:"search"}),placeholder:"Search affected dashboards",value:d,onChange:C=>l(C.currentTarget.value)}),u.loading?t.createElement("p",null,"Loading connected dashboards..."):t.createElement("table",{className:E.myTable},t.createElement("thead",null,t.createElement("tr",null,t.createElement("th",null,"Dashboard name"))),t.createElement("tbody",null,c.map((C,I)=>t.createElement("tr",{key:`dashrow-${I}`},t.createElement("td",null,C))))),t.createElement(x.a.ButtonRow,null,t.createElement(h.$n,{variant:"secondary",onClick:r,fill:"outline"},"Cancel"),n&&t.createElement(h.$n,{variant:"destructive",onClick:M},"Discard"),t.createElement(h.$n,{onClick:()=>{v(e,a).then(()=>{s()})}},"Update all"))))};var ea=o(98365),Ue=o(19752),oe=o(79971),Oe=o(80095),F=o(53466);function ta(e,a){return async n=>{const r=a.initEditPanel(e);n((0,F.GU)({panel:r,sourcePanel:e}))}}function ze(){return async(e,a)=>{const{getPanel:n}=a().panelEditor;n().configRev=0,e((0,F.MJ)(!0))}}function aa(e,a){return n=>{if(e.libraryPanel?.uid===void 0||!a)return;const r=e.getSaveModel();for(const s of a.panels){if(na(e,s))continue;s.restoreModel({...r,...(0,Z.pick)(s,"gridPos","id")});const i=s.plugin?.meta.id!==e.plugin?.meta.id;s.plugin=e.plugin,s.configRev++,i&&(s.generateNewKey(),n((0,Oe.XM)({key:s.key,plugin:s.plugin}))),setTimeout(()=>{s.getQueryRunner().useLastResultFrom(e.getQueryRunner())},20)}e.repeat&&setTimeout(()=>a.processRepeats(),20)}}function na(e,a){return!!(a.libraryPanel?.uid!==e.libraryPanel.uid||a.id&&a.id===e.id||a.repeatPanelId)}function ra(){return async(e,a)=>{const n=a().dashboard.getModel(),{getPanel:r,getSourcePanel:s,shouldDiscardChanges:i}=a().panelEditor,d=r();n&&n.exitPanelEditor();const l=s();if(sa(d)&&!i){const u=d.getSaveModel(),c=l.type!==d.type;e(aa(d,n)),l.restoreModel(u),l.configRev++,c&&(l.plugin=d.plugin,l.generateNewKey(),await e((0,Oe.XM)({key:l.key,plugin:d.plugin}))),setTimeout(()=>{l.getQueryRunner().useLastResultFrom(d.getQueryRunner()),l.render(),d.hasSavedPanelEditChange&&!d.hasChanged&&(l.configRev=0)},20)}l.isNew&&(i?n&&(0,Ue.FC)(n,l,!0):delete l.isNew),e((0,oe.O6)(d.key)),e((0,F.Ox)())}}function sa(e){return e.hasChanged||e.hasSavedPanelEditChange||e.isAngularPlugin()}function ie(e){return(a,n)=>{const r={...n().panelEditor.ui,...e};a((0,F.fR)(r));try{K.A.setObject(F.wi,r)}catch(s){console.error(s)}}}var oa=o(78050);const ia=({dashboard:e,onSaveSuccess:a,onDiscard:n,onDismiss:r})=>t.createElement(x.a,{isOpen:!0,title:"Unsaved changes",onDismiss:r,icon:"exclamation-triangle",className:(0,m.css)({width:"500px"})},t.createElement("h5",null,"Do you want to save your changes?"),t.createElement(x.a.ButtonRow,null,t.createElement(h.$n,{variant:"secondary",onClick:r,fill:"outline"},"Cancel"),t.createElement(h.$n,{variant:"destructive",onClick:n},"Discard"),t.createElement(oa.C,{dashboard:e,onSaveSuccess:a}))),Be=t.memo(({dashboard:e})=>{const[a,n]=(0,t.useState)({original:null}),r=(0,y.useDispatch)(),{original:s,originalPath:i}=a,{showModal:d,hideModal:l}=(0,t.useContext)(w.wE);(0,t.useEffect)(()=>{const c=setTimeout(()=>{const v=g.Ny.getLocation().pathname,E=e.getSaveModelCloneOld();n({originalPath:v,original:E})},1e3),p=Zt.l.subscribe(A.Eu,()=>{const v=e.getSaveModelCloneOld();n({originalPath:i,original:v})});return()=>{clearTimeout(c),p.unsubscribe()}},[e,i]),(0,t.useEffect)(()=>{const c=p=>{Ve(e,s)||We(e,s)&&(p.preventDefault(),p.returnValue="")};return window.addEventListener("beforeunload",c),()=>window.removeEventListener("beforeunload",c)},[e,s]);const u=c=>{const p=e.panelInEdit,v=new URLSearchParams(c.search);return p&&p.libraryPanel&&p.hasChanged&&!v.has("editPanel")?(d(Fe,{isUnsavedPrompt:!0,panel:e.panelInEdit,folderUid:e.meta.folderUid??"",onConfirm:()=>{l(),X(c)},onDiscard:()=>{r(ze()),X(c),l()},onDismiss:l}),!1):i===c.pathname||!s?(p&&!v.has("editPanel")&&r(ra()),!0):Ve(e,s)||!We(e,s)?!0:(d(ia,{dashboard:e,onSaveSuccess:()=>{l(),X(c)},onDiscard:()=>{n({...a,original:null}),l(),X(c)},onDismiss:l}),!1)};return t.createElement(f.XG,{when:!0,message:u})});Be.displayName="DashboardPrompt";function X(e){e&&setTimeout(()=>g.Ny.push(e),10)}function Ve(e,a){if(!a||a.version===0||!B.TP.isSignedIn||!e)return!0;const{canSave:n,fromScript:r,fromFile:s}=e.meta;return!B.TP.isEditor&&!n?!0:!n||r||s}function $e(e){const a=new ea.G(e);a.expandRows();const n=a.getSaveModelClone();if(delete n.time,delete n.refresh,n.schemaVersion=0,delete n.timezone,n.panels=[],n.templating?.list)for(const r of n.templating.list)delete r.current,delete r.options,delete r.filters;return n}function We(e,a){if(e.hasUnsavedChanges())return!0;const n=$e(e.getSaveModelCloneOld()),r=$e(a),s=(0,Z.find)(n.nav,{type:"timepicker"}),i=(0,Z.find)(r.nav,{type:"timepicker"});s&&i&&(s.now=i.now);const d=JSON.stringify(n,null),l=JSON.stringify(r,null);return d!==l}var la=o(16561),L=o(16560),Ge=o(40334),le=o(70713),ke=o(41987),He=o(87978),G=o(67061),ca=o(29678),ce=o(63021),Y=o(40675),da=o(62930),q=o(88575),ua=o(21594),Qe=o(10534),ma=o(32372),_=o(66864),k=o(15292),pa=o(4213),ga=o.n(pa),ha=o(72724),ee=o(83195),fa=o(2619),va=o(85445),$=o(74856),Ea=o(34214),Ke=o(18803),H=(e=>(e[e.Support=0]="Support",e[e.Data=1]="Data",e))(H||{}),te=(e=>(e[e.PanelSnapshot=0]="PanelSnapshot",e[e.GithubComment=1]="GithubComment",e))(te||{});class ya extends fa.Q{constructor(a){super({panel:a,panelTitle:a.replaceVariables(a.title,void 0,"text")||"Panel",currentTab:0,showMessage:1,snapshotText:"",markdownText:"",randomize:{},snapshotUpdate:0,options:[{label:"GitHub comment",description:"Copy and paste this message into a GitHub issue or comment",value:1},{label:"Panel support snapshot",description:"Dashboard JSON used to help troubleshoot visualization issues",value:0}]}),this.onCurrentTabChange=n=>{this.setState({currentTab:n})},this.onShowMessageChange=n=>{this.setState({showMessage:n.value})},this.onGetMarkdownForClipboard=()=>{const{markdownText:n}=this.state,r=Math.pow(1024,2)*1.5;return n.length>r?(this.setState({error:{title:"Copy to clipboard failed",message:"Snapshot is too large, consider download and attaching a file instead"}}),""):n},this.onDownloadDashboard=()=>{const{snapshotText:n,panelTitle:r}=this.state,s=new Blob([n],{type:"text/plain"}),i=`debug-${r}-${(0,ha.LE)(new Date)}.json.txt`;ga()(s,i)},this.onSetSnapshotText=n=>{this.setState({snapshotText:n})},this.onToggleRandomize=n=>{const{randomize:r}=this.state;this.setState({randomize:{...r,[n]:!r[n]}})},this.onPreviewDashboard=()=>{const{snapshot:n}=this.state;n&&((0,U.OI)({meta:{},dashboard:n}),o.g.open(D.$.appUrl+"dashboard/new","_blank"))}}async buildDebugDashboard(){const{panel:a,randomize:n,snapshotUpdate:r}=this.state,s=await(0,Ke.E_)(a,n,(0,$.jG)().timeRange()),i=JSON.stringify(s,null,2),d=(0,Ke.jD)(a,i),l=(0,ee.cN)((0,ee.j_)("bytes")(i?.length??0));let u;if(!a.isAngularPlugin())try{const c=new Ea.G(s,{isEmbedded:!0});u=(0,va.EH)(c).state.body}catch(c){console.log("Error creating scene:",c)}this.setState({snapshot:s,snapshotText:i,markdownText:d,snapshotSize:l,snapshotUpdate:r+1,scene:u})}}function ba({panel:e,plugin:a,onClose:n}){const r=(0,b.of)(Pa),s=(0,t.useMemo)(()=>new ya(e),[e]),{currentTab:i,loading:d,error:l,options:u,showMessage:c,snapshotSize:p,markdownText:v,snapshotText:E,randomize:M,panelTitle:S,scene:C}=s.useState();if((0,t.useEffect)(()=>{s.buildDebugDashboard()},[s,a,M]),!a)return null;const I=[{label:"Snapshot",value:H.Support},{label:"Data",value:H.Data}],R=D.$.supportBundlesEnabled&&B.TP.hasPermission(y.AccessControlAction.ActionSupportBundlesCreate);return t.createElement(He._,{title:"Get help with this panel",size:"lg",onClose:n,subtitle:t.createElement(G.B,{direction:"column",gap:1},t.createElement(G.B,{direction:"row",gap:1},t.createElement(ca.y,{featureState:ke.Ay.beta}),t.createElement("a",{href:"https://grafana.com/docs/grafana/latest/troubleshooting/",target:"blank",className:"external-link",rel:"noopener noreferrer"},"Troubleshooting docs ",t.createElement(J.I,{name:"external-link-alt"}))),t.createElement("span",{className:"muted"},"To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The snapshot contains query response data and panel settings."),R&&t.createElement("span",{className:"muted"},"You can also retrieve a support bundle containing information concerning your Grafana instance and configured datasources in the ",t.createElement("a",{href:"/support-bundles"},"support bundles section"),".")),tabs:t.createElement(ce.U,null,I.map((T,ae)=>t.createElement(Y.o,{key:`${T.value}-${ae}`,label:T.label,active:T.value===i,onChangeTab:()=>s.onCurrentTabChange(T.value)})))},d&&t.createElement(da.y,null),l&&t.createElement(V.F,{title:l.title},l.message),i===H.Data&&t.createElement("div",{className:r.code},t.createElement("div",{className:r.opts},t.createElement(q.D,{label:"Template",className:r.field},t.createElement(ua.l6,{options:u,value:c,onChange:s.onShowMessageChange})),c===te.GithubComment?t.createElement(Qe.b,{icon:"copy",getText:s.onGetMarkdownForClipboard},"Copy to clipboard"):t.createElement(h.$n,{icon:"download-alt",onClick:s.onDownloadDashboard},"Download (",p,")")),t.createElement(le.Ay,{disableWidth:!0},({height:T})=>t.createElement(ma.B,{width:"100%",height:T,language:c===te.GithubComment?"markdown":"json",showLineNumbers:!0,showMiniMap:!0,value:c===te.GithubComment?v:E,readOnly:!1,onBlur:s.onSetSnapshotText}))),i===H.Support&&t.createElement(t.Fragment,null,t.createElement(q.D,{label:"Randomize data",description:"Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal."},t.createElement(_.Gy,null,t.createElement(k.K,{label:"Labels",id:"randomize-labels",showLabel:!0,value:!!M.labels,onChange:()=>s.onToggleRandomize("labels")}),t.createElement(k.K,{label:"Field names",id:"randomize-field-names",showLabel:!0,value:!!M.names,onChange:()=>s.onToggleRandomize("names")}),t.createElement(k.K,{label:"String values",id:"randomize-string-values",showLabel:!0,value:!!M.values,onChange:()=>s.onToggleRandomize("values")}))),t.createElement(q.D,{label:"Support snapshot",description:`Panel: ${S}`},t.createElement(G.B,null,t.createElement(h.$n,{icon:"download-alt",onClick:s.onDownloadDashboard},"Dashboard (",p,")"),t.createElement(Qe.b,{icon:"github",getText:s.onGetMarkdownForClipboard,title:"Copy a complete GitHub comment to the clipboard"},"Copy to clipboard"),t.createElement(h.$n,{onClick:s.onPreviewDashboard,variant:"secondary",title:"Open support snapshot dashboard in a new tab"},"Preview"))),t.createElement(le.Ay,{disableWidth:!0},({height:T})=>t.createElement("div",{style:{height:T,overflow:"auto"}},C&&t.createElement(C.Component,{model:C})))))}const Pa=e=>({code:(0,m.css)({flexGrow:1,height:"100%",overflow:"scroll"}),field:(0,m.css)({width:"100%"}),opts:(0,m.css)({display:"flex",width:"100%",flexGrow:0,alignItems:"center",justifyContent:"flex-end",button:{marginLeft:"8px"}})});var de=o(39070);const ue=(e,a,n)=>{const r=(0,t.useRef)(),[s,i]=(0,t.useState)();return(0,t.useEffect)(()=>{let d=-1,l=0;return r.current=e.getQueryRunner().getData({withTransforms:a.withTransforms,withFieldConfig:!1}).subscribe({next:u=>{if(n){if(d===u.structureRev){const c=Date.now();if(c-l<1e4)return;l=c}d=u.structureRev??-1}i(u)}}),()=>{r.current&&r.current.unsubscribe()}},[e,a.withTransforms]),{data:s,isLoading:s?.state===de.Gu.Loading,hasSeries:s?!!s.series:!1,hasError:!!(s&&(s.error||s?.errors?.length||s.state===de.Gu.Error))}};var je=o(72574),me=o(8484),Sa=o(61453),Ca=o(82344),Ta=o(61396);const Da=({data:e,metadataDatasource:a})=>!a||!a.components?.MetadataInspector?t.createElement(me.x6,{i18nKey:"dashboard.inspect-meta.no-inspector"},"No Metadata Inspector"):t.createElement(a.components.MetadataInspector,{datasource:a,data:e.series});var Na=o(32067),xa=o(90820);const Ma=({panel:e,plugin:a,dashboard:n,tabs:r,data:s,isDataLoading:i,dataOptions:d,metadataDatasource:l,defaultTab:u,onDataOptionsChange:c,onClose:p})=>{const[v,E]=(0,t.useState)(u??L.q.Data);if(!a)return null;let M=Ia(s),S=v;r.find(R=>R.value===v)||(S=L.q.JSON);const C=(0,je.w)().replace(e.title,e.scopedVars,"text")||"Panel",I=(0,me.t)("dashboard.inspect.title","Inspect: {{panelTitle}}",{panelTitle:C});return t.createElement(He._,{title:I,subtitle:s&&La(s),onClose:p,tabs:t.createElement(ce.U,null,r.map((R,T)=>t.createElement(Y.o,{key:`${R.value}-${T}`,label:R.label,active:R.value===S,onChangeTab:()=>E(R.value||L.q.Data)})))},S===L.q.Data&&t.createElement(Sa.q,{dataName:e.getDisplayTitle(),panelPluginId:e.type,fieldConfig:e.fieldConfig,hasTransformations:!!e.transformations?.length,data:s&&s.series,isLoading:i,options:d,onOptionsChange:c,timeZone:n.timezone,app:ke.Jk.Dashboard}),s&&S===L.q.Meta&&t.createElement(Da,{data:s,metadataDatasource:l}),S===L.q.JSON&&t.createElement(Ta.w,{panel:e,dashboard:n,data:s,onClose:p}),S===L.q.Error&&t.createElement(Ca.y,{errors:M}),s&&S===L.q.Stats&&t.createElement(Na.N,{data:s,timeZone:n.getTimezone()}),s&&S===L.q.Query&&t.createElement(xa.e,{data:s,onRefreshQuery:()=>e.refresh()}))};function Ia(e){let a=e?.errors??[];return e?.error&&!a.includes(e.error)&&(a=[e.error,...a]),!a.length&&e?.state===de.Gu.Error?[{message:"Error loading data"}]:a}function La(e){const{request:a}=e;if(!a||(0,Z.isEmpty)(a))return"";const n=a.targets.length,r=a.endTime?a.endTime-a.startTime:0,s=(0,ee.cN)((0,ee.j_)("ms")(r));return t.createElement(me.x6,{i18nKey:"dashboard.inspect.subtitle"},{queryCount:n}," queries with total query time of ",{formatted:s})}var Je=o(65123);const Ra=({panel:e,dashboard:a,plugin:n})=>{const r=(0,f.zy)(),s=new URLSearchParams(r.search).get("inspectTab"),[i,d]=(0,t.useState)({withTransforms:s===L.q.Error,withFieldConfig:!0}),{data:l,isLoading:u,hasError:c}=ue(e,i,!1),p=(0,Je.sd)(l),v=(0,Je.kx)(e,a,n,c,p),E=()=>{g.Ny.partial({inspect:null,inspectTab:null})};return n?s===L.q.Help?t.createElement(ba,{panel:e,plugin:n,onClose:E}):t.createElement(Ma,{dashboard:a,panel:e,plugin:n,defaultTab:s,tabs:v,data:l,isDataLoading:u,dataOptions:i,onDataOptionsChange:d,metadataDatasource:p,onClose:E}):null},wa=(e,a)=>{const n=(0,Ge.U)(e,a.panel);return n?{plugin:n.plugin}:{plugin:null}},Aa=(0,j.connect)(wa)(Ra);var Ze=o(64423),Xe=o(94354),pe=o(27746),Fa=o(15068),Ye=o(3911),Ua=o(75269),qe=o(58720),Oa=o(10096),ge=o(12470),he=o(56034),za=o(20601),Ba=o(13344);const Va=e=>{const a=(0,t.useMemo)(()=>za.B.get(e.variable.type).picker,[e.variable]);return e.variable?t.createElement(G.B,{gap:0},t.createElement($a,{variable:e.variable}),e.variable.hide!==ge.zL.hideVariable&&a&&t.createElement(a,{variable:e.variable,readOnly:e.readOnly??!1})):t.createElement("div",null,"Couldn't load variable")};function $a({variable:e}){const a=(0,t.useMemo)(()=>e.label||e.name,[e]);if(e.hide!==ge.zL.dontHide)return null;const n=Ba.qz+e.id;return e.description?t.createElement(he.m,{content:e.description,placement:"bottom"},t.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":P.Tp.pages.Dashboard.SubMenu.submenuItemLabels(a),htmlFor:n},a)):t.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":P.Tp.pages.Dashboard.SubMenu.submenuItemLabels(a),htmlFor:n},a)}const _e=({variables:e,readOnly:a})=>{const[n,r]=(0,t.useState)([]);return(0,t.useEffect)(()=>{r(e.filter(s=>s.hide!==ge.zL.hideVariable))},[e]),n.length===0?null:t.createElement(t.Fragment,null,n.map(s=>t.createElement("div",{key:s.id,className:"submenu-item","data-testid":P.Tp.pages.Dashboard.SubMenu.submenuItem},t.createElement(Va,{variable:s,readOnly:a}))))};var Wa=o(81862),Ga=o(54174),et=o(82792),fe=o(87421),ka=o(39569),Ha=o(62367),Qa=o(70497),Ka=o(26443),ja=o(19727),Ja=o(41394);const tt=e=>a=>a.plugins.panels[e]||(0,Ja.$)(`Panel plugin not found (${e})`,!0),ve=({panel:e})=>{const a=(0,y.useDispatch)(),n=(0,y.useSelector)(tt(e.type)),r=(0,y.useSelector)(l=>l.panelEditor.ui.isPanelOptionsVisible),s=(0,y.useSelector)(l=>l.panelEditor.isVizPickerOpen),i=()=>{a((0,F.eK)(!s))},d=()=>{a(ie({isPanelOptionsVisible:!r}))};return n?t.createElement("div",{className:at.wrapper},t.createElement(ja.e,null,t.createElement(pe.I,{className:at.vizButton,tooltip:"Click to change visualization",imgSrc:n.meta.info.logos.small,isOpen:s,onClick:i,"data-testid":P.Tp.components.PanelEditor.toggleVizPicker,"aria-label":"Change Visualization",variant:"canvas",fullWidth:!0},n.meta.name),t.createElement(pe.I,{tooltip:r?"Close options pane":"Show options pane",icon:r?"angle-right":"angle-left",onClick:d,variant:"canvas","data-testid":P.Tp.components.PanelEditor.toggleVizOptions,"aria-label":r?"Close options pane":"Show options pane"}))):null};ve.displayName="VisualizationTab";const at={wrapper:(0,m.css)({display:"flex",flexDirection:"column"}),vizButton:(0,m.css)({textAlign:"left"})};var Za=o(78685),Xa=o(67647),nt=o(15054),rt=o(14792),Ya=o(68313),qa=o(96227),_a=o(96374);const en=({onConfirm:e,onDismiss:a,panel:n})=>{const r=(0,et.X)(n),s=`${r?"Changing":"Replace with"} library panel`,i=`${r?"Changing":"Replacing with a"} library panel will remove any changes since last save.`;return t.createElement(_a.u,{onConfirm:e,onDismiss:a,confirmText:r?"Change":"Replace",title:s,body:i,dismissText:"Cancel",isOpen:!0})};var tn=o(83791);const an=({panel:e,searchQuery:a,isWidget:n=!1})=>{const[r,s]=(0,t.useState)(!1),[i,d]=(0,t.useState)(void 0),[l,u]=(0,t.useState)([]),c=(0,t.useCallback)(C=>{u(C.map(I=>I.id))},[u]),p=(0,rt.UA)().getCurrent(),v=(0,y.useDispatch)(),E=async()=>{i&&(d(void 0),v((0,oe.Xk)(e,i)))},M=()=>s(!0),S=()=>d(void 0);return t.createElement(_.gW,{spacing:"md"},!e.libraryPanel&&t.createElement(_.gW,{align:"center"},t.createElement(h.$n,{icon:"plus",onClick:M,variant:"secondary",fullWidth:!0},"Create new library panel")),t.createElement(Ya.$,{onChange:c,isWidget:n}),t.createElement("div",{className:nn.libraryPanelsView},t.createElement(tn.y,{currentPanelId:e.libraryPanel?.uid,searchString:a,panelFilter:l,onClickCard:d,showSecondaryActions:!0,isWidget:n})),r&&t.createElement(qa.o,{panel:e,onDismiss:()=>s(!1),initialFolderUid:p?.meta.folderUid,isOpen:r}),i&&t.createElement(en,{panel:e,onDismiss:S,onConfirm:E}))},nn={libraryPanelsView:(0,m.css)`
    width: 100%;
  `};var rn=o(56707),st=o(86292),N=o(32696);const ot=({panel:e,data:a})=>{const n=(0,y.useSelector)(tt(e.type)),[r,s]=(0,t.useState)(""),i=!!n.meta.skipDataQuery,d=!!(i&&D.$.featureToggles.vizAndWidgetSplit),l=d?nt.MM:nt.wV,u=d?N.__.Widgets:N.__.Visualizations,[c,p]=(0,Za.A)(l,u),v=(0,y.useDispatch)(),E=(0,b.of)(sn),M=(0,t.useRef)(null),S=(0,t.useCallback)(T=>{v((0,oe.gW)({panel:e,...T})),T.withModKey||v((0,F.eK)(!1))},[v,e]),C=()=>{v((0,F.eK)(!1))};if(!n)return null;const I=[{label:"Visualizations",value:N.__.Visualizations},{label:"Suggestions",value:N.__.Suggestions},{label:"Library panels",value:N.__.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}],R=[{label:"Widgets",value:N.__.Widgets},{label:"Library panels",value:N.__.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}];return t.createElement("div",{className:E.openWrapper},t.createElement("div",{className:E.formBox},t.createElement("div",{className:E.searchRow},t.createElement(Xa.Z,{value:r,onChange:s,ref:M,autoFocus:!0,placeholder:"Search for..."}),t.createElement(h.$n,{title:"Close",variant:"secondary",icon:"angle-up",className:E.closeButton,"aria-label":P.Tp.components.PanelEditor.toggleVizPicker,onClick:C})),t.createElement(q.D,{className:E.customFieldMargin},t.createElement(Xe.z,{options:d?R:I,value:c,onChange:p,fullWidth:!0}))),t.createElement("div",{className:E.scrollWrapper},t.createElement(se.E,{autoHeightMin:"100%"},t.createElement("div",{className:E.scrollContent},c===N.__.Visualizations&&t.createElement(st.G,{pluginId:n.meta.id,onChange:S,searchQuery:r}),c===N.__.Widgets&&t.createElement(st.G,{pluginId:n.meta.id,onChange:S,searchQuery:r,isWidget:!0}),c===N.__.Suggestions&&t.createElement(rn.a,{onChange:S,searchQuery:r,panel:e,data:a}),c===N.__.LibraryPanels&&t.createElement(an,{searchQuery:r,panel:e,key:"Panel Library",isWidget:i})))))};ot.displayName="VisualizationSelectPane";const sn=e=>({icon:(0,m.css)({color:e.v1.palette.gray33}),wrapper:(0,m.css)({display:"flex",flexDirection:"column",flex:"1 1 0",height:"100%"}),vizButton:(0,m.css)({textAlign:"left"}),scrollWrapper:(0,m.css)({flexGrow:1,minHeight:0}),scrollContent:(0,m.css)({padding:e.spacing(1)}),openWrapper:(0,m.css)({display:"flex",flexDirection:"column",flex:"1 1 100%",height:"100%",background:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`}),searchRow:(0,m.css)({display:"flex",marginBottom:e.spacing(1)}),closeButton:(0,m.css)({marginLeft:e.spacing(1)}),customFieldMargin:(0,m.css)({marginBottom:e.spacing(1)}),formBox:(0,m.css)({padding:e.spacing(1),paddingBottom:0})}),on=({plugin:e,panel:a,onFieldConfigsChange:n,onPanelOptionsChanged:r,onPanelConfigChange:s,dashboard:i,instanceState:d})=>{const l=(0,b.of)(ln),u=(0,y.useSelector)(p=>p.panelEditor.isVizPickerOpen),{data:c}=ue(a,{withTransforms:!0,withFieldConfig:!1},!0);return t.createElement("div",{className:l.wrapper,"data-testid":P.Tp.components.PanelEditor.OptionsPane.content},!u&&t.createElement(t.Fragment,null,t.createElement("div",{className:l.vizButtonWrapper},t.createElement(ve,{panel:a})),t.createElement("div",{className:l.optionsWrapper},t.createElement(Ka.Ff,{panel:a,dashboard:i,plugin:e,instanceState:d,data:c,onFieldConfigsChange:n,onPanelOptionsChanged:r,onPanelConfigChange:s}))),u&&t.createElement(ot,{panel:a,data:c}))},ln=e=>({wrapper:(0,m.css)({height:"100%",width:"100%",display:"flex",flex:"1 1 0",flexDirection:"column",padding:0}),optionsWrapper:(0,m.css)({flexGrow:1,minHeight:0}),vizButtonWrapper:(0,m.css)({padding:`0 ${e.spacing(2,2)} 0`}),legacyOptions:(0,m.css)({label:"legacy-options",".panel-options-grid":{display:"flex",flexDirection:"column"},".panel-options-group":{marginBottom:0},".panel-options-group__body":{padding:`${e.spacing(2)} 0`},".section":{display:"block",margin:`${e.spacing(2)} 0`,"&:first-child":{marginTop:0}}})});var it=o(3591),cn=o(91052),dn=o(20726),un=o(36663),mn=(e=>(e.Error="Error",e.Info="Info",e.Links="Links",e))(mn||{});class pn extends t.Component{constructor(){super(...arguments),this.timeSrv=(0,$.jG)(),this.getInfoMode=()=>{const{panel:a,error:n}=this.props;if(n)return"Error";if(a.description)return"Info";if(a.links&&a.links.length)return"Links"},this.getInfoContent=()=>{const{panel:a}=this.props,n=a.description||"",r=(0,je.w)().replace(n,a.scopedVars),s=(0,un.G)(r),i=this.props.links&&this.props.links.getLinks(a.replaceVariables);return t.createElement("div",{className:"panel-info-content markdown-html"},t.createElement("div",{dangerouslySetInnerHTML:{__html:s}}),i&&i.length>0&&t.createElement("ul",{className:"panel-info-corner-links"},i.map((d,l)=>t.createElement("li",{key:l},t.createElement("a",{className:"panel-info-corner-links__item",href:d.href,target:d.target},d.title)))))},this.onClickError=()=>{g.Ny.partial({inspect:this.props.panel.id,inspectTab:L.q.Error})}}render(){const{error:a}=this.props,n=this.getInfoMode();return n?n==="Error"&&a?t.createElement(lt,{infoMode:n,content:a,onClick:this.onClickError}):n==="Info"||n==="Links"?t.createElement(lt,{infoMode:n,content:this.getInfoContent}):null:null}}const gn=pn;function lt({infoMode:e,content:a,onClick:n}){const r=e==="Error"?"error":"info",s=P.Tp.components.Panels.Panel.headerCornerInfo(e.toLowerCase()),i=(0,b.of)(fn);return t.createElement(he.m,{content:a,placement:"top-start",theme:r,interactive:!0},t.createElement("button",{type:"button",className:i.infoCorner,onClick:n,"aria-label":s},t.createElement(J.I,{name:hn[e],size:e==="Links"?"sm":"lg",className:(0,m.cx)(i.icon,{[i.iconLinks]:e==="Links"})}),t.createElement("span",{className:(0,m.cx)(i.inner,{[i.error]:e==="Error"})})))}const hn={Error:"exclamation",Info:"info",Links:"external-link-alt"},fn=e=>({icon:(0,m.css)({position:"absolute",top:0,left:0,zIndex:2,fill:e.colors.text.maxContrast}),iconLinks:(0,m.css)({left:e.spacing(.5),top:e.spacing(.25)}),inner:(0,m.css)({width:0,height:0,position:"absolute",left:0,bottom:0,borderBottom:`${e.spacing(4)} solid transparent`,borderLeft:`${e.spacing(4)} solid ${e.colors.background.secondary}`}),error:(0,m.css)({borderLeftColor:e.colors.error.main}),infoCorner:(0,m.css)({background:"none",border:"none",color:e.colors.text.secondary,cursor:"pointer",position:"absolute",left:0,top:0,width:e.spacing(4),height:e.spacing(4),zIndex:3})});function vn({width:e,height:a,panel:n,dashboard:r}){const{data:s}=ue(n,{withTransforms:!0,withFieldConfig:!1},!1),[i,d]=(0,t.useState)({frameIndex:0,showHeader:!0,showTypeIcons:!0});if((0,t.useEffect)(()=>{const u=(0,$.jG)(),c=n.events.subscribe(it._,()=>{const p=(0,Ue.nk)(n,u.timeRange());n.runAllPanelQueries({dashboardUID:r.uid,dashboardTimezone:r.getTimezone(),timeData:p,width:e})});return()=>{c.unsubscribe()}},[n,r,e]),!s)return null;const l=s?.errors?s.errors.length>1?"Multiple errors found. Click for more details":s.errors[0].message:s?.error?.message;return t.createElement(cn.NR,{width:e,height:a,padding:"none"},(u,c)=>t.createElement(t.Fragment,null,t.createElement(gn,{panel:n,error:l}),t.createElement(dn.m,{title:"Raw data",pluginId:"table",width:u,height:c,data:s,options:i,onOptionsChange:d})))}var ct=o(69731),dt=o(8984),En=o(40980),ut=o(27747);const yn=({panel:e,dashboard:a,...n})=>{const{rules:r,loading:s}=(0,ut.S)({panelId:e.id,dashboardUID:a.uid});return t.createElement(Y.o,{...n,counter:s?null:r.length})};var bn=o(39558),Pn=o(76885),mt=o(25027),Sn=o(63066);const pt=({dashboard:e,panel:a,className:n})=>{const r=(0,y.useSelector)(u=>u.templating),s=(0,f.zy)(),{loading:i,value:d}=(0,W.A)(()=>(0,Sn.mp)(a,e),[a,e,r]);if(i)return t.createElement(h.$n,{disabled:!0},"New alert rule");if(!d)return t.createElement(V.F,{severity:"info",title:"No alerting capable query found"},"Cannot create alerts from this panel because no query to an alerting capable datasource is found.");const l=Pn.kM.renderUrl("alerting/new",{defaults:JSON.stringify(d),returnTo:s.pathname+s.search});return t.createElement(h.z9,{icon:"bell",onClick:()=>(0,mt.fH)(mt.le.alertRuleFromPanel),href:l,className:n,"data-testid":"create-alert-rule-button"},"New alert rule")};var Cn=o(80215),Tn=o(75471),Dn=o(56361);const Nn=({dashboard:e,panel:a})=>{const n=(0,b.of)(xn),{errors:r,loading:s,rules:i}=(0,ut.S)({dashboardUID:e.uid,panelId:a.id,poll:!0}),d=(0,Tn.Wd)("grafana"),l=B.TP.hasPermission(d.create),u=r.length?t.createElement(V.F,{title:"Errors loading rules",severity:"error"},r.map((c,p)=>t.createElement("div",{key:p},"Failed to load Grafana rules state: ",(0,Dn.JZ)(c)))):null;return s&&!i.length?t.createElement("div",{className:n.innerWrapper},u,t.createElement(bn._,{text:"Loading rules..."})):i.length?t.createElement(se.E,{autoHeightMin:"100%"},t.createElement("div",{className:n.innerWrapper},u,t.createElement(Cn.s,{rules:i}),!!e.meta.canSave&&l&&t.createElement(pt,{className:n.newButton,panel:a,dashboard:e}))):t.createElement("div",{"data-testid":P.Tp.components.PanelAlertTabContent.content,className:n.noRulesWrapper},u,!!e.uid&&t.createElement(t.Fragment,null,t.createElement("p",null,"There are no alert rules linked to this panel."),!!e.meta.canSave&&l&&t.createElement(pt,{panel:a,dashboard:e})),!e.uid&&!!e.meta.canSave&&t.createElement(V.F,{severity:"info",title:"Dashboard not saved"},"Dashboard must be saved before alerts can be added."))},xn=e=>({newButton:(0,m.css)({marginTop:e.spacing(3)}),innerWrapper:(0,m.css)({padding:e.spacing(2)}),noRulesWrapper:(0,m.css)({margin:e.spacing(2),backgroundColor:e.colors.background.secondary,padding:e.spacing(3)})});var Mn=o(66879),In=o(22391),Ln=o(47311),Ee=o(31193),Rn=o(37464);class wn extends t.PureComponent{constructor(a){super(a),this.updateLastUsedDatasource=n=>{(0,Ln.tw)(n)},this.onRunQueries=()=>{this.props.panel.refresh()},this.onOpenQueryInspector=()=>{g.Ny.partial({inspect:this.props.panel.id,inspectTab:"query"})},this.onOptionsChange=n=>{const{panel:r}=this.props;r.updateQueries(n),n.dataSource.uid!==r.datasource?.uid&&setTimeout(this.onRunQueries,10),this.forceUpdate()}}buildQueryOptions(a){const n=a.datasource??{default:!0},r=(0,Ee.tR)().getInstanceSettings(n);return this.updateLastUsedDatasource(n),{cacheTimeout:r?.meta.queryOptions?.cacheTimeout?a.cacheTimeout:void 0,dataSource:{default:r?.isDefault,type:r?.type,uid:r?.uid},queryCachingTTL:r?.cachingConfig?.enabled?a.queryCachingTTL:void 0,queries:a.targets,maxDataPoints:a.maxDataPoints,minInterval:a.interval,timeRange:{from:a.timeFrom,shift:a.timeShift,hide:a.hideTimeOverride}}}async componentDidMount(){const{panel:a}=this.props;if(!a.datasource){let n;const r=(0,rt.UA)().getCurrent()?.uid??"",s=(0,we.CW)(r);s?.datasourceUid!==null&&(n=(0,Ee.tR)().getInstanceSettings(s?.datasourceUid)),n||(n=(0,Ee.tR)().getInstanceSettings(null)),a.datasource=(0,In.p$)(n),this.forceUpdate()}}render(){const{panel:a}=this.props;if(!a.datasource)return null;const n=this.buildQueryOptions(a);return t.createElement(Rn.g,{options:n,queryRunner:a.getQueryRunner(),onRunQueries:this.onRunQueries,onOpenQueryInspector:this.onOpenQueryInspector,onOptionsChange:this.onOptionsChange})}}const gt=t.memo(({panel:e,dashboard:a,tabs:n,onChangeTab:r})=>{const s=(0,ct.C)(),i=(0,b.of)(Fn),d=(0,t.useCallback)(c=>{let p="panel_editor_tabs_changed";D.$.featureToggles.transformationsRedesign&&(p="transformations_redesign_"+p),c.active||(0,xe.rR)(p,{tab_id:c.id}),r(c)},[r]);(0,t.useEffect)(()=>{const c=new Ze.yU;return c.add(e.events.subscribe(A.zq,s)),c.add(e.events.subscribe(A.JI,s)),()=>c.unsubscribe()},[e,a,s]);const l=n.find(c=>c.active);if(n.length===0)return null;const u=D.$.unifiedAlertingEnabled;return t.createElement("div",{className:i.wrapper},t.createElement(ce.U,{className:i.tabBar,hideBorder:!0},n.map(c=>c.id===N.M8.Alert&&u?t.createElement(yn,{key:c.id,label:c.text,active:c.active,onChangeTab:()=>r(c),icon:(0,dt.toIconName)(c.icon),panel:e,dashboard:a}):t.createElement(Y.o,{key:c.id,label:c.text,active:c.active,onChangeTab:()=>d(c),icon:(0,dt.toIconName)(c.icon),counter:An(e,c)}))),t.createElement(En.J,{className:i.tabContent},l.id===N.M8.Query&&t.createElement(wn,{panel:e,queries:e.targets}),l.id===N.M8.Alert&&t.createElement(Nn,{panel:e,dashboard:a}),l.id===N.M8.Transform&&t.createElement(Mn.o,{panel:e})))});gt.displayName="PanelEditorTabs";function An(e,a){switch(a.id){case N.M8.Query:return e.targets.length;case N.M8.Alert:return e.alert?1:0;case N.M8.Transform:return(e.getTransformations()??[]).length}return null}const Fn=e=>({wrapper:(0,m.css)({display:"flex",flexDirection:"column",height:"100%"}),tabBar:(0,m.css)({paddingLeft:e.spacing(2)}),tabContent:(0,m.css)({padding:0,display:"flex",flexDirection:"column",flex:1,minHeight:0,background:e.colors.background.primary,border:`1px solid ${e.components.panel.borderColor}`,borderLeft:"none",borderBottom:"none",borderTopRightRadius:e.shape.borderRadius(1.5)})});var Un=o(95689),On=o(54612);const zn=(e,a)=>{const n=e.panelEditor.getPanel(),r=(0,Ge.U)(e,n);return{panel:n,plugin:r?.plugin,instanceState:r?.instanceState,initDone:e.panelEditor.initDone,uiState:e.panelEditor.ui,tableViewEnabled:e.panelEditor.tableViewEnabled,variables:(0,fe.SS)(a.dashboard.uid,e)}},Bn={initPanelEditor:ta,discardPanelChanges:ze,updatePanelEditorUIState:ie,updateTimeZoneForSession:Wa.Cj,toggleTableView:F.kw,notifyApp:Te.dx},Vn=(0,j.connect)(zn,Bn);class $n extends t.PureComponent{constructor(){super(...arguments),this.state={showSaveLibraryPanelModal:!1},this.triggerForceUpdate=()=>{this.forceUpdate()},this.onBack=()=>{g.Ny.partial({editPanel:null,tab:null,showCategory:null})},this.onDiscard=()=>{this.props.discardPanelChanges(),this.onBack()},this.onSaveDashboard=()=>{Oa.lE.publish(new A.S8({component:Qa.$,props:{dashboard:this.props.dashboard}}))},this.onSaveLibraryPanel=async()=>{(0,et.X)(this.props.panel)&&this.setState({showSaveLibraryPanelModal:!0})},this.onChangeTab=a=>{g.Ny.partial({tab:a.id})},this.onFieldConfigChange=a=>{this.props.panel.updateFieldConfig({...a})},this.onPanelOptionsChanged=a=>{this.props.panel.updateOptions(a)},this.onPanelConfigChanged=(a,n)=>{this.props.panel.setProperty(a,n),this.props.panel.render(),this.forceUpdate()},this.onDisplayModeChange=a=>{const{updatePanelEditorUIState:n}=this.props;this.props.tableViewEnabled&&this.props.toggleTableView(),n({mode:a})},this.onToggleTableView=()=>{this.props.toggleTableView()},this.onGoBackToDashboard=()=>{g.Ny.partial({editPanel:null,tab:null,showCategory:null})},this.onConfirmAndDismissLibarayPanelModel=()=>{this.setState({showSaveLibraryPanelModal:!1})}}componentDidMount(){this.props.initPanelEditor(this.props.sourcePanel,this.props.dashboard)}componentDidUpdate(){const{panel:a,initDone:n}=this.props;n&&!this.eventSubs&&(this.eventSubs=new Ze.yU,this.eventSubs.add(a.events.subscribe(A.PR,this.triggerForceUpdate)))}componentWillUnmount(){this.eventSubs?.unsubscribe()}renderPanel(a,n){const{dashboard:r,panel:s,uiState:i,tableViewEnabled:d,theme:l}=this.props;return t.createElement("div",{className:a.mainPaneWrapper,key:"panel"},this.renderPanelToolbar(a),t.createElement("div",{className:a.panelWrapper},t.createElement(le.Ay,null,({width:u,height:c})=>{if(u<3||c<3)return null;if(n&&(c-=l.spacing.gridSize*2),d)return t.createElement(vn,{width:u,height:c,panel:s,dashboard:r});const p=(0,On.A)(i.mode,u,c,s);return t.createElement("div",{className:a.centeringContainer,style:{width:u,height:c}},t.createElement("div",{style:p,"data-panelid":s.id},t.createElement(ka.L,{key:s.key,stateKey:s.key,dashboard:r,panel:s,isEditing:!0,isViewing:!1,lazy:!1,width:p.width,height:p.height})))})))}renderPanelAndEditor(a,n){const{panel:r,dashboard:s,plugin:i,tab:d}=this.props,l=(0,Un.a)(d,i),u=l.length===0,c=this.renderPanel(n,u);return l.length===0?t.createElement("div",{className:n.onlyPanel},c):t.createElement(qe.g,{splitOrientation:"horizontal",maxSize:-200,paneSize:a.topPaneSize,primary:"first",secondaryPaneStyle:{minHeight:0},onDragFinished:p=>{p&&ie({topPaneSize:p/window.innerHeight})}},c,t.createElement("div",{className:n.tabsWrapper,"data-testid":P.Tp.components.PanelEditor.DataPane.content,key:"panel-editor-tabs"},t.createElement(gt,{key:r.key,panel:r,dashboard:s,tabs:l,onChangeTab:this.onChangeTab})))}renderTemplateVariables(a){const{variables:n}=this.props;return n.length?t.createElement("div",{className:a.variablesWrapper},t.createElement(_e,{variables:n})):null}renderPanelToolbar(a){const{dashboard:n,uiState:r,variables:s,updateTimeZoneForSession:i,panel:d,tableViewEnabled:l}=this.props;return t.createElement("div",{className:a.panelToolbar},t.createElement(_.Gy,{justify:s.length>0?"space-between":"flex-end",align:"flex-start"},this.renderTemplateVariables(a),t.createElement(G.B,{gap:1},t.createElement(k.K,{label:"Table view",showLabel:!0,id:"table-view",value:l,onClick:this.onToggleTableView,"data-testid":P.Tp.components.PanelEditor.toggleTableView}),t.createElement(Xe.z,{value:r.mode,options:N.Nt,onChange:this.onDisplayModeChange}),t.createElement(Ha.$,{dashboard:n,onChangeTimeZone:i,isOnCanvas:!0}),!r.isPanelOptionsVisible&&t.createElement(ve,{panel:d}))))}renderEditorActions(){const a="sm";let n=[t.createElement(h.$n,{onClick:this.onDiscard,title:"Undo all changes",key:"discard",size:a,variant:"destructive",fill:"outline"},"Discard"),this.props.dashboard.meta.canSave&&(this.props.panel.libraryPanel?t.createElement(h.$n,{onClick:this.onSaveLibraryPanel,variant:"primary",size:a,title:"Apply changes and save library panel",key:"save-panel"},"Save library panel"):t.createElement(h.$n,{onClick:this.onSaveDashboard,title:"Apply changes and save dashboard",key:"save",size:a,variant:"secondary"},"Save")),t.createElement(h.$n,{onClick:this.onBack,variant:"primary",title:"Apply changes and go back to dashboard","data-testid":P.Tp.components.PanelEditor.applyButton,key:"apply",size:a},"Apply")];return this.props.panel.libraryPanel&&(n.splice(1,0,t.createElement(w.$s,{key:"unlink-controller"},({showModal:r,hideModal:s})=>t.createElement(pe.I,{onClick:()=>{r(Ga.l,{onConfirm:()=>{this.props.panel.unlinkLibraryPanel(),this.forceUpdate()},onDismiss:s,isOpen:!0})},title:"Disconnects this panel from the library panel so that you can edit it regularly.",key:"unlink"},"Unlink"))),n.pop()),n}renderOptionsPane(){const{plugin:a,dashboard:n,panel:r,instanceState:s}=this.props;return a?t.createElement(on,{plugin:a,dashboard:n,panel:r,instanceState:s,onFieldConfigsChange:this.onFieldConfigChange,onPanelOptionsChanged:this.onPanelOptionsChanged,onPanelConfigChange:this.onPanelConfigChanged}):t.createElement("div",null)}render(){const{initDone:a,uiState:n,theme:r,sectionNav:s,pageNav:i,className:d,updatePanelEditorUIState:l}=this.props,u=Gn(r,this.props);return a?t.createElement(z.Y,{navModel:s,pageNav:i,"data-testid":P.Tp.components.PanelEditor.General.content,layout:O.k.Custom,className:d},t.createElement(Ua.H,{actions:t.createElement(Fa.U,{alignment:"right"},this.renderEditorActions())}),t.createElement("div",{className:u.wrapper},t.createElement("div",{className:u.verticalSplitPanesWrapper},n.isPanelOptionsVisible?t.createElement(qe.g,{splitOrientation:"vertical",maxSize:-300,paneSize:n.rightPaneSize,primary:"second",onDragFinished:c=>{c&&l({rightPaneSize:c/window.innerWidth})}},this.renderPanelAndEditor(n,u),this.renderOptionsPane()):this.renderPanelAndEditor(n,u)),this.state.showSaveLibraryPanelModal&&t.createElement(Fe,{panel:this.props.panel,folderUid:this.props.dashboard.meta.folderUid??"",onConfirm:this.onConfirmAndDismissLibarayPanelModel,onDiscard:this.onDiscard,onDismiss:this.onConfirmAndDismissLibarayPanelModel}))):null}}const Wn=(0,b.cV)(Vn($n)),Gn=(0,Ye.N)((e,a)=>{const{uiState:n}=a,r=e.spacing(2);return{wrapper:(0,m.css)({width:"100%",flexGrow:1,minHeight:0,display:"flex",paddingTop:e.spacing(2)}),verticalSplitPanesWrapper:(0,m.css)({display:"flex",flexDirection:"column",height:"100%",width:"100%",position:"relative"}),mainPaneWrapper:(0,m.css)({display:"flex",flexDirection:"column",height:"100%",width:"100%",paddingRight:`${n.isPanelOptionsVisible?0:r}`}),variablesWrapper:(0,m.css)({label:"variablesWrapper",display:"flex",flexGrow:1,flexWrap:"wrap",gap:e.spacing(1,2)}),panelWrapper:(0,m.css)({flex:"1 1 0",minHeight:0,width:"100%",paddingLeft:r}),tabsWrapper:(0,m.css)({height:"100%",width:"100%"}),panelToolbar:(0,m.css)({display:"flex",padding:`0 0 ${r} ${r}`,justifyContent:"space-between",flexWrap:"wrap"}),angularWarning:(0,m.css)({display:"flex",height:e.spacing(4),alignItems:"center"}),toolbarLeft:(0,m.css)({paddingLeft:e.spacing(1)}),centeringContainer:(0,m.css)({display:"flex",justifyContent:"center",alignItems:"center",position:"relative",flexDirection:"column"}),onlyPanel:(0,m.css)({height:"100%",position:"absolute",overflow:"hidden",width:"100%"})}});var kn=o(1702),Hn=o(39268),Qn=o(14186),Kn=o(89963),jn=o(42972);const Jn=({annotation:e,events:a,onEnabledChanged:n})=>{const[r,s]=(0,t.useState)(!1),i=(0,b.of)(Zn),d=()=>(0,jn.Dh)().cancel(e);return(0,t.useEffect)(()=>{const l=a.getStream(A.xc).subscribe({next:c=>{c.payload===e&&s(!0)}}),u=a.getStream(A.yj).subscribe({next:c=>{c.payload===e&&s(!1)}});return()=>{l.unsubscribe(),u.unsubscribe()}}),t.createElement("div",{key:e.name,className:i.annotation},t.createElement(Hn.C,null,t.createElement(Qn.I,{label:e.name,disabled:r,"data-testid":P.Tp.pages.Dashboard.SubMenu.Annotations.annotationLabel(e.name)},t.createElement(k.K,{label:e.name,value:e.enable,onChange:()=>n(e),disabled:r,"data-testid":P.Tp.pages.Dashboard.SubMenu.Annotations.annotationToggle(e.name)})),t.createElement("div",{className:i.indicator},t.createElement(Kn.I,{loading:r,onCancel:d}))))};function Zn(e){return{annotation:(0,m.css)({display:"inline-block",marginRight:e.spacing(1),".fa-caret-down":{fontSize:"75%",paddingLeft:e.spacing(1)},".gf-form-inline .gf-form":{marginBottom:0}}),indicator:(0,m.css)({alignSelf:"center",padding:`0 ${e.spacing(.5)}`})}}const Xn=({annotations:e,onAnnotationChanged:a,events:n})=>{const[r,s]=(0,t.useState)([]);return(0,t.useEffect)(()=>{s(e.filter(i=>i.hide!==!0))},[e]),r.length===0?null:t.createElement("div",{"data-testid":P.Tp.pages.Dashboard.SubMenu.Annotations.annotationsWrapper},r.map(i=>t.createElement(Jn,{events:n,annotation:i,onEnabledChanged:a,key:i.name})))};var Yn=o(94701),qn=o(80997),_n=o(4588),er=o(6923),ht=o(52424);const tr=({dashboard:e,links:a})=>{const n=(0,ct.C)();return(0,Yn.A)(()=>{const r=e.events.subscribe(it.sR,n);return()=>r.unsubscribe()}),a.length?t.createElement(t.Fragment,null,a.map((r,s)=>{const i=(0,er.mQ)().getAnchorInfo(r),d=`${r.title}-$${s}`;if(r.type==="dashboards")return t.createElement(ht.aK,{key:d,link:r,linkInfo:i,dashboardUID:e.uid});const l=_n.G[r.icon],u=t.createElement(ht.Zx,{href:(0,qn.Jf)(i.href),target:r.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":P.Tp.components.DashboardLinks.link,icon:l},i.title);return t.createElement("div",{key:d,"data-testid":P.Tp.components.DashboardLinks.container},r.tooltip?t.createElement(he.m,{content:i.tooltip},u):u)})):null};class ar extends t.PureComponent{constructor(){super(...arguments),this.onAnnotationStateChanged=a=>{for(let n=0;n<this.props.dashboard.annotations.list.length;n++){const r=this.props.dashboard.annotations.list[n];if(r.name===a.name){r.enable=!r.enable;break}}this.props.dashboard.startRefresh(),this.forceUpdate()},this.disableSubmitOnEnter=a=>{a.preventDefault()}}render(){const{dashboard:a,variables:n,links:r,annotations:s,theme:i}=this.props,d=rr(i),l=a.meta.isSnapshot??!1;return t.createElement("div",{className:d.submenu},t.createElement("form",{"aria-label":"Template variables",className:d.formStyles,onSubmit:this.disableSubmitOnEnter},t.createElement(_e,{variables:n,readOnly:l})),t.createElement(Xn,{annotations:s,onAnnotationChanged:this.onAnnotationStateChanged,events:a.events}),t.createElement("div",{className:d.spacer}),a&&t.createElement(tr,{dashboard:a,links:r}))}}const nr=(e,a)=>{const{uid:n}=a.dashboard,r=(0,fe.nx)(n,e);return{variables:(0,fe.pi)(n,r.variables)}},rr=(0,Ye.N)(e=>({formStyles:(0,m.css)({display:"contents",flexWrap:"wrap"}),submenu:(0,m.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignContent:"flex-start",alignItems:"flex-start",gap:`${e.spacing(1)} ${e.spacing(2)}`,padding:`0 0 ${e.spacing(1)} 0`}),spacer:(0,m.css)({flexGrow:1})})),ft=(0,b.cV)((0,j.connect)(nr)(ar));ft.displayName="SubMenu";var sr=o(2118),or=o(61582),vt=o(84423),ir=o(3673);const lr=e=>({initPhase:e.dashboard.initPhase,initError:e.dashboard.initError,dashboard:e.dashboard.getModel(),navIndex:e.navIndex}),cr={initDashboard:U.vR,cleanUpDashboardAndVariables:ir.Bz,notifyApp:Te.dx,cancelVariables:Le.Y7,templateVarsChangedInUrl:Le.Hn},dr=(0,j.connect)(lr,cr);class ur extends t.PureComponent{constructor(){super(...arguments),this.forceRouteReloadCounter=0,this.state=this.getCleanState(),this.updateLiveTimer=()=>{let a;this.props.dashboard?.liveNow&&(a=(0,$.jG)().timeRange()),or.a.setLiveTimeRange(a)},this.setScrollRef=a=>{this.setState({scrollElement:a})},this.onCloseShareModal=()=>{g.Ny.partial({shareView:null})}}static{this.contextType=It.YE}getCleanState(){return{editPanel:null,viewPanel:null,showLoadingState:!1,panelNotFound:!1,editPanelAccessDenied:!1}}componentDidMount(){this.initDashboard(),this.forceRouteReloadCounter=this.props.history.location.state?.routeReloadCounter||0}componentWillUnmount(){this.closeDashboard()}closeDashboard(){this.props.cleanUpDashboardAndVariables(),this.setState(this.getCleanState())}initDashboard(){const{dashboard:a,match:n,queryParams:r}=this.props;a&&this.closeDashboard(),this.props.initDashboard({urlSlug:n.params.slug,urlUid:n.params.uid,urlType:n.params.type,urlFolderUid:r.folderUid,panelType:r.panelType,routeName:this.props.route.routeName,fixUrl:!0,accessToken:n.params.accessToken,keybindingSrv:this.context.keybindings}),setTimeout(this.updateLiveTimer,250)}componentDidUpdate(a,n){const{dashboard:r,match:s,templateVarsChangedInUrl:i}=this.props,d=this.props.history.location.state?.routeReloadCounter;if(r){if(a.match.params.uid!==s.params.uid||d!==void 0&&this.forceRouteReloadCounter!==d){this.initDashboard(),this.forceRouteReloadCounter=d;return}if(a.location.search!==this.props.location.search){const l=a.queryParams,u=this.props.queryParams;(u?.from!==l?.from||u?.to!==l?.to)&&((0,$.jG)().updateTimeRangeFromUrl(),this.updateLiveTimer()),!l?.refresh&&u?.refresh&&(0,$.jG)().setAutoRefresh(u.refresh);const c=(0,Gt.Wz)(this.props.queryParams,a.queryParams);c&&i(r.uid,c)}this.state.editPanel&&!n.editPanel&&(Ne.t.setEditingState(!0),this.props.dashboard?.events.publish(new A.sL(this.state.editPanel.id))),!this.state.editPanel&&n.editPanel&&(Ne.t.setEditingState(!1),this.props.dashboard?.events.publish(new A.i0(n.editPanel.id))),this.state.editPanelAccessDenied&&(this.props.notifyApp((0,De.gi)("Permission to edit panel denied")),g.Ny.partial({editPanel:null})),this.state.panelNotFound&&(this.props.notifyApp((0,De.gi)("Panel not found")),g.Ny.partial({editPanel:null,viewPanel:null}))}}static getDerivedStateFromProps(a,n){const{dashboard:r,queryParams:s}=a,i=s.editPanel,d=s.viewPanel;if(!r)return n;const l={...n};if(!n.editPanel&&i){const u=r.getPanelByUrlId(i);u?r.canEditPanel(u)?(l.editPanel=u,l.rememberScrollTop=n.scrollElement?.scrollTop):l.editPanelAccessDenied=!0:l.panelNotFound=!0}else n.editPanel&&!i&&(l.editPanel=null,l.updateScrollTop=n.rememberScrollTop);if(!n.viewPanel&&d){const u=r.getPanelByUrlId(d);u?(r.initViewPanel(u),l.viewPanel=u,l.rememberScrollTop=n.scrollElement?.scrollTop,l.updateScrollTop=0):l.panelNotFound=!0}else n.viewPanel&&!d&&(r.exitViewPanel(n.viewPanel),l.viewPanel=null,l.updateScrollTop=n.rememberScrollTop);return(n.panelNotFound||n.editPanelAccessDenied&&!i)&&(l.panelNotFound=!1,l.editPanelAccessDenied=!1),mr(a,l)}getInspectPanel(){const{dashboard:a,queryParams:n}=this.props,r=n.inspect;if(!a||!r)return null;const s=a.getPanelById(parseInt(r,10));return s||null}render(){const{dashboard:a,initError:n,queryParams:r}=this.props,{editPanel:s,viewPanel:i,updateScrollTop:d,pageNav:l,sectionNav:u}=this.state,c=Lt(this.props.queryParams);if(!a||!l||!u)return t.createElement(Jt.P,{initPhase:this.props.initPhase});const p=this.getInspectPanel(),v=!s&&!c&&!this.props.queryParams.editview&&a.isSubMenuVisible(),E=c!==y.KioskMode.Full&&!r.editview,M=(0,m.cx)({"panel-in-fullscreen":!!i,"page-hidden":!!(r.editview||s)});if(a.meta.dashboardNotFound)return t.createElement(z.Y,{navId:"dashboards/browse",layout:O.k.Canvas,pageNav:{text:"Not found"}},t.createElement(Mt.L,{entity:"Dashboard"}));const S=new Set(["autoMigrateOldPanels","autoMigrateGraphPanel","autoMigrateTablePanel","autoMigratePiechartPanel","autoMigrateWorldmapPanel","autoMigrateStatPanel","disableAngular"]),C=()=>{const T=new URLSearchParams(window.location.search);let ae=!1;return T.forEach((bt,Pt)=>{if(Pt.startsWith("__feature.")){const St=Pt.substring(10),hr=bt==="true"||bt==="";if(D.$.featureToggles[St])return;if(S.has(St)&&hr){ae=!0;return}}}),ae},I=a.panels.some(T=>T.autoMigrateFrom&&vt.NB[T.autoMigrateFrom]!=null),R=D.$.featureToggles.angularDeprecationUI&&I&&C()&&a.uid!==null;return t.createElement(t.Fragment,null,t.createElement(z.Y,{navModel:u,pageNav:l,layout:O.k.Canvas,className:M,scrollRef:this.setScrollRef,scrollTop:d},E&&t.createElement("header",{"data-testid":P.Tp.pages.Dashboard.DashNav.navV2},t.createElement(Kt.U,{dashboard:a,title:a.title,folderTitle:a.meta.folderTitle,isFullscreen:!!i,kioskMode:c,hideTimePicker:a.timepicker.hidden})),t.createElement(Be,{dashboard:a}),n&&t.createElement(jt.y,null),v&&t.createElement("section",{"aria-label":P.Tp.pages.Dashboard.SubMenu.submenu},t.createElement(ft,{dashboard:a,annotations:a.annotations.list,links:a.links})),D.$.featureToggles.angularDeprecationUI&&a.hasAngularPlugins()&&a.uid!==null&&t.createElement(Ot,{dashboardUid:a.uid,showAutoMigrateLink:a.panels.some(T=>vt.vI.includes(T.type))}),R&&t.createElement($t,{dashboardUid:a.uid}),t.createElement(sr.N,{dashboard:a,isEditable:!!a.meta.canEdit,viewPanel:i,editPanel:s}),p&&t.createElement(Aa,{dashboard:a,panel:p}),r.shareView&&t.createElement(kn.ShareModal,{dashboard:a,onDismiss:this.onCloseShareModal})),s&&t.createElement(Wn,{dashboard:a,sourcePanel:s,tab:this.props.queryParams.tab,sectionNav:u,pageNav:l}),r.editview&&t.createElement(la.s,{dashboard:a,editview:r.editview,pageNav:l,sectionNav:u}),r.addWidget&&D.$.featureToggles.vizAndWidgetSplit&&t.createElement(Ht,null))}}function mr(e,a){const{dashboard:n,navIndex:r}=e;if(!n)return a;let s=a.pageNav,i=a.sectionNav;if((!s||n.title!==s.text||n.meta.folderUrl!==s.parentItem?.url)&&(s={text:n.title,url:xt.I.getUrlForPartial(e.history.location,{editview:null,editPanel:null,viewPanel:null})}),e.route.routeName===y.DashboardRoutes.Path){i=Ie();const l=Me(e.match.params.slug);l?.parentItem&&(l.parentItem=l.parentItem)}else i=(0,re.tc)(e.navIndex,Rt.L1+n.uid,(0,re.tc)(e.navIndex,"dashboards/browse"));const{folderUid:d}=n.meta;if(d&&s&&i.main.id!=="starred"){const l=(0,re.tc)(r,`folder-dashboards-${d}`).main;l.id!=="not-found"&&(s={...s,parentItem:l})}return(a.editPanel||a.viewPanel)&&(s={...s,text:`${a.editPanel?"Edit":"View"} panel`,parentItem:s,url:void 0}),a.pageNav===s&&a.sectionNav===i?a:{...a,pageNav:s,sectionNav:i}}const Et=(0,b.cV)(ur);Et.displayName="DashboardPage";const yt=dr(Et);function pr(e){const a=e.queryParams.scenes===!0,n=e.queryParams.scenes===!1;if(a||D.$.featureToggles.dashboardScene&&!n)return t.createElement(Ce,{...e});const r=(0,Se.sP)(),s=!!(e.route.routeName===y.DashboardRoutes.Home||e.route.routeName===y.DashboardRoutes.Normal&&e.match.params.uid),i=(0,W.A)(async()=>e.match.params.type==="snapshot"?null:r.fetchDashboard({route:e.route.routeName,uid:e.match.params.uid??"",keepDashboardFromExploreInLocalStorage:!0}),[e.match.params.uid,e.route.routeName]);return D.$.featureToggles.dashboardSceneForViewers?i.loading||i?.value?.dashboard?.uid!==e.match.params.uid&&i.value?.meta?.isNew!==!0?null:i.value&&!(i.value.meta?.canEdit||i.value.meta?.canMakeEditable)&&s?t.createElement(Ce,{...e}):t.createElement(yt,{...e}):t.createElement(yt,{...e})}const gr=pr},53652:(Ct,Q,o)=>{o.d(Q,{E:()=>K,o:()=>y});var t=o(89667),W=o(57875),D=o(17172),O=o(32264),z=o(27677);class ne{constructor(){}async get(f){const g=`api/storage/read/${f}`.replace("//","/");return(0,D.AI)().get(g)}async list(f){let g="api/storage/list/";f&&(g+=f+"/");const w=await(0,D.AI)().get(g);if(w?.data){const b=(0,t.or)(w);for(const x of b.fields)x.display=(0,W.J)({field:x,theme:O.$.theme2});return b}}async createFolder(f){const g=await(0,D.AI)().post("/api/storage/createFolder",JSON.stringify({path:f}));return g.success?{}:{error:g.message??"unknown error"}}async deleteFolder(f){const g=await(0,D.AI)().post("/api/storage/deleteFolder",JSON.stringify(f));return g.success?{}:{error:g.message??"unknown error"}}async deleteFile(f){const g=await(0,D.AI)().post(`/api/storage/delete/${f.path}`);return g.success?{}:{error:g.message??"unknown error"}}async delete(f){return f.isFolder?this.deleteFolder({path:f.path,force:!0}):this.deleteFile({path:f.path})}async upload(f,g,w){const b=new FormData;b.append("folder",f),b.append("file",g),b.append("overwriteExistingFile",String(w));const x=await fetch("/api/storage/upload",{method:"POST",body:b});let h=await x.json();return h||(h={}),h.status=x.status,h.statusText=x.statusText,x.status!==200&&!h.err&&(h.err=!0),h}async write(f,g){return z.IB.post(`/api/storage/write/${f}`,g)}async getConfig(){return(0,D.AI)().get("/api/storage/config")}async getOptions(f){return(0,D.AI)().get(`/api/storage/options/${f}`)}}function K(m,f){const w=m.toLowerCase().trim();return f.map(x=>x.trim().toLowerCase()).includes(w)}let U;function y(){return U||(U=new ne),U}}}]);

//# sourceMappingURL=DashboardPageProxy.53725fe76b78fada005e.js.map