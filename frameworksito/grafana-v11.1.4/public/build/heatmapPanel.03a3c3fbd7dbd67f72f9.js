"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5857],{96589:(Ue,fe,d)=>{d.d(fe,{w:()=>De});var f=d(32196),N=d(96540),pe=d(40845);const q=10,De=({colorPalette:M,min:w,max:j,display:S,hoverValue:b,useStopsPercentage:_})=>{const[ee,k]=(0,N.useState)([]),[K,Q]=(0,N.useState)({isShown:!1,value:0}),[T,ve]=(0,N.useState)(null),se=(0,pe.$j)(),I=he(se,ee);(0,N.useEffect)(()=>{k(U({colorArray:M,stops:q,useStopsPercentage:_}))},[M,_]);const Ve=J=>{const ae=J.nativeEvent.offsetX,ye=J.currentTarget.offsetWidth,xe=Math.floor(ae*100/ye+1),Le=Math.floor((j-w)*xe/100+w);Q({isShown:!0,value:Le}),ve(xe)},ge=()=>{Q({isShown:!1,value:0})};return(0,N.useEffect)(()=>{ve(b==null?null:i((b-w)/(j-w)))},[b,w,j]),N.createElement("div",{className:I.scaleWrapper,onMouseMove:Ve,onMouseLeave:ge},N.createElement("div",{className:I.scaleGradient},S&&(K.isShown||b!==void 0)&&N.createElement("div",{className:I.followerContainer},N.createElement("div",{className:I.follower,style:{left:`${T}%`}}))),S&&N.createElement("div",{className:I.followerContainer},N.createElement("div",{className:I.legendValues},N.createElement("span",{className:I.disabled},S(w)),N.createElement("span",{className:I.disabled},S(j))),T!=null&&(K.isShown||b!==void 0)&&N.createElement("span",{className:I.hoverValue,style:{left:`${T}%`}},S(b??K.value))))},U=({colorArray:M,stops:w,useStopsPercentage:j=!0})=>{const S=M.length;if(j&&S<=20){const k=1/S*100;let K=0;const Q=[];for(const T of M)K>0?Q.push(`${T} ${K}%`):Q.push(T),K+=k,Q.push(`${T} ${K}%`);return Q}const b=M[S-1],_=Math.ceil(S/w),ee=new Set;for(let k=0;k<S;k+=_)ee.add(M[k]);return ee.add(b),[...ee]};function i(M){return M>1?100:M<0?0:M*100}const he=(M,w)=>({scaleWrapper:(0,f.css)({width:"100%",fontSize:"11px",opacity:1}),scaleGradient:(0,f.css)({background:`linear-gradient(90deg, ${w.join()})`,height:"9px",pointerEvents:"none",borderRadius:M.shape.radius.default}),legendValues:(0,f.css)({display:"flex",justifyContent:"space-between",pointerEvents:"none"}),hoverValue:(0,f.css)({position:"absolute",marginTop:"-14px",padding:"3px 15px",transform:"translateX(-50%)"}),followerContainer:(0,f.css)({position:"relative",pointerEvents:"none",whiteSpace:"nowrap"}),follower:(0,f.css)({position:"absolute",height:"13px",width:"13px",borderRadius:M.shape.radius.default,transform:"translateX(-50%) translateY(-50%)",border:`2px solid ${M.colors.text.primary}`,top:"5px"}),disabled:(0,f.css)({color:M.colors.text.disabled})})},26235:(Ue,fe,d)=>{d.r(fe),d.d(fe,{plugin:()=>gt});var f=d(96540),N=d(65158),pe=d(37055),q=d(11261),De=d(27310),U=d(32264),i=d(52622),he=d(38248),M=d(11404),w=d(96589),j=d(27825),S=d(3290),b=d(32196),_=d(94624),ee=d(97152),k=d(40845),K=d(79041),Q=d(67266),T=d(81297),ve=d(68268),se=d(77455),I=d(62567),Ve=d(7874),ge=d(36613),J=d(41260),ae=d(83195),ye=d(28240),xe=d(11389),Le=d(58749),je=d(52415),Se=d(79871),Je=d(14792),Xe=d(1819),Ze=d(21164),qe=d(22731),_e=d(82915);function et(e,s,a,o,t,l,n){let r=e.current?.getContext("2d");if(r!=null){let p=l;for(;o[p-1]===o[l];)p--;let c=p+n,v=0,y=p;for(;y<c;){let V=t[y];v=Math.max(v,V),y++}let P=new Path2D,G=new Path2D;y=p;let Y=0;for(;y<c;){let V=t[y];if(V>0){let R=V/v,H=Y/n,C=y===l?P:G;const E=s*H+1,W=s/n-1;C.rect(E,Math.round(a*(1-R)),W,Math.round(a*R))}y++,Y++}r.clearRect(0,0,s,a),r.fillStyle="#2E3036",r.fill(G),r.fillStyle="#5794F2",r.fill(P)}}const Fe=(e,s)=>{const a=e.heatmapColors?.palette,o=e.heatmapColors?.values[s];let t;return o!=null&&(t=a[o]),{cellColor:t,colorPalette:a}},$e={year:1e3*60*60*24*365,month:1e3*60*60*24*30,week:1e3*60*60*24*7,day:1e3*60*60*24,h:1e3*60*60,m:1e3*60,s:1e3,ms:1},tt=new Set(["ms","s","m","h"]),at=e=>{let s=1,a="ms";for(a in $e)if(e>=$e[a]){s=Math.floor(e/$e[a]);break}const t=s!==1&&!tt.has(a)?a+"s":a;return`${s} ${t}`},ke=(e,s,a)=>{let o;switch(s){case"x":o=a?e?.fields.find(({name:t})=>t==="x"||t==="xMin"||t==="xMax"):e?.fields[0];break;case"y":o=a?e?.fields.find(({name:t})=>t==="y"||t==="yMin"||t==="yMax"):e?.fields[1];break;case"count":o=a?e?.fields.find(({name:t})=>t==="count"):e?.fields[2];break}return o},Ie=(e,s)=>{let a=e.heatmap.fields,o=a.find(r=>r.name==="xMax"),t=a.find(r=>r.name==="yMin"),l=a.find(r=>r.name==="yMax"),n=o.config.interval;return{xBucketMin:o.values[s]-n,xBucketMax:o.values[s],yBucketMin:t.values[s],yBucketMax:l.values[s]}},lt=e=>e.seriesIdx===2?f.createElement(Xe.e,{data:e.dataRef.current.exemplars,rowIndex:e.dataIdxs[2],header:"Exemplar",padding:8}):f.createElement(ot,{...e}),Re=264,nt=64,ot=({dataIdxs:e,dataRef:s,showHistogram:a,isPinned:o,showColorScale:t=!1,mode:l,annotate:n,maxHeight:r,maxWidth:u})=>{const p=e[1],c=s.current,[v]=(0,f.useState)(()=>c.heatmap?.meta?.type===J.m.HeatmapCells&&!(0,S.Nb)(c.heatmap)),y=ke(c.heatmap,"x",v),P=ke(c.heatmap,"y",v),G=ke(c.heatmap,"count",v),Y=g=>y?.display?(0,ae.cN)(y.display(g)):y?.type===q.PU.time?(0,Je.UA)().getCurrent()?.formatDate(g,"YYYY-MM-DD HH:mm:ss"):`${g}`,V=y.values,R=P.values,H=G.values,C=(0,S.eE)(c.heatmap),E=P?.display?g=>(0,ae.cN)(P.display(g)):g=>`${g}`;let W=y?.config.interval,h,O,A,L,le,ne=[];const F=g=>g%(c.yBucketCount??1);let D=F(p);const z=Math.floor(p/(c.yBucketCount??1)),te=(g=p)=>{if(C.yOrdinalDisplay){const x=c.yLayout===i.D7.le?D-1:D,$=c.yLayout===i.D7.le?D:D+1;h=x<0?C.yMinDisplay:`${C.yOrdinalDisplay[x]}`,O=`${C.yOrdinalDisplay[$]}`,(!C.yOrdinalLabel||Number.isNaN(+C.yOrdinalLabel[0]))&&(le=c.yLayout===i.D7.le?O:h)}else{const x=R?.[D];if(c.yLayout===i.D7.le)if(O=`${x}`,c.yLog){let B=(c.yLog===2?Math.log2:Math.log10)(x)-1/c.yLogSplit;h=`${c.yLog**B}`}else h=`${x-c.yBucketSize}`;else if(h=`${x}`,c.yLog){let B=(c.yLog===2?Math.log2:Math.log10)(x)+1/c.yLogSplit;O=`${c.yLog**B}`}else O=`${x+c.yBucketSize}`}c.xLayout===i.D7.le?(L=V[g],A=L-c.xBucketSize):(A=V[g],L=A+c.xBucketSize)};v?{xBucketMin:A,xBucketMax:L,yBucketMin:h,yBucketMax:O}=Ie(c,p):te();const{cellColor:Ee,colorPalette:X}=Fe(c,p),ue=(g,x)=>{let $=[];for(let B=g;B<=x;B++){if(!H?.[B])continue;const oe=Fe(c,B).cellColor;Z=we(B),v?{xBucketMin:A,xBucketMax:L,yBucketMin:h,yBucketMax:O}=Ie(c,B):(D=F(B),te(B));const{label:Mt,value:Nt}=de()[0];$.push({label:Mt,value:Nt,color:oe??"#FFF",isActive:p===B})}return $},de=()=>{const g=l===i.$N.Multi&&!o;if(le)return g?[{label:`Name ${le}`,value:c.display(Z)}]:[{label:"Name",value:le}];switch(c.yLayout){case i.D7.unknown:return g?[{label:E(h),value:c.display(Z)}]:[{label:"",value:E(h)}]}return g?[{label:`Bucket ${E(h)}-${E(O)}`,value:c.display(Z)}]:[{label:"Bucket",value:`${E(h)}-${E(O)}`}]},we=g=>H?.[g];let Z=we(p);if(l===i.$N.Single||o){const g=W?[{label:"Duration",value:at(W)}]:[];ne=[{label:(0,ye.Ct)(G,c.heatmap),value:c.display(Z),color:Ee??"#FFF",colorPlacement:Se.lJ.trailing,colorIndicator:Se.fX.value},...de(),...g]}if(l===i.$N.Multi&&!o){let g=y.values[p],x=p,$=p;for(;y.values[x-1]===g;)x--;for(;y.values[$+1]===g;)$++;ue(x,$).forEach(oe=>{ne.push({label:oe.label,value:oe.value,color:oe.color??"#FFF",colorIndicator:Se.fX.value,colorPlacement:Se.lJ.trailing,isActive:oe.isActive})})}let me;if(o){let g=[];const x=c.series?.fields[D+1];if(x!=null){const $=!x.config.custom?.hideFrom?.tooltip,B=(x.config.links?.length??0)>0;$&&B&&(g=(0,Ze.u)(x,z))}me=f.createElement(Le.S,{dataLinks:g,annotate:n})}let Qe=(0,f.useRef)(null);const Te=(0,k.$j)(),yt=parseInt(Te.spacing(1),10);let Ge=Math.min(Re,u?u-yt*2:Re),Ye=nt,We=Math.round(Ge*ge.A.pxRatio),ze=Math.round(Ye*ge.A.pxRatio);(0,f.useEffect)(()=>{a&&V!=null&&H!=null&&l===i.$N.Single&&et(Qe,We,ze,V,H,p,c.yBucketCount)},[p]);const xt={label:"",value:Y(L)};let Ae=[];l===i.$N.Single&&(a&&!v&&Ae.push(f.createElement("canvas",{width:We,height:ze,ref:Qe,style:{width:Ge+"px",height:Ye+"px"}})),X&&t&&Ae.push(f.createElement(w.w,{colorPalette:X,min:c.heatmapColors?.minValue,max:c.heatmapColors?.maxValue,display:c.display,hoverValue:Z})));const St=(0,k.of)(qe.$);return f.createElement("div",{className:St.wrapper},f.createElement(je.A,{item:xt,isPinned:o}),f.createElement(xe.o,{items:ne,isPinned:o,scrollable:(0,_e.T5)({mode:l,maxHeight:r}),maxHeight:r},Ae?.map((g,x)=>f.createElement("div",{key:x,style:{padding:`${Te.spacing(1)} 0`}},g))),me)};var He=d(90708),st=d(73060),it=d(57875),ie=d(59809),re=d(88891);function Pe(e,s,a,o,t,l=n=>n){if(!e?.length)return{};(0,ye.Fm)(e);const n=s?.find(u=>u.name==="exemplar");if(n?.fields.forEach(u=>{u.getLinks=(0,He._M)(n,u,u.state?.scopedVars??{},l)}),a.calculate){if(U.$.featureToggles.transformationsVariableSupport){const u={...a,calculation:{xBuckets:{...a.calculation?.xBuckets},yBuckets:{...a.calculation?.yBuckets}}};return u.calculation?.xBuckets?.value&&l!==void 0&&(u.calculation.xBuckets.value=l(u.calculation.xBuckets.value)),u.calculation?.yBuckets?.value&&l!==void 0&&(u.calculation.yBuckets.value=l(u.calculation.yBuckets.value)),Me((0,S.VQ)(e,u.calculation??{}),n,u,o,t)}return Me((0,S.VQ)(e,a.calculation??{}),n,a,o,t)}let r;for(const u of e)switch(u.meta?.type){case J.m.HeatmapCells:return(0,S.Nb)(u)?Me(u,n,a,o,t):rt(u,n,a,o,t);case J.m.HeatmapRows:r=u}if(r==null)if(e.length>1)e.every(p=>!Number.isNaN((0,ie.L)(p.fields[1].state?.displayName)))&&e.sort(ie.Bm),r=(0,st.Fd)({frames:e,keepDisplayNames:!0});else{let u=e[0],p=u.fields.filter(v=>v.type===q.PU.number);p.every(v=>!Number.isNaN((0,ie.L)(v.state?.displayName)))?(p.sort((v,y)=>(0,ie.L)(v.state?.displayName)-(0,ie.L)(y.state?.displayName)),r={...u,fields:[u.fields.find(v=>v.type===q.PU.time),...p]}):r=u}return r.fields.forEach(u=>{(u.config.links?.length??0)!==0&&(u.getLinks=(0,He._M)(r,u,u.state?.scopedVars??{},l))}),{...Me((0,S.yJ)({unit:a.yAxis?.unit,decimals:a.yAxis?.decimals,...a.rowsFrame,frame:r}),n,a,o,t),series:r}}const rt=(e,s,a,o,t)=>{if(e.meta?.type!==J.m.HeatmapCells||(0,S.Nb)(e))return{warning:"Expected sparse heatmap format",heatmap:e};Ne(e.fields[1],a.yAxis,t);const l=e.fields[3],n=Ne(l,a.cellValues,t);let[r,u]=(0,re.g$)(l.values,a.color.min,a.color.max,a.filterValues?.le,a.filterValues?.ge);return{heatmap:e,heatmapColors:{palette:o,values:(0,re.O4)(l.values,o,r,u),minValue:r,maxValue:u},exemplars:s,display:p=>(0,ae.cN)(n(p))}},Me=(e,s,a,o,t)=>{if(e.meta?.type!==J.m.HeatmapCells)return{warning:"Expected heatmap scanlines format",heatmap:e};if(e.fields.length<2||e.length<2)return{heatmap:e};const l=(0,S.eE)(e);let n,r,u;for(const h of e.fields)switch(h.name){case"y":r=h.name;case"yMin":case"yMax":{r||(r=h.name),l.yOrdinalDisplay==null&&Ne(h,a.yAxis,t);break}case"x":case"xMin":case"xMax":n=h.name;break;default:h.type===q.PU.number&&!u&&(u=h)}if(!r)return{warning:"Missing Y field",heatmap:e};if(!r)return{warning:"Missing X field",heatmap:e};if(!u)return{warning:"Missing value field",heatmap:e};const p=Ne(u,a.cellValues,t),c=e.fields[0].values,v=e.fields[1].values,y=c.length;let P=y-v.lastIndexOf(v[0]),G=y/P,Y=v[1]-v[0],V=c[P]-c[0],[R,H]=(0,re.g$)(u.values,a.color.min,a.color.max,a.filterValues?.le,a.filterValues?.ge),C=a.calculation?.xBuckets,E=a.calculation?.yBuckets;return{heatmap:e,heatmapColors:{palette:o,values:(0,re.O4)(u.values,o,R,H),minValue:R,maxValue:H},exemplars:s?.length?s:void 0,xBucketSize:V,yBucketSize:Y,xBucketCount:G,yBucketCount:P,yLog:E?.scale?.log??0,xLog:C?.scale?.log??0,xLogSplit:C?.scale?.log?+(C?.value??"1"):1,yLogSplit:E?.scale?.log?+(E?.value??"1"):1,xLayout:n==="xMax"?i.D7.le:n==="xMin"?i.D7.ge:i.D7.unknown,yLayout:r==="yMax"?i.D7.le:r==="yMin"?i.D7.ge:i.D7.unknown,display:h=>(0,ae.cN)(p(h))}};function Ne(e,s,a){if(s?.unit?.length||s?.decimals!=null){const{unit:o,decimals:t}=s;e.display=void 0,e.config={...e.config},o?.length&&(e.config.unit=o),t!=null&&(e.config.decimals=t)}return e.display||(e.display=(0,it.J)({field:e,theme:a})),e.display}var Oe=d(21313),ct=d(37634),be=d(84140),m=d(52995);const ce=[{name:"BrBG",invert:"always"},{name:"PiYG",invert:"always"},{name:"PRGn",invert:"always"},{name:"PuOr",invert:"always"},{name:"RdBu",invert:"always"},{name:"RdGy",invert:"always"},{name:"RdYlBu",invert:"always"},{name:"RdYlGn",invert:"always"},{name:"Spectral",invert:"always"},{name:"Blues",invert:"dark"},{name:"Greens",invert:"dark"},{name:"Greys",invert:"dark"},{name:"Oranges",invert:"dark"},{name:"Purples",invert:"dark"},{name:"Reds",invert:"dark"},{name:"Turbo",invert:"light"},{name:"Cividis",invert:"light"},{name:"Viridis",invert:"light"},{name:"Magma",invert:"light"},{name:"Inferno",invert:"light"},{name:"Plasma",invert:"light"},{name:"Warm",invert:"light"},{name:"Cool",invert:"light"},{name:"Cubehelix",invert:"light",name2:"CubehelixDefault"},{name:"BuGn",invert:"dark"},{name:"BuPu",invert:"dark"},{name:"GnBu",invert:"dark"},{name:"OrRd",invert:"dark"},{name:"PuBuGn",invert:"dark"},{name:"PuBu",invert:"dark"},{name:"PuRd",invert:"dark"},{name:"RdPu",invert:"dark"},{name:"YlGnBu",invert:"dark"},{name:"YlGn",invert:"dark"},{name:"YlOrBr",invert:"dark"},{name:"YlOrRd",invert:"dark"},{name:"Rainbow",invert:"always"},{name:"Sinebow",invert:"always"}],ut=ce.find(e=>e.name==="Spectral");function Ce(e,s){const a={...m.KQ.color,...e},o=[],t=(a.steps??128)-1;if(e.mode===m.P7.Opacity){const l=(0,be.A)(s.visualization.getColorByName(e.fill)).toPercentageRgb(),n=a.scale===m.uM.Exponential?Oe.scalePow().exponent(a.exponent).domain([0,1]).range([0,1]):Oe.scaleLinear().domain([0,1]).range([0,1]);for(let r=0;r<=t;r++)l.a=n(r/t),o.push((0,be.A)(l).toString("hex8"))}else{const l=ce.find(u=>u.name===a.scheme)??ut;let n="interpolate"+(l.name2??l.name);const r=ct[n];for(let u=0;u<=t;u++){let p=r(u/t),c=p.indexOf("rgb")===0?"#"+[...p.matchAll(/\d+/g)].map(v=>(+v[0]).toString(16).padStart(2,"0")).join(""):p;o.push(c)}(l.invert==="always"||l.invert==="dark"&&s.isDark||l.invert==="light"&&s.isLight)&&o.reverse(),e.reverse&&o.reverse()}return o}const dt=({data:e,id:s,timeRange:a,timeZone:o,width:t,height:l,options:n,fieldConfig:r,eventBus:u,onChangeTimeRange:p,replaceVariables:c})=>{const v=(0,k.$j)(),y=(0,k.of)(mt),{sync:P,eventsScope:G,canAddAnnotations:Y,onSelectRange:V}=(0,K.d2)(),R=P?.()??_.y.Off,[H,C]=(0,f.useState)(null);let E=(0,f.useRef)(a);E.current=a;const W=(0,f.useMemo)(()=>Ce(n.color,v),[n.color,v]),h=(0,f.useMemo)(()=>{try{return Pe(e.series,e.annotations,n,W,v,c)}catch(F){return{warning:`${F}`}}},[e.series,e.annotations,n,W,v,c]),O=(0,f.useMemo)(()=>{let F=[],D=[];const z=(0,S.eE)(h.heatmap);return h.exemplars?.length&&(F=h.exemplars?.fields[0].values,z.yMatchWithLabel&&z.yOrdinalDisplay!=null?D=(h.exemplars?.fields.find(X=>X.name===z.yMatchWithLabel).values).map(X=>z.yOrdinalLabel?.indexOf(X)):D=h.exemplars?.fields[1].values),[null,h.heatmap?.fields.map(te=>te.values),[F,D]]},[h.heatmap,h.exemplars]),A=(0,f.useRef)(h);A.current=h;const L=(0,f.useMemo)(()=>{const F=A.current?.heatmap?.fields[1].config?.custom?.scaleDistribution;return(0,re.Mv)({dataRef:A,theme:v,timeZone:o,getTimeRange:()=>E.current,cellGap:n.cellGap,hideLE:n.filterValues?.le,hideGE:n.filterValues?.ge,exemplarColor:n.exemplars?.color??"rgba(255,0,255,0.7)",yAxisConfig:n.yAxis,ySizeDivisor:F?.type===i.L4.Log?+(n.calculation?.yBuckets?.value||1):1,selectionMode:n.selectionMode})},[n,o,e.structureRev,R]),le=()=>!h.heatmap||!n.legend.show?null:f.createElement(Q.KU.Legend,{placement:"bottom",maxHeight:"20%"},f.createElement("div",{className:y.colorScaleWrapper},f.createElement(w.w,{hoverValue:void 0,colorPalette:W,min:A.current.heatmapColors?.minValue,max:A.current.heatmapColors?.maxValue,display:h.display})));if(h.warning||!h.heatmap)return f.createElement(ee.a,{panelId:s,fieldConfig:r,data:e,needsNumberField:!0,message:h.warning});const ne=!!(Y&&Y());return f.createElement(f.Fragment,null,f.createElement(Q.KU,{width:t,height:l,legend:le()},(F,D)=>f.createElement(T.Z,{key:L.uid,config:L,data:O,width:F,height:D},R!==_.y.Off&&f.createElement(ve.K,{config:L,eventBus:u,frame:h.series??h.heatmap}),n.tooltip.mode!==i.$N.None&&f.createElement(se.xl,{config:L,hoverMode:n.tooltip.mode===i.$N.Single?se.b3.xOne:se.b3.xAll,queryZoom:p,onSelectRange:V,syncMode:R,syncScope:G,render:(z,te,Ee,X,ue,de,we)=>{if(ne&&de!=null){C(de),ue();return}const Z=()=>{let me=z.posToVal(z.cursor.left,"x");C({from:me,to:me}),ue()};return f.createElement(lt,{mode:we?i.$N.Multi:n.tooltip.mode,dataIdxs:te,seriesIdx:Ee,dataRef:A,isPinned:X,dismiss:ue,showHistogram:n.tooltip.yHistogram,showColorScale:n.tooltip.showColorScale,panelData:e,annotate:ne?Z:void 0,maxHeight:n.tooltip.maxHeight,maxWidth:n.tooltip.maxWidth})},maxWidth:n.tooltip.maxWidth}),f.createElement(I.W,{annotations:e.annotations??[],config:L,timeZone:o,newRange:H,setNewRange:C,canvasRegionRendering:!1}),f.createElement(Ve.U,{config:L,onChangeTimeRange:p}))))},mt=()=>({colorScaleWrapper:(0,b.css)({marginLeft:"25px",padding:"10px 0",maxWidth:"300px"})}),ft=e=>{if(Object.keys(e.options??{}).length===0)return Ke(e,"heatmap",{angular:e},e.fieldConfig);let s=e.options?.tooltip?.show;return s!==void 0&&(s===!0?e.options.tooltip.mode=i.$N.Single:s===!1&&(e.options.tooltip.mode=i.$N.None),delete e.options.tooltip?.show),e.options},Ke=(e,s,a,o)=>{if(s==="heatmap"&&a.angular){const{fieldConfig:t,options:l}=pt({...a.angular,fieldConfig:o});return e.fieldConfig=t,l}if(s==="heatmap-new"){const{bucketFrame:t,...l}=e.options;return t?{...l,rowsFrame:t}:e.options}return{}};function pt(e){const s={defaults:{},overrides:[]},a=e.dataFormat!=="tsbuckets",o={...m.KQ.calculation},t={logBase:1,...e.yAxis};a&&(e.xBucketSize?o.xBuckets={mode:i.J1.Size,value:`${e.xBucketSize}`}:e.xBucketNumber&&(o.xBuckets={mode:i.J1.Count,value:`${e.xBucketNumber}`}),e.yBucketSize?o.yBuckets={mode:i.J1.Size,value:`${e.yBucketSize}`}:e.xBucketNumber&&(o.yBuckets={mode:i.J1.Count,value:`${e.yBucketNumber}`}),t.logBase>1&&(o.yBuckets={mode:i.J1.Count,value:+t.splitFactor>0?`${t.splitFactor}`:void 0,scale:{type:i.L4.Log,log:t.logBase}}));const l=Be(e.cards?.cardPadding,2),n={calculate:a,calculation:o,color:{...m.KQ.color,steps:128},cellGap:l||1,cellRadius:Be(e.cards?.cardRound),yAxis:{axisPlacement:t.show===!1?i.vM.Hidden:i.vM.Left,reverse:!!e.reverseYBuckets,axisWidth:Be(t.width),min:t.min,max:t.max,unit:t.format,decimals:t.decimals},cellValues:{decimals:Be(e.tooltipDecimals)},rowsFrame:{layout:ht(e.yBucketBound)},legend:{show:!!e.legend?.show},showValue:i.yL.Never,tooltip:{mode:e.tooltip?.show?i.$N.Single:i.$N.None,yHistogram:!!e.tooltip?.showHistogram},exemplars:{...m.KQ.exemplars}};e.hideZeroBuckets&&(n.filterValues={...m.KQ.filterValues});const r=e.color??{};switch(r?.mode){case"spectrum":{n.color.mode=m.P7.Scheme;const u=r.colorScheme;let p=ce.find(c=>c.name===u);p||(p=ce.find(c=>u.indexOf(c.name)>=0)),n.color.scheme=p?p.name:m.KQ.color.scheme;break}case"opacity":{n.color.mode=m.P7.Opacity,n.color.scale=r.scale;break}}return n.color.fill=r.cardColor,n.color.min=r.min,n.color.max=r.max,typeof r.min=="number"&&typeof r.max=="number"&&r.min>r.max&&(n.color.min=r.max,n.color.max=r.min,n.color.reverse=!0),{fieldConfig:s,options:n}}function ht(e){switch(e){case"upper":return i.D7.ge;case"lower":return i.D7.le;case"middle":return i.D7.unknown}return i.D7.auto}function Be(e,s){if(e==null||e==="")return s;const a=+e;return isNaN(a)?s:a}class vt{getSuggestionsForData(s){const{dataSummary:a}=s;if(!s.data?.series||!a.hasData||a.timeFieldCount<1||a.numberFieldCount<2||a.numberFieldCount>10)return;const o=Ce(m.KQ.color,U.$.theme2),t=Pe(s.data.series,void 0,m.KQ,o,U.$.theme2);!t||t.warning||s.getListAppender({name:"",pluginId:"heatmap",options:{},fieldConfig:{defaults:{custom:{}},overrides:[]}})}}const gt=new N.m(dt).useFieldConfig({disableStandardOptions:Object.values(pe.uo).filter(e=>e!==pe.uo.Links),useCustomConfig:e=>{e.addCustomEditor({id:"scaleDistribution",path:"scaleDistribution",name:"Y axis scale",category:["Heatmap"],editor:he.W,override:he.W,defaultValue:{type:i.L4.Linear},shouldApply:s=>s.type===q.PU.number,process:De.hS,hideFromDefaults:!0}),(0,M.e)(e)}}).setPanelChangeHandler(Ke).setMigrationHandler(ft).setPanelOptions((e,s)=>{const a=s.options??m.KQ;let o=!1;if(s.data.length>0)try{const l=Ce(a.color,U.$.theme2),n=Pe(s.data,void 0,a,l,U.$.theme2);o=(0,S.eE)(n.heatmap).yOrdinalDisplay!=null}catch{}let t=["Heatmap"];e.addRadio({path:"calculate",name:"Calculate from data",defaultValue:m.KQ.calculate,category:t,settings:{options:[{label:"Yes",value:!0},{label:"No",value:!1}]}}),a.calculate&&(0,j.J)("calculation.",e,a.calculation,t),t=["Y Axis"],e.addRadio({path:"yAxis.axisPlacement",name:"Placement",defaultValue:m.KQ.yAxis.axisPlacement??i.vM.Left,category:t,settings:{options:[{label:"Left",value:i.vM.Left},{label:"Right",value:i.vM.Right},{label:"Hidden",value:i.vM.Hidden}]}}).addUnitPicker({category:t,path:"yAxis.unit",name:"Unit",defaultValue:void 0,settings:{isClearable:!0}}).addNumberInput({category:t,path:"yAxis.decimals",name:"Decimals",settings:{placeholder:"Auto"}}),o||e.addNumberInput({path:"yAxis.min",name:"Min value",settings:{placeholder:"Auto"},category:t}).addTextInput({path:"yAxis.max",name:"Max value",settings:{placeholder:"Auto"},category:t}),e.addNumberInput({path:"yAxis.axisWidth",name:"Axis width",defaultValue:m.KQ.yAxis.axisWidth,settings:{placeholder:"Auto",min:5},category:t}).addTextInput({path:"yAxis.axisLabel",name:"Axis label",defaultValue:m.KQ.yAxis.axisLabel,settings:{placeholder:"Auto"},category:t}),a.calculate||e.addRadio({path:"rowsFrame.layout",name:"Tick alignment",defaultValue:m.KQ.rowsFrame?.layout??i.D7.auto,category:t,settings:{options:[{label:"Auto",value:i.D7.auto},{label:"Top (LE)",value:i.D7.le},{label:"Middle",value:i.D7.unknown},{label:"Bottom (GE)",value:i.D7.ge}]}}),e.addBooleanSwitch({path:"yAxis.reverse",name:"Reverse",defaultValue:m.KQ.yAxis.reverse===!0,category:t}),t=["Colors"],e.addRadio({path:"color.mode",name:"Mode",defaultValue:m.KQ.color.mode,category:t,settings:{options:[{label:"Scheme",value:m.P7.Scheme},{label:"Opacity",value:m.P7.Opacity}]}}),e.addColorPicker({path:"color.fill",name:"Color",defaultValue:m.KQ.color.fill,category:t,showIf:l=>l.color.mode===m.P7.Opacity}),e.addRadio({path:"color.scale",name:"Scale",defaultValue:m.KQ.color.scale,category:t,settings:{options:[{label:"Exponential",value:m.uM.Exponential},{label:"Linear",value:m.uM.Linear}]},showIf:l=>l.color.mode===m.P7.Opacity}),e.addSliderInput({path:"color.exponent",name:"Exponent",defaultValue:m.KQ.color.exponent,category:t,settings:{min:.1,max:2,step:.1},showIf:l=>l.color.mode===m.P7.Opacity&&l.color.scale===m.uM.Exponential}),e.addSelect({path:"color.scheme",name:"Scheme",description:"",defaultValue:m.KQ.color.scheme,category:t,settings:{options:ce.map(l=>({value:l.name,label:l.name}))},showIf:l=>l.color.mode!==m.P7.Opacity}),e.addSliderInput({path:"color.steps",name:"Steps",defaultValue:m.KQ.color.steps,category:t,settings:{min:2,max:128,step:1}}).addBooleanSwitch({path:"color.reverse",name:"Reverse",defaultValue:m.KQ.color.reverse,category:t}).addCustomEditor({id:"__scale__",path:"__scale__",name:"",category:t,editor:()=>{const l=Ce(a.color,U.$.theme2);return f.createElement("div",null,f.createElement(w.w,{colorPalette:l,min:1,max:100}))}}),e.addNumberInput({path:"color.min",name:"Start color scale from value",defaultValue:m.KQ.color.min,settings:{placeholder:"Auto (min)"},category:t}).addNumberInput({path:"color.max",name:"End color scale at value",defaultValue:m.KQ.color.max,settings:{placeholder:"Auto (max)"},category:t}),t=["Cell display"],a.calculate||e.addTextInput({path:"rowsFrame.value",name:"Value name",defaultValue:m.KQ.rowsFrame?.value,settings:{placeholder:"Value"},category:t}),e.addUnitPicker({category:t,path:"cellValues.unit",name:"Unit",defaultValue:void 0,settings:{isClearable:!0}}).addNumberInput({category:t,path:"cellValues.decimals",name:"Decimals",settings:{placeholder:"Auto"}}),e.addSliderInput({name:"Cell gap",path:"cellGap",defaultValue:m.KQ.cellGap,category:t,settings:{min:0,max:25}}).addNumberInput({path:"filterValues.le",name:"Hide cells with values <=",defaultValue:m.KQ.filterValues?.le,settings:{placeholder:"None"},category:t}).addNumberInput({path:"filterValues.ge",name:"Hide cells with values >=",defaultValue:m.KQ.filterValues?.ge,settings:{placeholder:"None"},category:t}),t=["Tooltip"],e.addRadio({path:"tooltip.mode",name:"Tooltip mode",category:t,defaultValue:i.$N.Single,settings:{options:[{value:i.$N.Single,label:"Single"},{value:i.$N.Multi,label:"All"},{value:i.$N.None,label:"Hidden"}]}}),e.addBooleanSwitch({path:"tooltip.yHistogram",name:"Show histogram (Y axis)",defaultValue:m.KQ.tooltip.yHistogram,category:t,showIf:l=>l.tooltip.mode===i.$N.Single}),e.addBooleanSwitch({path:"tooltip.showColorScale",name:"Show color scale",defaultValue:m.KQ.tooltip.showColorScale,category:t,showIf:l=>l.tooltip.mode===i.$N.Single}),e.addNumberInput({path:"tooltip.maxWidth",name:"Max width",category:t,settings:{integer:!0}}),e.addNumberInput({path:"tooltip.maxHeight",name:"Max height",category:t,defaultValue:void 0,settings:{integer:!0},showIf:l=>l.tooltip?.mode===i.$N.Multi}),t=["Legend"],e.addBooleanSwitch({path:"legend.show",name:"Show legend",defaultValue:m.KQ.legend.show,category:t}),t=["Exemplars"],e.addColorPicker({path:"exemplars.color",name:"Color",defaultValue:m.KQ.exemplars.color,category:t})}).setSuggestionsSupplier(new vt).setDataSupport({annotations:!0})}}]);

//# sourceMappingURL=heatmapPanel.03a3c3fbd7dbd67f72f9.js.map