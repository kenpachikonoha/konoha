"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3726],{13726:(X,I,t)=>{t.r(I),t.d(I,{ActiveTab:()=>ge,ContactPoint:()=>Ae,ContactPointReceiverSummary:()=>Pe,ContactPointReceiverTitleRow:()=>Se,default:()=>it});var u=t(32196),M=t(53076),R=t(2543),T=t(55127),$=t.n(T),e=t(96540),G=t(42941),N=t(47232),B=t(42418),P=t(67061),z=t(63021),F=t(40675),V=t(40980),W=t(39558),A=t(55852),a=t(94753),c=t(19384),g=t(40845),v=t(38138),C=t(56034),S=t(72109),x=t(83122),l=t(14578),y=t(23896),p=t(39964);const L={pagerduty:"PagerDuty",pushover:"Pushover",slack:"Slack",opsgenie:"OpsGenie",webhook:"Webhook",victorops:"VictorOps",wechat:"WeChat",discord:"Discord",webex:"Cisco Webex Teams",sns:"Amazon SNS",telegram:"Telegram",msteams:"Microsoft Teams"};var m=t(19073),w=t(98439),Q=t(70383),J=t(19645),te=t(57220),k=t(3704),ne=t(57895),D=t(55196),H=t(90141),ie=t(48205),ae=t(26058),fe=t(79938),Ee=t(16293),ve=t(76648),he=t(84029);const Le=({receiverName:n,decrypt:o,exportFormat:r,onClose:i})=>{const{currentData:s="",isFetching:d}=fe.hK.useExportReceiverQuery({receiverName:n,decrypt:o,format:r}),h=`cp-${n}-${new Date().getTime()}`;return d?e.createElement(W._,{text:"Loading...."}):e.createElement(Ee.J,{format:r,textDefinition:s,downloadFileName:h,onClose:i})},De=({onClose:n,receiverName:o,decrypt:r})=>{const[i,s]=(0,e.useState)("yaml");return e.createElement(ve.m,{activeTab:i,onTabChange:s,onClose:n,formatProviders:Object.values(he.sl)},e.createElement(Le,{receiverName:o,decrypt:r,exportFormat:i,onClose:n}))},Ie=({decrypt:n,exportFormat:o,onClose:r})=>{const{currentData:i="",isFetching:s}=fe.hK.useExportReceiversQuery({decrypt:n,format:o}),d=`contact-points-${new Date().getTime()}`;return s?e.createElement(W._,{text:"Loading...."}):e.createElement(Ee.J,{format:o,textDefinition:i,downloadFileName:d,onClose:r})},Me=({onClose:n,decrypt:o})=>{const[r,i]=(0,e.useState)("yaml");return e.createElement(ve.m,{activeTab:r,onTabChange:i,onClose:n,formatProviders:Object.values(he.sl)},e.createElement(Ie,{decrypt:o,exportFormat:r,onClose:n}))},xe=({metadata:{icon:n,title:o,externalUrl:r,warning:i}})=>{const s=(0,g.of)(Oe);return e.createElement(P.B,{alignItems:"center",gap:.5},e.createElement(P.B,{direction:"row",alignItems:"center",gap:.5},i?e.createElement(C.m,{content:i,theme:"error"},e.createElement(l.I,{name:"exclamation-triangle",className:s.warnIcon})):e.createElement("img",{src:n,alt:o,height:"16px"}),e.createElement("span",null,o)),r&&e.createElement(A.z9,{icon:"external-link-alt",href:r,target:"_blank",variant:"secondary",size:"sm"}))},Oe=n=>({warnIcon:(0,u.css)({fill:n.colors.warning.text})});var Ne=t(51488),Be=t(96374),Fe=t(31678),oe=t(64853),We=t(23770),Ue=t(4554),le=t(56361),Ke=t(64047),$e=t(84396),se=t(72275),Ge=t(96615);const Ve=({config:n,alertManagerName:o})=>{const r=(0,Fe.useDispatch)(),[i,s]=(0,e.useState)({}),d=(0,g.of)(Ue.L),h=(0,e.useMemo)(()=>Object.entries(n.template_files).map(([U,O])=>({name:U,template:O,provenance:(n.template_file_provenances??{})[U]})),[n]),[f,E]=(0,e.useState)(),K=()=>{f&&r((0,We.EY)(f,o)),E(void 0)};return e.createElement(e.Fragment,null,e.createElement("table",{className:d.table,"data-testid":"templates-table"},e.createElement("colgroup",null,e.createElement("col",{className:d.colExpand}),e.createElement("col",null),e.createElement("col",null)),e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Template"),e.createElement(oe._,{actions:[m.QI.CreateNotificationTemplate,m.QI.UpdateNotificationTemplate,m.QI.DeleteNotificationTemplate]},e.createElement("th",null,"Actions")))),e.createElement("tbody",null,!h.length&&e.createElement("tr",{className:d.evenRow},e.createElement("td",{colSpan:3},"No templates defined.")),h.map(({name:b,template:U,provenance:O},j)=>{const Y=!!i[b];return e.createElement(e.Fragment,{key:b},e.createElement("tr",{key:b,className:j%2===0?d.evenRow:void 0},e.createElement("td",null,e.createElement(Ke.e,{isCollapsed:!i[b],onToggle:()=>s({...i,[b]:!Y})})),e.createElement("td",null,b," ",O&&e.createElement(ie.rS,null)),e.createElement("td",{className:d.actionsCell},O&&e.createElement(se.M,{to:(0,le.nL)(`/alerting/notifications/templates/${encodeURIComponent(b)}/edit`,o),tooltip:"view template",icon:"file-alt"}),!O&&e.createElement(oe._,{actions:[m.QI.UpdateNotificationTemplate]},e.createElement(se.M,{to:(0,le.nL)(`/alerting/notifications/templates/${encodeURIComponent(b)}/edit`,o),tooltip:"edit template",icon:"pen"})),e.createElement(oe._,{actions:[m.QI.CreateContactPoint]},e.createElement(se.M,{to:(0,le.nL)(`/alerting/notifications/templates/${encodeURIComponent(b)}/duplicate`,o),tooltip:"Copy template",icon:"copy"})),!O&&e.createElement(oe._,{actions:[m.QI.DeleteNotificationTemplate]},e.createElement(se.M,{onClick:()=>E(b),tooltip:"delete template",icon:"trash-alt"})))),Y&&e.createElement("tr",{className:j%2===0?d.evenRow:void 0},e.createElement("td",null),e.createElement("td",{colSpan:2},e.createElement($e.X,{label:"Description",horizontal:!0},e.createElement(Ge.K,{width:"auto",height:"auto",autoHeight:!0,value:U,showLineNumbers:!1,monacoOptions:{readOnly:!0,scrollBeyondLastLine:!1}})))))}))),!!f&&e.createElement(Be.u,{isOpen:!0,title:"Delete template",body:`Are you sure you want to delete template "${f}"?`,confirmText:"Yes, delete",onConfirm:K,onDismiss:()=>E(void 0)}))},we=()=>{const{selectedAlertmanager:n}=(0,Q.VI)(),{data:o,error:r}=(0,Ne.f)(n);return r?e.createElement(B.F,{title:"Failed to fetch notification templates"},String(r)):o?e.createElement(Ve,{config:o,alertManagerName:n}):null};var ze=t(40996),Qe=t(46819),He=t(88575),je=t(10354);const Ye=()=>{const n=(0,g.of)(Xe),[o,r]=(0,p.l)(),i=o.get("search")??"",[s,d]=(0,e.useState)(i),[h,f]=(0,ze.A)(()=>{r({search:s},!0)},300,[r,s]),E=(0,e.useCallback)(()=>{f(),d(""),r({search:""},!0)},[f,r]),K=!!i;return e.createElement(Qe.B,{direction:"row",alignItems:"end",gap:.5},e.createElement(He.D,{className:n.noBottom,label:"Search by name or type"},e.createElement(je.p,{"aria-label":"search contact points",placeholder:"Search",width:46,prefix:e.createElement(l.I,{name:"search"}),onChange:b=>{d(b.currentTarget.value)},value:s})),e.createElement(A.$n,{variant:"secondary",icon:"times",onClick:()=>E(),disabled:!K,"aria-label":"clear"},"Clear"))},Xe=()=>({noBottom:(0,u.css)({marginBottom:0})}),Je=({alertManagerName:n})=>{const o=(0,te.AL)(n);return e.createElement(oe._,{actions:[m.QI.UpdateExternalConfiguration]},e.createElement(B.F,{severity:"info",title:"Global config for contact points"},e.createElement("p",null,"For each external Alertmanager you can define global settings, like server addresses, usernames and password, for all the supported contact points."),e.createElement(A.z9,{href:(0,le.nL)("alerting/notifications/global-config",n),variant:"secondary"},o?"View global config":"Edit global config")))};var ue=t(37390);const ke=(n,o)=>{const[r,i]=(0,e.useState)(!1),[s,d]=(0,e.useState)(),[h,f]=(0,e.useState)(),E=(0,e.useCallback)(()=>{o||(d(void 0),i(!1),f(void 0))},[o]),K=(0,e.useCallback)(O=>{d(O),i(!0),f(void 0)},[]),b=(0,e.useCallback)(()=>{s&&n(s).then(()=>i(!1)).catch(f)},[n,s]);return[(0,e.useMemo)(()=>h?e.createElement(Ze,{isOpen:r,onDismiss:E,error:h}):e.createElement(ue.a,{isOpen:r,onDismiss:E,closeOnBackdropClick:!o,closeOnEscape:!o,title:"Delete contact point"},e.createElement("p",null,"Deleting this contact point will permanently remove it."),e.createElement("p",null,"Are you sure you want to delete this contact point?"),e.createElement(ue.a.ButtonRow,null,e.createElement(A.$n,{type:"button",variant:"destructive",onClick:b,disabled:o},o?"Deleting...":"Yes, delete contact point"),e.createElement(A.$n,{type:"button",variant:"secondary",onClick:E,disabled:o},"Cancel"))),[h,E,b,o,r]),K,E]},Ze=({isOpen:n,onDismiss:o,error:r})=>e.createElement(ue.a,{isOpen:n,onDismiss:o,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Something went wrong"},e.createElement("p",null,"Failed to update your configuration:"),e.createElement("p",null,e.createElement("pre",null,e.createElement("code",null,(0,le.JZ)(r)))));var qe=t(39938);const _e=()=>e.createElement(qe.E,{text:"Unused","aria-label":"unused",color:"orange",icon:"exclamation-triangle",tooltip:"This contact point is not used in any notification policy"});var Z=t(79381),Ce=t(77141),ge=(n=>(n.ContactPoints="contact_points",n.NotificationTemplates="templates",n))(ge||{});const ye=10,et=()=>{const[n,o]=(0,p.l)();return[(0,e.useMemo)(()=>{const s=n.get("tab");return!s||!Object.values(ge).map(String).includes(s)?"contact_points":s||"contact_points"},[n]),s=>o({tab:s})]},tt=()=>{const{selectedAlertmanager:n}=(0,Q.VI)(),[o]=(0,p.l)(),[r,i]=et();let{isLoading:s,error:d,contactPoints:h}=(0,Z.dK)();const{deleteTrigger:f,updateAlertmanagerState:E}=(0,Z.$x)(n),[K,b]=(0,m.L7)(m.QI.CreateContactPoint),[U,O]=(0,m.L7)(m.QI.ExportContactPoint),[j,Y]=(0,m.L7)(m.QI.CreateNotificationTemplate),[re,de]=ke(f,E.isLoading),[pe,_]=Te(),me=o.get("search"),q=r==="contact_points",ee=r==="templates";if(d)return e.createElement(B.F,{title:"Failed to fetch contact points"},d.message);const st=n===te.hY;return e.createElement(e.Fragment,null,e.createElement(ne.M,{currentAlertmanager:n}),e.createElement(P.B,{direction:"column"},e.createElement(z.U,null,e.createElement(F.o,{label:"Contact Points",active:q,counter:h.length,onChangeTab:()=>i("contact_points")}),e.createElement(F.o,{label:"Notification Templates",active:ee,onChangeTab:()=>i("templates")})),e.createElement(V.J,null,e.createElement(P.B,{direction:"column"},e.createElement(e.Fragment,null,s&&e.createElement(W._,{text:"Loading..."}),q&&e.createElement(e.Fragment,null,d?e.createElement(B.F,{title:"Failed to fetch contact points"},String(d)):e.createElement(e.Fragment,null,e.createElement(P.B,{direction:"row",alignItems:"end"},e.createElement(Ye,null),e.createElement(ae.h,null),e.createElement(P.B,{direction:"row",gap:1},K&&e.createElement(A.z9,{icon:"plus","aria-label":"add contact point",variant:"primary",href:"/alerting/notifications/receivers/new",disabled:!b},"Add contact point"),U&&e.createElement(A.$n,{icon:"download-alt",variant:"secondary","aria-label":"export all",disabled:!O,onClick:()=>_(Re)},"Export all"))),e.createElement(nt,{contactPoints:h,search:me,pageSize:ye,onDelete:ct=>de(ct),disabled:E.isLoading}),!st&&e.createElement(Je,{alertManagerName:n}))),ee&&e.createElement(e.Fragment,null,e.createElement(P.B,{direction:"row",alignItems:"center"},e.createElement(a.E,{variant:"body",color:"secondary"},"Create notification templates to customize your notifications."),e.createElement(ae.h,null),j&&e.createElement(A.z9,{icon:"plus",variant:"primary",href:"/alerting/notifications/templates/new",disabled:!Y},"Add notification template")),e.createElement(we,null)))))),re,pe)},nt=({contactPoints:n,disabled:o=!1,search:r,pageSize:i=ye,onDelete:s})=>{const d=at(n,r),{page:h,pageItems:f,numberOfPages:E,onPageChange:K}=(0,w.W)(d,1,i);return e.createElement(e.Fragment,null,f.map((b,U)=>{const O=(0,Ce.NY)(b),j=b.policies??[],Y=`${b.name}-${U}`;return e.createElement(Ae,{key:Y,name:b.name,disabled:o,onDelete:s,receivers:b.grafana_managed_receiver_configs,provisioned:O,policies:j})}),e.createElement(c.d,{currentPage:h,numberOfPages:E,onNavigate:K,hideWhenSinglePage:!0}))},be=new M.A({intraMode:1,intraIns:1,intraSub:1,intraDel:1,intraTrn:1});function at(n,o){const r=(0,e.useMemo)(()=>n.map(f=>f.name),[n]),i=(0,e.useMemo)(()=>n.map(f=>f.grafana_managed_receiver_configs.map(E=>E[Z.MX].name).join(" ")),[n]);if(!o)return n;const s=be.filter(r,o)??[],d=be.filter(i,o)??[],h=[...s,...d];return(0,R.uniq)(h).map(f=>n[f])??[]}const Ae=({name:n,disabled:o=!1,provisioned:r=!1,receivers:i,policies:s=[],onDelete:d})=>{const h=(0,g.of)(ce),f=i.some(E=>!!E[Z.v4]);return e.createElement("div",{className:h.contactPointWrapper,"data-testid":"contact-point"},e.createElement(P.B,{direction:"column",gap:0},e.createElement(ot,{name:n,policies:s,provisioned:r,disabled:o,onDelete:d}),f?e.createElement("div",null,i.map((E,K)=>{const b=E[Z.v4],U=E[Z.MX],O=!E.disableResolveMessage,j=E[Z.sW],Y=U.name+K;return e.createElement(lt,{key:Y,name:U.name,type:E.type,description:(0,Ce.aM)(E),diagnostics:b,pluginMetadata:j,sendingResolved:O})})):e.createElement("div",{className:h.integrationWrapper},e.createElement(Pe,{receivers:i}))))},ot=n=>{const{name:o,disabled:r=!1,provisioned:i=!1,policies:s=[],onDelete:d}=n,h=(0,g.of)(ce),[f,E]=(0,m.L7)(m.QI.ExportContactPoint),[K,b]=(0,m.L7)(m.QI.UpdateContactPoint),[U,O]=(0,m.L7)(m.QI.UpdateContactPoint),[j,Y]=Te(),re=s.length,de=re>0,pe=s.some(ee=>ee.route.type!=="auto-generated"),_=K&&b&&!i,me=U&&O&&!i&&!pe,q=[];return f&&q.push(e.createElement(e.Fragment,{key:"export-contact-point"},e.createElement(v.W.Item,{icon:"download-alt",label:"Export",ariaLabel:"export",disabled:!E,"data-testid":"export",onClick:()=>Y(o)}),e.createElement(v.W.Divider,null))),U&&q.push(e.createElement(y.A,{key:"delete-contact-point",shouldWrap:!me,wrap:ee=>e.createElement(C.m,{content:"Contact point is currently in use by one or more notification policies",placement:"top"},e.createElement("span",null,ee))},e.createElement(v.W.Item,{label:"Delete",ariaLabel:"delete",icon:"trash-alt",destructive:!0,disabled:r||!me,onClick:()=>d(o)}))),e.createElement("div",{className:h.headerWrapper},e.createElement(P.B,{direction:"row",alignItems:"center",gap:1},e.createElement(P.B,{alignItems:"center",gap:1},e.createElement(a.E,{element:"h2",variant:"body",weight:"medium"},o)),de&&e.createElement(a.E,{variant:"bodySmall",color:"secondary"},"is used by"," ",e.createElement(S.Y,{href:(0,k.c)("/alerting/routes",{contactPoint:o}),variant:"bodySmall",color:"primary",inline:!1},`${re} ${$()("notification policy",re)}`)),i&&e.createElement(ie.rS,null),!de&&e.createElement(_e,null),e.createElement(ae.h,null),e.createElement(A.z9,{tooltipPlacement:"top",tooltip:i?"Provisioned contact points cannot be edited in the UI":void 0,variant:"secondary",size:"sm",icon:_?"pen":"eye",type:"button",disabled:r,"aria-label":`${_?"edit":"view"}-action`,"data-testid":`${_?"edit":"view"}-action`,href:`/alerting/notifications/receivers/${encodeURIComponent(o)}/edit`},_?"Edit":"View"),q.length>0&&e.createElement(x.m,{overlay:e.createElement(v.W,null,q)},e.createElement(H.A,null))),j)},lt=n=>{const{name:o,type:r,description:i,diagnostics:s,pluginMetadata:d,sendingResolved:h=!0}=n,f=(0,g.of)(ce),E=s!==void 0;return e.createElement("div",{className:f.integrationWrapper},e.createElement(P.B,{direction:"column",gap:.5},e.createElement(Se,{name:o,type:r,description:i,pluginMetadata:d}),E&&e.createElement(rt,{diagnostics:s,sendingResolved:h})))};function Se(n){const{name:o,type:r,description:i,pluginMetadata:s}=n,d=J.M[r];return e.createElement(P.B,{direction:"row",alignItems:"center",gap:1},e.createElement(P.B,{direction:"row",alignItems:"center",gap:.5},d&&e.createElement(l.I,{name:d}),s?e.createElement(xe,{metadata:s}):e.createElement(a.E,{variant:"body",color:"primary"},o)),i&&e.createElement(a.E,{variant:"bodySmall",color:"secondary"},i))}const Pe=({receivers:n})=>{const o=(0,R.groupBy)(n,r=>r.type);return e.createElement(P.B,{direction:"column",gap:0},e.createElement(P.B,{direction:"row",alignItems:"center",gap:1},Object.entries(o).map(([r,i],s)=>{const d=J.M[r],h=L[r]??(0,R.upperFirst)(r),f=(0,R.size)(o)-1===s;return e.createElement(e.Fragment,{key:r},e.createElement(P.B,{direction:"row",alignItems:"center",gap:.5},d&&e.createElement(l.I,{name:d}),e.createElement(a.E,{variant:"body"},h,i.length>1&&e.createElement(e.Fragment,null," (",i.length,")"))),!f&&"\u22C5")})))},rt=({diagnostics:n,sendingResolved:o})=>{const r=(0,g.of)(ce),i=!!n.lastNotifyAttemptError,s=(0,N.KQ)(n.lastNotifyAttempt),d=n.lastNotifyAttemptDuration,h=s.isValid();return e.createElement("div",{className:r.metadataRow},e.createElement(P.B,{direction:"row",gap:1},i?e.createElement(e.Fragment,null,e.createElement(D.P,{color:"error",icon:"exclamation-circle"},e.createElement(C.m,{content:n.lastNotifyAttemptError},e.createElement("span",null,"Last delivery attempt failed")))):e.createElement(e.Fragment,null,h&&e.createElement(e.Fragment,null,e.createElement(D.P,{icon:"clock-nine"},"Last delivery attempt"," ",e.createElement(C.m,{content:s.toLocaleString()},e.createElement("span",null,e.createElement(a.E,{color:"primary"},s.locale("en").fromNow())))),e.createElement(D.P,{icon:"stopwatch"},"took ",e.createElement(a.E,{color:"primary"},d))),!h&&e.createElement(D.P,{icon:"clock-nine"},"No delivery attempts"),!o&&e.createElement(D.P,{icon:"info-circle"},"Delivering ",e.createElement(a.E,{color:"primary"},"only firing")," notifications"))))},Re=Symbol("all contact points"),Te=()=>{const[n,o]=(0,e.useState)(null),[r,i]=(0,G.A)(!1),[s,d]=(0,m.L7)(m.QI.DecryptSecrets),h=s&&d,f=(0,e.useCallback)(()=>{o(null),i(!1)},[i]),E=b=>{o(b),i(!0)};return[(0,e.useMemo)(()=>!n||!r?null:n===Re?e.createElement(Me,{decrypt:h,onClose:f}):e.createElement(De,{receiverName:n,decrypt:h,onClose:f}),[h,r,f,n]),E]},ce=n=>({contactPointWrapper:(0,u.css)({borderRadius:`${n.shape.radius.default}`,border:`solid 1px ${n.colors.border.weak}`,borderBottom:"none"}),integrationWrapper:(0,u.css)({position:"relative",background:`${n.colors.background.primary}`,padding:`${n.spacing(1)} ${n.spacing(1.5)}`,borderBottom:`solid 1px ${n.colors.border.weak}`}),headerWrapper:(0,u.css)({background:`${n.colors.background.secondary}`,padding:`${n.spacing(1)} ${n.spacing(1.5)}`,borderBottom:`solid 1px ${n.colors.border.weak}`,borderTopLeftRadius:`${n.shape.radius.default}`,borderTopRightRadius:`${n.shape.radius.default}`}),metadataRow:(0,u.css)({borderBottomLeftRadius:`${n.shape.radius.default}`,borderBottomRightRadius:`${n.shape.radius.default}`})}),it=tt},79381:(X,I,t)=>{t.d(I,{$x:()=>a,MX:()=>z,dK:()=>A,sW:()=>F,v4:()=>P});var u=t(1932),M=t(2543),R=t.n(M),T=t(82843),$=t(26423),e=t(12210),G=t(70383),N=t(99494),B=t(77141);const P=Symbol("receiver_status"),z=Symbol("receiver_metadata"),F=Symbol("receiver_plugin_metadata"),W={includePoliciesCount:!0,receiverStatusPollingInterval:10*1e3};function A({includePoliciesCount:c,receiverStatusPollingInterval:g}=W){const{selectedAlertmanager:v,isGrafanaAlertmanager:C}=(0,G.VI)(),{installed:S,loading:x}=(0,e._)(N.W.OnCall),l=T.m.endpoints.getContactPointsStatus.useQuery(void 0,{refetchOnFocus:!0,refetchOnReconnect:!0,pollingInterval:g,skip:!C}),y=T.m.endpoints.grafanaNotifiers.useQuery(void 0,{skip:!C}),{data:p,isLoading:L}=$.WG.endpoints.grafanaOnCallIntegrations.useQuery(void 0,{skip:!S||!C});let m;S?m=p??[]:S===!1&&(m=null);const w=T.m.endpoints.getAlertmanagerConfiguration.useQuery(v,{refetchOnFocus:!0,refetchOnReconnect:!0,selectFromResult:D=>({...D,contactPoints:D.data?(0,B.Rm)(l.data,y.data,m,D.data.alertmanager_config.receivers??[],D.data):[]}),skip:!c}),Q=T.m.endpoints.getContactPointsList.useQuery(void 0,{refetchOnFocus:!0,refetchOnReconnect:!0,selectFromResult:D=>({...D,contactPoints:D.data?(0,B.Rm)(l.data,y.data,m,D.data,void 0):[]}),skip:c||!C}),J=w.error||Q.error||l.error,te=w.isLoading||Q.isLoading||l.isLoading||x||L,ne=(c?w.contactPoints:Q.contactPoints).sort((D,H)=>D.name.localeCompare(H.name));return{error:J,isLoading:te,contactPoints:ne,refetchReceivers:Q.refetch}}function a(c){const[g]=T.m.endpoints.getAlertmanagerConfiguration.useLazyQuery(),[v,C]=T.m.endpoints.updateAlertmanagerConfiguration.useMutation();return{deleteTrigger:x=>g(c).then(({data:l})=>{if(!l)return;const y=(0,u.jM)(l,p=>((0,M.remove)(p?.alertmanager_config?.receivers??[],L=>L.name===x),p));return v({selectedAlertmanager:c,config:y}).unwrap()}),updateAlertmanagerState:C}}},77141:(X,I,t)=>{t.d(I,{Rm:()=>v,aM:()=>c,NY:()=>a});var u=t(2543),M=t(32264),R=t(60021),T=t(79581);function $(l){return"grafana_managed_receiver_configs"in l?l.grafana_managed_receiver_configs??[]:Object.entries(l).filter(([p])=>p!=="grafana_managed_receiver_configs"&&p.endsWith("_configs")).filter(([p,L])=>Array.isArray(L)&&!(0,u.isEmpty)(L)).reduce((p,[L,m])=>{const w=L.replace("_configs",""),Q=(0,u.times)(m.length,()=>({name:l.name,type:w,settings:[],disableResolveMessage:!1}));return p.concat(Q)},[])}var e=t(37534),G=t(99494),N=t(76156),B=t(86768);const F={title:"Grafana OnCall",icon:B.K[G.W.OnCall]};function V(l,y,p=!0){if(!p||l===void 0)return F;if(l==null)return{...F,warning:"Grafana OnCall is not installed or is disabled"};const L=l.find(m=>m.integration_url===y.settings?.url);return{...F,description:L?.display_name,externalUrl:L?(0,N.h)(G.W.OnCall,`/integrations/${L.value}`):void 0,warning:L?void 0:"OnCall Integration no longer exists"}}var W=t(79381);const A="__grafana_receiver__";function a(l){return!!l.grafana_managed_receiver_configs?.find(p=>p.provenance)?.provenance}function c(l){if(l.settings)switch(l.type){case"email":return"addresses"in l.settings?g(l.settings.addresses):void 0;case"slack":{const y=l.settings.recipient;return y?`#${y.replace(/^#/,"")}`:void 0}case"kafka":return l.settings.kafkaTopic;case"webhook":return l.settings.url;case e.J4.OnCall:return l[W.sW]?.description;default:return l[W.MX]?.description}}function g(l){const p=/,|;|\n+/g,L=l.trim().split(p).map(u.trim),m=(0,u.take)(L,3),w=(0,u.difference)(L,m);return w.length&&m.push(`+${w.length} more`),m.join(", ")}function v(l=[],y=[],p,L,m){const w=(0,T._I)(m?.alertmanager_config?.route??{}),Q=S(w),J=(0,u.groupBy)(Q,"receiver");return(m?m?.alertmanager_config.receivers??[]:L??[]).map(k=>{const ne=$(k),D=l.find(H=>H.name===k.name);return{...k,policies:m&&J&&(J[k.name]??[]),grafana_managed_receiver_configs:ne.map((H,ie)=>{const ae=H.type===e.J4.OnCall;return{...H,[W.v4]:D?.integrations[ie],[W.MX]:x(y,H),[W.sW]:ae?V(p,H,!!m):void 0}})}})}function C(l){return!(M.$.featureToggles.alertingSimplifiedRouting??!1)||!l.object_matchers?!1:l.object_matchers.some(p=>p[0]===A&&p[1]===R.ho.equal)??!1}function S(l){const y=l.routes?.flatMap(p=>S(p))??[];return l.receiver?[{receiver:l.receiver,route:{type:C(l)?"auto-generated":"normal"}},...y]:y}function x(l,y){const p=l.find(L=>L.type===y.type);return{name:p?.name??(0,u.upperFirst)(y.type),description:p?.description}}},96615:(X,I,t)=>{t.d(I,{K:()=>A});var u=t(96540),M=t(32372),R=t(2543),T=t(83225);function $(a){const c=a.languages.CompletionItemKind.Function;return[{label:T.AlertmanagerTemplateFunction.toUpper,detail:"function(s string)",kind:c},{label:T.AlertmanagerTemplateFunction.toLower,detail:"function(s string)",kind:c},{label:T.AlertmanagerTemplateFunction.title,documentation:"Capitalizes the first letter of each word",detail:"function(s string)",kind:c},{label:T.AlertmanagerTemplateFunction.join,documentation:{value:"Joins an array of strings using the separator provided."},detail:"function(separator string, s []string)",kind:c},{label:T.AlertmanagerTemplateFunction.match,detail:"function",kind:c},{label:T.AlertmanagerTemplateFunction.safeHtml,detail:"function(pattern, repl, text)",kind:c},{label:T.AlertmanagerTemplateFunction.reReplaceAll,detail:"function(pattern, repl, text)",kind:c},{label:T.AlertmanagerTemplateFunction.stringSlice,detail:"function(s ...string)",kind:c}]}var e=t(57954);function G(a){const c={triggerCharacters:["."],provideCompletionItems(g,v,C){const S=g.getWordUntilPosition(v),x={startLineNumber:v.lineNumber,endLineNumber:v.lineNumber,startColumn:S.startColumn,endColumn:S.endColumn},l=new B(a,x);if(!N(g,v))return l.getSnippetsSuggestions();if(C.triggerKind===a.languages.CompletionTriggerKind.Invoke&&!C.triggerCharacter)return l.getFunctionsSuggestions();const p=g.getWordUntilPosition({lineNumber:v.lineNumber,column:v.column-1});return l.getTemplateDataSuggestions(p.word)}};return a.languages.registerCompletionItemProvider("go-template",c)}function N(a,c){const g={startLineNumber:c.lineNumber,endLineNumber:c.lineNumber,startColumn:a.getLineMinColumn(c.lineNumber),endColumn:a.getLineMaxColumn(c.lineNumber)};return a.findMatches('\\{\\{[a-zA-Z0-9._() "]+\\}\\}',g,!0,!1,null,!0).some(S=>S.range.containsPosition(c))}class B{constructor(c,g){this.monaco=c,this.range=g,this.getSnippetsSuggestions=()=>this.getCompletionsFromDefinitions((0,e.Mq)(this.monaco)),this.getFunctionsSuggestions=()=>this.getCompletionsFromDefinitions($(this.monaco)),this.getTemplateDataSuggestions=v=>{switch(v){case"":return this.getCompletionsFromDefinitions((0,e.Xt)(this.monaco),(0,e.So)(this.monaco));case"Alerts":return this.getCompletionsFromDefinitions((0,e.J2)(this.monaco));case"GroupLabels":case"CommonLabels":case"CommonAnnotations":case"Labels":case"Annotations":return this.getCompletionsFromDefinitions((0,e.KS)(this.monaco));default:return{suggestions:[]}}},this.getCompletionsFromDefinitions=(...v)=>({suggestions:(0,R.concat)(...v).map(S=>P(S,this.range))})}}function P({label:a,detail:c,documentation:g,kind:v,insertText:C},S){const x=typeof a=="string"?a:a.label,l=typeof a=="string"?{label:a,description:c}:{...a};return l.description??=c,{label:l,kind:v,insertText:C??x,range:S,documentation:g,detail:c}}const z="go-template",V={id:z,extensions:[],aliases:[],mimetypes:[],loader:()=>Promise.resolve().then(t.bind(t,83225))},W=(a,c)=>{const{id:g,loader:v}=c;a.languages.getLanguages().find(S=>S.id===g)||(a.languages.register({id:g}),v().then(S=>{a.languages.setMonarchTokensProvider(g,S.language),a.languages.setLanguageConfiguration(g,S.conf)}))},A=a=>{const c=!!a.autoHeight,g=(0,u.useRef)(null),v=C=>{if(c){const S=C.getContentHeight();try{C.layout({height:S,width:NaN})}catch{}}};return(0,u.useEffect)(()=>()=>{g.current?.dispose()},[]),u.createElement(M.B,{showLineNumbers:!0,showMiniMap:!1,...a,monacoOptions:{scrollBeyondLastLine:!1},onEditorDidMount:v,onBeforeEditorMount:C=>{W(C,V),g.current=G(C)},language:z})}},57954:(X,I,t)=>{t.d(I,{So:()=>P,J2:()=>z,Xt:()=>B,KS:()=>F,Mq:()=>W,L:()=>V});const u=`
{{ range .Alerts }}
  Status: {{ .Status }}
  Starts at: {{ .StartsAt }}
{{ end }}
`,M=`
[{{.Status}}] {{ .Labels.alertname }}

Labels:
{{ range .Labels.SortedPairs }}
  {{ .Name }}: {{ .Value }}
{{ end }}

{{ if gt (len .Annotations) 0 }}
Annotations:
{{ range .Annotations.SortedPairs }}
  {{ .Name }}: {{ .Value }}
{{ end }}
{{ end }}

{{ if gt (len .SilenceURL ) 0 }}
  Silence alert: {{ .SilenceURL }}
{{ end }}
{{ if gt (len .DashboardURL ) 0 }}
  Go to dashboard: {{ .DashboardURL }}
{{ end }}
`,R=N("GroupLabels.SortedPairs"),T=N("CommonLabels.SortedPairs"),$=N("CommonAnnotations.SortedPairs"),e=N("Labels.SortedPairs"),G=N("Annotations.SortedPairs");function N(A){return`
{{ range .${A} }}
  {{ .Name }} = {{ .Value }}
{{ end }}`}function B(A){const a=A.languages.CompletionItemKind.Field;return[{label:"Alerts",kind:a,detail:"Alert[]",documentation:{value:"An Array containing all alerts"}},{label:"Receiver",kind:a,detail:"string"},{label:"Status",kind:a,detail:"string"},{label:"GroupLabels",kind:a,detail:"[]KeyValue"},{label:"CommonLabels",kind:a,detail:"[]KeyValue"},{label:"CommonAnnotations",kind:a,detail:"[]KeyValue"},{label:"ExternalURL",kind:a,detail:"string"}]}function P(A){const a=A.languages.CompletionItemKind.Field;return[{label:{label:"Status",detail:"(Alert)",description:"string"},kind:a,detail:"string",documentation:{value:"Status of the alert. It can be `firing` or `resolved`"}},{label:{label:"Labels",detail:"(Alert)"},kind:a,detail:"[]KeyValue",documentation:{value:"A set of labels attached to the alert."}},{label:{label:"Annotations",detail:"(Alert)"},kind:a,detail:"[]KeyValue",documentation:"A set of annotations attached to the alert."},{label:{label:"StartsAt",detail:"(Alert)"},kind:a,detail:"time.Time",documentation:"Time the alert started firing."},{label:{label:"EndsAt",detail:"(Alert)"},kind:a,detail:"time.Time",documentation:"Only set if the end time of an alert is known. Otherwise set to a configurable timeout period from the time since the last alert was received."},{label:{label:"GeneratorURL",detail:"(Alert)"},kind:a,detail:"string",documentation:"Back link to Grafana or external Alertmanager."},{label:{label:"SilenceURL",detail:"(Alert)"},kind:a,detail:"string",documentation:"Link to Grafana silence for with labels for this alert pre-filled. Only for Grafana managed alerts."},{label:{label:"DashboardURL",detail:"(Alert)"},kind:a,detail:"string",documentation:"Link to Grafana dashboard, if alert rule belongs to one. Only for Grafana managed alerts."},{label:{label:"PanelURL",detail:"(Alert)"},kind:a,detail:"string",documentation:"Link to Grafana dashboard panel, if alert rule belongs to one. Only for Grafana managed alerts."},{label:{label:"Fingerprint",detail:"(Alert)"},kind:a,detail:"string",documentation:"Fingerprint that can be used to identify the alert."},{label:{label:"ValueString",detail:"(Alert)"},kind:a,detail:"string",documentation:"String that contains labels and values of each reduced expression in the alert."}]}function z(A){const a=A.languages.CompletionItemKind.Field;return[{label:"Firing",kind:a,detail:"Alert[]"},{label:"Resolved",kind:a,detail:"Alert[]"}]}function F(A){const a=A.languages.CompletionItemKind.Field;return[{label:"SortedPairs",kind:a,detail:"[]KeyValue"},{label:"Names",kind:a,detail:"[]string"},{label:"Values",kind:a,detail:"[]string"},{label:"Remove",detail:"KeyValue[] function(keys []string)",kind:A.languages.CompletionItemKind.Method}]}const V={alerts:{label:"alertsloop",description:"Renders a loop through alerts",snippet:u},alertDetails:{label:"alertdetails",description:"Renders all information available about the alert",snippet:M},groupLabels:{label:"grouplabelsloop",description:"Renders a loop through group labels",snippet:R},commonLabels:{label:"commonlabelsloop",description:"Renders a loop through common labels",snippet:T},commonAnnotations:{label:"commonannotationsloop",description:"Renders a loop through common annotations",snippet:$},labels:{label:"labelsloop",description:"Renders a loop through labels",snippet:e},annotations:{label:"annotationsloop",description:"Renders a loop through annotations",snippet:G}};function W(A){const a=A.languages.CompletionItemKind.Snippet,c=A.languages.CompletionItemInsertTextRule.InsertAsSnippet,{alerts:g,alertDetails:v,groupLabels:C,commonLabels:S,commonAnnotations:x,labels:l,annotations:y}=V;return[{label:g.label,documentation:g.description,kind:a,insertText:g.snippet,insertTextRules:c},{label:{label:v.label,detail:"(Alert)"},documentation:v.description,kind:a,insertText:v.snippet,insertTextRules:c},{label:C.label,documentation:C.description,kind:a,insertText:C.snippet,insertTextRules:c},{label:S.label,documentation:S.description,kind:a,insertText:S.snippet,insertTextRules:c},{label:x.label,documentation:x.description,kind:a,insertText:x.snippet,insertTextRules:c},{label:{label:l.label,detail:"(Alert)"},documentation:l.description,kind:a,insertText:l.snippet,insertTextRules:c},{label:{label:y.label,detail:"(Alert)"},documentation:y.description,kind:a,insertText:y.snippet,insertTextRules:c}]}},86768:(X,I,t)=>{t.d(I,{K:()=>M});var u=t(99494);const M={[u.W.OnCall]:"public/img/alerting/oncall_logo.svg",[u.W.Incident]:"",[u.W.MachineLearning]:"",[u.W.Labels]:""}},72275:(X,I,t)=>{t.d(I,{M:()=>T});var u=t(96540),M=t(56034),R=t(55852);const T=({tooltip:$,icon:e,to:G,target:N,onClick:B,className:P,tooltipPlacement:z="top",...F})=>{const V=typeof $=="string"?$:void 0;return u.createElement(M.m,{content:$,placement:z},G?u.createElement(R.z9,{variant:"secondary",fill:"text",icon:e,href:G,size:"sm",target:N,...F,"aria-label":V}):u.createElement(R.$n,{className:P,variant:"secondary",fill:"text",size:"sm",icon:e,type:"button",onClick:B,...F,"aria-label":V}))}},4554:(X,I,t)=>{t.d(I,{L:()=>M});var u=t(32196);const M=R=>({table:(0,u.css)({width:"100%",borderRadius:R.shape.radius.default,border:`solid 1px ${R.colors.border.weak}`,backgroundColor:R.colors.background.secondary,th:{padding:R.spacing(1)},td:{padding:`0 ${R.spacing(1)}`},tr:{height:"38px"}}),evenRow:(0,u.css)({backgroundColor:R.colors.background.primary}),colExpand:(0,u.css)({width:"36px"}),nameCell:(0,u.css)({gap:R.spacing(1)}),actionsCell:(0,u.css)({textAlign:"right",width:"1%",whiteSpace:"nowrap","& > * + *":{marginLeft:R.spacing(.5)}})})}}]);

//# sourceMappingURL=3726.478eacb8b8ed9bbf9ae1.js.map