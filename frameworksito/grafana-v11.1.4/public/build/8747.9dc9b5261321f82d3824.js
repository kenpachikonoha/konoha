(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8747],{35931:(be,B,y)=>{"use strict";y.d(B,{H:()=>i});var x=y(32196),f=y(96540),O=y(40845);function i(G){const{description:ee,suffix:Y,feature:ge}=G,Z=`Learn more about ${ge}`,F=(0,O.of)(l);return f.createElement("span",{className:F.container},ee,f.createElement("a",{"aria-label":Z,href:`https://grafana.com/docs/grafana/next/datasources/${Y}`,rel:"noreferrer",target:"_blank"},Z))}const l=G=>({container:(0,x.css)({color:G.colors.text.secondary,a:(0,x.css)({color:G.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})})})},18747:(be,B,y)=>{"use strict";y.r(B),y.d(B,{plugin:()=>wi});var x=y(40187),f=y(69129),O=y(3591),i=y(32196),l=y(96540),G=y(43127),ee=y(42418),Y=y(40845),ge=y(20084),Z=y(76892),F=y(14186),I=y(10354);const _=e=>(s,r)=>{const n={};for(const c in e)n[c]=e[c](s[c],r);return n},te=(e,s,r)=>(0,l.useCallback)(c=>{e(r(s,c))},[e,s,r]),Ke=(0,l.createContext)(void 0),k=()=>{const e=(0,l.useContext)(Ke);if(!e)throw new Error("Use DispatchContext first.");return e},Ze=e=>({name:e,pipelineAgg:""}),At=e=>`var${Math.max(0,...e.map(s=>parseInt(s.name.match("^var(\\d+)$")?.[1]||"0",10)))+1}`,wt=e=>e.settings?.model==="ewma",Je=e=>e.settings?.model==="holt",De=e=>e.settings?.model==="holt_winters",vs=e=>["holt","ewma","holt_winters"].includes(e.settings?.model||""),le=e=>N[e.type].requiresField,$e=e=>N[e.type].isPipelineAgg,Pe=e=>N[e.type].supportsMultipleBucketPaths,Es=e=>N[e.type].supportsMissing,Xe=e=>N[e.type].hasSettings,oe=e=>N[e.type].hasMeta,ne=e=>N[e.type].supportsInlineScript,Oe=["count","avg","sum","min","max","extended_stats","percentiles","cardinality","raw_document","raw_data","logs","moving_avg","moving_fn","derivative","serial_diff","cumulative_sum","bucket_script","rate","top_metrics"],Ct=e=>Oe.includes(e),N={count:{label:"Count",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!1,hasMeta:!1,supportsInlineScript:!1,defaults:{}},avg:{label:"Average",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},sum:{label:"Sum",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},max:{label:"Max",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},min:{label:"Min",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},extended_stats:{label:"Extended Stats",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!0,defaults:{meta:{std_deviation_bounds_lower:!0,std_deviation_bounds_upper:!0}}},percentiles:{label:"Percentiles",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{settings:{percents:["25","50","75","95","99"]}}},cardinality:{label:"Unique Count",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},moving_avg:{label:"Moving Average",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,versionRange:"<8.0.0",supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{model:"simple",window:"5"}}},moving_fn:{label:"Moving Function",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMultipleBucketPaths:!1,supportsInlineScript:!1,supportsMissing:!1,hasMeta:!1,hasSettings:!0,defaults:{}},derivative:{label:"Derivative",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},serial_diff:{label:"Serial Difference",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{lag:"1"}}},cumulative_sum:{label:"Cumulative Sum",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},bucket_script:{label:"Bucket Script",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!0,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{pipelineVariables:[Ze(At([]))]}},raw_document:{label:"Raw Document (deprecated)",requiresField:!1,impliedQueryType:"raw_document",isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{size:"500"}}},raw_data:{label:"Raw Data",requiresField:!1,impliedQueryType:"raw_data",isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{size:"500"}}},logs:{label:"Logs",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,impliedQueryType:"logs",supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{limit:"500"}}},top_metrics:{label:"Top Metrics",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{order:"desc"}}},rate:{label:"Rate",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!0,hasMeta:!1,defaults:{}}},Ks={moving_avg:[{label:"window",default:5},{label:"model",default:"simple"},{label:"predict"},{label:"minimize",default:!1}],moving_fn:[{label:"window",default:5},{label:"script"}],derivative:[{label:"unit"}],serial_diff:[{label:"lag"}],cumulative_sum:[{label:"format"}],bucket_script:[]},Mt=(e,s)=>{const r=s.filter(n=>Pe(n)?n.pipelineVariables?.some(c=>c.pipelineAgg===e.id):le(n)&&e.id===n.field);return[...r,...r.flatMap(n=>Mt(n,s))]},Tt=[{label:"Avg",value:"avg"},{label:"Min",value:"min"},{label:"Max",value:"max"},{label:"Sum",value:"sum"},{label:"Count",value:"count"},{label:"Std Dev",value:"std_deviation"},{label:"Std Dev Upper",value:"std_deviation_bounds_upper"},{label:"Std Dev Lower",value:"std_deviation_bounds_lower"}],bs=[{label:"Simple",value:"simple"},{label:"Linear",value:"linear"},{label:"Exponentially Weighted",value:"ewma"},{label:"Holt Linear",value:"holt"},{label:"Holt Winters",value:"holt_winters"}],Dt={pre:"@HIGHLIGHT@",post:"@/HIGHLIGHT@"},et="3";function ce(e="1"){return{type:"count",id:e}}function pe(e="1"){return{type:"date_histogram",id:e,settings:{interval:"auto"}}}const Pt=(e,s)=>e.find(r=>r.id===s);function tt(e,s){return!!e?.metrics?.some(r=>r.type===s)}function st(e){return e in pipelineOptions}function Zs(e){return!!metricAggregationConfig[e].supportsMultipleBucketPaths}var Fe=y(21970);const me=e=>le(e)?`${N[e.type].label} ${e.field}`:N[e.type].label,Ve=e=>Object.entries(e).reduce((s,[r,n])=>{if(n==null)return{...s};if(Array.isArray(n)&&n.length===0)return{...s};if(typeof n=="string"&&n.length===0)return{...s};if(!Array.isArray(n)&&typeof n=="object"){const c=Ve(n);return Object.keys(c).length===0?{...s}:{...s,[r]:c}}return{...s,[r]:n}},{}),rt=e=>{const s=e.match(/^(\d+)/);return s?s[1]:void 0},Re=e=>(typeof e.settings?.script=="object"?e.settings?.script?.inline:e.settings?.script)||"",it=e=>!!(0,Fe.gte)(e,"7.16.0"),nt="Support for Elasticsearch versions after their end-of-life (currently versions < 7.16) was removed. Using unsupported version of Elasticsearch may lead to unexpected and incorrect results.",at=e=>e?.bucketAggs?.slice(-1)[0]?.type==="date_histogram",lt=/\$(\w+)|\[\[(\w+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g;function Ot(e,s){s=s||{};const r=s.delimiter||".";let n=s.maxDepth||3,c=1;const d={};function g(E,S){Object.keys(E).forEach(h=>{const b=E[h],T=s?.safe&&Array.isArray(b),P=Object.prototype.toString.call(b)==="[object Object]",z=S?S+r+h:h;if(s?.maxDepth||(n=c+1),!T&&P&&b&&Object.keys(b).length&&c<n)return++c,g({...b},z);d[z]=b})}return g(e,null),d}var V=y(65307);const Le=(0,V.VP)("@metrics/add"),Ne=(0,V.VP)("@metrics/remove"),_e=(0,V.VP)("@metrics/toggle_visibility"),Se=(0,V.VP)("@metrics/change_field"),he=(0,V.VP)("@metrics/change_type"),ot=(0,V.VP)("@metrics/change_attr"),j=(0,V.VP)("@metrics/change_setting"),Vt=(0,V.VP)("@metrics/change_meta"),xe=(0,V.VP)("init"),Rt=(0,V.VP)("change_query"),Lt=(0,V.VP)("change_alias_pattern"),$s=(e,s)=>Rt.match(s)?s.payload:xe.match(s)?e||"":e,Fs=(e,s)=>Lt.match(s)?s.payload:xe.match(s)?e||"":e;var ct=y(91410);const Nt=()=>({label:"",query:"*"}),Q={terms:{label:"Terms",requiresField:!0,defaultSettings:{min_doc_count:"1",size:"10",order:"desc",orderBy:"_term"}},filters:{label:"Filters",requiresField:!1,defaultSettings:{filters:[Nt()]}},geohash_grid:{label:"Geo Hash Grid",requiresField:!0,defaultSettings:{precision:et}},date_histogram:{label:"Date Histogram",requiresField:!0,defaultSettings:{interval:"auto",min_doc_count:"0",trimEdges:"0",timeZone:ct.g$.utc}},histogram:{label:"Histogram",requiresField:!0,defaultSettings:{interval:"1000",min_doc_count:"0"}},nested:{label:"Nested (experimental)",requiresField:!0,defaultSettings:{}}},_t=[{label:"Term value",value:"_term"},{label:"Doc Count",value:"_count"}],Ie=[{label:"Top",value:"desc"},{label:"Bottom",value:"asc"}],ut=[{label:"No limit",value:"0"},{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"5",value:"5"},{label:"10",value:"10"},{label:"15",value:"15"},{label:"20",value:"20"}],Qt=(0,V.VP)("@bucketAggs/add"),Bt=(0,V.VP)("@bucketAggs/remove"),jt=(0,V.VP)("@bucketAggs/change_type"),kt=(0,V.VP)("@bucketAggs/change_field"),q=(0,V.VP)("@bucketAggs/change_setting"),Ss=e=>(s,r)=>{if(Qt.match(r)){const n={id:r.payload,type:"terms",settings:Q.terms.defaultSettings},c=s[s.length-1];return c?.type==="date_histogram"?[...s.slice(0,s.length-1),n,c]:[...s,n]}return Bt.match(r)?s.filter(n=>n.id!==r.payload):jt.match(r)?s.map(n=>n.id!==r.payload.id?n:{id:n.id,type:r.payload.newType,settings:Q[r.payload.newType].defaultSettings}):kt.match(r)?s.map(n=>n.id!==r.payload.id?n:{...n,field:r.payload.newField}):he.match(r)?N[r.payload.type].impliedQueryType!=="metrics"?[]:s.length===0?[{...pe("2"),field:e}]:s:q.match(r)?s.map(n=>{if(n.id!==r.payload.bucketAgg.id)return n;const c=Ve({...n.settings,[r.payload.settingName]:r.payload.newValue});return{...n,settings:{...c}}}):xe.match(r)?s&&s.length>0?s:[{...pe("2"),field:e}]:s},xs=(e,s)=>{if(Le.match(s))return[...e,ce(s.payload)];if(Ne.match(s)){const r=e.find(d=>d.id===s.payload),n=[r,...Mt(r,e)],c=e.filter(d=>!n.some(g=>g.id===d.id));return c.length===0?[ce("1")]:c}return he.match(s)?e.filter(r=>N[s.payload.type].impliedQueryType==="metrics"?!0:r.id===s.payload.id).map(r=>r.id!==s.payload.id?r:{id:r.id,type:s.payload.type,...N[s.payload.type].defaults}):Se.match(s)?e.map(r=>{if(r.id!==s.payload.id)return r;const n={...r,field:s.payload.field};return $e(r)?{...n,pipelineAgg:s.payload.field}:n}):_e.match(s)?e.map(r=>r.id!==s.payload?r:{...r,hide:!r.hide}):j.match(s)?e.map(r=>{if(r.id!==s.payload.metric.id)return r;if(Xe(r)){const n=Ve({...r.settings,[s.payload.settingName]:s.payload.newValue});return{...r,settings:{...n}}}return r}):Vt.match(s)?e.map(r=>r.id!==s.payload.metric.id?r:oe(r)?{...r,meta:{...r.meta,[s.payload.meta]:s.payload.newValue}}:r):ot.match(s)?e.map(r=>r.id!==s.payload.metric.id?r:{...r,[s.payload.attribute]:s.payload.newValue}):xe.match(s)?e&&e.length>0?e:[ce("1")]:e},dt=(0,l.createContext)(void 0),qt=(0,l.createContext)(void 0),Ae=(0,l.createContext)(void 0),Qe=({children:e,onChange:s,onRunQuery:r,query:n,datasource:c,range:d})=>{const g=(0,l.useCallback)((L,P)=>{s(L),(L.query===P.query||P.query===void 0)&&r()},[s,r]),E=_({query:$s,alias:Fs,metrics:xs,bucketAggs:Ss(c.timeField)}),S=te(L=>g({...n,...L,timeField:c.timeField},n),n,E),h=!n.metrics||!n.bucketAggs||n.query===void 0,[b,T]=(0,l.useState)(h);return(0,l.useEffect)(()=>{b&&h&&(S(xe()),T(!1))},[b,S,h]),h?null:l.createElement(dt.Provider,{value:c},l.createElement(qt.Provider,{value:n},l.createElement(Ae.Provider,{value:d},l.createElement(Ke.Provider,{value:S},e))))},ft=e=>()=>{const s=(0,l.useContext)(e);if(!s)throw new Error("use ElasticsearchProvider first.");return s},ue=ft(qt),se=ft(dt),Be=ft(Ae),Wt=e=>e.id,Is=e=>parseInt(e,10),As=()=>{const{metrics:e,bucketAggs:s}=ue();return(0,l.useMemo)(()=>(Math.max(...[...e?.map(Wt)||["0"],...s?.map(Wt)||["0"]].map(Is))+1).toString(),[e,s])};var ye=y(55852),R=y(2543),je=y(39268),we=y(63056),gt=y(29158);const zt=({children:e,label:s,onRemoveClick:r,onHideClick:n,hidden:c=!1})=>{const d=(0,Y.of)(Ht);return l.createElement(je.C,null,l.createElement(we.e,null,l.createElement(Z.c,{width:17,as:"div"},l.createElement("span",null,s),l.createElement("span",{className:d.iconWrapper},n&&l.createElement(gt.K,{name:c?"eye-slash":"eye",onClick:n,size:"sm","aria-pressed":c,className:d.icon,tooltip:"Hide row"}),l.createElement(gt.K,{name:"trash-alt",size:"sm",className:d.icon,onClick:r||R.noop,disabled:!r,tooltip:"Remove row"})))),e)},Ht=e=>({iconWrapper:(0,i.css)`
      display: flex;
    `,icon:(0,i.css)`
      color: ${e.colors.text.secondary};
      margin-left: ${e.spacing(.25)};
    `});var Ut=y(38401),Ce=y(83684),re=y(75505);const ke=e=>Q[e.type].requiresField,ws=["date_histogram","histogram","terms","filters","geohash_grid","nested"],Gt=e=>ws.includes(e),Cs=e=>{if(Ct(e))switch(e){case"cardinality":return[];case"top_metrics":return["number"];default:return["number"]}if(Gt(e))switch(e){case"date_histogram":return["date"];case"geohash_grid":return["geo_point"];case"histogram":return["number"];default:return[]}return[]},Yt=({text:e})=>({label:e,value:e}),qe=e=>{const s=se(),r=Be(),n=Array.isArray(e)?e:Cs(e);let c;return async d=>(c||(c=await(0,re.s)(s.getFields(n,r))),c.filter(({text:g})=>d===void 0||g.includes(d)).map(Yt))},ve=(0,i.css)`
  min-width: 150px;
`;var Kt=y(14578);const Zt=(e,s)=>({wrapper:(0,i.css)`
      max-width: 500px;
      display: flex;
      flex-direction: column;
    `,settingsWrapper:(0,i.css)`
      padding-top: ${e.spacing(.5)};
    `,icon:(0,i.css)`
      margin-right: ${e.spacing(.5)};
    `,button:(0,i.css)`
      justify-content: start;
      ${s&&(0,i.css)`
        color: ${e.colors.text.disabled};
      `}
    `}),a=({label:e,children:s,hidden:r=!1})=>{const[n,c]=(0,l.useState)(!1),d=(0,Y.$j)(),g=Zt(d,r);return l.createElement(we.e,null,l.createElement("div",{className:(0,i.cx)(g.wrapper)},l.createElement("button",{className:(0,i.cx)("gf-form-label query-part",g.button,ve),onClick:()=>c(!n),"aria-expanded":n,type:"button"},l.createElement(Kt.I,{name:n?"angle-down":"angle-right","aria-hidden":"true",className:g.icon}),e),n&&l.createElement("div",{className:g.settingsWrapper},s)))};var A=y(21594),We=y(20333);const J=["1w","1M","1q","1y"];class pt{constructor(s){this.timeField=s.timeField}getRangeFilter(){return{[this.timeField]:{gte:"$timeFrom",lte:"$timeTo",format:"epoch_millis"}}}buildTermsAgg(s,r,n){if(r.terms={field:s.field},!s.settings)return r;const c=s.settings?.size?parseInt(s.settings.size,10):500;if(r.terms.size=c===0?500:c,s.settings.orderBy!==void 0){r.terms.order={},s.settings.orderBy==="_term"?r.terms.order._key=s.settings.order:r.terms.order[s.settings.orderBy]=s.settings.order;const d=rt(s.settings.orderBy);if(d){for(let g of n.metrics||[])if(g.id===d){g.type==="count"?r.terms.order={_count:s.settings.order}:le(g)&&(r.aggs={},r.aggs[g.id]={[g.type]:{field:g.field}});break}}}return s.settings.min_doc_count!==void 0&&(r.terms.min_doc_count=parseInt(s.settings.min_doc_count,10),isNaN(r.terms.min_doc_count)&&(r.terms.min_doc_count=s.settings.min_doc_count)),s.settings.missing&&(r.terms.missing=s.settings.missing),r}getDateHistogramAgg(s){const r={},n=s.settings||{};r.field=s.field||this.timeField,r.min_doc_count=n.min_doc_count||0,r.extended_bounds={min:"$timeFrom",max:"$timeTo"},r.format="epoch_millis",n.timeZone&&n.timeZone!==ct.g$.utc&&(r.time_zone=n.timeZone),n.offset!==""&&(r.offset=n.offset);const c=n.interval==="auto"?"${__interval_ms}ms":n.interval;return c!==void 0&&J.includes(c)?r.calendar_interval=c:r.fixed_interval=c,r}getHistogramAgg(s){return{interval:s.settings?.interval,field:s.field,min_doc_count:s.settings?.min_doc_count||0}}getFiltersAgg(s){const r={};for(let{query:n,label:c}of s.settings?.filters||[])r[c||n]={query_string:{query:n,analyze_wildcard:!0}};return r}documentQuery(s,r){return s.size=r,s.sort=[{[this.timeField]:{order:"desc",unmapped_type:"boolean"}},{_doc:{order:"desc"}}],s.script_fields={},s}build(s){s.metrics=s.metrics||[ce()],s.bucketAggs=s.bucketAggs||[pe()],s.timeField=this.timeField;let r,n,c,d,g;const E={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};if(s.query&&s.query!==""&&(E.query.bool.filter=[...E.query.bool.filter,{query_string:{analyze_wildcard:!0,query:s.query}}]),s.bucketAggs.length===0&&(r=s.metrics[0],!r||!(r.type==="raw_document"||r.type==="raw_data")))throw{message:"Invalid query"};if(s.metrics?.[0]?.type==="raw_document"||s.metrics?.[0]?.type==="raw_data"){r=s.metrics[0];const S=r.settings?.size?parseInt(r.settings.size,10):500;return this.documentQuery(E,S||500)}for(g=E,n=0;n<s.bucketAggs.length;n++){const S=s.bucketAggs[n],h={};switch(S.type){case"date_histogram":{h.date_histogram=this.getDateHistogramAgg(S);break}case"histogram":{h.histogram=this.getHistogramAgg(S);break}case"filters":{h.filters={filters:this.getFiltersAgg(S)};break}case"terms":{this.buildTermsAgg(S,h,s);break}case"geohash_grid":{h.geohash_grid={field:S.field,precision:S.settings?.precision||et};break}case"nested":{h.nested={path:S.field};break}}g.aggs=g.aggs||{},g.aggs[S.id]=h,g=h}for(g.aggs={},n=0;n<s.metrics.length;n++){if(r=s.metrics[n],r.type==="count")continue;const S={};let h={};if($e(r))if(Pe(r))if(r.pipelineVariables){for(h={buckets_path:{}},c=0;c<r.pipelineVariables.length;c++)if(d=r.pipelineVariables[c],d.name&&d.pipelineAgg&&/^\d*$/.test(d.pipelineAgg)){const b=Pt(s.metrics,d.pipelineAgg);b&&(b.type==="count"?h.buckets_path[d.name]="_count":h.buckets_path[d.name]=d.pipelineAgg)}}else continue;else if(r.field&&/^\d*$/.test(r.field)){const b=Pt(s.metrics,r.field);b&&(b.type==="count"?h={buckets_path:"_count"}:h={buckets_path:r.field})}else continue;else le(r)&&(h={field:r.field});if(Xe(r))switch(Object.entries(r.settings||{}).filter(([b,T])=>T!==null).forEach(([b,T])=>{h[b]=b==="script"?this.buildScript(Re(r)):T}),r.type){case"moving_avg":h={...h,...h?.window!==void 0&&{window:this.toNumber(h.window)},...h?.predict!==void 0&&{predict:this.toNumber(h.predict)},...vs(r)&&{settings:{...h.settings,...Object.fromEntries(Object.entries(h.settings||{}).filter(([b])=>["alpha","beta","gamma","period"].includes(b)).filter(([b,T])=>T!==void 0).map(([b,T])=>[b,this.toNumber(T)]))}}};break;case"serial_diff":h={...h,...h.lag!==void 0&&{lag:this.toNumber(h.lag)}};break;case"top_metrics":h={metrics:r.settings?.metrics?.map(b=>({field:b})),size:1},r.settings?.orderBy&&(h.sort=[{[r.settings?.orderBy]:r.settings?.order}]);break}S[r.type]=h,g.aggs[r.id]=S}return E}buildScript(s){return s}toNumber(s){const r=parseFloat(`${s}`);return isNaN(r)?s:r}getTermsQuery(s){const r={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};s.query&&r.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:s.query}});let n=500;s.size&&(n=s.size),r.aggs={1:{terms:{field:s.field,size:n,order:{}}}};const{orderBy:c="key",order:d=c==="doc_count"?"desc":"asc"}=s;if(["asc","desc"].indexOf(d)<0)throw{message:`Invalid query sort order ${d}`};switch(c){case"key":case"term":const g="_key";r.aggs[1].terms.order[g]=d;break;case"doc_count":r.aggs[1].terms.order._count=d;break;default:throw{message:`Invalid query sort type ${c}`}}return r}getLogsQuery(s,r){let n={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};return s.query&&n.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:s.query}}),n=this.documentQuery(n,r),{...n,aggs:this.build(s).aggs,highlight:{fields:{"*":{}},pre_tags:[Dt.pre],post_tags:[Dt.post],fragment_size:2147483647}}}}const v=e=>({value:s})=>s===e,ze=(e,s)=>s===void 0||e.some(v(s))?e:[...e,{value:s,label:s}],Ms=({options:e,value:s,onChange:r})=>{const[n,c]=(0,l.useState)(ze(e,s)),d=g=>c([...n,{value:g,label:g}]);return{onCreateOption:g=>{d(g),r({value:g})},onChange:r,allowCustomValue:!0,options:n,value:s}},He=[{label:"auto",value:"auto"},{label:"10s",value:"10s"},{label:"1m",value:"1m"},{label:"5m",value:"5m"},{label:"10m",value:"10m"},{label:"20m",value:"20m"},{label:"1h",value:"1h"},{label:"1d",value:"1d"},{label:"1w",value:"1w"},{label:"1M",value:"1M"},{label:"1q",value:"1q"},{label:"1y",value:"1y"}],Js=e=>({value:s})=>s===e,Xs=(e,s,r)=>!r.some(Js(e))&&e.trim().length>0,D=(e,s)=>e.value?.startsWith(s)||!1,Me=e=>e&&J.includes(e)?"calendar":"fixed",Ts=({bucketAgg:e})=>{const s=k(),{current:r}=(0,l.useRef)((0,R.uniqueId)("es-date_histogram-")),n=(0,l.useCallback)(({value:d})=>s(q({bucketAgg:e,settingName:"interval",newValue:d})),[e,s]),c=Me(e.settings?.interval||Q.date_histogram.defaultSettings?.interval);return l.createElement(l.Fragment,null,l.createElement(F.I,{label:c==="calendar"?"Calendar interval":"Fixed interval",tooltip:c==="calendar"?"Calendar-aware intervals adapt to varying day lengths, month durations, and leap seconds, considering the calendar context.":"Fixed intervals remain constant, always being multiples of SI units, independent of calendar changes.",...H},l.createElement(A.l6,{inputId:(0,R.uniqueId)("es-date_histogram-interval"),isValidNewOption:Xs,filterOption:D,...Ms({options:He,value:e.settings?.interval||Q.date_histogram.defaultSettings?.interval,onChange:n})})),l.createElement(F.I,{label:"Min Doc Count",...H},l.createElement(I.p,{id:`${r}-min_doc_count`,onBlur:d=>s(q({bucketAgg:e,settingName:"min_doc_count",newValue:d.target.value})),defaultValue:e.settings?.min_doc_count||Q.date_histogram.defaultSettings?.min_doc_count})),l.createElement(F.I,{label:"Trim Edges",...H,tooltip:"Trim the edges on the timeseries datapoints"},l.createElement(I.p,{id:`${r}-trime_edges`,onBlur:d=>s(q({bucketAgg:e,settingName:"trimEdges",newValue:d.target.value})),defaultValue:e.settings?.trimEdges||Q.date_histogram.defaultSettings?.trimEdges})),l.createElement(F.I,{label:"Offset",...H,tooltip:"Change the start value of each bucket by the specified positive (+) or negative offset (-) duration, such as 1h for an hour, or 1d for a day"},l.createElement(I.p,{id:`${r}-offset`,onBlur:d=>s(q({bucketAgg:e,settingName:"offset",newValue:d.target.value})),defaultValue:e.settings?.offset||Q.date_histogram.defaultSettings?.offset})),l.createElement(F.I,{label:"Timezone",...H},l.createElement(We.U,{value:e.settings?.timeZone||Q.date_histogram.defaultSettings?.timeZone,includeInternal:[ct.g$.utc],onChange:d=>{s(q({bucketAgg:e,settingName:"timeZone",newValue:d}))}})))},Jt=({index:e,onAdd:s,onRemove:r,elements:n})=>l.createElement("div",{className:(0,i.css)`
        display: flex;
      `},e===0&&l.createElement(ye.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:s,tooltip:"Add","aria-label":"Add"}),n.length>=2&&l.createElement(ye.$n,{variant:"secondary",fill:"text",icon:"minus",onClick:r,tooltip:"Remove","aria-label":"Remove"})),Ue=(0,V.VP)("@bucketAggregations/filter/add"),mt=(0,V.VP)("@bucketAggregations/filter/remove"),de=(0,V.VP)("@bucketAggregations/filter/change"),$=(e=[],s)=>Ue.match(s)?[...e,Nt()]:mt.match(s)?e.slice(0,s.payload).concat(e.slice(s.payload+1)):de.match(s)?e.map((r,n)=>n!==s.payload.index?r:s.payload.filter):e,Ds=({bucketAgg:e})=>{const{current:s}=(0,l.useRef)((0,R.uniqueId)("es-filters-")),r=k(),n=te(c=>r(q({bucketAgg:e,settingName:"filters",newValue:c})),e.settings?.filters,$);return(0,l.useEffect)(()=>{e.settings?.filters?.length||n(Ue())},[n,e.settings?.filters?.length]),l.createElement(l.Fragment,null,l.createElement("div",{className:(0,i.css)`
          display: flex;
          flex-direction: column;
        `},e.settings?.filters.map((c,d)=>l.createElement("div",{key:d,className:(0,i.css)`
              display: flex;
            `},l.createElement(F.I,{label:"Query",labelWidth:8},l.createElement("div",{className:(0,i.css)`
                  width: 150px;
                `},l.createElement(ge.X,{placeholder:"Lucene Query",portalOrigin:"elasticsearch",onChange:g=>n(de({index:d,filter:{...c,query:g}})),query:c.query}))),l.createElement(F.I,{label:"Label",labelWidth:8},l.createElement(I.p,{width:16,id:`${s}-label-${d}`,placeholder:"Label",onBlur:g=>n(de({index:d,filter:{...c,label:g.target.value}})),defaultValue:c.label})),l.createElement(Jt,{index:d,elements:e.settings?.filters||[],onAdd:()=>n(Ue()),onRemove:()=>n(mt(d))})))))},Xt=({bucketAgg:e})=>{const{metrics:s}=ue(),r=ss(s),{current:n}=(0,l.useRef)((0,R.uniqueId)("es-terms-")),c=k();return l.createElement(l.Fragment,null,l.createElement(F.I,{label:"Order",...H},l.createElement(A.l6,{inputId:`${n}-order`,onChange:d=>c(q({bucketAgg:e,settingName:"order",newValue:d.value})),options:Ie,value:e.settings?.order||Q.terms.defaultSettings?.order})),l.createElement(F.I,{label:"Size",...H},l.createElement(A.l6,{inputId:`${n}-size`,...Ms({options:ut,value:e.settings?.size||Q.terms.defaultSettings?.size,onChange({value:d}){c(q({bucketAgg:e,settingName:"size",newValue:d}))}})})),l.createElement(F.I,{label:"Min Doc Count",...H},l.createElement(I.p,{id:`${n}-min_doc_count`,onBlur:d=>c(q({bucketAgg:e,settingName:"min_doc_count",newValue:d.target.value})),defaultValue:e.settings?.min_doc_count||Q.terms.defaultSettings?.min_doc_count})),l.createElement(F.I,{label:"Order By",...H},l.createElement(A.l6,{inputId:`${n}-order_by`,onChange:d=>c(q({bucketAgg:e,settingName:"orderBy",newValue:d.value})),options:r,value:e.settings?.orderBy||Q.terms.defaultSettings?.orderBy})),l.createElement(F.I,{label:"Missing",...H},l.createElement(I.p,{id:`${n}-missing`,onBlur:d=>c(q({bucketAgg:e,settingName:"missing",newValue:d.target.value})),defaultValue:e.settings?.missing||Q.terms.defaultSettings?.missing})))};function es(e){return e.meta?Object.keys(e.meta).filter(r=>e.meta?.[r]).map(r=>{let n=r;return r==="std_deviation_bounds_lower"&&(n="std_lower"),r==="std_deviation_bounds_upper"&&(n="std_upper"),{label:`${me(e)} (${n})`,value:`${e.id}[${n}]`}}):[]}function ie(e){return e.settings?.percents?e.settings.percents.map(s=>{const r=/^\d+\.\d+/.test(`${s}`)?s:`${s}.0`;return{label:`${me(e)} (${s})`,value:`${e.id}[${r}]`}}):[]}function ts(e){return e.type!=="top_metrics"&&!$e(e)}const ss=(e=[])=>{const s=e.filter(ts).flatMap(r=>r.type==="extended_stats"?es(r):r.type==="percentiles"?ie(r):{label:me(r),value:r.id});return[..._t,...s]},rs=e=>s=>s.value===e,ht=e=>{const{metrics:s}=ue();switch(e.type){case"terms":{const r=e.settings?.order||"desc",n=e.settings?.size||"10",c=parseInt(e.settings?.min_doc_count||"0",10),d=e.settings?.orderBy||"_term";let g="";n!=="0"&&(g=`${Ie.find(rs(r))?.label} ${n}, `),c>0&&(g+=`Min Doc Count: ${c}, `),g+="Order by: ";const E=_t.find(rs(d));if(E)g+=E.label;else{const S=s?.find(h=>h.id===rt(d));S?g+=me(S):g+="metric not found"}return n==="0"&&(g+=` (${r})`),g}case"histogram":{const r=e.settings?.interval||"1000",n=parseInt(e.settings?.min_doc_count||"1",10);return`Interval: ${r}${n>0?`, Min Doc Count: ${n}`:""}`}case"filters":return`Filter Queries (${(e.settings?.filters||Q.filters.defaultSettings?.filters).length})`;case"geohash_grid":return`Precision: ${parseInt(e.settings?.precision||et,10)}`;case"date_histogram":{const r=e.settings?.interval||"auto",n=parseInt(e.settings?.min_doc_count||"0",10),c=parseInt(e.settings?.trimEdges||"0",10);let d=`Interval: ${r}`;return n>0&&(d+=`, Min Doc Count: ${n}`),c>0&&(d+=`, Trim edges: ${c}`),d}default:return"Settings"}},H={labelWidth:18},is=({bucketAgg:e})=>{const{current:s}=(0,l.useRef)((0,R.uniqueId)("es-setting-")),r=k(),n=ht(e);return l.createElement(a,{label:n},e.type==="terms"&&l.createElement(Xt,{bucketAgg:e}),e.type==="date_histogram"&&l.createElement(Ts,{bucketAgg:e}),e.type==="filters"&&l.createElement(Ds,{bucketAgg:e}),e.type==="geohash_grid"&&l.createElement(F.I,{label:"Precision",...H},l.createElement(I.p,{id:`${s}-geohash_grid-precision`,onBlur:c=>r(q({bucketAgg:e,settingName:"precision",newValue:c.target.value})),defaultValue:e.settings?.precision||Q[e.type].defaultSettings?.precision})),e.type==="histogram"&&l.createElement(l.Fragment,null,l.createElement(F.I,{label:"Interval",...H},l.createElement(I.p,{id:`${s}-histogram-interval`,onBlur:c=>r(q({bucketAgg:e,settingName:"interval",newValue:c.target.value})),defaultValue:e.settings?.interval||Q[e.type].defaultSettings?.interval})),l.createElement(F.I,{label:"Min Doc Count",...H},l.createElement(I.p,{id:`${s}-histogram-min_doc_count`,onBlur:c=>r(q({bucketAgg:e,settingName:"min_doc_count",newValue:c.target.value})),defaultValue:e.settings?.min_doc_count||Q[e.type].defaultSettings?.min_doc_count}))))},ae=Object.entries(Q).map(([e,{label:s}])=>({label:s,value:e})),ns=e=>({label:Q[e.type].label,value:e.type}),as=({value:e})=>{const s=k(),r=qe(e.type);return l.createElement(l.Fragment,null,l.createElement(we.e,null,l.createElement(Ut.Y,{className:ve,options:ae,onChange:n=>s(jt({id:e.id,newType:n.value})),value:ns(e)}),ke(e)&&l.createElement(Ce.s,{className:ve,loadOptions:r,onChange:n=>s(kt({id:e.id,newField:n.value})),placeholder:"Select Field",value:e.field})),l.createElement(is,{bucketAgg:e}))},Ps=({nextId:e})=>{const s=k(),{bucketAggs:r}=ue(),n=r?.length||0;return l.createElement(l.Fragment,null,r.map((c,d)=>l.createElement(zt,{key:`${c.type}-${c.id}`,label:d===0?"Group By":"Then By",onRemoveClick:n>1&&(()=>s(Bt(c.id)))},l.createElement(as,{value:c}),d===0&&l.createElement(ye.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:()=>s(Qt(e)),tooltip:"Add grouping condition","aria-label":"Add grouping condition"}))))};var Te=y(15292);const ls=(0,i.css)`
  white-space: nowrap;
`,yt=e=>({label:me(e),value:e}),Ge=e=>e.map(yt),os=({options:e,onChange:s,className:r,value:n})=>{const c=e.find(d=>d.id===n);return l.createElement(Ut.Y,{className:(0,i.cx)(r,ls),options:Ge(e),onChange:s,placeholder:"Select Metric",value:c?yt(c):void 0})};function W({label:e,settingName:s,metric:r,placeholder:n,tooltip:c}){const d=k(),[g]=(0,l.useState)((0,R.uniqueId)("es-field-id-"));let S=r.settings?.[s]||"";return s==="script"&&(S=Re(r)),l.createElement(F.I,{label:e,labelWidth:16,tooltip:c},l.createElement(I.p,{id:g,placeholder:n,onBlur:h=>d(j({metric:r,settingName:s,newValue:h.target.value})),defaultValue:S}))}const vt=(0,V.VP)("@pipelineVariables/add"),cs=(0,V.VP)("@pipelineVariables/remove"),Et=(0,V.VP)("@pipelineVariables/rename"),bt=(0,V.VP)("@pipelineVariables/change_metric"),Os=(e=[],s)=>vt.match(s)?[...e,Ze(At(e))]:cs.match(s)?e.slice(0,s.payload).concat(e.slice(s.payload+1)):Et.match(s)?e.map((r,n)=>n!==s.payload.index?r:{...r,name:s.payload.newName}):bt.match(s)?e.map((r,n)=>n!==s.payload.index?r:{...r,pipelineAgg:s.payload.newMetric}):e,fe=({value:e,previousMetrics:s})=>{const r=k(),n=te(c=>r(ot({metric:e,attribute:"pipelineVariables",newValue:c})),e.pipelineVariables,Os);return(0,l.useEffect)(()=>{e.pipelineVariables?.length||n(vt())},[n,e.pipelineVariables?.length]),l.createElement(l.Fragment,null,l.createElement("div",{className:(0,i.css)`
          display: flex;
        `},l.createElement(Z.c,{width:16},"Variables"),l.createElement("div",{className:(0,i.css)`
            display: grid;
            grid-template-columns: 1fr auto;
            row-gap: 4px;
            margin-bottom: 4px;
          `},e.pipelineVariables.map((c,d)=>l.createElement(l.Fragment,{key:(0,R.uniqueId)("es-bs-")},l.createElement("div",{className:(0,i.css)`
                  display: grid;
                  column-gap: 4px;
                  grid-template-columns: auto auto;
                `},l.createElement(I.p,{"aria-label":"Variable name",defaultValue:c.name,placeholder:"Variable Name",onBlur:g=>n(Et({newName:g.target.value,index:d}))}),l.createElement(os,{onChange:g=>n(bt({newMetric:g.value.id,index:d})),options:s,value:c.pipelineAgg})),l.createElement(Jt,{index:d,elements:e.pipelineVariables||[],onAdd:()=>n(vt()),onRemove:()=>n(cs(d))}))))),l.createElement(W,{label:"Script",metric:e,settingName:"script",tooltip:"Elasticsearch v5.0 and above: Scripting language is Painless. Use params.<var> to reference a variable. Elasticsearch pre-v5.0: Scripting language is per default Groovy if not changed. For Groovy use <var> to reference a variable.",placeholder:"params.var1 / params.var2"}))},us=({metric:e})=>{const s=k(),{current:r}=(0,l.useRef)((0,R.uniqueId)("es-moving-avg-"));return l.createElement(l.Fragment,null,l.createElement(F.I,{label:"Model",labelWidth:16},l.createElement(A.l6,{inputId:`${r}-model`,onChange:n=>s(j({metric:e,settingName:"model",newValue:n.value})),options:bs,value:e.settings?.model})),l.createElement(W,{label:"Window",settingName:"window",metric:e,placeholder:"5"}),l.createElement(W,{label:"Predict",settingName:"predict",metric:e}),(wt(e)||Je(e)||De(e))&&l.createElement(F.I,{label:"Alpha",labelWidth:16},l.createElement(I.p,{id:`${r}-alpha`,onBlur:n=>s(j({metric:e,settingName:"settings",newValue:{...e.settings?.settings,alpha:n.target.value}})),defaultValue:e.settings?.settings?.alpha})),(Je(e)||De(e))&&l.createElement(F.I,{label:"Beta",labelWidth:16},l.createElement(I.p,{id:`${r}-beta`,onBlur:n=>s(j({metric:e,settingName:"settings",newValue:{...e.settings?.settings,beta:n.target.value}})),defaultValue:e.settings?.settings?.beta})),De(e)&&l.createElement(l.Fragment,null,l.createElement(F.I,{label:"Gamma",labelWidth:16},l.createElement(I.p,{id:`${r}-gamma`,onBlur:n=>s(j({metric:e,settingName:"settings",newValue:{...e.settings?.settings,gamma:n.target.value}})),defaultValue:e.settings?.settings?.gamma})),l.createElement(F.I,{label:"Period",labelWidth:16},l.createElement(I.p,{id:`${r}-period`,onBlur:n=>s(j({metric:e,settingName:"settings",newValue:{...e.settings?.settings,period:n.target.value}})),defaultValue:e.settings?.settings?.period})),l.createElement(F.I,{label:"Pad",labelWidth:16},l.createElement(Te.K,{id:`${r}-pad`,onChange:n=>s(j({metric:e,settingName:"settings",newValue:{...e.settings?.settings,pad:n.target.checked}})),checked:!!e.settings?.settings?.pad}))),(wt(e)||Je(e)||De(e))&&l.createElement(F.I,{label:"Minimize",labelWidth:16},l.createElement(Te.K,{id:`${r}-minimize`,onChange:n=>s(j({metric:e,settingName:"minimize",newValue:n.target.checked})),checked:!!e.settings?.minimize})))},$t=e=>({value:e,label:e}),Vs=({metric:e})=>{const s=k(),r=qe(["number","date"]),n=qe(e.type);return l.createElement(l.Fragment,null,l.createElement(F.I,{label:"Metrics",labelWidth:16},l.createElement(A.Iv,{onChange:c=>s(j({metric:e,settingName:"metrics",newValue:c.map(d=>d.value)})),loadOptions:n,value:e.settings?.metrics?.map($t),closeMenuOnSelect:!1,defaultOptions:!0})),l.createElement(F.I,{label:"Order",labelWidth:16},l.createElement(A.l6,{onChange:c=>s(j({metric:e,settingName:"order",newValue:c.value})),options:Ie,value:e.settings?.order})),l.createElement(F.I,{label:"Order By",labelWidth:16,className:(0,i.css)`
          & > div {
            width: 100%;
          }
        `},l.createElement(Ce.s,{className:(0,i.css)`
            margin-right: 0;
          `,loadOptions:r,onChange:c=>s(j({metric:e,settingName:"orderBy",newValue:c.value})),placeholder:"Select Field",value:e.settings?.orderBy})))},C=e=>s=>s.value===e,Ft=e=>{switch(e.type){case"cardinality":return`Precision threshold: ${e.settings?.precision_threshold||""}`;case"percentiles":return e.settings?.percents&&e.settings?.percents?.length>=1?`Values: ${e.settings?.percents}`:"Percents: Default";case"extended_stats":{const s=Object.entries(e.meta||{}).map(([r,n])=>n&&Tt.find(C(r))?.label).filter(Boolean);return`Stats: ${s.length>0?s.join(", "):"None selected"}`}case"raw_document":case"raw_data":return`Size: ${e.settings?.size||500}`;default:return"Options"}},t={labelWidth:16},o=({metric:e,previousMetrics:s})=>{const{current:r}=(0,l.useRef)((0,R.uniqueId)("es-setting-")),n=k(),c=Ft(e),d=(0,l.useId)(),g=(0,l.useId)(),E=(0,l.useId)(),S=[{value:"second",label:"Second"},{value:"minute",label:"Minute"},{value:"hour",label:"Hour"},{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"quarter",label:"Quarter"},{value:"Year",label:"Year"}],h=[{value:"sum",label:"Sum"},{value:"value_count",label:"Value count"}];return l.createElement(a,{label:c,hidden:e.hide},e.type==="derivative"&&l.createElement(W,{label:"Unit",metric:e,settingName:"unit"}),e.type==="serial_diff"&&l.createElement(W,{label:"Lag",metric:e,settingName:"lag",placeholder:"1"}),e.type==="cumulative_sum"&&l.createElement(W,{label:"Format",metric:e,settingName:"format"}),e.type==="moving_avg"&&l.createElement(us,{metric:e}),e.type==="moving_fn"&&l.createElement(l.Fragment,null,l.createElement(W,{label:"Window",metric:e,settingName:"window"}),l.createElement(W,{label:"Script",metric:e,settingName:"script"}),l.createElement(W,{label:"Shift",metric:e,settingName:"shift"})),e.type==="top_metrics"&&l.createElement(Vs,{metric:e}),e.type==="bucket_script"&&l.createElement(fe,{value:e,previousMetrics:s}),(e.type==="raw_data"||e.type==="raw_document")&&l.createElement(F.I,{label:"Size",...t,htmlFor:d},l.createElement(I.p,{id:d,onBlur:b=>n(j({metric:e,settingName:"size",newValue:b.target.value})),defaultValue:e.settings?.size??N.raw_data.defaults.settings?.size})),e.type==="logs"&&l.createElement(W,{label:"Limit",metric:e,settingName:"limit",placeholder:"500"}),e.type==="cardinality"&&l.createElement(W,{label:"Precision Threshold",metric:e,settingName:"precision_threshold"}),e.type==="extended_stats"&&l.createElement(l.Fragment,null,Tt.map(b=>l.createElement(u,{key:b.value,stat:b,onChange:T=>n(Vt({metric:e,meta:b.value,newValue:T})),value:e.meta?.[b.value]!==void 0?!!e.meta?.[b.value]:!!N.extended_stats.defaults.meta?.[b.value]})),l.createElement(W,{label:"Sigma",metric:e,settingName:"sigma",placeholder:"3"})),e.type==="percentiles"&&l.createElement(F.I,{label:"Percentiles",...t},l.createElement(I.p,{id:`${r}-percentiles-percents`,onBlur:b=>n(j({metric:e,settingName:"percents",newValue:b.target.value.split(",").filter(Boolean)})),defaultValue:e.settings?.percents||N.percentiles.defaults.settings?.percents,placeholder:"1,5,25,50,75,95,99"})),e.type==="rate"&&l.createElement(l.Fragment,null,l.createElement(F.I,{label:"Unit",...t,"data-testid":"unit-select",htmlFor:g},l.createElement(A.l6,{id:g,onChange:b=>n(j({metric:e,settingName:"unit",newValue:b.value})),options:S,value:e.settings?.unit})),l.createElement(F.I,{label:"Mode",...t,"data-testid":"mode-select",htmlFor:E},l.createElement(A.l6,{id:E,onChange:b=>n(j({metric:e,settingName:"mode",newValue:b.value})),options:h,value:e.settings?.unit}))),ne(e)&&l.createElement(W,{label:"Script",metric:e,settingName:"script",placeholder:"_value * 1"}),Es(e)&&l.createElement(W,{label:"Missing",metric:e,settingName:"missing",tooltip:`The missing parameter defines how documents that are missing a value should be treated. By default
            they will be ignored but it is also possible to treat them as if they had a value`}))},u=({stat:e,onChange:s,value:r})=>{const[n]=(0,l.useState)((0,R.uniqueId)("es-field-id-"));return l.createElement(F.I,{label:e.label,...t,key:e.value},l.createElement(Te.K,{id:n,onChange:c=>s(c.target.checked),value:r}))},p=({name:e,metric:s})=>{const r=[];return l.createElement(je.C,null,l.createElement(we.e,null,l.createElement(Z.c,{width:17,as:"div"},l.createElement("span",null,e))),l.createElement(o,{metric:s,previousMetrics:r}))},m=(e,s)=>({color:s&&(0,i.css)`
        &,
        &:hover,
        label,
        a {
          color: ${s?e.colors.text.disabled:e.colors.text.primary};
        }
      `}),M=e=>({label:N[e.type].label,value:e.type}),w=e=>!N[e.type].isPipelineAgg,K=(e,s)=>{const r=e.some(w);return Object.entries(N).filter(([n,c])=>c.impliedQueryType==="metrics").filter(([n,{versionRange:c="*"}])=>s!=null?(0,Fe.satisfies)(s,c):!0).filter(([n,c])=>r||!c.isPipelineAgg).map(([n,{label:c}])=>({label:c,value:n}))},mr=({value:e})=>{const s=m((0,Y.$j)(),!!e.hide),r=se(),n=ue(),c=k(),d=qe(e.type),g=async h=>{const b=await r.getDatabaseVersion();return K(h,b)},E=(0,l.useCallback)(async()=>{const h=await d();return ne(e)?[{label:"None"},...h]:h},[d,e]),S=n.metrics.slice(0,n.metrics.findIndex(h=>h.id===e.id));return l.createElement(l.Fragment,null,l.createElement(we.e,null,l.createElement(Ce.s,{className:(0,i.cx)(s.color,ve),loadOptions:()=>g(S),onChange:h=>c(he({id:e.id,type:h.value})),value:M(e)}),le(e)&&!$e(e)&&l.createElement(Ce.s,{className:(0,i.cx)(s.color,ve),loadOptions:E,onChange:h=>c(Se({id:e.id,field:h.value})),placeholder:"Select Field",value:e.field}),$e(e)&&!Pe(e)&&l.createElement(os,{className:(0,i.cx)(s.color,ve),onChange:h=>c(Se({id:e.id,field:h.value?.id})),options:S,value:e.field})),Xe(e)&&l.createElement(o,{metric:e,previousMetrics:S}))},hr=({nextId:e})=>{const s=k(),{metrics:r}=ue(),n=r?.length||0;return l.createElement(l.Fragment,null,r?.map((c,d)=>{switch(c.type){case"logs":return l.createElement(p,{key:`${c.type}-${c.id}`,name:"Logs",metric:c});case"raw_data":return l.createElement(p,{key:`${c.type}-${c.id}`,name:"Raw Data",metric:c});case"raw_document":return l.createElement(l.Fragment,null,l.createElement(p,{key:`${c.type}-${c.id}`,name:"Raw Document",metric:c}),l.createElement(ee.F,{severity:"warning",title:"The 'Raw Document' query type is deprecated."}));default:return l.createElement(zt,{key:`${c.type}-${c.id}`,label:`Metric (${c.id})`,hidden:c.hide,onHideClick:()=>s(_e(c.id)),onRemoveClick:n>1&&(()=>s(Ne(c.id)))},l.createElement(mr,{value:c}),N[c.type].impliedQueryType==="metrics"&&d===0&&l.createElement(ye.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:()=>s(Le(e)),tooltip:"Add metric","aria-label":"Add metric"}))}}))};var yr=y(94354);const vr=[{value:"metrics",label:"Metrics"},{value:"logs",label:"Logs"},{value:"raw_data",label:"Raw Data"},{value:"raw_document",label:"Raw Document"}];function Er(e){switch(e){case"logs":case"raw_data":case"raw_document":return e;case"metrics":return"count";default:throw new Error(`invalid query type: ${e}`)}}const br=()=>{const e=ue(),s=k(),r=e.metrics?.[0];if(r==null)return null;const n=N[r.type].impliedQueryType,c=d=>{s(he({id:r.id,type:Er(d)}))};return l.createElement(yr.z,{fullWidth:!1,options:vr,value:n,onChange:c})};function $r(e){const[s,r]=(0,l.useState)(null);return(0,l.useEffect)(()=>{let n=!1;return e.getDatabaseVersion().then(c=>{n||r(c)},c=>{console.log(c)}),()=>{n=!0}},[e]),s}const Fr=({query:e,onChange:s,onRunQuery:r,datasource:n,range:c})=>{const d=$r(n),g=d!=null&&!it(d);return l.createElement(Qe,{datasource:n,onChange:s,onRunQuery:r,query:e,range:c||(0,G.E2)()},g&&l.createElement(ee.F,{title:nt}),l.createElement(Sr,{value:e}))},er=e=>({root:(0,i.css)`
    display: flex;
  `,queryItem:(0,i.css)`
    flex-grow: 1;
    margin: 0 ${e.spacing(.5)} ${e.spacing(.5)} 0;
  `}),tr=({value:e,onChange:s})=>{const r=(0,Y.of)(er);return l.createElement("div",{className:r.queryItem},l.createElement(ge.X,{query:e,onChange:s,placeholder:"Enter a lucene query",portalOrigin:"elasticsearch"}))},Sr=({value:e})=>{const s=k(),r=As(),n=(0,l.useId)(),c=(0,Y.of)(er),d=at(e),g=e.metrics?.every(E=>N[E.type].impliedQueryType==="metrics");return l.createElement(l.Fragment,null,l.createElement("div",{className:c.root},l.createElement(Z.c,{width:17},"Query type"),l.createElement("div",{className:c.queryItem},l.createElement(br,null))),l.createElement("div",{className:c.root},l.createElement(Z.c,{width:17},"Lucene Query"),l.createElement(tr,{onChange:E=>s(Rt(E)),value:e?.query}),d&&l.createElement(F.I,{label:"Alias",labelWidth:15,tooltip:"Aliasing only works for timeseries queries (when the last group is 'Date Histogram'). For all other query types this field is ignored.",htmlFor:n},l.createElement(I.p,{id:n,placeholder:"Alias Pattern",onBlur:E=>s(Lt(E.currentTarget.value)),defaultValue:e.alias}))),l.createElement(hr,{nextId:r}),g&&l.createElement(Ps,{nextId:r}))};var xr=y(61765),Ir=y(66025),Ar=y(68704),wr=y(77657),Cr=y(39748),Rs=y(67861),Mr=y(91062),Tr=y(32346),ds=y(32264),Ls=y(25994),sr=y(67061),Dr=y(17081),Pr=y(6709),Or=y(91890),Ns=y(29020),_s=y(35931),Vr=y(84596),Rr=y(55882),Lr=y(64078);const Nr=e=>{const{value:s,onChange:r,onDelete:n,suggestions:c,className:d}=e,g=(0,Y.of)(Qr),[E,S]=_r(s.datasourceUid),h=b=>T=>{r({...s,[b]:T.currentTarget.value})};return l.createElement("div",{className:d},l.createElement("div",{className:g.firstRow},l.createElement(F.I,{label:"Field",htmlFor:"elasticsearch-datasource-config-field",labelWidth:12,tooltip:"Can be exact field name or a regex pattern that will match on the field name."},l.createElement(I.p,{type:"text",id:"elasticsearch-datasource-config-field",value:s.field,onChange:h("field"),width:100})),l.createElement(ye.$n,{variant:"destructive",title:"Remove field",icon:"times",onClick:b=>{b.preventDefault(),n()}})),l.createElement(je.C,null,l.createElement("div",{className:g.urlField},l.createElement(Z.c,{htmlFor:"elasticsearch-datasource-internal-link",width:12},E?"Query":"URL"),l.createElement(Lr.l,{placeholder:E?"${__value.raw}":"http://example.com/${__value.raw}",value:s.url||"",onChange:b=>r({...s,url:b}),suggestions:c})),l.createElement("div",{className:g.urlDisplayLabelField},l.createElement(F.I,{label:"URL Label",htmlFor:"elasticsearch-datasource-url-label",labelWidth:14,tooltip:"Use to override the button label."},l.createElement(I.p,{type:"text",id:"elasticsearch-datasource-url-label",value:s.urlDisplayLabel,onChange:h("urlDisplayLabel")})))),l.createElement("div",{className:g.row},l.createElement(F.I,{label:"Internal link",labelWidth:12},l.createElement(Te.K,{label:"Internal link",value:E||!1,onChange:()=>{E&&r({...s,datasourceUid:void 0}),S(!E)}})),E&&l.createElement(Rr.s,{tracing:!0,onChange:b=>{r({...s,datasourceUid:b.uid})},current:s.datasourceUid})))};function _r(e){const[s,r]=(0,l.useState)(!!e),n=(0,Vr.A)(e);return(0,l.useEffect)(()=>{!n&&e&&!s&&r(!0),n&&!e&&s&&r(!1)},[n,e,s]),[s,r]}const Qr=()=>({firstRow:(0,i.css)`
    display: flex;
  `,nameField:(0,i.css)`
    flex: 2;
  `,regexField:(0,i.css)`
    flex: 3;
  `,row:(0,i.css)`
    display: flex;
    align-items: baseline;
  `,urlField:(0,i.css)`
    display: flex;
    flex: 1;
  `,urlDisplayLabelField:(0,i.css)`
    flex: 1;
  `}),Br=e=>({addButton:(0,i.css)`
      margin-right: 10px;
    `,container:(0,i.css)`
      margin-bottom: ${e.spacing(2)};
    `,dataLink:(0,i.css)`
      margin-bottom: ${e.spacing(1)};
    `}),jr=e=>{const{value:s,onChange:r}=e,n=(0,Y.of)(Br);return l.createElement(Ns.I,{title:"Data links",description:l.createElement(_s.H,{description:"Add links to existing fields. Links will be shown in log row details next to the field value.",suffix:"elasticsearch/#data-links",feature:"Elasticsearch data links"})},l.createElement("div",{className:n.container},s&&s.length>0&&l.createElement("div",{className:"gf-form-group"},s.map((c,d)=>l.createElement(Nr,{className:n.dataLink,key:d,value:c,onChange:g=>{const E=[...s];E.splice(d,1,g),r(E)},onDelete:()=>{const g=[...s];g.splice(d,1),r(g)},suggestions:[{value:Pr.c.valueRaw,label:"Raw value",documentation:"Raw value of the field",origin:Or.$0.Value}]}))),l.createElement(ye.$n,{type:"button",variant:"secondary",className:n.addButton,icon:"plus",onClick:c=>{c.preventDefault();const d=[...s||[],{field:"",url:""}];r(d)}},"Add")))},Qs=[{label:"No pattern",value:"none"},{label:"Hourly",value:"Hourly",example:"[logstash-]YYYY.MM.DD.HH"},{label:"Daily",value:"Daily",example:"[logstash-]YYYY.MM.DD"},{label:"Weekly",value:"Weekly",example:"[logstash-]GGGG.WW"},{label:"Monthly",value:"Monthly",example:"[logstash-]YYYY.MM"},{label:"Yearly",value:"Yearly",example:"[logstash-]YYYY"}],kr=({value:e,onChange:s})=>l.createElement(Ns.I,{title:"Elasticsearch details",description:l.createElement(_s.H,{description:"Specific settings for the Elasticsearch data source.",suffix:"elasticsearch/#index-settings",feature:"Elasticsearch details"})},l.createElement(F.I,{label:"Index name",htmlFor:"es_config_indexName",labelWidth:29,tooltip:"Name of your Elasticsearch index. You can use a time pattern, such as YYYY.MM.DD, or a wildcard for the index name."},l.createElement(I.p,{id:"es_config_indexName",value:e.jsonData.index??(e.database||""),onChange:qr(e,s),width:24,placeholder:"es-index-name",required:!0})),l.createElement(F.I,{label:"Pattern",htmlFor:"es_config_indexPattern",labelWidth:29,tooltip:"If you're using a pattern for your index, select the type, or no pattern."},l.createElement(A.l6,{inputId:"es_config_indexPattern",value:Qs.find(r=>r.value===(e.jsonData.interval===void 0?"none":e.jsonData.interval)),options:Qs,onChange:zr(e,s),width:24})),l.createElement(F.I,{label:"Time field name",htmlFor:"es_config_timeField",labelWidth:29,tooltip:"Name of your time field. Defaults to @timestamp."},l.createElement(I.p,{id:"es_config_timeField",value:e.jsonData.timeField||"",onChange:Bs("timeField",e,s),width:24,placeholder:"@timestamp",required:!0})),l.createElement(F.I,{label:"Max concurrent Shard Requests",htmlFor:"es_config_shardRequests",labelWidth:29,tooltip:"Maximum number of concurrent shards a search request can hit per node. Defaults to 5."},l.createElement(I.p,{id:"es_config_shardRequests",value:e.jsonData.maxConcurrentShardRequests||"",onChange:Bs("maxConcurrentShardRequests",e,s),width:24})),l.createElement(F.I,{label:"Min time interval",htmlFor:"es_config_minTimeInterval",labelWidth:29,tooltip:l.createElement(l.Fragment,null,"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example"," ",l.createElement("code",null,"1m")," if your data is written every minute."),error:"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s",invalid:!!e.jsonData.timeInterval&&!/^\d+(ms|[Mwdhmsy])$/.test(e.jsonData.timeInterval)},l.createElement(I.p,{id:"es_config_minTimeInterval",value:e.jsonData.timeInterval||"",onChange:Bs("timeInterval",e,s),width:24,placeholder:"10s"})),l.createElement(F.I,{label:"Include Frozen Indices",htmlFor:"es_config_frozenIndices",labelWidth:29,tooltip:"Include frozen indices in searches."},l.createElement(Te.K,{id:"es_config_frozenIndices",value:e.jsonData.includeFrozen??!1,onChange:Wr("includeFrozen",e,s)}))),qr=(e,s)=>r=>{s({...e,database:"",jsonData:{...e.jsonData,index:r.currentTarget.value}})},Bs=(e,s,r)=>n=>{r({...s,jsonData:{...s.jsonData,[e]:n.currentTarget.value}})},Wr=(e,s,r)=>n=>{r({...s,jsonData:{...s.jsonData,[e]:n.currentTarget.checked}})},zr=(e,s)=>r=>{const n=r.value==="none"?void 0:r.value,c=e.jsonData.index??e.database;if(!c||c.length===0||c.startsWith("[logstash-]")){let d="";if(n!==void 0){const g=Qs.find(E=>E.value===n);g&&(d=g.example??"")}s({...e,database:"",jsonData:{...e.jsonData,index:d,interval:n}})}else s({...e,jsonData:{...e.jsonData,interval:n}})};function Hr(){return 5}const Ur=e=>{const{value:s,onChange:r}=e,n=c=>d=>{r({...s,[c]:d.currentTarget.value})};return l.createElement(Ns.I,{title:"Logs",description:l.createElement(_s.H,{description:"Configure which fields the data source uses for log messages and log levels.",suffix:"elasticsearch/#logs",feature:"Elasticsearch log fields"})},l.createElement(F.I,{label:"Message field name",labelWidth:22,tooltip:"Configure the field to be used for log messages."},l.createElement(I.p,{id:"es_logs-config_logMessageField",value:s.logMessageField,onChange:n("logMessageField"),placeholder:"_source",width:24})),l.createElement(F.I,{label:"Level field name",labelWidth:22,tooltip:"Configure the field that determines the level of each log message."},l.createElement(I.p,{id:"es_logs-config_logLevelField",value:s.logLevelField,onChange:n("logLevelField"),width:24})))},Gr=e=>({...e,jsonData:{...e.jsonData,timeField:e.jsonData.timeField||"@timestamp",maxConcurrentShardRequests:e.jsonData.maxConcurrentShardRequests||Hr(),logMessageField:e.jsonData.logMessageField||"",logLevelField:e.jsonData.logLevelField||"",includeFrozen:e.jsonData.includeFrozen??!1}}),Yr=e=>!!e.jsonData.timeField&&!!e.jsonData.maxConcurrentShardRequests&&e.jsonData.logMessageField!==void 0&&e.jsonData.logLevelField!==void 0,Kr=e=>{const{options:s,onOptionsChange:r}=e;(0,l.useEffect)(()=>{Yr(s)||r(Gr(s))},[r,s]);const n=(0,Ir.pe)({config:s,onChange:r});return ds.$.sigV4AuthEnabled&&(n.customMethods=[{id:"custom-sigv4",label:"SigV4 auth",description:"AWS Signature Version 4 authentication",component:l.createElement(xr._r,{inExperimentalAuthComponent:!0,...e})}],n.selectedMethod=s.jsonData.sigV4Auth?"custom-sigv4":n.selectedMethod),l.createElement(l.Fragment,null,s.access==="direct"&&l.createElement(ee.F,{title:"Error",severity:"error"},"Browser access mode in the Elasticsearch datasource is no longer available. Switch to server access mode."),l.createElement(Ar.I,{dataSourceName:"Elasticsearch",docsLink:"https://grafana.com/docs/grafana/latest/datasources/elasticsearch",hasRequiredFields:!1}),l.createElement(Ls.c,{spacing:4}),l.createElement(wr.u,{config:s,onChange:r,urlPlaceholder:"http://localhost:9200"}),l.createElement(Ls.c,{spacing:4}),l.createElement(Cr.N,{...n,onAuthMethodSelect:c=>{r({...s,basicAuth:c===Rs.q.BasicAuth,withCredentials:c===Rs.q.CrossSiteCredentials,jsonData:{...s.jsonData,sigV4Auth:c==="custom-sigv4",oauthPassThru:c===Rs.q.OAuthForward}})}}),l.createElement(Ls.c,{spacing:4}),l.createElement(Mr.A,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!0},l.createElement(sr.B,{gap:5,direction:"column"},l.createElement(Tr.g,{config:s,onChange:r}),ds.$.secureSocksDSProxyEnabled&&l.createElement(Dr.Y,{options:s,onOptionsChange:r}),l.createElement(kr,{value:s,onChange:r}),l.createElement(Ur,{value:s.jsonData,onChange:c=>r({...s,jsonData:c})}),l.createElement(jr,{value:s.jsonData.dataLinks,onChange:c=>{r({...s,jsonData:{...s.jsonData,dataLinks:c}})}}))))};var Zr=y(51553),fs=y(65474),gs=y(62467),js=y(66847),rr=y(69862),Jr=y(2174),Xr=y(41560),ei=y(57532),St=y(81160),ti=y(59099),X=y(9557),si=y(65879),ks=y(41987),U=y(47232),ri=y(26657),ii=y(72574),ni=y(19347);const ir={Hourly:{startOf:"hour",amount:"hours"},Daily:{startOf:"day",amount:"days"},Weekly:{startOf:"isoWeek",amount:"weeks"},Monthly:{startOf:"month",amount:"months"},Yearly:{startOf:"year",amount:"years"}};class ai{constructor(s,r){this.pattern=s,this.interval=r,this.dateLocale="en"}getIndexForToday(){return this.interval?(0,U.yT)().locale(this.dateLocale).format(this.pattern):this.pattern}getIndexList(s,r){if(!this.interval)return this.pattern;const c=ir[this.interval],d=(0,U.KQ)(s||(0,U.KQ)(r).add(-7,c.amount)).utc().startOf(c.startOf),g=(0,U.KQ)(r||(0,U.KQ)(s).add(7,c.amount)).utc().startOf(c.startOf).valueOf(),E=[];for(;d.valueOf()<=g;)E.push(d.locale(this.dateLocale).format(this.pattern)),d.add(1,c.amount);return E}}var ps=y(73372);class li extends x.Is{constructor(s,r){super(),this.datasource=s,Object.assign(this,r)}importFromAbstractQuery(s){return{metrics:[{id:"1",type:"logs"}],query:this.getElasticsearchQuery(s.labelMatchers),refId:s.refId}}getElasticsearchQuery(s){return s.map(r=>{switch(r.operator){case ps.D_.Equal:return r.name+':"'+r.value+'"';case ps.D_.NotEqual:return"-"+r.name+':"'+r.value+'"';case ps.D_.EqualRegEx:return r.name+":/"+r.value+"/";case ps.D_.NotEqualRegEx:return"-"+r.name+":/"+r.value+"/"}}).join(" AND ")}}var oi=y(9e4),ms=y(81580);function ci(e){const s=e.annotation,r=e.onAnnotationChange;return l.createElement(sr.B,{direction:"column",gap:5},l.createElement("div",null,l.createElement(tr,{value:s.target?.query,onChange:n=>{const d={...s.target??{refId:"annotation_query"},query:n};r({...s,target:d})}})),l.createElement("div",null,l.createElement("h6",null,"Field mappings"),l.createElement(oi.U,null,l.createElement(ms.c,{label:"Time"},l.createElement(I.p,{type:"text",placeholder:"@timestamp",value:s.timeField,onChange:n=>{r({...s,timeField:n.currentTarget.value})}})),l.createElement(ms.c,{label:"Time End"},l.createElement(I.p,{type:"text",value:s.timeEndField,onChange:n=>{r({...s,timeEndField:n.currentTarget.value})}})),l.createElement(ms.c,{label:"Text"},l.createElement(I.p,{type:"text",value:s.textField,onChange:n=>{r({...s,textField:n.currentTarget.value})}})),l.createElement(ms.c,{label:"Tags"},l.createElement(I.p,{type:"text",placeholder:"tags",value:s.tagsField,onChange:n=>{r({...s,tagsField:n.currentTarget.value})}})))),l.createElement("div",null))}function ui(e){return!e||typeof e!="object"?!1:"meta"in e}var Ye=y(94601);function hs(e,s,r,n=""){return nr(e,s,r,n)!==null}function nr(e,s,r,n=""){const c=`${n}${Ye.term.escape(s)}`;r=Ye.phrase.escape(r);let d=ur(e);return d?qs(d,c,r):null}function qs(e,s,r){return Object.keys(e).length===0?null:cr(e.left)?qs(e.left,s,r):ys(e.left)&&e.left.field===s&&e.left.term===r?e.left:Hs(e)?null:ys(e.right)&&e.right.field===s&&e.right.term===r?e.right:Us(e.right)?qs(e.right,s,r):null}function xt(e,s,r,n=""){if(hs(e,s,r,n))return e;s=or(s),r=zs(r);const c=`${n}${s}:"${r}"`;return ar(e,c)}function ar(e,s,r="AND"){return s?e.trim()===""?s:`${e} ${r} ${s}`:e}function di(e,s){if(!s.key||!s.value)return e;if(s={...s,value:s.value.toString()},["=","!="].includes(s.operator))return xt(e,s.key,s.value,s.operator==="="?"":"-");const n=or(s.key),c=zs(s.value);let d="";switch(s.operator){case"=~":d=`${n}:/${c}/`;break;case"!~":d=`-${n}:/${c}/`;break;case">":d=`${n}:>${c}`;break;case"<":d=`${n}:<${c}`;break}return ar(e,d)}function lr(e,s,r,n=""){const c=nr(e,s,r,n),d=ur(e);return!c||!d?e:Ye.toString(Ws(d,c))}function Ws(e,s){return Object.keys(e).length===0?e:cr(e.left)?(e.left=Ws(e.left,s),e):ys(e.left)&&(0,R.isEqual)(e.left,s)?(Object.assign(e,{left:void 0,operator:void 0,right:void 0},"right"in e?e.right:{}),e):Hs(e)?e:ys(e.right)&&(0,R.isEqual)(e.right,s)?(Object.assign(e,{right:void 0,operator:void 0}),e):(Us(e.right)&&(e.right=Ws(e.right,s)),e)}function or(e){return Ye.term.escape(e)}function zs(e){return e=e.replace(/\\/g,"\\\\"),Ye.phrase.escape(e)}function fi(e){return e.replace(/(\w+)\s(:)/gi,"$1$2")}function Hs(e){return!e||typeof e!="object"?!1:"left"in e&&!("right"in e)}function Us(e){return!e||typeof e!="object"?!1:"left"in e&&"right"in e}function cr(e){return Hs(e)||Us(e)}function ys(e){return!!(e&&typeof e=="object"&&"term"in e)}function ur(e){try{return Ye.parse(fi(e))}catch{return null}}function dr(e,s,r=!0){const n=`"${zs(s)}"`;return e.trim()?`${e} ${r?"AND":"NOT"} ${n}`:`${r?"":"NOT "}${n}`}var Gs=y(14110),gi=y(45622);const pi=({payload:{dashboardId:e,orgId:s,grafanaVersion:r,queries:n}})=>{try{const c=n[gi.id]?.filter(P=>!P.hide);if(!c?.length)return;const d=c.filter(hi),g=c.filter(P=>!!P.query),E=c.filter(P=>It(P)==="logs"),S=c.filter(P=>It(P)==="metric"),h=c.filter(P=>It(P)==="raw_data"),b=c.filter(P=>It(P)==="raw_document"),T=c.filter(mi),L={grafana_version:r,dashboard_id:e,org_id:s,queries_count:c.length,logs_queries_count:E.length,metric_queries_count:S.length,raw_data_queries_count:h.length,raw_document_queries_count:b.length,queries_with_template_variables_count:d.length,queries_with_changed_line_limit_count:T.length,queries_with_lucene_query_count:g.length};(0,Gs.rR)("grafana_elasticsearch_dashboard_loaded",L)}catch(c){console.error("error in elasticsearch tracking handler",c)}},It=e=>!e.metrics||!e.metrics.length?void 0:["logs","raw_data","raw_document"].includes(e.metrics[0].type)?e.metrics[0].type:"metric",fr=e=>{if(e.metrics?.[0]?.type!=="logs")return;const s=e.metrics?.[0].settings?.limit;return s?parseInt(s,10):void 0},mi=e=>{const s=fr(e);return s!==void 0&&s!==500},hi=e=>lt.test(e.query??""),yi=e=>!!e.startsWith(gr);function vi(e,s,r){const{targets:n,app:c}=s;if(!(c===ks.Jk.Dashboard||c===ks.Jk.PanelViewer))for(const d of n){if(yi(d.refId))return;(0,Gs.rR)("grafana_elasticsearch_query_executed",{app:c,grafana_version:ds.$.buildInfo.version,with_lucene_query:!!d.query,query_type:It(d),line_limit:fr(d),alias:d.alias,has_error:e.error!==void 0,has_data:e.data.some(g=>g.length>0),simultaneously_sent_query_count:n.length,time_range_from:s?.range?.from?.toISOString(),time_range_to:s?.range?.to?.toISOString(),time_taken:Date.now()-r.getTime()})}}function Ei(e){(0,Gs.rR)("grafana_elasticsearch_annotation_query_executed",{grafana_version:ds.$.buildInfo.version,has_target_query:!!e.target?.query,has_query:!!e.query,has_time_field:!!e.timeField,has_time_end_field:!!e.timeEndField,has_tags_field:!!e.tagsField,has_text_field:!!e.textField,has_index:!!e.index})}const Mi={filters:[]},Ti={pipelineVariables:[]},Di={bucketAggs:[],metrics:[]},bi=e=>e&&typeof e=="object"&&"responses"in e&&Array.isArray(e.responses)&&e.responses.find(s=>typeof s=="object"&&s!==null&&"hits"in s&&typeof s.hits=="object"&&s.hits!==null&&"hits"in s.hits&&Array.isArray(s.hits.hits)),$i=e=>e&&typeof e=="object"&&"responses"in e&&Array.isArray(e.responses)&&e.responses.find(s=>typeof s=="object"&&s!==null&&"aggregations"in s&&typeof s.aggregations=="object"&&s.aggregations!==null&&Object.keys(s.aggregations).length>0),gr="log-volume-",pr="log-sample-",Fi=["_index","_type","_id","_source","_size","_field_names","_ignored","_routing","_meta"];class Si extends ri.iy{constructor(s,r=(0,ii.w)()){super(s),this.templateSrv=r,this.getLogRowContext=async(c,d)=>{const g=this.makeLogContextDataRequest(c,d);return(0,re.s)(this.query(g).pipe((0,js.W)(E=>{throw{message:"Error during context query. Please check JS console logs.",status:E.status,statusText:E.statusText}})))},this.makeLogContextDataRequest=(c,d)=>{const g=d?.direction||X.ZF.Backward,E={type:"logs",id:"1",settings:{limit:d?.limit?d?.limit.toString():"10",sortDirection:g===X.ZF.Backward?"desc":"asc",searchAfter:c.dataFrame.fields.find(P=>P.name==="sort")?.values[c.rowIndex]??[c.timeEpochMs]}},S={refId:`log-context-${c.dataFrame.refId}-${g}`,metrics:[E],query:""},h=Ai(c.timeEpochMs,g,this.intervalPattern),b={from:h.from,to:h.to,raw:h},T=si.calculateInterval(b,1);return{requestId:`log-context-request-${c.dataFrame.refId}-${d?.direction}`,targets:[S],interval:T.interval,intervalMs:T.intervalMs,range:b,scopedVars:{},timezone:"UTC",app:ks.Jk.Explore,startTime:Date.now(),hideFromInspector:!0}},this.basicAuth=s.basicAuth,this.withCredentials=s.withCredentials,this.url=s.url,this.name=s.name,this.isProxyAccess=s.access==="proxy";const n=s.jsonData||{};this.index=n.index??s.database??"",this.timeField=n.timeField,this.indexPattern=new ai(this.index,n.interval),this.intervalPattern=n.interval,this.interval=n.timeInterval,this.maxConcurrentShardRequests=n.maxConcurrentShardRequests,this.queryBuilder=new pt({timeField:this.timeField}),this.logMessageField=n.logMessageField||"",this.logLevelField=n.logLevelField||"",this.dataLinks=n.dataLinks||[],this.includeFrozen=n.includeFrozen??!1,this.databaseVersion=null,this.annotations={QueryEditor:ci},this.logMessageField===""&&(this.logMessageField=void 0),this.logLevelField===""&&(this.logLevelField=void 0),this.languageProvider=new li(this)}getResourceRequest(s,r,n){return this.getResource(s,r,n)}postResourceRequest(s,r,n){const c=n??{};return c.headers=c.headers??{},c.headers["content-type"]="application/x-ndjson",this.postResource(s,r,c)}async importFromAbstractQueries(s){return s.map(r=>this.languageProvider.importFromAbstractQuery(r))}requestAllIndices(s=(0,G.E2)()){let r=this.indexPattern.getIndexList(s.from,s.to);Array.isArray(r)||(r=[this.indexPattern.getIndexForToday()]);const n="_mapping",c=r.map(E=>(E=E.replace(/\/$/,""),E===""?n:`${E}/${n}`)),d=7,g=c.length;return(0,Zr.c)({initialState:0,condition:E=>E<Math.min(g,d),iterate:E=>E+1}).pipe((0,rr.Z)(E=>{const S=c[g-E-1];return(0,fs.H)(this.getResource(S)).pipe((0,js.W)(h=>(0,gs.of)({err:h})))}),(0,Jr.j)(E=>E?.err?.status===404),(0,Xr.v)(()=>"Could not find an available index for this time range."),(0,ei.$)(),(0,St.T)(E=>{if(E.err)throw E.err;return E}))}annotationQuery(s){const r=this.prepareAnnotationRequest(s);Ei(s.annotation);const n=(0,fs.H)(this.postResourceRequest("_msearch",r));return(0,re.s)(n.pipe((0,St.T)(c=>{if(!bi(c))return[];const d=c?.responses[0].hits?.hits??[];return this.processHitsToAnnotationEvents(s.annotation,d)})))}prepareAnnotationRequest(s){const r=s.annotation,n=r.timeField||"@timestamp",c=r.timeEndField||null,S=s.dashboard.getVariables().filter(Ee=>Ee.type==="adhoc").filter(Ee=>Ee.datasource?.uid===r.datasource.uid).map(Ee=>Ee.filters).flat(),h=r.query??r.target?.query??"",b=[],T={};if(T[n]={from:s.range.from.valueOf(),to:s.range.to.valueOf(),format:"epoch_millis"},b.push({range:T}),c){const Ee={};Ee[c]={from:s.range.from.valueOf(),to:s.range.to.valueOf(),format:"epoch_millis"},b.push({range:Ee})}const L=this.interpolateLuceneQuery(h),P=this.addAdHocFilters(L,S),z={bool:{filter:[{bool:{should:b,minimum_should_match:1}}]}};P&&z.bool.filter.push({query_string:{query:P}});const Ci={query:z,size:1e4},Ys={search_type:"query_then_fetch",ignore_unavailable:!0};return r.index?Ys.index=r.index:Ys.index=this.indexPattern.getIndexList(s.range.from,s.range.to),JSON.stringify(Ys)+`
`+JSON.stringify(Ci)+`
`}processHitsToAnnotationEvents(s,r){const n=s.timeField||"@timestamp",c=s.timeEndField||null,d=s.textField||"tags",g=s.tagsField||null,E=[],S=(h,b)=>{if(!b)return;const T=b.split(".");let L=h;for(let P=0;P<T.length;P++)if(L=L[T[P]],!L)return"";return L};for(let h=0;h<r.length;h++){const b=r[h]._source;let T=S(b,n);if(typeof r[h].fields<"u"){const z=r[h].fields;typeof z=="object"&&((0,R.isString)(z[n])||(0,R.isNumber)(z[n]))&&(T=z[n])}const L={annotation:s,time:(0,U.yT)(T).valueOf(),text:S(b,d)};if(c){const z=S(b,c);z&&(L.timeEnd=(0,U.yT)(z).valueOf())}if(s.titleField){const z=S(b,s.titleField);z&&(L.text=z+`
`+L.text)}const P=S(b,g);typeof P=="string"?L.tags=P.split(","):L.tags=P,E.push(L)}return E}interpolateLuceneQuery(s,r){return this.templateSrv.replace(s,r,"lucene")}interpolateVariablesInQueries(s,r,n){return s.map(c=>this.applyTemplateVariables(c,r,n))}async testDatasource(){const s=await this.getDatabaseVersion(!1),n=(s!=null?it(s):!0)?"":`WARNING: ${nt} `;return(0,re.s)(this.getFields(["date"]).pipe((0,rr.Z)(c=>(0,R.find)(c,{text:this.timeField})?(0,gs.of)({status:"success",message:`${n}Data source successfully connected.`}):(0,gs.of)({status:"error",message:"No date field named "+this.timeField+" found"})),(0,js.W)(c=>{const g=`Unable to connect with Elasticsearch${c.message?` (${c.message})`:""}. Please check the server logs for more details.`;return(0,gs.of)({status:"error",message:g})})))}getQueryHeader(s,r,n){const c={search_type:s,ignore_unavailable:!0,index:this.indexPattern.getIndexList(r,n)};return JSON.stringify(c)}getQueryDisplayText(s){const r=s.metrics,n=s.bucketAggs;let c="";return s.query&&(c+="Query: "+s.query+", "),c+="Metrics: ",c+=r?.reduce((d,g)=>{let S=N[g.type].label+"(";return le(g)&&(S+=g.field),Pe(g)&&(S+=Re(g).replace(new RegExp("params.","g"),"")),S+="), ",`${d} ${S}`},""),c+=n?.reduce((d,g,E)=>{const S=Q[g.type];let h="";return E===0&&(h+=" Group by: "),h+=S.label+"(",ke(g)&&(h+=g.field),`${d} ${h}), `},""),s.alias&&(c+="Alias: "+s.alias),c}getSupplementaryRequest(s,r){switch(s){case X.cF.LogsVolume:return this.getLogsVolumeDataProvider(r);case X.cF.LogsSample:return this.getLogsSampleDataProvider(r);default:return}}getSupportedSupplementaryQueryTypes(){return[X.cF.LogsVolume,X.cF.LogsSample]}getSupplementaryQuery(s,r){let n=!1;switch(s.type){case X.cF.LogsVolume:if(n=r.metrics?.length===1&&r.metrics[0].type==="logs",!n)return;const c=[],d=this.timeField??"@timestamp";return this.logLevelField&&c.push({id:"2",type:"terms",settings:{min_doc_count:"0",size:"0",order:"desc",orderBy:"_count",missing:X.$b.unknown},field:this.logLevelField}),c.push({id:"3",type:"date_histogram",settings:{interval:"auto",min_doc_count:"0",trimEdges:"0"},field:d}),{refId:`${gr}${r.refId}`,query:r.query,metrics:[{type:"count",id:"1"}],timeField:d,bucketAggs:c};case X.cF.LogsSample:return n=at(r),n?s.limit?{refId:`${pr}${r.refId}`,query:r.query,metrics:[{type:"logs",id:"1",settings:{limit:s.limit.toString()}}]}:{refId:`${pr}${r.refId}`,query:r.query,metrics:[{type:"logs",id:"1"}]}:void 0;default:return}}getLogsVolumeDataProvider(s){const r=(0,R.cloneDeep)(s),n=r.targets.map(c=>this.getSupplementaryQuery({type:X.cF.LogsVolume},c)).filter(c=>!!c);if(n.length)return{...r,targets:n}}getLogsSampleDataProvider(s){const r=(0,R.cloneDeep)(s),d=r.targets.map(g=>this.getSupplementaryQuery({type:X.cF.LogsSample,limit:100},g)).filter(g=>!!g);if(d.length)return{...r,targets:d}}query(s){const r=new Date;return super.query(s).pipe((0,ti.M)(n=>vi(n,s,r)),(0,St.T)(n=>(n.data.forEach(c=>{xi(c,this.dataLinks)}),n)))}filterQuery(s){return!s.hide}isMetadataField(s){return Fi.includes(s)}getFields(s,r){const n={float:"number",double:"number",integer:"number",long:"number",date:"date",date_nanos:"date",string:"string",text:"string",scaled_float:"number",nested:"nested",histogram:"number"};return this.requestAllIndices(r).pipe((0,St.T)(c=>{const d=(h,b)=>this.isMetadataField(b)?!1:!s||s.length===0?!0:s.includes(h.type)||s.includes(n[h.type]),g=[],E={};function S(h){for(const b in h){const T=h[b];if((0,R.isObject)(T.properties)&&(g.push(b),S(T.properties)),(0,R.isObject)(T.fields)&&(g.push(b),S(T.fields)),(0,R.isString)(T.type)){const L=g.concat(b).join(".");d(T,b)&&(E[L]={text:L,type:T.type})}}g.pop()}for(const h in c){const b=c[h];if(b&&b.mappings){const L=b.mappings.properties;S(L)}}return(0,R.map)(E,h=>h)}))}getTerms(s,r=(0,G.E2)()){const c=this.getQueryHeader("query_then_fetch",r.from,r.to);let d=JSON.stringify(this.queryBuilder.getTermsQuery(s));d=d.replace(/\$timeFrom/g,r.from.valueOf().toString()),d=d.replace(/\$timeTo/g,r.to.valueOf().toString()),d=c+`
`+d+`
`;const g=this.getMultiSearchUrl();return(0,fs.H)(this.postResourceRequest(g,d)).pipe((0,St.T)(E=>{if(!$i(E))return[];if(!E||!E.responses[0].aggregations)return[];const S=E.responses[0].aggregations[1].buckets;return(0,R.map)(S,h=>({text:h.key_as_string||h.key,value:h.key}))}))}getMultiSearchUrl(){const s=new URLSearchParams;return this.maxConcurrentShardRequests&&s.append("max_concurrent_shard_requests",`${this.maxConcurrentShardRequests}`),this.includeFrozen&&s.append("ignore_throttled","false"),("_msearch?"+s.toString()).replace(/\?$/,"")}metricFindQuery(s,r){const n=r?.range,c=JSON.parse(s);if(s){if(c.find==="fields")return c.type=this.interpolateLuceneQuery(c.type),(0,re.s)(this.getFields(c.type,n));if(c.find==="terms")return c.field=this.interpolateLuceneQuery(c.field),c.query=this.interpolateLuceneQuery(c.query),(0,re.s)(this.getTerms(c,n))}return Promise.resolve([])}getTagKeys(){return(0,re.s)(this.getFields())}getTagValues(s){return(0,re.s)(this.getTerms({field:s.key},s.timeRange))}targetContainsTemplate(s){if(this.templateSrv.containsTemplate(s.query)||this.templateSrv.containsTemplate(s.alias))return!0;if(s.bucketAggs){for(const r of s.bucketAggs)if(ke(r)&&this.templateSrv.containsTemplate(r.field)||this.objectContainsTemplate(r.settings))return!0}if(s.metrics){for(const r of s.metrics)if(le(r)&&(r.field&&this.templateSrv.containsTemplate(r.field)||r.settings&&this.objectContainsTemplate(r.settings)||ui(r)&&this.objectContainsTemplate(r.meta)))return!0}return!1}objectContainsTemplate(s){if(typeof s=="string")return this.templateSrv.containsTemplate(s);if(!s||typeof s!="object")return!1;for(const r in s)if(Array.isArray(s[r])){for(const n of s[r])if(this.objectContainsTemplate(n))return!0}else if(this.objectContainsTemplate(s[r]))return!0;return!1}toggleQueryFilter(s,r){let n=s.query??"";switch(r.type){case"FILTER_FOR":{n=hs(n,r.options.key,r.options.value)?lr(n,r.options.key,r.options.value):xt(n,r.options.key,r.options.value);break}case"FILTER_OUT":{hs(n,r.options.key,r.options.value)&&(n=lr(n,r.options.key,r.options.value)),n=xt(n,r.options.key,r.options.value,"-");break}}return{...s,query:n}}queryHasFilter(s,r){let n=s.query??"";return hs(n,r.key,r.value)}modifyQuery(s,r){if(!r.options)return s;let n=s.query??"";switch(r.type){case"ADD_FILTER":{n=xt(n,r.options.key,r.options.value);break}case"ADD_FILTER_OUT":{n=xt(n,r.options.key,r.options.value,"-");break}case"ADD_STRING_FILTER":{n=dr(n,r.options.value);break}case"ADD_STRING_FILTER_OUT":{n=dr(n,r.options.value,!1);break}}return{...s,query:n}}getSupportedQueryModifications(){return["ADD_FILTER","ADD_FILTER_OUT","ADD_STRING_FILTER","ADD_STRING_FILTER_OUT"]}addAdHocFilters(s,r){if(!r)return s;let n=s;return r.forEach(c=>{n=di(n,c)}),n}applyTemplateVariables(s,r,n){const c=E=>E.type==="filters"?{...E,settings:{...E.settings,filters:E.settings?.filters?.map(S=>({...S,query:this.interpolateLuceneQuery(S.query,r)||"*"}))}}:E,d={...s,datasource:this.getRef(),query:this.addAdHocFilters(this.interpolateLuceneQuery(s.query||"",r),n),bucketAggs:s.bucketAggs?.map(c)};return JSON.parse(this.templateSrv.replace(JSON.stringify(d),r))}getDatabaseVersionUncached(){const s=(0,fs.H)(this.getResourceRequest(""));return(0,re.s)(s).then(r=>{const n=r?.version?.number;if(typeof n!="string")return null;try{return new Fe.SemVer(n)}catch(c){return console.error(c),null}},r=>(console.error(r),null))}async getDatabaseVersion(s=!0){if(s){const n=this.databaseVersion;if(n!=null)return n}const r=await this.getDatabaseVersionUncached();return this.databaseVersion=r,r}}function xi(e,s){if(s.length)for(const r of e.fields){const n=s.filter(c=>new RegExp(c.field).test(r.name));n.length!==0&&(r.config=r.config||{},r.config.links=[...(r.config.links,n.map(Ii))])}}function Ii(e){const s=(0,ni.l)();if(e.datasourceUid){const r=s.getInstanceSettings(e.datasourceUid);return{title:e.urlDisplayLabel||"",url:"",internal:{query:{query:e.url},datasourceUid:e.datasourceUid,datasourceName:r?.name??"Data source not found"}}}else return{title:e.urlDisplayLabel||"",url:e.url}}function Ai(e,s,r){if(r){const c=ir[r];return s===X.ZF.Forward?{from:(0,U.KQ)(e).utc(),to:(0,U.KQ)(e).add(7,c.amount).utc().startOf(c.startOf)}:{from:(0,U.KQ)(e).subtract(7,c.amount).utc().startOf(c.startOf),to:(0,U.KQ)(e).utc()}}else return s===X.ZF.Forward?{from:(0,U.KQ)(e).utc(),to:(0,U.KQ)(e).add(7,"hours").utc()}:{from:(0,U.KQ)(e).subtract(7,"hours").utc(),to:(0,U.KQ)(e).utc()}}const wi=new x.tD(Si).setQueryEditor(Fr).setConfigEditor(Kr);(0,O.J7)().subscribe(f.gc,pi)},27487:(be,B)=>{B.escape=function(O){return O.replace(/[\+\-\!\(\)\{\}\[\]\^\"\?\:\\\&\|\'\/\s\*\~]/g,y)};function y(f){return"\\"+f}B.unescape=function(O){return O.replace(/\\([\+\-\!\(\)\{\}\[\]\^\"\?\:\\\&\|\'\/\s\*\~])/g,x)};function x(f,O){return O}B.escapePhrase=function(O){return O.replace(/"/g,y)},B.unescapePhrase=function(O){return O.replace(/\\(")/g,x)}},94601:(be,B,y)=>{"use strict";var x=y(79148),f=y(27487);B.parse=x.parse.bind(x),B.toString=y(20559),B.term={escape:f.escape,unescape:f.unescape},B.phrase={escape:f.escapePhrase,unescape:f.unescapePhrase}},79148:be=>{"use strict";function B(f,O){function i(){this.constructor=f}i.prototype=O.prototype,f.prototype=new i}function y(f,O,i,l){this.message=f,this.expected=O,this.found=i,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,y)}B(y,Error),y.buildMessage=function(f,O){var i={literal:function(F){return'"'+G(F.text)+'"'},class:function(F){var I="",_;for(_=0;_<F.parts.length;_++)I+=F.parts[_]instanceof Array?ee(F.parts[_][0])+"-"+ee(F.parts[_][1]):ee(F.parts[_]);return"["+(F.inverted?"^":"")+I+"]"},any:function(F){return"any character"},end:function(F){return"end of input"},other:function(F){return F.description}};function l(F){return F.charCodeAt(0).toString(16).toUpperCase()}function G(F){return F.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(I){return"\\x0"+l(I)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(I){return"\\x"+l(I)})}function ee(F){return F.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(I){return"\\x0"+l(I)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(I){return"\\x"+l(I)})}function Y(F){return i[F.type](F)}function ge(F){var I=new Array(F.length),_,te;for(_=0;_<F.length;_++)I[_]=Y(F[_]);if(I.sort(),I.length>0){for(_=1,te=1;_<I.length;_++)I[_-1]!==I[_]&&(I[te]=I[_],te++);I.length=te}switch(I.length){case 1:return I[0];case 2:return I[0]+" or "+I[1];default:return I.slice(0,-1).join(", ")+", or "+I[I.length-1]}}function Z(F){return F?'"'+G(F)+'"':"end of input"}return"Expected "+ge(f)+" but "+Z(O)+" found."};function x(f,O){O=O!==void 0?O:{};var i={},l={start:es},G=es,ee=function(t){return t[0]},Y=function(){return{}},ge=function(t){return{operator:t}},Z=function(t,o,u,M){var m={start:t,left:o},M=M.length==0?null:M[0].right==null?M[0].left:M[0];return M!=null&&(m.operator=u==""?"<implicit>":u[0],m.right=M),m},F=function(t,o){return o},I=function(t,o,m){var p={left:t},m=m.length==0?null:m[0].right==null?m[0].left:m[0];return m!=null&&(p.operator=o==""?"<implicit>":o[0],p.right=m),p},_=function(t){return t},te="(",Ke=D("(",!1),k=")",Ze=D(")",!1),At=function(t){return t[0].parenthesized=!0,t[0]},wt=function(t,o){return o.field=t==null||t.label==""?"<implicit>":t.label,o.fieldLocation=t==null||t.label==""?null:t.location,o},Je=function(t,o){return o.field=t.label,o.fieldLocation=t.location,o},De=function(t,o){var u={field:t==null||t.label==""?"<implicit>":t.label,fieldLocation:t==null||t.label==""?null:t.location};for(var p in o)u[p]=o[p];return u},vs=/^[:]/,le=Me([":"],!1,!1),$e=function(t){return{label:t.label,location:t.location}},Pe=function(t,o,u,p){var m={term:o,quoted:!0,regex:!1,termLocation:He()};return u!=""&&(m.proximity=u),p!=""&&(m.boost=p),t!=""&&(m.prefix=t),m},Es=function(t,o){var u={term:o,quoted:!1,regex:!0,termLocation:He()};return u},Xe=function(t,o,u,p){var m={term:o.label,quoted:!1,regex:!1,termLocation:He()};return u!=""&&(m.similarity=u),p!=""&&(m.boost=p),t!=""&&(m.prefix=t),m},oe="\\",ne=D("\\",!1),Oe=function(t){return"\\"+t},Ct=".",N=D(".",!1),Ks=/^[^ \t\r\n\f{}()"\/\^~[\]]/,Mt=Me([" ","	","\r",`
`,"\f","{","}","(",")",'"',"/","^","~","[","]"],!0,!1),Tt=function(t){return t.join("")},bs=function(t){return{label:t.join(""),location:He()}},Dt=/^[^: \t\r\n\f{}()"\/\^~[\]]/,et=Me([":"," ","	","\r",`
`,"\f","{","}","(",")",'"',"/","^","~","[","]"],!0,!1),ce='"',pe=D('"',!1),Pt=function(t){return t.join("")},tt="/",st=D("/",!1),Zs=function(t){return t.join("")},Fe=Ts(),me=function(t){return t},Ve="+",rt=D("+",!1),Re="-",it=D("-",!1),nt="!",at=D("!",!1),lt="{",Ot=D("{",!1),V="}",Le=D("}",!1),Ne="[",_e=D("[",!1),Se="]",he=D("]",!1),ot="^",j=D("^",!1),Vt="?",xe=D("?",!1),Rt=":",Lt=D(":",!1),$s="&",Fs=D("&",!1),ct="|",Nt=D("|",!1),Q="'",_t=D("'",!1),Ie="~",ut=D("~",!1),Qt="*",Bt=D("*",!1),jt=" ",kt=D(" ",!1),q=function(t){return t},Ss=function(t){return t},xs=function(t){return t==""||t==null?.5:t},dt="0.",qt=D("0.",!1),Ae=/^[0-9]/,Qe=Me([["0","9"]],!1,!1),ft=function(t){return parseFloat("0."+t.join(""))},ue=function(t){return parseInt(t.join(""))},se="TO",Be=D("TO",!1),Wt=function(t,o){return{term_min:t,term_max:o,inclusive:"both"}},Is=function(t,o){return{term_min:t,term_max:o,inclusive:"none"}},As=function(t,o){return{term_min:t,term_max:o,inclusive:"left"}},ye=function(t,o){return{term_min:t,term_max:o,inclusive:"right"}},R=function(t){return t},je="OR NOT",we=D("OR NOT",!1),gt="AND NOT",zt=D("AND NOT",!1),Ht="OR",Ut=D("OR",!1),Ce="AND",re=D("AND",!1),ke="NOT",ws=D("NOT",!1),Gt="||",Cs=D("||",!1),Yt="&&",qe=D("&&",!1),ve=Ue("whitespace"),Kt=/^[ \t\r\n\f]/,Zt=Me([" ","	","\r",`
`,"\f"],!1,!1),a=0,A=0,We=[{line:1,column:1}],J=0,pt=[],v=0,ze;if("startRule"in O){if(!(O.startRule in l))throw new Error(`Can't start parsing from rule "`+O.startRule+'".');G=l[O.startRule]}function Ms(){return f.substring(A,a)}function He(){return de(A,a)}function Js(t,o){throw o=o!==void 0?o:de(A,a),Xt([Ue(t)],f.substring(A,a),o)}function Xs(t,o){throw o=o!==void 0?o:de(A,a),Ds(t,o)}function D(t,o){return{type:"literal",text:t,ignoreCase:o}}function Me(t,o,u){return{type:"class",parts:t,inverted:o,ignoreCase:u}}function Ts(){return{type:"any"}}function Jt(){return{type:"end"}}function Ue(t){return{type:"other",description:t}}function mt(t){var o=We[t],u;if(o)return o;for(u=t-1;!We[u];)u--;for(o=We[u],o={line:o.line,column:o.column};u<t;)f.charCodeAt(u)===10?(o.line++,o.column=1):o.column++,u++;return We[t]=o,o}function de(t,o){var u=mt(t),p=mt(o);return{start:{offset:t,line:u.line,column:u.column},end:{offset:o,line:p.line,column:p.column}}}function $(t){a<J||(a>J&&(J=a,pt=[]),pt.push(t))}function Ds(t,o){return new y(t,null,null,o)}function Xt(t,o,u){return new y(y.buildMessage(t,o),t,o,u)}function es(){var t,o,u,p;for(t=a,o=[],u=C();u!==i;)o.push(u),u=C();if(o!==i){if(u=[],p=ie(),p!==i)for(;p!==i;)u.push(p),p=ie();else u=i;u!==i?(A=t,o=ee(u),t=o):(a=t,t=i)}else a=t,t=i;if(t===i){for(t=a,o=[],u=C();u!==i;)o.push(u),u=C();o!==i&&(A=t,o=Y()),t=o,t===i&&(t=a,o=Ft(),o!==i&&(A=t,o=Y()),t=o)}return t}function ie(){var t,o,u,p,m,M;if(t=a,o=fe(),o!==i?(u=Ft(),u!==i?(A=t,o=ge(o),t=o):(a=t,t=i)):(a=t,t=i),t===i){if(t=a,o=fe(),o!==i)if(u=ts(),u!==i){for(p=[],m=fe();m!==i;)p.push(m),m=fe();if(p!==i){for(m=[],M=ie();M!==i;)m.push(M),M=ie();m!==i?(A=t,o=Z(o,u,p,m),t=o):(a=t,t=i)}else a=t,t=i}else a=t,t=i;else a=t,t=i;if(t===i&&(t=a,o=fe(),o!==i?(u=ie(),u!==i?(A=t,o=F(o,u),t=o):(a=t,t=i)):(a=t,t=i),t===i))if(t=a,o=ts(),o!==i){for(u=[],p=fe();p!==i;)u.push(p),p=fe();if(u!==i){for(p=[],m=ie();m!==i;)p.push(m),m=ie();p!==i?(A=t,o=I(o,u,p),t=o):(a=t,t=i)}else a=t,t=i}else a=t,t=i}return t}function ts(){var t,o,u,p;if(t=a,o=rs(),o!==i){for(u=[],p=C();p!==i;)u.push(p),p=C();u!==i?(A=t,o=_(o),t=o):(a=t,t=i)}else a=t,t=i;return t===i&&(t=ss()),t}function ss(){var t,o,u,p,m,M,w;if(t=a,f.charCodeAt(a)===40?(o=te,a++):(o=i,v===0&&$(Ke)),o!==i){for(u=[],p=C();p!==i;)u.push(p),p=C();if(u!==i){if(p=[],m=ie(),m!==i)for(;m!==i;)p.push(m),m=ie();else p=i;if(p!==i)if(f.charCodeAt(a)===41?(m=k,a++):(m=i,v===0&&$(Ze)),m!==i){for(M=[],w=C();w!==i;)M.push(w),w=C();M!==i?(A=t,o=At(p),t=o):(a=t,t=i)}else a=t,t=i;else a=t,t=i}else a=t,t=i}else a=t,t=i;return t}function rs(){var t,o,u;return t=a,o=ht(),o===i&&(o=null),o!==i?(u=Os(),u!==i?(A=t,o=wt(o,u),t=o):(a=t,t=i)):(a=t,t=i),t===i&&(t=a,o=ht(),o!==i?(u=ss(),u!==i?(A=t,o=Je(o,u),t=o):(a=t,t=i)):(a=t,t=i),t===i&&(t=a,o=ht(),o===i&&(o=null),o!==i?(u=H(),u!==i?(A=t,o=De(o,u),t=o):(a=t,t=i)):(a=t,t=i))),t}function ht(){var t,o,u,p,m;if(t=a,o=ns(),o!==i)if(vs.test(f.charAt(a))?(u=f.charAt(a),a++):(u=i,v===0&&$(le)),u!==i){for(p=[],m=C();m!==i;)p.push(m),m=C();p!==i?(A=t,o=$e(o),t=o):(a=t,t=i)}else a=t,t=i;else a=t,t=i;return t}function H(){var t,o,u,p,m,M,w;if(t=a,o=$t(),o===i&&(o=null),o!==i)if(u=Ps(),u!==i)if(p=os(),p===i&&(p=null),p!==i)if(m=W(),m===i&&(m=null),m!==i){for(M=[],w=C();w!==i;)M.push(w),w=C();M!==i?(A=t,o=Pe(o,u,p,m),t=o):(a=t,t=i)}else a=t,t=i;else a=t,t=i;else a=t,t=i;else a=t,t=i;if(t===i){if(t=a,o=$t(),o===i&&(o=null),o!==i)if(u=Te(),u!==i){for(p=[],m=C();m!==i;)p.push(m),m=C();p!==i?(A=t,o=Es(o,u),t=o):(a=t,t=i)}else a=t,t=i;else a=t,t=i;if(t===i)if(t=a,o=$t(),o===i&&(o=null),o!==i)if(u=ns(),u!==i)if(p=vt(),p===i&&(p=null),p!==i)if(m=W(),m===i&&(m=null),m!==i){for(M=[],w=C();w!==i;)M.push(w),w=C();M!==i?(A=t,o=Xe(o,u,p,m),t=o):(a=t,t=i)}else a=t,t=i;else a=t,t=i;else a=t,t=i;else a=t,t=i}return t}function is(){var t,o,u;return t=a,f.charCodeAt(a)===92?(o=oe,a++):(o=i,v===0&&$(ne)),o!==i?(u=Ge(),u!==i?(A=t,o=Oe(u),t=o):(a=t,t=i)):(a=t,t=i),t===i&&(f.charCodeAt(a)===46?(t=Ct,a++):(t=i,v===0&&$(N)),t===i&&(Ks.test(f.charAt(a))?(t=f.charAt(a),a++):(t=i,v===0&&$(Mt)))),t}function ae(){var t,o,u;if(t=a,o=[],u=is(),u!==i)for(;u!==i;)o.push(u),u=is();else o=i;return o!==i&&(A=t,o=Tt(o)),t=o,t}function ns(){var t,o,u;if(t=a,o=[],u=as(),u!==i)for(;u!==i;)o.push(u),u=as();else o=i;return o!==i&&(A=t,o=bs(o)),t=o,t}function as(){var t,o,u;return t=a,f.charCodeAt(a)===92?(o=oe,a++):(o=i,v===0&&$(ne)),o!==i?(u=Ge(),u!==i?(A=t,o=Oe(u),t=o):(a=t,t=i)):(a=t,t=i),t===i&&(f.charCodeAt(a)===46?(t=Ct,a++):(t=i,v===0&&$(N)),t===i&&(Dt.test(f.charAt(a))?(t=f.charAt(a),a++):(t=i,v===0&&$(et)))),t}function Ps(){var t,o,u,p;if(t=a,f.charCodeAt(a)===34?(o=ce,a++):(o=i,v===0&&$(pe)),o!==i){for(u=[],p=ls();p!==i;)u.push(p),p=ls();u!==i?(f.charCodeAt(a)===34?(p=ce,a++):(p=i,v===0&&$(pe)),p!==i?(A=t,o=Pt(u),t=o):(a=t,t=i)):(a=t,t=i)}else a=t,t=i;return t}function Te(){var t,o,u,p;if(t=a,f.charCodeAt(a)===47?(o=tt,a++):(o=i,v===0&&$(st)),o!==i){if(u=[],p=yt(),p!==i)for(;p!==i;)u.push(p),p=yt();else u=i;u!==i?(f.charCodeAt(a)===47?(p=tt,a++):(p=i,v===0&&$(st)),p!==i?(A=t,o=Zs(u),t=o):(a=t,t=i)):(a=t,t=i)}else a=t,t=i;return t}function ls(){var t,o,u;return t=a,o=a,v++,f.charCodeAt(a)===34?(u=ce,a++):(u=i,v===0&&$(pe)),u===i&&(f.charCodeAt(a)===92?(u=oe,a++):(u=i,v===0&&$(ne))),v--,u===i?o=void 0:(a=o,o=i),o!==i?(f.length>a?(u=f.charAt(a),a++):(u=i,v===0&&$(Fe)),u!==i?(A=t,o=me(u),t=o):(a=t,t=i)):(a=t,t=i),t===i&&(t=a,f.charCodeAt(a)===92?(o=oe,a++):(o=i,v===0&&$(ne)),o!==i?(u=Ge(),u!==i?(A=t,o=Oe(u),t=o):(a=t,t=i)):(a=t,t=i)),t}function yt(){var t,o,u;return t=a,o=a,v++,f.charCodeAt(a)===47?(u=tt,a++):(u=i,v===0&&$(st)),u===i&&(f.charCodeAt(a)===92?(u=oe,a++):(u=i,v===0&&$(ne))),v--,u===i?o=void 0:(a=o,o=i),o!==i?(f.length>a?(u=f.charAt(a),a++):(u=i,v===0&&$(Fe)),u!==i?(A=t,o=me(u),t=o):(a=t,t=i)):(a=t,t=i),t===i&&(t=a,f.charCodeAt(a)===92?(o=oe,a++):(o=i,v===0&&$(ne)),o!==i?(u=Ge(),u!==i?(A=t,o=Oe(u),t=o):(a=t,t=i)):(a=t,t=i)),t}function Ge(){var t;return f.charCodeAt(a)===43?(t=Ve,a++):(t=i,v===0&&$(rt)),t===i&&(f.charCodeAt(a)===45?(t=Re,a++):(t=i,v===0&&$(it)),t===i&&(f.charCodeAt(a)===33?(t=nt,a++):(t=i,v===0&&$(at)),t===i&&(f.charCodeAt(a)===40?(t=te,a++):(t=i,v===0&&$(Ke)),t===i&&(f.charCodeAt(a)===41?(t=k,a++):(t=i,v===0&&$(Ze)),t===i&&(f.charCodeAt(a)===123?(t=lt,a++):(t=i,v===0&&$(Ot)),t===i&&(f.charCodeAt(a)===125?(t=V,a++):(t=i,v===0&&$(Le)),t===i&&(f.charCodeAt(a)===91?(t=Ne,a++):(t=i,v===0&&$(_e)),t===i&&(f.charCodeAt(a)===93?(t=Se,a++):(t=i,v===0&&$(he)),t===i&&(f.charCodeAt(a)===94?(t=ot,a++):(t=i,v===0&&$(j)),t===i&&(f.charCodeAt(a)===34?(t=ce,a++):(t=i,v===0&&$(pe)),t===i&&(f.charCodeAt(a)===63?(t=Vt,a++):(t=i,v===0&&$(xe)),t===i&&(f.charCodeAt(a)===58?(t=Rt,a++):(t=i,v===0&&$(Lt)),t===i&&(f.charCodeAt(a)===92?(t=oe,a++):(t=i,v===0&&$(ne)),t===i&&(f.charCodeAt(a)===38?(t=$s,a++):(t=i,v===0&&$(Fs)),t===i&&(f.charCodeAt(a)===124?(t=ct,a++):(t=i,v===0&&$(Nt)),t===i&&(f.charCodeAt(a)===39?(t=Q,a++):(t=i,v===0&&$(_t)),t===i&&(f.charCodeAt(a)===47?(t=tt,a++):(t=i,v===0&&$(st)),t===i&&(f.charCodeAt(a)===126?(t=Ie,a++):(t=i,v===0&&$(ut)),t===i&&(f.charCodeAt(a)===42?(t=Qt,a++):(t=i,v===0&&$(Bt)),t===i&&(f.charCodeAt(a)===32?(t=jt,a++):(t=i,v===0&&$(kt)))))))))))))))))))))),t}function os(){var t,o,u;return t=a,f.charCodeAt(a)===126?(o=Ie,a++):(o=i,v===0&&$(ut)),o!==i?(u=bt(),u!==i?(A=t,o=q(u),t=o):(a=t,t=i)):(a=t,t=i),t}function W(){var t,o,u;return t=a,f.charCodeAt(a)===94?(o=ot,a++):(o=i,v===0&&$(j)),o!==i?(u=cs(),u!==i?(A=t,o=Ss(u),t=o):(a=t,t=i)):(a=t,t=i),t}function vt(){var t,o,u;return t=a,f.charCodeAt(a)===126?(o=Ie,a++):(o=i,v===0&&$(ut)),o!==i?(u=Et(),u===i&&(u=null),u!==i?(A=t,o=xs(u),t=o):(a=t,t=i)):(a=t,t=i),t}function cs(){var t;return t=Et(),t===i&&(t=bt()),t}function Et(){var t,o,u,p;if(t=a,f.substr(a,2)===dt?(o=dt,a+=2):(o=i,v===0&&$(qt)),o!==i){if(u=[],Ae.test(f.charAt(a))?(p=f.charAt(a),a++):(p=i,v===0&&$(Qe)),p!==i)for(;p!==i;)u.push(p),Ae.test(f.charAt(a))?(p=f.charAt(a),a++):(p=i,v===0&&$(Qe));else u=i;u!==i?(A=t,o=ft(u),t=o):(a=t,t=i)}else a=t,t=i;return t}function bt(){var t,o,u;if(t=a,o=[],Ae.test(f.charAt(a))?(u=f.charAt(a),a++):(u=i,v===0&&$(Qe)),u!==i)for(;u!==i;)o.push(u),Ae.test(f.charAt(a))?(u=f.charAt(a),a++):(u=i,v===0&&$(Qe));else o=i;return o!==i&&(A=t,o=ue(o)),t=o,t}function Os(){var t,o,u,p,m,M,w,K;if(t=a,f.charCodeAt(a)===91?(o=Ne,a++):(o=i,v===0&&$(_e)),o!==i)if(u=ae(),u!==i){for(p=[],m=C();m!==i;)p.push(m),m=C();if(p!==i)if(f.substr(a,2)===se?(m=se,a+=2):(m=i,v===0&&$(Be)),m!==i){if(M=[],w=C(),w!==i)for(;w!==i;)M.push(w),w=C();else M=i;M!==i?(w=ae(),w!==i?(f.charCodeAt(a)===93?(K=Se,a++):(K=i,v===0&&$(he)),K!==i?(A=t,o=Wt(u,w),t=o):(a=t,t=i)):(a=t,t=i)):(a=t,t=i)}else a=t,t=i;else a=t,t=i}else a=t,t=i;else a=t,t=i;if(t===i){if(t=a,f.charCodeAt(a)===123?(o=lt,a++):(o=i,v===0&&$(Ot)),o!==i)if(u=ae(),u!==i){for(p=[],m=C();m!==i;)p.push(m),m=C();if(p!==i)if(f.substr(a,2)===se?(m=se,a+=2):(m=i,v===0&&$(Be)),m!==i){if(M=[],w=C(),w!==i)for(;w!==i;)M.push(w),w=C();else M=i;M!==i?(w=ae(),w!==i?(f.charCodeAt(a)===125?(K=V,a++):(K=i,v===0&&$(Le)),K!==i?(A=t,o=Is(u,w),t=o):(a=t,t=i)):(a=t,t=i)):(a=t,t=i)}else a=t,t=i;else a=t,t=i}else a=t,t=i;else a=t,t=i;if(t===i){if(t=a,f.charCodeAt(a)===91?(o=Ne,a++):(o=i,v===0&&$(_e)),o!==i)if(u=ae(),u!==i){for(p=[],m=C();m!==i;)p.push(m),m=C();if(p!==i)if(f.substr(a,2)===se?(m=se,a+=2):(m=i,v===0&&$(Be)),m!==i){if(M=[],w=C(),w!==i)for(;w!==i;)M.push(w),w=C();else M=i;M!==i?(w=ae(),w!==i?(f.charCodeAt(a)===125?(K=V,a++):(K=i,v===0&&$(Le)),K!==i?(A=t,o=As(u,w),t=o):(a=t,t=i)):(a=t,t=i)):(a=t,t=i)}else a=t,t=i;else a=t,t=i}else a=t,t=i;else a=t,t=i;if(t===i)if(t=a,f.charCodeAt(a)===123?(o=lt,a++):(o=i,v===0&&$(Ot)),o!==i)if(u=ae(),u!==i){for(p=[],m=C();m!==i;)p.push(m),m=C();if(p!==i)if(f.substr(a,2)===se?(m=se,a+=2):(m=i,v===0&&$(Be)),m!==i){if(M=[],w=C(),w!==i)for(;w!==i;)M.push(w),w=C();else M=i;M!==i?(w=ae(),w!==i?(f.charCodeAt(a)===93?(K=Se,a++):(K=i,v===0&&$(he)),K!==i?(A=t,o=ye(u,w),t=o):(a=t,t=i)):(a=t,t=i)):(a=t,t=i)}else a=t,t=i;else a=t,t=i}else a=t,t=i;else a=t,t=i}}return t}function fe(){var t,o,u,p,m;for(t=a,o=[],u=C();u!==i;)o.push(u),u=C();if(o!==i)if(u=us(),u!==i){if(p=[],m=C(),m!==i)for(;m!==i;)p.push(m),m=C();else p=i;p!==i?(A=t,o=R(u),t=o):(a=t,t=i)}else a=t,t=i;else a=t,t=i;if(t===i){for(t=a,o=[],u=C();u!==i;)o.push(u),u=C();o!==i?(u=us(),u!==i?(p=Ft(),p!==i?(A=t,o=R(u),t=o):(a=t,t=i)):(a=t,t=i)):(a=t,t=i)}return t}function us(){var t;return f.substr(a,6)===je?(t=je,a+=6):(t=i,v===0&&$(we)),t===i&&(f.substr(a,7)===gt?(t=gt,a+=7):(t=i,v===0&&$(zt)),t===i&&(f.substr(a,2)===Ht?(t=Ht,a+=2):(t=i,v===0&&$(Ut)),t===i&&(f.substr(a,3)===Ce?(t=Ce,a+=3):(t=i,v===0&&$(re)),t===i&&(f.substr(a,3)===ke?(t=ke,a+=3):(t=i,v===0&&$(ws)),t===i&&(f.substr(a,2)===Gt?(t=Gt,a+=2):(t=i,v===0&&$(Cs)),t===i&&(f.substr(a,2)===Yt?(t=Yt,a+=2):(t=i,v===0&&$(qe)))))))),t}function $t(){var t,o,u;for(t=a,o=[],u=C();u!==i;)o.push(u),u=C();return o!==i?(u=Vs(),u!==i?(A=t,o=R(u),t=o):(a=t,t=i)):(a=t,t=i),t}function Vs(){var t;return f.charCodeAt(a)===43?(t=Ve,a++):(t=i,v===0&&$(rt)),t===i&&(f.charCodeAt(a)===45?(t=Re,a++):(t=i,v===0&&$(it)),t===i&&(f.charCodeAt(a)===33?(t=nt,a++):(t=i,v===0&&$(at)))),t}function C(){var t,o;if(v++,t=[],Kt.test(f.charAt(a))?(o=f.charAt(a),a++):(o=i,v===0&&$(Zt)),o!==i)for(;o!==i;)t.push(o),Kt.test(f.charAt(a))?(o=f.charAt(a),a++):(o=i,v===0&&$(Zt));else t=i;return v--,t===i&&(o=i,v===0&&$(ve)),t}function Ft(){var t,o;return t=a,v++,f.length>a?(o=f.charAt(a),a++):(o=i,v===0&&$(Fe)),v--,o===i?t=void 0:(a=t,t=i),t}if(ze=G(),ze!==i&&a===f.length)return ze;throw ze!==i&&a<f.length&&$(Jt()),Xt(pt,J<f.length?f.charAt(J):null,J<f.length?de(J,J+1):de(J,J))}be.exports={SyntaxError:y,parse:x}},20559:be=>{"use strict";var B="<implicit>";be.exports=function y(x){if(!x)return"";var f="";return x.start!=null&&(f+=(x.parenthesized?"(":"")+x.start+" "),x.field&&x.field!==B&&(f+=x.field+":"),x.left&&(x.parenthesized&&!x.start&&(f+="("),f+=y(x.left),x.parenthesized&&!x.right&&(f+=")")),x.operator&&(x.left&&(f+=" "),x.operator!==B&&(f+=x.operator)),x.right&&(x.operator&&x.operator!==B&&(f+=" "),f+=y(x.right),x.parenthesized&&(f+=")")),(x.term||x.term===""&&x.quoted)&&(x.prefix&&(f+=x.prefix),x.quoted?(f+='"',f+=x.term,f+='"'):x.regex?(f+="/",f+=x.term,f+="/"):f+=x.term,x.proximity!=null&&(f+="~"+x.proximity),x.boost!=null&&(f+="^"+x.boost)),x.term_min&&(x.inclusive==="both"||x.inclusive==="left"?f+="[":f+="{",f+=x.term_min,f+=" TO ",f+=x.term_max,x.inclusive==="both"||x.inclusive==="right"?f+="]":f+="}"),x.similarity&&(f+="~",x.similarity!==.5&&(f+=x.similarity)),f}}}]);

//# sourceMappingURL=8747.9dc9b5261321f82d3824.js.map