"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1036],{31084:(z,v,e)=>{e.d(v,{Y:()=>A});var O=e(96540),t=e(41053),r=e(10096),M=e(31678),D=e(37425),f=e(85927);const A=({teamId:E,roleOptions:c,disabled:s,roles:m,onApplyRoles:P,pendingRoles:d,apply:I=!1,maxWidth:S,width:K,isLoading:L})=>{const[{loading:y,value:g=m||[]},u]=(0,t.A)(async()=>{try{if(m)return m;if(I&&d?.length)return d;if(r.contextSrv.hasPermission(M.AccessControlAction.ActionTeamsRolesList)&&E>0)return await(0,f.xN)(E)}catch(p){console.error("Error loading options",p)}return[]},[E,d,m]);(0,O.useEffect)(()=>{u()},[u]);const B=async p=>{I?P&&P(p):(await(0,f.G3)(p,E),await u())},C=r.contextSrv.hasPermission(M.AccessControlAction.ActionTeamsRolesAdd)&&r.contextSrv.hasPermission(M.AccessControlAction.ActionTeamsRolesRemove);return O.createElement(D.n,{apply:I,onRolesChange:B,roleOptions:c,appliedRoles:g,isLoading:y||L,disabled:s,basicRoleDisabled:!0,canUpdateRoles:C,maxWidth:S,width:K})}},52576:(z,v,e)=>{e.r(v),e.d(v,{TeamList:()=>G,default:()=>W});var O=e(32196),t=e(96540),r=e(70255),M=e(71468),D=e(40845),f=e(12942),A=e(72109),E=e(67061),c=e(55852),s=e(91605),m=e(69529),P=e(14186),d=e(67647),I=e(48840),S=e(19384),K=e(67608),L=e(85927),y=e(8484),g=e(16233),u=e(31678),B=e(31084),C=e(33667);const p=new Array(3).fill(null).map((_,h)=>({id:h,memberCount:0,name:"",orgId:0,permission:0})),G=({teams:_,query:h,noTeams:x,hasFetched:T,loadTeams:$,deleteTeam:U,changeQuery:H,totalPages:X,page:Z,rolesLoading:Q,changePage:w,changeSort:F})=>{const[V,k]=(0,t.useState)([]),N=(0,D.of)(b);(0,t.useEffect)(()=>{$(!0)},[$]),(0,t.useEffect)(()=>{g.TP.licensedAccessControlEnabled()&&g.TP.hasPermission(u.AccessControlAction.ActionRolesList)&&(0,L.RL)().then(i=>k(i))},[]);const Y=g.TP.hasPermission(u.AccessControlAction.ActionTeamsCreate),J=a(),q=(0,t.useMemo)(()=>[{id:"avatarUrl",header:"",disableGrow:!0,cell:({cell:{value:i}})=>T?i&&t.createElement(f.e,{src:i,alt:"User avatar"}):t.createElement(r.A,{containerClassName:N.blockSkeleton,width:24,height:24,circle:!0})},{id:"name",header:"Name",cell:({cell:{value:i},row:{original:R}})=>T?g.TP.hasPermissionInMetadata(u.AccessControlAction.ActionTeamsRead,R)?t.createElement(A.Y,{color:"primary",inline:!1,href:`/org/teams/edit/${R.id}`,title:"Edit team"},i):i:t.createElement(r.A,{width:100}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:i}})=>T?i:t.createElement(r.A,{width:60}),sortType:"string"},{id:"memberCount",header:"Members",disableGrow:!0,cell:({cell:{value:i}})=>T?i:t.createElement(r.A,{width:40}),sortType:"number"},...J?[{id:"role",header:"Role",cell:({cell:{value:i},row:{original:R}})=>T?g.TP.hasPermissionInMetadata(u.AccessControlAction.ActionTeamsRolesList,R)&&t.createElement(B.Y,{teamId:R.id,roles:R.roles||[],isLoading:Q,roleOptions:V,width:40}):t.createElement(r.A,{width:320,height:32,containerClassName:N.blockSkeleton})}]:[],{id:"actions",header:"",disableGrow:!0,cell:({row:{original:i}})=>{if(!T)return t.createElement(E.B,{direction:"row",justifyContent:"flex-end",alignItems:"center"},t.createElement(r.A,{containerClassName:N.blockSkeleton,width:16,height:16}),t.createElement(r.A,{containerClassName:N.blockSkeleton,width:22,height:24}));const R=g.TP.hasPermissionInMetadata(u.AccessControlAction.ActionTeamsRead,i),j=g.TP.hasPermissionInMetadata(u.AccessControlAction.ActionTeamsDelete,i);return t.createElement(E.B,{direction:"row",justifyContent:"flex-end",gap:2},R&&t.createElement(c.z9,{href:`org/teams/edit/${i.id}`,"aria-label":`Edit team ${i.name}`,icon:"pen",size:"sm",variant:"secondary",tooltip:"Edit team"}),t.createElement(s.e,{"aria-label":`Delete team ${i.name}`,size:"sm",disabled:!j,onConfirm:()=>U(i.id)}))}}],[J,T,Q,V,U,N]);return t.createElement(K.Y,{navId:"teams",actions:x?void 0:t.createElement(c.z9,{href:Y?"org/teams/new":"#",disabled:!Y},"New Team")},t.createElement(K.Y.Contents,null,x?t.createElement(m.p,{variant:"call-to-action",button:t.createElement(c.z9,{disabled:!Y,href:"org/teams/new",icon:"users-alt",size:"lg"},t.createElement(y.x6,{i18nKey:"teams.empty-state.button-title"},"New team")),message:(0,y.t)("teams.empty-state.title","You haven't created any teams yet")},t.createElement(y.x6,{i18nKey:"teams.empty-state.pro-tip"},"Assign folder and dashboard permissions to teams instead of users to ease administration."," ",t.createElement(A.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/team-management"},"Learn more"))):t.createElement(t.Fragment,null,t.createElement("div",{className:"page-action-bar"},t.createElement(P.I,{grow:!0},t.createElement(d.Z,{placeholder:"Search teams",value:h,onChange:H}))),T&&_.length===0?t.createElement(m.p,{variant:"not-found",message:(0,y.t)("teams.empty-state.message","No teams found")}):t.createElement(E.B,{direction:"column",gap:2},t.createElement(I.j,{columns:q,data:T?_:p,getRowId:i=>String(i.id),fetchData:F}),t.createElement(E.B,{justifyContent:"flex-end"},t.createElement(S.d,{hideWhenSinglePage:!0,currentPage:Z,numberOfPages:X,onNavigate:w}))))))};function a(){return g.TP.licensedAccessControlEnabled()&&g.TP.hasPermission(u.AccessControlAction.ActionTeamsRolesList)&&g.TP.hasPermission(u.AccessControlAction.ActionRolesList)}function n(_){return{teams:_.teams.teams,query:_.teams.query,perPage:_.teams.perPage,page:_.teams.page,noTeams:_.teams.noTeams,totalPages:_.teams.totalPages,hasFetched:_.teams.hasFetched,rolesLoading:_.teams.rolesLoading}}const o={loadTeams:C.Bu,deleteTeam:C.To,changePage:C.yd,changeQuery:C.nM,changeSort:C.Vk},W=(0,M.connect)(n,o)(G),b=_=>({blockSkeleton:(0,O.css)({lineHeight:1,display:"flex"})})},33667:(z,v,e)=>{e.d(v,{Bu:()=>s,It:()=>C,To:()=>d,Vk:()=>K,aK:()=>B,eo:()=>P,n7:()=>u,nC:()=>p,nM:()=>I,yd:()=>S});var O=e(2543),t=e.n(O),r=e(17172),M=e(82467),D=e(10096),f=e(80714),A=e(31678),E=e(78319),c=e(34655);function s(a=!1){return async(n,o)=>{const{query:l,page:W,perPage:b,sort:_}=o().teams;if(!D.contextSrv.hasPermission(A.AccessControlAction.ActionTeamsRead)){n((0,c.Q9)({teams:[],totalCount:0,page:1,perPage:b,noTeams:!0}));return}const h=await(0,r.AI)().get("/api/teams/search",(0,f.F)({query:l,page:W,perpage:b,sort:_}));let x=!1;if(a&&(x=h.teams.length===0),D.contextSrv.licensedAccessControlEnabled()&&D.contextSrv.hasPermission(A.AccessControlAction.ActionTeamsRolesList)){n((0,c.dJ)());const T=h?.teams.map(U=>U.id),$=await(0,r.AI)().post("/api/access-control/teams/roles/search",{teamIds:T});h.teams.forEach(U=>{U.roles=$?$[U.id]||[]:[]}),n((0,c.jE)())}n((0,c.Q9)({noTeams:x,...h}))}}const m=(0,O.debounce)(a=>a(s()),500);function P(a){return async n=>{const o=await(0,r.AI)().get(`/api/teams/${a}`,(0,f.F)());n((0,c.$T)(o)),n((0,M.Vz)((0,E.R)(o)))}}function d(a){return async n=>{await(0,r.AI)().delete(`/api/teams/${a}`),await D.contextSrv.fetchUserPermissions(),n(s())}}function I(a){return async n=>{n((0,c.L5)(a)),m(n)}}function S(a){return async n=>{n((0,c.EC)(a)),n(s())}}function K({sortBy:a}){const n=a.length?`${a[0].id}-${a[0].desc?"desc":"asc"}`:void 0;return async o=>{o((0,c.$u)(n)),o(s())}}function L(){return async(a,n)=>{const o=n().team.team,l=await getBackendSrv().get(`/api/teams/${o.id}/members`);a(teamMembersLoaded(l))}}function y(a){return async(n,o)=>{const l=o().team.team;await getBackendSrv().post(`/api/teams/${l.id}/members`,{userId:a}),n(L())}}function g(a){return async(n,o)=>{const l=o().team.team;await getBackendSrv().delete(`/api/teams/${l.id}/members/${a}`),n(L())}}function u(a,n){return async(o,l)=>{const W=l().team.team;await(0,r.AI)().put(`/api/teams/${W.id}`,{name:a,email:n}),o(P(W.id))}}function B(){return async(a,n)=>{const o=n().team.team,l=await(0,r.AI)().get(`/api/teams/${o.id}/groups`);a((0,c.tC)(l))}}function C(a){return async(n,o)=>{const l=o().team.team;await(0,r.AI)().post(`/api/teams/${l.id}/groups`,{groupId:a}),n(B())}}function p(a){return async(n,o)=>{const l=o().team.team;await(0,r.AI)().delete(`/api/teams/${l.id}/groups?groupId=${encodeURIComponent(a)}`),n(B())}}function G(a){return async n=>{await getBackendSrv().put(`/api/teams/${a.teamId}/members/${a.userId}`,{permission:a.permission}),n(L())}}},78319:(z,v,e)=>{e.d(v,{R:()=>E,X:()=>c});var O=e(33378),t=e(76323),r=e(2913),M=e(16233),D=e(35538),f=e(31678);const A={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:f.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function E(s){const m={img:s.avatarUrl,id:"team-"+s.id,subTitle:"Manage members and settings",url:"",text:s.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${s.id}`,text:"Settings",url:`org/teams/edit/${s.id}/settings`}]};(s===A||M.TP.hasPermissionInMetadata(f.AccessControlAction.ActionTeamsPermissionsRead,s))&&m.children.unshift({active:!1,icon:"users-alt",id:`team-members-${s.id}`,text:"Members",url:`org/teams/edit/${s.id}/members`});const P={active:!1,icon:"sync",id:`team-groupsync-${s.id}`,text:"External group sync",url:`org/teams/edit/${s.id}/groupsync`},d=s===A;return(0,D.z5)()&&(P.tabSuffix=()=>(0,t.J)({experimentId:d?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,O.a)("teamsync")?(d||M.TP.hasPermissionInMetadata(f.AccessControlAction.ActionTeamsPermissionsRead,s))&&m.children.push(P):r.Ay.featureToggles.featureHighlights&&m.children.push({...P,tabSuffix:()=>(0,t.J)({experimentId:d?"":"feature-highlights-team-sync-badge"})}),m}function c(s){const m=E(A);let P;for(const d of m.children)if(d.id.indexOf(s)>0){d.active=!0,P=d;break}return{main:m,node:P}}}}]);

//# sourceMappingURL=TeamList.6438727f90f6b9a2f63d.js.map